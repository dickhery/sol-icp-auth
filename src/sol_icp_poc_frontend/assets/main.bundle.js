var ta=Object.defineProperty;var ea=(e,t)=>{for(var r in t)ta(e,r,{get:t[r],enumerable:!0})};var Fo;(function(e){e[e.SysFatal=1]="SysFatal",e[e.SysTransient=2]="SysTransient",e[e.DestinationInvalid=3]="DestinationInvalid",e[e.CanisterReject=4]="CanisterReject",e[e.CanisterError=5]="CanisterError"})(Fo||(Fo={}));var Se;(function(e){e.Replied="replied",e.Rejected="rejected"})(Se||(Se={}));function Vo(e){return e!=null&&"reject_code"in e}function $o(e){return e!=null&&"certificate"in e}var vn="abcdefghijklmnopqrstuvwxyz234567",mr=Object.create(null);for(let e=0;e<vn.length;e++)mr[vn[e]]=e;mr[0]=mr.o;mr[1]=mr.i;function jo(e){let t=0,r=0,n="";function s(o){return t<0?r|=o>>-t:r=o<<t&248,t>3?(t-=8,1):(t<4&&(n+=vn[r>>3],t+=5),0)}for(let o=0;o<e.length;)o+=s(e[o]);return n+(t<0?vn[r>>3]:"")}function Ho(e){let t=0,r=0,n=new Uint8Array(e.length*4/3|0),s=0;function o(i){let c=mr[i.toLowerCase()];if(c===void 0)throw new Error(`Invalid character: ${JSON.stringify(i)}`);c<<=3,r|=c>>>t,t+=5,t>=8&&(n[s++]=r,t-=8,t>0?r=c<<5-t&255:r=0)}for(let i of e)o(i);return n.slice(0,s)}var ra=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function Ko(e){let t=-1;for(let r=0;r<e.length;r++){let s=(e[r]^t)&255;t=ra[s]^t>>>8}return(t^-1)>>>0}var Ke=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function te(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Ss(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function nt(e,...t){if(!te(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function As(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Zo(e,t){nt(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Ge(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Tn(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Vt(e,t){return e<<32-t|e>>>t}var Yo=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",na=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function K(e){if(nt(e),Yo)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=na[e[r]];return t}var ie={_0:48,_9:57,A:65,F:70,a:97,f:102};function Go(e){if(e>=ie._0&&e<=ie._9)return e-ie._0;if(e>=ie.A&&e<=ie.F)return e-(ie.A-10);if(e>=ie.a&&e<=ie.f)return e-(ie.a-10)}function $t(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(Yo)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let s=0,o=0;s<r;s++,o+=2){let i=Go(e.charCodeAt(o)),c=Go(e.charCodeAt(o+1));if(i===void 0||c===void 0){let a=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+o)}n[s]=i*16+c}return n}function z(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Os(e){return typeof e=="string"&&(e=z(e)),nt(e),e}function F(...e){let t=0;for(let n=0;n<e.length;n++){let s=e[n];nt(s),t+=s.length}let r=new Uint8Array(t);for(let n=0,s=0;n<e.length;n++){let o=e[n];r.set(o,s),s+=o.length}return r}var In=class{};function Sn(e){let t=n=>e().update(Os(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function yr(e=32){if(Ke&&typeof Ke.getRandomValues=="function")return Ke.getRandomValues(new Uint8Array(e));if(Ke&&typeof Ke.randomBytes=="function")return Uint8Array.from(Ke.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function sa(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let s=BigInt(32),o=BigInt(4294967295),i=Number(r>>s&o),c=Number(r&o),a=n?4:0,u=n?0:4;e.setUint32(t+a,i,n),e.setUint32(t+u,c,n)}function Xo(e,t,r){return e&t^~e&r}function zo(e,t,r){return e&t^e&r^t&r}var Fr=class extends In{constructor(t,r,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(t),this.view=Tn(this.buffer)}update(t){As(this),t=Os(t),nt(t);let{view:r,buffer:n,blockLen:s}=this,o=t.length;for(let i=0;i<o;){let c=Math.min(s-this.pos,o-i);if(c===s){let a=Tn(t);for(;s<=o-i;i+=s)this.process(a,i);continue}n.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){As(this),Zo(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:s,isLE:o}=this,{pos:i}=this;r[i++]=128,Ge(this.buffer.subarray(i)),this.padOffset>s-i&&(this.process(n,0),i=0);for(let d=i;d<s;d++)r[d]=0;sa(n,s-8,BigInt(this.length*8),o),this.process(n,0);let c=Tn(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=a/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)c.setUint32(4*d,h[d],o)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:s,finished:o,destroyed:i,pos:c}=this;return t.destroyed=i,t.finished=o,t.length=s,t.pos=c,s%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},ce=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ae=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]);var yt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var An=BigInt(4294967295),Wo=BigInt(32);function oa(e,t=!1){return t?{h:Number(e&An),l:Number(e>>Wo&An)}:{h:Number(e>>Wo&An)|0,l:Number(e&An)|0}}function Qo(e,t=!1){let r=e.length,n=new Uint32Array(r),s=new Uint32Array(r);for(let o=0;o<r;o++){let{h:i,l:c}=oa(e[o],t);[n[o],s[o]]=[i,c]}return[n,s]}var Cs=(e,t,r)=>e>>>r,Rs=(e,t,r)=>e<<32-r|t>>>r,Ze=(e,t,r)=>e>>>r|t<<32-r,Ye=(e,t,r)=>e<<32-r|t>>>r,Vr=(e,t,r)=>e<<64-r|t>>>r-32,$r=(e,t,r)=>e>>>r-32|t<<64-r;function ee(e,t,r,n){let s=(t>>>0)+(n>>>0);return{h:e+r+(s/2**32|0)|0,l:s|0}}var Jo=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),ti=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,ei=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),ri=(e,t,r,n,s)=>t+r+n+s+(e/2**32|0)|0,ni=(e,t,r,n,s)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(s>>>0),si=(e,t,r,n,s,o)=>t+r+n+s+o+(e/2**32|0)|0;var ca=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ae=new Uint32Array(64),On=class extends Fr{constructor(t=32){super(64,t,8,!1),this.A=ce[0]|0,this.B=ce[1]|0,this.C=ce[2]|0,this.D=ce[3]|0,this.E=ce[4]|0,this.F=ce[5]|0,this.G=ce[6]|0,this.H=ce[7]|0}get(){let{A:t,B:r,C:n,D:s,E:o,F:i,G:c,H:a}=this;return[t,r,n,s,o,i,c,a]}set(t,r,n,s,o,i,c,a){this.A=t|0,this.B=r|0,this.C=n|0,this.D=s|0,this.E=o|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,r){for(let d=0;d<16;d++,r+=4)Ae[d]=t.getUint32(r,!1);for(let d=16;d<64;d++){let f=Ae[d-15],l=Ae[d-2],p=Vt(f,7)^Vt(f,18)^f>>>3,b=Vt(l,17)^Vt(l,19)^l>>>10;Ae[d]=b+Ae[d-7]+p+Ae[d-16]|0}let{A:n,B:s,C:o,D:i,E:c,F:a,G:u,H:h}=this;for(let d=0;d<64;d++){let f=Vt(c,6)^Vt(c,11)^Vt(c,25),l=h+f+Xo(c,a,u)+ca[d]+Ae[d]|0,b=(Vt(n,2)^Vt(n,13)^Vt(n,22))+zo(n,s,o)|0;h=u,u=a,a=c,c=i+l|0,i=o,o=s,s=n,n=l+b|0}n=n+this.A|0,s=s+this.B|0,o=o+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(n,s,o,i,c,a,u,h)}roundClean(){Ge(Ae)}destroy(){this.set(0,0,0,0,0,0,0,0),Ge(this.buffer)}},Ns=class extends On{constructor(){super(28),this.A=ae[0]|0,this.B=ae[1]|0,this.C=ae[2]|0,this.D=ae[3]|0,this.E=ae[4]|0,this.F=ae[5]|0,this.G=ae[6]|0,this.H=ae[7]|0}},oi=Qo(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),aa=oi[0],fa=oi[1],Oe=new Uint32Array(80),Ce=new Uint32Array(80),Us=class extends Fr{constructor(t=64){super(128,t,16,!1),this.Ah=yt[0]|0,this.Al=yt[1]|0,this.Bh=yt[2]|0,this.Bl=yt[3]|0,this.Ch=yt[4]|0,this.Cl=yt[5]|0,this.Dh=yt[6]|0,this.Dl=yt[7]|0,this.Eh=yt[8]|0,this.El=yt[9]|0,this.Fh=yt[10]|0,this.Fl=yt[11]|0,this.Gh=yt[12]|0,this.Gl=yt[13]|0,this.Hh=yt[14]|0,this.Hl=yt[15]|0}get(){let{Ah:t,Al:r,Bh:n,Bl:s,Ch:o,Cl:i,Dh:c,Dl:a,Eh:u,El:h,Fh:d,Fl:f,Gh:l,Gl:p,Hh:b,Hl:g}=this;return[t,r,n,s,o,i,c,a,u,h,d,f,l,p,b,g]}set(t,r,n,s,o,i,c,a,u,h,d,f,l,p,b,g){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=s|0,this.Ch=o|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=u|0,this.El=h|0,this.Fh=d|0,this.Fl=f|0,this.Gh=l|0,this.Gl=p|0,this.Hh=b|0,this.Hl=g|0}process(t,r){for(let y=0;y<16;y++,r+=4)Oe[y]=t.getUint32(r),Ce[y]=t.getUint32(r+=4);for(let y=16;y<80;y++){let _=Oe[y-15]|0,v=Ce[y-15]|0,I=Ze(_,v,1)^Ze(_,v,8)^Cs(_,v,7),T=Ye(_,v,1)^Ye(_,v,8)^Rs(_,v,7),A=Oe[y-2]|0,E=Ce[y-2]|0,S=Ze(A,E,19)^Vr(A,E,61)^Cs(A,E,6),U=Ye(A,E,19)^$r(A,E,61)^Rs(A,E,6),C=ei(T,U,Ce[y-7],Ce[y-16]),x=ri(C,I,S,Oe[y-7],Oe[y-16]);Oe[y]=x|0,Ce[y]=C|0}let{Ah:n,Al:s,Bh:o,Bl:i,Ch:c,Cl:a,Dh:u,Dl:h,Eh:d,El:f,Fh:l,Fl:p,Gh:b,Gl:g,Hh:m,Hl:w}=this;for(let y=0;y<80;y++){let _=Ze(d,f,14)^Ze(d,f,18)^Vr(d,f,41),v=Ye(d,f,14)^Ye(d,f,18)^$r(d,f,41),I=d&l^~d&b,T=f&p^~f&g,A=ni(w,v,T,fa[y],Ce[y]),E=si(A,m,_,I,aa[y],Oe[y]),S=A|0,U=Ze(n,s,28)^Vr(n,s,34)^Vr(n,s,39),C=Ye(n,s,28)^$r(n,s,34)^$r(n,s,39),x=n&o^n&c^o&c,B=s&i^s&a^i&a;m=b|0,w=g|0,b=l|0,g=p|0,l=d|0,p=f|0,{h:d,l:f}=ee(u|0,h|0,E|0,S|0),u=c|0,h=a|0,c=o|0,a=i|0,o=n|0,i=s|0;let R=Jo(S,C,B);n=ti(R,E,U,x),s=R|0}({h:n,l:s}=ee(this.Ah|0,this.Al|0,n|0,s|0)),{h:o,l:i}=ee(this.Bh|0,this.Bl|0,o|0,i|0),{h:c,l:a}=ee(this.Ch|0,this.Cl|0,c|0,a|0),{h:u,l:h}=ee(this.Dh|0,this.Dl|0,u|0,h|0),{h:d,l:f}=ee(this.Eh|0,this.El|0,d|0,f|0),{h:l,l:p}=ee(this.Fh|0,this.Fl|0,l|0,p|0),{h:b,l:g}=ee(this.Gh|0,this.Gl|0,b|0,g|0),{h:m,l:w}=ee(this.Hh|0,this.Hl|0,m|0,w|0),this.set(n,s,o,i,c,a,u,h,d,f,l,p,b,g,m,w)}roundClean(){Ge(Oe,Ce)}destroy(){Ge(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var gt=Sn(()=>new On),ii=Sn(()=>new Ns),ci=Sn(()=>new Us);var Cn="__principal__",ua=2,ai=4,da="aaaaa-aa",H=class e{static anonymous(){return new this(new Uint8Array([ai]))}static managementCanister(){return this.fromText(da)}static selfAuthenticating(t){let r=ii(t);return new this(new Uint8Array([...r,ua]))}static from(t){if(typeof t=="string")return e.fromText(t);if(Object.getPrototypeOf(t)===Uint8Array.prototype)return new e(t);if(e.isPrincipal(t))return new e(t._arr);throw new Error(`Impossible to convert ${JSON.stringify(t)} to Principal.`)}static fromHex(t){return new this($t(t))}static fromText(t){let r=t;if(t.includes(Cn)){let i=JSON.parse(t);Cn in i&&(r=i[Cn])}let n=r.toLowerCase().replace(/-/g,""),s=Ho(n);s=s.slice(4,s.length);let o=new this(s);if(o.toText()!==r)throw new Error(`Principal "${o.toText()}" does not have a valid checksum (original value "${r}" may not be a valid Principal ID).`);return o}static fromUint8Array(t){return new this(t)}static isPrincipal(t){return t instanceof e||typeof t=="object"&&t!==null&&"_isPrincipal"in t&&t._isPrincipal===!0&&"_arr"in t&&t._arr instanceof Uint8Array}constructor(t){this._arr=t,this._isPrincipal=!0}isAnonymous(){return this._arr.byteLength===1&&this._arr[0]===ai}toUint8Array(){return this._arr}toHex(){return K(this._arr).toUpperCase()}toText(){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,Ko(this._arr));let n=new Uint8Array(t),s=new Uint8Array([...n,...this._arr]),i=jo(s).match(/.{1,5}/g);if(!i)throw new Error;return i.join("-")}toString(){return this.toText()}toJSON(){return{[Cn]:this.toText()}}compareTo(t){for(let r=0;r<Math.min(this._arr.length,t._arr.length);r++){if(this._arr[r]<t._arr[r])return"lt";if(this._arr[r]>t._arr[r])return"gt"}return this._arr.length<t._arr.length?"lt":this._arr.length>t._arr.length?"gt":"eq"}ltEq(t){let r=this.compareTo(t);return r=="lt"||r=="eq"}gtEq(t){let r=this.compareTo(t);return r=="gt"||r=="eq"}};var fe;(function(e){e.Trust="Trust",e.Protocol="Protocol",e.Reject="Reject",e.Transport="Transport",e.External="External",e.Limit="Limit",e.Input="Input",e.Unknown="Unknown"})(fe||(fe={}));var $=class{constructor(t=!1){this.isCertified=t}toString(){let t=this.toErrorMessage();return this.requestContext&&(t+=`
Request context:
  Request ID (hex): ${this.requestContext.requestId?K(this.requestContext.requestId):"undefined"}
  Sender pubkey (hex): ${K(this.requestContext.senderPubKey)}
  Sender signature (hex): ${K(this.requestContext.senderSignature)}
  Ingress expiry: ${this.requestContext.ingressExpiry.toString()}`),this.callContext&&(t+=`
Call context:
  Canister ID: ${this.callContext.canisterId.toText()}
  Method name: ${this.callContext.methodName}
  HTTP details: ${JSON.stringify(this.callContext.httpDetails,null,2)}`),t}},jt=class e extends Error{get code(){return this.cause.code}set code(t){this.cause.code=t}get kind(){return this.cause.kind}set kind(t){this.cause.kind=t}get isCertified(){return this.code.isCertified}constructor(t,r){super(t.toString()),this.name="AgentError",this.cause={code:t,kind:r},Object.setPrototypeOf(this,e.prototype)}hasCode(t){return this.code instanceof t}toString(){return`${this.name} (${this.kind}): ${this.message}`}},ue=class extends jt{static fromCode(t){return new this(t)}},_t=class e extends ue{constructor(t){super(t,fe.Trust),this.name="TrustError",Object.setPrototypeOf(this,e.prototype)}},Q=class e extends ue{constructor(t){super(t,fe.Protocol),this.name="ProtocolError",Object.setPrototypeOf(this,e.prototype)}},Re=class e extends ue{constructor(t){super(t,fe.Reject),this.name="RejectError",Object.setPrototypeOf(this,e.prototype)}},jr=class e extends ue{constructor(t){super(t,fe.Transport),this.name="TransportError",Object.setPrototypeOf(this,e.prototype)}},at=class e extends ue{constructor(t){super(t,fe.External),this.name="ExternalError",Object.setPrototypeOf(this,e.prototype)}};var G=class e extends ue{constructor(t){super(t,fe.Input),this.name="InputError",Object.setPrototypeOf(this,e.prototype)}},lt=class e extends ue{constructor(t){super(t,fe.Unknown),this.name="UnknownError",Object.setPrototypeOf(this,e.prototype)}},Xe=class e extends ${constructor(t){super(),this.reason=t,this.name="CertificateVerificationErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Certificate verification error: "${this.reason}"`}},Hr=class e extends ${constructor(t,r,n,s){super(),this.maxAgeInMinutes=t,this.certificateTime=r,this.currentTime=n,this.ageType=s,this.name="CertificateTimeErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Certificate is signed more than ${this.maxAgeInMinutes} minutes in the ${this.ageType}. Certificate time: ${this.certificateTime.toISOString()} Current time: ${this.currentTime.toISOString()}`}},Rn=class e extends ${constructor(){super(),this.name="CertificateHasTooManyDelegationsErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return"Certificate has too many delegations"}},br=class e extends ${constructor(t,r){super(),this.canisterId=t,this.subnetId=r,this.name="CertificateNotAuthorizedErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`The certificate contains a delegation that does not include the canister ${this.canisterId.toText()} in the canister_ranges field. Subnet ID: 0x${K(this.subnetId)}`}},de=class e extends ${constructor(t,r){super(),this.message=t,this.lookupStatus=r,this.name="LookupErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`${this.message}. Lookup status: ${this.lookupStatus}`}},gr=class e extends ${constructor(t){super(),this.message=t,this.name="MalformedLookupFoundValueErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return this.message}},Nn=class e extends ${constructor(t){super(),this.message=t,this.name="MissingLookupValueErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return this.message}},xr=class e extends ${constructor(t,r){super(),this.expectedLength=t,this.actualLength=r,this.name="DerKeyLengthMismatchErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`BLS DER-encoded public key must be ${this.expectedLength} bytes long, but is ${this.actualLength} bytes long`}},Un=class e extends ${constructor(t,r){super(),this.expectedPrefix=t,this.actualPrefix=r,this.name="DerPrefixMismatchErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`BLS DER-encoded public key is invalid. Expected the following prefix: ${K(this.expectedPrefix)}, but got ${K(this.actualPrefix)}`}},qn=class e extends ${constructor(t,r){super(),this.expectedLength=t,this.actualLength=r,this.name="DerDecodeLengthMismatchErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`DER payload mismatch: Expected length ${this.expectedLength}, actual length: ${this.actualLength}`}},Ht=class e extends ${constructor(t){super(),this.error=t,this.name="DerDecodeErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Failed to decode DER: ${this.error}`}},Kr=class e extends ${constructor(t){super(),this.error=t,this.name="DerEncodeErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Failed to encode DER: ${this.error}`}},Ln=class e extends ${constructor(t,r){super(),this.error=t,this.input=r,this.name="CborDecodeErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Failed to decode CBOR: ${this.error}, input: ${K(this.input)}`}},Pn=class e extends ${constructor(t,r){super(),this.error=t,this.value=r,this.name="CborEncodeErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Failed to encode CBOR: ${this.error}, input: ${this.value}`}};var ze=class e extends ${constructor(t,r,n){super(),this.message=t,this.requestId=r,this.status=n,this.name="TimeoutWaitingForResponseErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){let t=`${this.message}
`;return this.requestId&&(t+=`  Request ID: ${K(this.requestId)}
`),this.status&&(t+=`  Request status: ${this.status}
`),t}},Dn=class e extends ${constructor(t,r,n){super(),this.maxIngressExpiryInMinutes=t,this.requestId=r,this.retryTimes=n,this.name="CertificateOutdatedErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){let t=`Certificate is stale (over ${this.maxIngressExpiryInMinutes} minutes). Is the computer's clock synchronized?
  Request ID: ${K(this.requestId)}
`;return this.retryTimes!==void 0&&(t+=`  Retried ${this.retryTimes} times.`),t}},We=class e extends ${constructor(t,r,n,s){super(!0),this.requestId=t,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=s,this.name="CertifiedRejectErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${K(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},Mn=class e extends ${constructor(t,r,n,s,o){super(),this.requestId=t,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=s,this.signatures=o,this.name="UncertifiedRejectErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${K(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},kn=class e extends ${constructor(t){super(),this.requestId=t,this.name="RequestStatusDoneNoReplyErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Call was marked as done but we never saw the reply:
  Request ID: ${K(this.requestId)}
`}},Kt=class e extends ${constructor(t){super(),this.shouldFetchRootKey=t,this.name="MissingRootKeyErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return this.shouldFetchRootKey===void 0?"Agent is missing root key":`Agent is missing root key and the shouldFetchRootKey value is set to ${this.shouldFetchRootKey}. The root key should only be unknown if you are in local development. Otherwise you should avoid fetching and use the default IC Root Key or the known root key of your environment.`}},Fn=class e extends ${constructor(t){super(),this.value=t,this.name="HashValueErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Attempt to hash a value of unsupported type: ${this.value}`}},wr=class e extends ${constructor(t){super(),this.error=t,this.name="HttpDefaultFetchErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return this.error}},Ne=class e extends ${constructor(){super(),this.name="IdentityInvalidErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return"This identity has expired due this application's security policy. Please refresh your authentication."}},Qe=class e extends ${constructor(t,r){super(),this.message=t,this.providedIngressExpiryInMinutes=r,this.name="IngressExpiryInvalidErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`${this.message}. Provided ingress expiry time is ${this.providedIngressExpiryInMinutes} minutes.`}},Vn=class e extends ${constructor(){super(),this.name="CreateHttpAgentErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return"Failed to create agent from provided agent"}},$n=class e extends ${constructor(t){super(),this.error=t,this.name="MalformedSignatureErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Query response contained a malformed signature: ${this.error}`}},Gr=class e extends ${constructor(){super(),this.name="MissingSignatureErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return"Query response did not contain any node signatures"}},jn=class e extends ${constructor(){super(),this.name="MalformedPublicKeyErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return"Read state response contained a malformed public key"}},Hn=class e extends ${constructor(t){super(),this.nodeId=t,this.name="QuerySignatureVerificationFailedErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Query signature verification failed. Node ID: ${this.nodeId}`}},Rt=class e extends ${constructor(t){super(),this.error=t,this.name="UnexpectedErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Unexpected error: ${this.error}`}},Ue=class e extends ${constructor(t){super(),this.error=t,this.name="HashTreeDecodeErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Failed to decode certificate: ${this.error}`}},Zr=class e extends ${constructor(t,r,n,s){super(),this.status=t,this.statusText=r,this.headers=n,this.bodyText=s,this.name="HttpErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){let t=`HTTP request failed:
  Status: ${this.status} (${this.statusText})
  Headers: ${JSON.stringify(this.headers)}
`;return this.bodyText&&(t+=`  Body: ${this.bodyText}
`),t}},Yr=class e extends ${constructor(){super(),this.name="HttpV3ApiNotSupportedErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return"HTTP request failed: v3 API is not supported"}},Xr=class e extends ${constructor(t){super(),this.error=t,this.name="HttpFetchErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Failed to fetch HTTP request: ${this.error}`}},zr=class e extends ${constructor(t){super(),this.receivedCanisterId=t,this.name="MissingCanisterIdErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Canister ID is required, but received ${typeof this.receivedCanisterId} instead. If you are using automatically generated declarations, this may be because your application is not setting the canister ID in process.env correctly.`}},Kn=class e extends ${constructor(t){super(),this.request=t,this.name="InvalidReadStateRequestErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Invalid read state request: ${this.request}`}},Wr=class e extends ${constructor(t){super(),this.error=t,this.name="ExpiryJsonDeserializeErrorCode",Object.setPrototypeOf(this,e.prototype)}toErrorMessage(){return`Failed to deserialize expiry: ${this.error}`}},qe=new Error("unreachable");var rr={};ea(rr,{Bool:()=>gi,BoolClass:()=>zn,ConstructType:()=>ne,Empty:()=>yi,EmptyClass:()=>Jr,FixedIntClass:()=>pe,FixedNatClass:()=>re,Float32:()=>Bi,Float64:()=>vi,FloatClass:()=>rn,Func:()=>Fi,FuncClass:()=>er,Int:()=>Ei,Int16:()=>Ti,Int32:()=>Si,Int64:()=>Ai,Int8:()=>Ii,IntClass:()=>tn,Nat:()=>_i,Nat16:()=>Ci,Nat32:()=>Ri,Nat64:()=>Ni,Nat8:()=>Oi,NatClass:()=>en,Null:()=>xi,NullClass:()=>Je,Opt:()=>Pi,OptClass:()=>De,PrimitiveType:()=>At,Principal:()=>Ui,PrincipalClass:()=>Jn,Rec:()=>ki,RecClass:()=>qt,Record:()=>Di,RecordClass:()=>tr,Reserved:()=>bi,ReservedClass:()=>se,Service:()=>Vi,ServiceClass:()=>vr,Text:()=>wi,TextClass:()=>Wn,Tuple:()=>qi,TupleClass:()=>Qn,Type:()=>Er,Unknown:()=>ma,UnknownClass:()=>Xn,Variant:()=>Mi,VariantClass:()=>Br,Vec:()=>Li,VecClass:()=>_r,Visitor:()=>ks,decode:()=>pa,encode:()=>ha,resetSubtypeCache:()=>Fs,subtype:()=>$s});function Z(...e){let t=new Uint8Array(e.reduce((n,s)=>n+s.byteLength,0)),r=0;for(let n of e)t.set(n,r),r+=n.byteLength;return t}var Gt=class{save(){return this._view}restore(t){if(!(t instanceof Uint8Array))throw new Error("Checkpoint must be a Uint8Array");this._view=t}constructor(t,r=t?.byteLength||0){if(t&&!(t instanceof Uint8Array))try{t=fi(t)}catch{throw new Error("Buffer must be a Uint8Array")}if(r<0||!Number.isInteger(r))throw new Error("Length must be a non-negative integer");if(t&&r>t.byteLength)throw new Error("Length cannot exceed buffer length");this._buffer=t||new Uint8Array(0),this._view=new Uint8Array(this._buffer.buffer,0,r)}get buffer(){return this._view.slice()}get byteLength(){return this._view.byteLength}read(t){let r=this._view.subarray(0,t);return this._view=this._view.subarray(t),r.slice()}readUint8(){if(this._view.byteLength===0)return;let t=this._view[0];return this._view=this._view.subarray(1),t}write(t){if(!(t instanceof Uint8Array))throw new Error("Buffer must be a Uint8Array");let r=this._view.byteLength;this._view.byteOffset+this._view.byteLength+t.byteLength>=this._buffer.byteLength?this.alloc(t.byteLength):this._view=new Uint8Array(this._buffer.buffer,this._view.byteOffset,this._view.byteLength+t.byteLength),this._view.set(t,r)}get end(){return this._view.byteLength===0}alloc(t){if(t<=0||!Number.isInteger(t))throw new Error("Amount must be a positive integer");let r=new Uint8Array((this._buffer.byteLength+t)*1.2|0),n=new Uint8Array(r.buffer,0,this._view.byteLength+t);n.set(this._view),this._buffer=r,this._view=n}};function fi(e){if(!e)throw new Error("Input cannot be null or undefined");return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?new Uint8Array(e):"buffer"in e?fi(e.buffer):new Uint8Array(e)}function ui(e,t){if(e.byteLength!==t.byteLength)return e.byteLength-t.byteLength;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]-t[r];return 0}function di(e){if(!(e instanceof Uint8Array))throw new Error("Input must be a Uint8Array");return new DataView(e.buffer,e.byteOffset,e.byteLength)}function la(e){let r=new TextEncoder().encode(e),n=0;for(let s of r)n=(n*223+s)%2**32;return n}function Bt(e){if(/^_\d+_$/.test(e)||/^_0x[0-9a-fA-F]+_$/.test(e)){let t=+e.slice(1,-1);if(Number.isSafeInteger(t)&&t>=0&&t<2**32)return t}return la(e)}function qs(e){let t=BigInt(e);if(e<=0)throw new RangeError("Input must be positive");return t.toString(2).length-1}function Gn(e){let t=BigInt(e);if(e<0)throw new RangeError("Input must be non-negative");return BigInt(1)<<t}function li(){throw new Error("unexpected end of buffer")}function Pe(e,t){return e.byteLength<t&&li(),e.read(t)}function Le(e){let t=e.readUint8();return t===void 0&&li(),t}function J(e){if(typeof e=="number"&&(e=BigInt(e)),e<BigInt(0))throw new Error("Cannot leb encode negative values.");let t=(e===BigInt(0)?0:qs(e))+1,r=new Gt(new Uint8Array(t),0);for(;;){let n=Number(e&BigInt(127));if(e/=BigInt(128),e===BigInt(0)){r.write(new Uint8Array([n]));break}else r.write(new Uint8Array([n|128]))}return r.buffer}function ot(e){let t=BigInt(1),r=BigInt(0),n;do n=Le(e),r+=BigInt(n&127).valueOf()*t,t*=BigInt(128);while(n>=128);return r}function it(e){typeof e=="number"&&(e=BigInt(e));let t=e<BigInt(0);t&&(e=-e-BigInt(1));let r=(e===BigInt(0)?0:qs(e))+1,n=new Gt(new Uint8Array(r),0);for(;;){let o=s(e);if(e/=BigInt(128),t&&e===BigInt(0)&&(o&64)!==0||!t&&e===BigInt(0)&&(o&64)===0){n.write(new Uint8Array([o]));break}else n.write(new Uint8Array([o|128]))}function s(o){let i=o%BigInt(128);return Number(t?BigInt(128)-i-BigInt(1):i)}return n.buffer}function le(e){let t=new Uint8Array(e.buffer),r=0;for(;r<t.byteLength;r++)if(t[r]<128){if((t[r]&64)===0)return ot(e);break}let n=new Uint8Array(Pe(e,r+1)),s=BigInt(0);for(let o=n.byteLength-1;o>=0;o--)s=s*BigInt(128)+BigInt(128-(n[o]&127)-1);return-s-BigInt(1)}function hi(e,t){if(BigInt(e)<BigInt(0))throw new Error("Cannot write negative values.");return Ls(e,t)}function Ls(e,t){e=BigInt(e);let r=new Gt(new Uint8Array(Math.min(1,t)),0),n=0,s=BigInt(256),o=BigInt(0),i=Number(e%s);for(r.write(new Uint8Array([i]));++n<t;)e<0&&o===BigInt(0)&&i!==0&&(o=BigInt(1)),i=Number((e/s-o)%BigInt(256)),r.write(new Uint8Array([i])),s*=BigInt(256);return r.buffer}function Ps(e,t){if(t<=0||!Number.isInteger(t))throw new Error("Byte length must be a positive integer");let r=BigInt(Le(e)),n=BigInt(1),s=0;for(;++s<t;){n*=BigInt(256);let o=BigInt(Le(e));r=r+n*o}return r}function pi(e,t){if(t<=0||!Number.isInteger(t))throw new Error("Byte length must be a positive integer");let r=Ps(e,t),n=BigInt(2)**(BigInt(8)*BigInt(t-1)+BigInt(7));return r>=n&&(r-=n*BigInt(2)),r}var X;(function(e){e[e.Null=-1]="Null",e[e.Bool=-2]="Bool",e[e.Nat=-3]="Nat",e[e.Int=-4]="Int",e[e.Float32=-13]="Float32",e[e.Float64=-14]="Float64",e[e.Text=-15]="Text",e[e.Reserved=-16]="Reserved",e[e.Empty=-17]="Empty",e[e.Opt=-18]="Opt",e[e.Vector=-19]="Vector",e[e.Record=-20]="Record",e[e.Variant=-21]="Variant",e[e.Func=-22]="Func",e[e.Service=-23]="Service",e[e.Principal=-24]="Principal"})(X||(X={}));var Zn="DIDL",mi=400;function Qr(e,t,r){return e.map((n,s)=>r(n,t[s]))}var Ms=class{constructor(){this._typs=[],this._idx=new Map}has(t){return this._idx.has(t.name)}add(t,r){let n=this._typs.length;this._idx.set(t.name,n),this._typs.push(r)}merge(t,r){let n=this._idx.get(t.name),s=this._idx.get(r);if(n===void 0)throw new Error("Missing type index for "+t);if(s===void 0)throw new Error("Missing type index for "+r);this._typs[n]=this._typs[s],this._typs.splice(s,1),this._idx.delete(r)}encode(){let t=J(this._typs.length),r=Z(...this._typs);return Z(t,r)}indexOf(t){if(!this._idx.has(t))throw new Error("Missing type index for "+t);return it(this._idx.get(t)||0)}},ks=class{visitType(t,r){throw new Error("Not implemented")}visitPrimitive(t,r){return this.visitType(t,r)}visitEmpty(t,r){return this.visitPrimitive(t,r)}visitBool(t,r){return this.visitPrimitive(t,r)}visitNull(t,r){return this.visitPrimitive(t,r)}visitReserved(t,r){return this.visitPrimitive(t,r)}visitText(t,r){return this.visitPrimitive(t,r)}visitNumber(t,r){return this.visitPrimitive(t,r)}visitInt(t,r){return this.visitNumber(t,r)}visitNat(t,r){return this.visitNumber(t,r)}visitFloat(t,r){return this.visitPrimitive(t,r)}visitFixedInt(t,r){return this.visitNumber(t,r)}visitFixedNat(t,r){return this.visitNumber(t,r)}visitPrincipal(t,r){return this.visitPrimitive(t,r)}visitConstruct(t,r){return this.visitType(t,r)}visitVec(t,r,n){return this.visitConstruct(t,n)}visitOpt(t,r,n){return this.visitConstruct(t,n)}visitRecord(t,r,n){return this.visitConstruct(t,n)}visitTuple(t,r,n){let s=r.map((o,i)=>[`_${i}_`,o]);return this.visitRecord(t,s,n)}visitVariant(t,r,n){return this.visitConstruct(t,n)}visitRec(t,r,n){return this.visitConstruct(r,n)}visitFunc(t,r){return this.visitConstruct(t,r)}visitService(t,r){return this.visitConstruct(t,r)}},k;(function(e){e.EmptyClass="__IDL_EmptyClass__",e.UnknownClass="__IDL_UnknownClass__",e.BoolClass="__IDL_BoolClass__",e.NullClass="__IDL_NullClass__",e.ReservedClass="__IDL_ReservedClass__",e.TextClass="__IDL_TextClass__",e.IntClass="__IDL_IntClass__",e.NatClass="__IDL_NatClass__",e.FloatClass="__IDL_FloatClass__",e.FixedIntClass="__IDL_FixedIntClass__",e.FixedNatClass="__IDL_FixedNatClass__",e.VecClass="__IDL_VecClass__",e.OptClass="__IDL_OptClass__",e.RecordClass="__IDL_RecordClass__",e.TupleClass="__IDL_TupleClass__",e.VariantClass="__IDL_VariantClass__",e.RecClass="__IDL_RecClass__",e.PrincipalClass="__IDL_PrincipalClass__",e.FuncClass="__IDL_FuncClass__",e.ServiceClass="__IDL_ServiceClass__"})(k||(k={}));var Er=class{display(){return this.name}valueToString(t){return st(t)}buildTypeTable(t){t.has(this)||this._buildTypeTableImpl(t)}},At=class extends Er{checkType(t){if(this.name!==t.name)throw new Error(`type mismatch: type on the wire ${t.name}, expect type ${this.name}`);return t}_buildTypeTableImpl(t){}},ne=class extends Er{checkType(t){if(t instanceof qt){let r=t.getType();if(typeof r>"u")throw new Error("type mismatch with uninitialized type");return r}throw new Error(`type mismatch: type on the wire ${t.name}, expect type ${this.name}`)}encodeType(t){return t.indexOf(this.name)}},Jr=class extends At{get typeName(){return k.EmptyClass}static[Symbol.hasInstance](t){return t.typeName===k.EmptyClass}accept(t,r){return t.visitEmpty(this,r)}covariant(t){throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(){throw new Error("Empty cannot appear as a function argument")}valueToString(){throw new Error("Empty cannot appear as a value")}encodeType(){return it(X.Empty)}decodeValue(){throw new Error("Empty cannot appear as an output")}get name(){return"empty"}},Xn=class extends Er{get typeName(){return k.UnknownClass}static[Symbol.hasInstance](t){return t.typeName===k.UnknownClass}checkType(t){throw new Error("Method not implemented for unknown.")}accept(t,r){throw t.visitType(this,r)}covariant(t){throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(){throw new Error("Unknown cannot appear as a function argument")}valueToString(){throw new Error("Unknown cannot appear as a value")}encodeType(){throw new Error("Unknown cannot be serialized")}decodeValue(t,r){let n=r.decodeValue(t,r);Object(n)!==n&&(n=Object(n));let s;return r instanceof qt?s=()=>r.getType():s=()=>r,Object.defineProperty(n,"type",{value:s,writable:!0,enumerable:!1,configurable:!0}),n}_buildTypeTableImpl(){throw new Error("Unknown cannot be serialized")}get name(){return"Unknown"}},zn=class extends At{get typeName(){return k.BoolClass}static[Symbol.hasInstance](t){return t.typeName===k.BoolClass}accept(t,r){return t.visitBool(this,r)}covariant(t){if(typeof t=="boolean")return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){return new Uint8Array([t?1:0])}encodeType(){return it(X.Bool)}decodeValue(t,r){switch(this.checkType(r),Le(t)){case 0:return!1;case 1:return!0;default:throw new Error("Boolean value out of range")}}get name(){return"bool"}},Je=class extends At{get typeName(){return k.NullClass}static[Symbol.hasInstance](t){return t.typeName===k.NullClass}accept(t,r){return t.visitNull(this,r)}covariant(t){if(t===null)return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(){return new Uint8Array(0)}encodeType(){return it(X.Null)}decodeValue(t,r){return this.checkType(r),null}get name(){return"null"}},se=class extends At{get typeName(){return k.ReservedClass}static[Symbol.hasInstance](t){return t.typeName===k.ReservedClass}accept(t,r){return t.visitReserved(this,r)}covariant(t){return!0}encodeValue(){return new Uint8Array(0)}encodeType(){return it(X.Reserved)}decodeValue(t,r){return r.name!==this.name&&r.decodeValue(t,r),null}get name(){return"reserved"}},Wn=class extends At{get typeName(){return k.TextClass}static[Symbol.hasInstance](t){return t.typeName===k.TextClass}accept(t,r){return t.visitText(this,r)}covariant(t){if(typeof t=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){let r=new TextEncoder().encode(t),n=J(r.byteLength);return Z(n,r)}encodeType(){return it(X.Text)}decodeValue(t,r){this.checkType(r);let n=ot(t),s=Pe(t,Number(n));return new TextDecoder("utf8",{fatal:!0}).decode(s)}get name(){return"text"}valueToString(t){return'"'+t+'"'}},tn=class extends At{get typeName(){return k.IntClass}static[Symbol.hasInstance](t){return t.typeName===k.IntClass}accept(t,r){return t.visitInt(this,r)}covariant(t){if(typeof t=="bigint"||Number.isInteger(t))return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){return it(t)}encodeType(){return it(X.Int)}decodeValue(t,r){return this.checkType(r),le(t)}get name(){return"int"}valueToString(t){return t.toString()}},en=class extends At{get typeName(){return k.NatClass}static[Symbol.hasInstance](t){return t.typeName===k.NatClass}accept(t,r){return t.visitNat(this,r)}covariant(t){if(typeof t=="bigint"&&t>=BigInt(0)||Number.isInteger(t)&&t>=0)return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){return J(t)}encodeType(){return it(X.Nat)}decodeValue(t,r){return this.checkType(r),ot(t)}get name(){return"nat"}valueToString(t){return t.toString()}},rn=class extends At{get typeName(){return k.FloatClass}static[Symbol.hasInstance](t){return t.typeName===k.FloatClass}constructor(t){if(super(),this._bits=t,t!==32&&t!==64)throw new Error("not a valid float type")}accept(t,r){return t.visitFloat(this,r)}covariant(t){if(typeof t=="number"||t instanceof Number)return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){let r=new ArrayBuffer(this._bits/8),n=new DataView(r);return this._bits===32?n.setFloat32(0,t,!0):n.setFloat64(0,t,!0),new Uint8Array(r)}encodeType(){let t=this._bits===32?X.Float32:X.Float64;return it(t)}decodeValue(t,r){this.checkType(r);let n=Pe(t,this._bits/8),s=di(n);return this._bits===32?s.getFloat32(0,!0):s.getFloat64(0,!0)}get name(){return"float"+this._bits}valueToString(t){return t.toString()}},pe=class extends At{get typeName(){return k.FixedIntClass}static[Symbol.hasInstance](t){return t.typeName===k.FixedIntClass}constructor(t){super(),this._bits=t}accept(t,r){return t.visitFixedInt(this,r)}covariant(t){let r=Gn(this._bits-1)*BigInt(-1),n=Gn(this._bits-1)-BigInt(1),s=!1;if(typeof t=="bigint")s=t>=r&&t<=n;else if(Number.isInteger(t)){let o=BigInt(t);s=o>=r&&o<=n}else s=!1;if(s)return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){return Ls(t,this._bits/8)}encodeType(){let t=Math.log2(this._bits)-3;return it(-9-t)}decodeValue(t,r){this.checkType(r);let n=pi(t,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`int${this._bits}`}valueToString(t){return t.toString()}},re=class extends At{get typeName(){return k.FixedNatClass}static[Symbol.hasInstance](t){return t.typeName===k.FixedNatClass}constructor(t){super(),this._bits=t}accept(t,r){return t.visitFixedNat(this,r)}covariant(t){let r=Gn(this._bits),n=!1;if(typeof t=="bigint"&&t>=BigInt(0)?n=t<r:Number.isInteger(t)&&t>=0?n=BigInt(t)<r:n=!1,n)return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){return hi(t,this._bits/8)}encodeType(){let t=Math.log2(this._bits)-3;return it(-5-t)}decodeValue(t,r){this.checkType(r);let n=Ps(t,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`nat${this._bits}`}valueToString(t){return t.toString()}},_r=class e extends ne{get typeName(){return k.VecClass}static[Symbol.hasInstance](t){return t.typeName===k.VecClass}constructor(t){super(),this._type=t,this._blobOptimization=!1,t instanceof re&&t._bits===8&&(this._blobOptimization=!0)}accept(t,r){return t.visitVec(this,this._type,r)}covariant(t){let r=this._type instanceof re?this._type._bits:this._type instanceof pe?this._type._bits:0;if(ArrayBuffer.isView(t)&&r==t.BYTES_PER_ELEMENT*8||Array.isArray(t)&&t.every((n,s)=>{try{return this._type.covariant(n)}catch(o){throw new Error(`Invalid ${this.display()} argument: 

index ${s} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){let r=J(t.length);if(this._blobOptimization)return Z(r,new Uint8Array(t));if(ArrayBuffer.isView(t))if(t instanceof Int16Array||t instanceof Uint16Array){let s=new DataView(new ArrayBuffer(t.length*2));for(let o=0;o<t.length;o++)t instanceof Int16Array?s.setInt16(o*2,t[o],!0):s.setUint16(o*2,t[o],!0);return Z(r,new Uint8Array(s.buffer))}else if(t instanceof Int32Array||t instanceof Uint32Array){let s=new DataView(new ArrayBuffer(t.length*4));for(let o=0;o<t.length;o++)t instanceof Int32Array?s.setInt32(o*4,t[o],!0):s.setUint32(o*4,t[o],!0);return Z(r,new Uint8Array(s.buffer))}else if(t instanceof BigInt64Array||t instanceof BigUint64Array){let s=new DataView(new ArrayBuffer(t.length*8));for(let o=0;o<t.length;o++)t instanceof BigInt64Array?s.setBigInt64(o*8,t[o],!0):s.setBigUint64(o*8,t[o],!0);return Z(r,new Uint8Array(s.buffer))}else return Z(r,new Uint8Array(t.buffer,t.byteOffset,t.byteLength));let n=new Gt(new Uint8Array(r.byteLength+t.length),0);n.write(r);for(let s of t){let o=this._type.encodeValue(s);n.write(new Uint8Array(o))}return n.buffer}_buildTypeTableImpl(t){this._type.buildTypeTable(t);let r=it(X.Vector),n=this._type.encodeType(t);t.add(this,Z(r,n))}decodeValue(t,r){let n=this.checkType(r);if(!(n instanceof e))throw new Error("Not a vector type");let s=Number(ot(t));if(this._type instanceof re){if(this._type._bits==8)return new Uint8Array(t.read(s));if(this._type._bits==16){let i=t.read(s*2);return new Uint16Array(i.buffer,i.byteOffset,s)}if(this._type._bits==32){let i=t.read(s*4);return new Uint32Array(i.buffer,i.byteOffset,s)}if(this._type._bits==64)return new BigUint64Array(t.read(s*8).buffer)}if(this._type instanceof pe){if(this._type._bits==8)return new Int8Array(t.read(s));if(this._type._bits==16){let i=t.read(s*2),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new Int16Array(s);for(let u=0;u<s;u++)a[u]=c.getInt16(u*2,!0);return a}if(this._type._bits==32){let i=t.read(s*4),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new Int32Array(s);for(let u=0;u<s;u++)a[u]=c.getInt32(u*4,!0);return a}if(this._type._bits==64){let i=t.read(s*8),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new BigInt64Array(s);for(let u=0;u<s;u++)a[u]=c.getBigInt64(u*8,!0);return a}}let o=[];for(let i=0;i<s;i++)o.push(this._type.decodeValue(t,n._type));return o}get name(){return`vec ${this._type.name}`}display(){return`vec ${this._type.display()}`}valueToString(t){return"vec {"+t.map(n=>this._type.valueToString(n)).join("; ")+"}"}},De=class e extends ne{get typeName(){return k.OptClass}static[Symbol.hasInstance](t){return t.typeName===k.OptClass}constructor(t){super(),this._type=t}accept(t,r){return t.visitOpt(this,this._type,r)}covariant(t){try{if(Array.isArray(t)&&(t.length===0||t.length===1&&this._type.covariant(t[0])))return!0}catch(r){throw new Error(`Invalid ${this.display()} argument: ${st(t)} 

-> ${r.message}`)}throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){return t.length===0?new Uint8Array([0]):Z(new Uint8Array([1]),this._type.encodeValue(t[0]))}_buildTypeTableImpl(t){this._type.buildTypeTable(t);let r=it(X.Opt),n=this._type.encodeType(t);t.add(this,Z(r,n))}decodeValue(t,r){if(r instanceof Je)return[];if(r instanceof se)return[];let n=r;if(r instanceof qt){let s=r.getType();if(typeof s>"u")throw new Error("type mismatch with uninitialized type");n=s}if(n instanceof e)switch(Le(t)){case 0:return[];case 1:{let s=t.save();try{return[this._type.decodeValue(t,n._type)]}catch{return t.restore(s),n._type.decodeValue(t,n._type),[]}}default:throw new Error("Not an option value")}else{if(this._type instanceof Je||this._type instanceof e||this._type instanceof se)return n.decodeValue(t,n),[];{let s=t.save();try{return[this._type.decodeValue(t,r)]}catch{return t.restore(s),n.decodeValue(t,r),[]}}}}get name(){return`opt ${this._type.name}`}display(){return`opt ${this._type.display()}`}valueToString(t){return t.length===0?"null":`opt ${this._type.valueToString(t[0])}`}},tr=class e extends ne{get typeName(){return k.RecordClass}static[Symbol.hasInstance](t){return t.typeName===k.RecordClass||t.typeName===k.TupleClass}constructor(t={}){super(),this._fields=Object.entries(t).sort((r,n)=>Bt(r[0])-Bt(n[0]))}accept(t,r){return t.visitRecord(this,this._fields,r)}tryAsTuple(){let t=[];for(let r=0;r<this._fields.length;r++){let[n,s]=this._fields[r];if(n!==`_${r}_`)return null;t.push(s)}return t}covariant(t){if(typeof t=="object"&&this._fields.every(([r,n])=>{if(!t.hasOwnProperty(r))throw new Error(`Record is missing key "${r}".`);try{return n.covariant(t[r])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

field ${r} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){let r=this._fields.map(([s])=>t[s]),n=Qr(this._fields,r,([,s],o)=>s.encodeValue(o));return Z(...n)}_buildTypeTableImpl(t){this._fields.forEach(([o,i])=>i.buildTypeTable(t));let r=it(X.Record),n=J(this._fields.length),s=this._fields.map(([o,i])=>Z(J(Bt(o)),i.encodeType(t)));t.add(this,Z(r,n,Z(...s)))}decodeValue(t,r){let n=this.checkType(r);if(!(n instanceof e))throw new Error("Not a record type");let s={},o=0,i=0;for(;i<n._fields.length;){let[c,a]=n._fields[i];if(o>=this._fields.length){a.decodeValue(t,a),i++;continue}let[u,h]=this._fields[o],d=Bt(this._fields[o][0]),f=Bt(c);if(d===f)s[u]=h.decodeValue(t,a),o++,i++;else if(f>d)if(h instanceof De||h instanceof se)s[u]=[],o++;else throw new Error("Cannot find required field "+u);else a.decodeValue(t,a),i++}for(let[c,a]of this._fields.slice(o))if(a instanceof De||a instanceof se)s[c]=[];else throw new Error("Cannot find required field "+c);return s}get fieldsAsObject(){let t={};for(let[r,n]of this._fields)t[Bt(r)]=n;return t}get name(){return`record {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`record {${this._fields.map(([r,n])=>r+":"+n.display()).join("; ")}}`}valueToString(t){let r=this._fields.map(([s])=>t[s]);return`record {${Qr(this._fields,r,([s,o],i)=>s+"="+o.valueToString(i)).join("; ")}}`}},Qn=class e extends tr{get typeName(){return k.TupleClass}static[Symbol.hasInstance](t){return t.typeName===k.TupleClass}constructor(t){let r={};t.forEach((n,s)=>r["_"+s+"_"]=n),super(r),this._components=t}accept(t,r){return t.visitTuple(this,this._components,r)}covariant(t){if(Array.isArray(t)&&t.length>=this._fields.length&&this._components.every((r,n)=>{try{return r.covariant(t[n])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

index ${n} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){let r=Qr(this._components,t,(n,s)=>n.encodeValue(s));return Z(...r)}decodeValue(t,r){let n=this.checkType(r);if(!(n instanceof e))throw new Error("not a tuple type");if(n._components.length<this._components.length)throw new Error("tuple mismatch");let s=[];for(let[o,i]of n._components.entries())o>=this._components.length?i.decodeValue(t,i):s.push(this._components[o].decodeValue(t,i));return s}display(){return`record {${this._components.map(r=>r.display()).join("; ")}}`}valueToString(t){return`record {${Qr(this._components,t,(n,s)=>n.valueToString(s)).join("; ")}}`}},Br=class e extends ne{get typeName(){return k.VariantClass}static[Symbol.hasInstance](t){return t.typeName===k.VariantClass}constructor(t={}){super(),this._fields=Object.entries(t).sort((r,n)=>Bt(r[0])-Bt(n[0]))}accept(t,r){return t.visitVariant(this,this._fields,r)}covariant(t){if(typeof t=="object"&&Object.entries(t).length===1&&this._fields.every(([r,n])=>{try{return!t.hasOwnProperty(r)||n.covariant(t[r])}catch(s){throw new Error(`Invalid ${this.display()} argument: 

variant ${r} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){for(let r=0;r<this._fields.length;r++){let[n,s]=this._fields[r];if(t.hasOwnProperty(n)){let o=J(r),i=s.encodeValue(t[n]);return Z(o,i)}}throw Error("Variant has no data: "+t)}_buildTypeTableImpl(t){this._fields.forEach(([,o])=>{o.buildTypeTable(t)});let r=it(X.Variant),n=J(this._fields.length),s=this._fields.map(([o,i])=>Z(J(Bt(o)),i.encodeType(t)));t.add(this,Z(r,n,...s))}decodeValue(t,r){let n=this.checkType(r);if(!(n instanceof e))throw new Error("Not a variant type");let s=Number(ot(t));if(s>=n._fields.length)throw Error("Invalid variant index: "+s);let[o,i]=n._fields[s];for(let[c,a]of this._fields)if(Bt(o)===Bt(c)){let u=a.decodeValue(t,i);return{[c]:u}}throw new Error("Cannot find field hash "+o)}get name(){return`variant {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`variant {${this._fields.map(([r,n])=>r+(n.name==="null"?"":`:${n.display()}`)).join("; ")}}`}valueToString(t){for(let[r,n]of this._fields)if(t.hasOwnProperty(r)){let s=n.valueToString(t[r]);return s==="null"?`variant {${r}}`:`variant {${r}=${s}}`}throw new Error("Variant has no data: "+t)}get alternativesAsObject(){let t={};for(let[r,n]of this._fields)t[Bt(r)]=n;return t}},qt=class e extends ne{constructor(){super(...arguments),this._id=e._counter++}get typeName(){return k.RecClass}static{this._counter=0}static[Symbol.hasInstance](t){return t.typeName===k.RecClass}accept(t,r){if(!this._type)throw Error("Recursive type uninitialized.");return t.visitRec(this,this._type,r)}fill(t){this._type=t}getType(){return this._type}covariant(t){if(this._type&&this._type.covariant(t))return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.encodeValue(t)}_buildTypeTableImpl(t){if(!this._type)throw Error("Recursive type uninitialized.");t.add(this,new Uint8Array([])),this._type.buildTypeTable(t),t.merge(this,this._type.name)}decodeValue(t,r){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.decodeValue(t,r)}get name(){return`rec_${this._id}`}display(){if(!this._type)throw Error("Recursive type uninitialized.");return`\u03BC${this.name}.${this._type.name}`}valueToString(t){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.valueToString(t)}};function Vs(e){if(Le(e)!==1)throw new Error("Cannot decode principal");let r=Number(ot(e));return H.fromUint8Array(new Uint8Array(Pe(e,r)))}var Jn=class extends At{get typeName(){return k.PrincipalClass}static[Symbol.hasInstance](t){return t.typeName===k.PrincipalClass}accept(t,r){return t.visitPrincipal(this,r)}covariant(t){if(t&&t._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){let r=t.toUint8Array(),n=J(r.byteLength);return Z(new Uint8Array([1]),n,r)}encodeType(){return it(X.Principal)}decodeValue(t,r){return this.checkType(r),Vs(t)}get name(){return"principal"}valueToString(t){return`${this.name} "${t.toText()}"`}},er=class extends ne{get typeName(){return k.FuncClass}static[Symbol.hasInstance](t){return t.typeName===k.FuncClass}static argsToString(t,r){if(t.length!==r.length)throw new Error("arity mismatch");return"("+t.map((n,s)=>n.valueToString(r[s])).join(", ")+")"}constructor(t,r,n=[]){super(),this.argTypes=t,this.retTypes=r,this.annotations=n}accept(t,r){return t.visitFunc(this,r)}covariant(t){if(Array.isArray(t)&&t.length===2&&t[0]&&t[0]._isPrincipal&&typeof t[1]=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue([t,r]){let n=t.toUint8Array(),s=J(n.byteLength),o=Z(new Uint8Array([1]),s,n),i=new TextEncoder().encode(r),c=J(i.byteLength);return Z(new Uint8Array([1]),o,c,i)}_buildTypeTableImpl(t){this.argTypes.forEach(u=>u.buildTypeTable(t)),this.retTypes.forEach(u=>u.buildTypeTable(t));let r=it(X.Func),n=J(this.argTypes.length),s=Z(...this.argTypes.map(u=>u.encodeType(t))),o=J(this.retTypes.length),i=Z(...this.retTypes.map(u=>u.encodeType(t))),c=J(this.annotations.length),a=Z(...this.annotations.map(u=>this.encodeAnnotation(u)));t.add(this,Z(r,n,s,o,i,c,a))}decodeValue(t,r){let n=r instanceof qt?r.getType()??r:r;if(!$s(n,this))throw new Error(`Cannot decode function reference at type ${this.display()} from wire type ${n.display()}`);if(Le(t)!==1)throw new Error("Cannot decode function reference");let o=Vs(t),i=Number(ot(t)),c=Pe(t,i),u=new TextDecoder("utf8",{fatal:!0}).decode(c);return[o,u]}get name(){let t=this.argTypes.map(s=>s.name).join(", "),r=this.retTypes.map(s=>s.name).join(", "),n=" "+this.annotations.join(" ");return`(${t}) -> (${r})${n}`}valueToString([t,r]){return`func "${t.toText()}".${r}`}display(){let t=this.argTypes.map(s=>s.display()).join(", "),r=this.retTypes.map(s=>s.display()).join(", "),n=" "+this.annotations.join(" ");return`(${t}) \u2192 (${r})${n}`}encodeAnnotation(t){if(t==="query")return new Uint8Array([1]);if(t==="oneway")return new Uint8Array([2]);if(t==="composite_query")return new Uint8Array([3]);throw new Error("Illegal function annotation")}},vr=class extends ne{get typeName(){return k.ServiceClass}static[Symbol.hasInstance](t){return t.typeName===k.ServiceClass}constructor(t){super(),this._fields=Object.entries(t).sort((r,n)=>r[0]<n[0]?-1:r[0]>n[0]?1:0)}accept(t,r){return t.visitService(this,r)}covariant(t){if(t&&t._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${st(t)}`)}encodeValue(t){let r=t.toUint8Array(),n=J(r.length);return Z(new Uint8Array([1]),n,r)}_buildTypeTableImpl(t){this._fields.forEach(([o,i])=>i.buildTypeTable(t));let r=it(X.Service),n=J(this._fields.length),s=this._fields.map(([o,i])=>{let c=new TextEncoder().encode(o),a=J(c.length);return Z(a,c,i.encodeType(t))});t.add(this,Z(r,n,...s))}decodeValue(t,r){let n=r instanceof qt?r.getType()??r:r;if(!$s(n,this))throw new Error(`Cannot decode service reference at type ${this.display()} from wire type ${n.display()}`);return Vs(t)}get name(){return`service {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}valueToString(t){return`service "${t.toText()}"`}fieldsAsObject(){let t={};for(let[r,n]of this._fields)t[r]=n;return t}};function st(e){let t=JSON.stringify(e,(r,n)=>typeof n=="bigint"?`BigInt(${n})`:n);return t&&t.length>mi?t.substring(0,mi-3)+"...":t}function ha(e,t){if(t.length<e.length)throw Error("Wrong number of message arguments");let r=new Ms;e.forEach(a=>a.buildTypeTable(r));let n=new TextEncoder().encode(Zn),s=r.encode(),o=J(t.length),i=Z(...e.map(a=>a.encodeType(r))),c=Z(...Qr(e,t,(a,u)=>{try{a.covariant(u)}catch(h){throw new Error(h.message+`

`)}return a.encodeValue(u)}));return Z(n,s,o,i,c)}function pa(e,t){let r=new Gt(t);if(t.byteLength<Zn.length)throw new Error("Message length smaller than magic number");let n=Pe(r,Zn.length),s=new TextDecoder().decode(n);if(s!==Zn)throw new Error("Wrong magic number: "+JSON.stringify(s));function o(f){let l=[],p=Number(ot(f));for(let m=0;m<p;m++){let w=Number(le(f));switch(w){case X.Opt:case X.Vector:{let y=Number(le(f));l.push([w,y]);break}case X.Record:case X.Variant:{let y=[],_=Number(ot(f)),v;for(;_--;){let I=Number(ot(f));if(I>=Math.pow(2,32))throw new Error("field id out of 32-bit range");if(typeof v=="number"&&v>=I)throw new Error("field id collision or not sorted");v=I;let T=Number(le(f));y.push([I,T])}l.push([w,y]);break}case X.Func:{let y=[],_=Number(ot(f));for(;_--;)y.push(Number(le(f)));let v=[],I=Number(ot(f));for(;I--;)v.push(Number(le(f)));let T=[],A=Number(ot(f));for(;A--;)switch(Number(ot(f))){case 1:{T.push("query");break}case 2:{T.push("oneway");break}case 3:{T.push("composite_query");break}default:throw new Error("unknown annotation")}l.push([w,[y,v,T]]);break}case X.Service:{let y=Number(ot(f)),_=[];for(;y--;){let v=Number(ot(f)),I=new TextDecoder().decode(Pe(f,v)),T=le(f);_.push([I,T])}l.push([w,_]);break}default:throw new Error("Illegal op_code: "+w)}}let b=[],g=Number(ot(f));for(let m=0;m<g;m++)b.push(Number(le(f)));return[l,b]}let[i,c]=o(r);if(c.length<e.length)throw new Error("Wrong number of return values");let a=i.map(f=>ki());function u(f){if(f<-24)throw new Error("future value not supported");if(f<0)switch(f){case-1:return xi;case-2:return gi;case-3:return _i;case-4:return Ei;case-5:return Oi;case-6:return Ci;case-7:return Ri;case-8:return Ni;case-9:return Ii;case-10:return Ti;case-11:return Si;case-12:return Ai;case-13:return Bi;case-14:return vi;case-15:return wi;case-16:return bi;case-17:return yi;case-24:return Ui;default:throw new Error("Illegal op_code: "+f)}if(f>=i.length)throw new Error("type index out of range");return a[f]}function h(f){switch(f[0]){case X.Vector:{let l=u(f[1]);return Li(l)}case X.Opt:{let l=u(f[1]);return Pi(l)}case X.Record:{let l={};for(let[g,m]of f[1]){let w=`_${g}_`;l[w]=u(m)}let p=Di(l),b=p.tryAsTuple();return Array.isArray(b)?qi(...b):p}case X.Variant:{let l={};for(let[p,b]of f[1]){let g=`_${p}_`;l[g]=u(b)}return Mi(l)}case X.Func:{let[l,p,b]=f[1];return Fi(l.map(g=>u(g)),p.map(g=>u(g)),b)}case X.Service:{let l={},p=f[1];for(let[b,g]of p){let m=u(g);if(m instanceof qt&&(m=m.getType()),!(m instanceof er))throw new Error("Illegal service definition: services can only contain functions");l[b]=m}return Vi(l)}default:throw new Error("Illegal op_code: "+f[0])}}i.forEach((f,l)=>{if(f[0]===X.Func){let p=h(f);a[l].fill(p)}}),i.forEach((f,l)=>{if(f[0]!==X.Func){let p=h(f);a[l].fill(p)}}),Fs();let d=c.map(f=>u(f));try{let f=e.map((l,p)=>l.decodeValue(r,d[p]));for(let l=e.length;l<d.length;l++)d[l].decodeValue(r,d[l]);if(r.byteLength>0)throw new Error("decode: Left-over bytes");return f}finally{Fs()}}var yi=new Jr,bi=new se,ma=new Xn,gi=new zn,xi=new Je,wi=new Wn,Ei=new tn,_i=new en,Bi=new rn(32),vi=new rn(64),Ii=new pe(8),Ti=new pe(16),Si=new pe(32),Ai=new pe(64),Oi=new re(8),Ci=new re(16),Ri=new re(32),Ni=new re(64),Ui=new Jn;function qi(...e){return new Qn(e)}function Li(e){return new _r(e)}function Pi(e){return new De(e)}function Di(e){return new tr(e)}function Mi(e){return new Br(e)}function ki(){return new qt}function Fi(e,t,r=[]){return new er(e,t,r)}function Vi(e){return new vr(e)}var ts=class e{constructor(t=new Map){this.rels=t}copy(){let t=new Map;for(let[r,n]of this.rels.entries()){let s=new Map(n);t.set(r,s)}return new e(t)}known(t,r){return this.rels.get(t.name)?.get(r.name)}addNegative(t,r){this.addNames(t.name,r.name,!1)}add(t,r){this.addNames(t.name,r.name,!0)}display(){let t="";for(let[r,n]of this.rels)for(let[s,o]of n)t+=`${r} ${o?":<":"!<:"} ${s}
`;return t}addNames(t,r,n){let s=this.rels.get(t);if(s==null){let o=new Map;o.set(r,n),this.rels.set(t,o)}else s.set(r,n)}},Yn=new ts;function Fs(){Yn=new ts}function ya(e,t){let r=new Set(e.annotations),n=new Set(t.annotations);if(r.size!==n.size)return!1;for(let s of r)if(!n.has(s))return!1;return!0}function Ds(e){return e instanceof De||e instanceof Je||e instanceof se}function $s(e,t){let r=Yn.copy(),n=he(r,e,t);return n?Yn.add(e,t):Yn.addNegative(e,t),n}function he(e,t,r){if(t.name===r.name)return!0;let n=e.known(t,r);if(n!==void 0)return n;if(e.add(t,r),r instanceof se||t instanceof Jr||t instanceof en&&r instanceof tn)return!0;if(t instanceof _r&&r instanceof _r)return he(e,t._type,r._type);if(r instanceof De)return!0;if(t instanceof tr&&r instanceof tr){let s=t.fieldsAsObject;for(let[o,i]of r._fields){let c=s[Bt(o)];if(c){if(!he(e,c,i))return!1}else if(!Ds(i))return!1}return!0}if(t instanceof er&&r instanceof er){if(!ya(t,r))return!1;for(let s=0;s<t.argTypes.length;s++){let o=t.argTypes[s];if(s<r.argTypes.length){if(!he(e,r.argTypes[s],o))return!1}else if(!Ds(o))return!1}for(let s=0;s<r.retTypes.length;s++){let o=r.retTypes[s];if(s<t.retTypes.length){if(!he(e,t.retTypes[s],o))return!1}else if(!Ds(o))return!1}return!0}if(t instanceof Br&&r instanceof Br){let s=r.alternativesAsObject;for(let[o,i]of t._fields){let c=s[Bt(o)];if(!c||!he(e,i,c))return!1}return!0}if(t instanceof vr&&r instanceof vr){let s=t.fieldsAsObject();for(let[o,i]of r._fields){let c=s[o];if(!c||!he(e,c,i))return!1}return!0}return t instanceof qt?he(e,t.getType(),r):r instanceof qt?he(e,t,r.getType()):!1}function Ir(e){if(!e)throw new Error("Input cannot be null or undefined");return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?new Uint8Array(e):"buffer"in e?Ir(e.buffer):new Uint8Array(e)}function nr(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function js(e){if(typeof e=="string")return $i(e);if(typeof e=="number")return gt(J(e));if(e instanceof Uint8Array||ArrayBuffer.isView(e))return gt(Ir(e));if(Array.isArray(e)){let t=e.map(js);return gt(F(...t))}else{if(e&&typeof e=="object"&&e._isPrincipal)return gt(e.toUint8Array());if(typeof e=="object"&&e!==null&&typeof e.toHash=="function")return js(e.toHash());if(typeof e=="object")return nn(e);if(typeof e=="bigint")return gt(J(e))}throw G.fromCode(new Fn(e))}var $i=e=>{let t=new TextEncoder().encode(e);return gt(t)};function es(e){return nn(e)}function nn(e){let n=Object.entries(e).filter(([,i])=>i!==void 0).map(([i,c])=>{let a=$i(i),u=js(c);return[a,u]}).sort(([i],[c])=>ui(i,c)),s=F(...n.map(i=>F(...i)));return gt(s)}var Ed=new TextEncoder().encode(`
ic-request`),ji=new TextEncoder().encode("\vic-response"),_d=new TextEncoder().encode("ic-request-auth-delegation");var sn=class{getPrincipal(){return H.anonymous()}async transformRequest(t){return{...t,body:{content:t.body}}}};var me=class extends Error{constructor(t){super(t),this.name="DecodingError"}},Ki=55799,Gi=Symbol("CBOR_STOP_CODE"),Xt=(e=>(e[e.False=20]="False",e[e.True=21]="True",e[e.Null=22]="Null",e[e.Undefined=23]="Undefined",e[e.Break=31]="Break",e))(Xt||{}),ut=(e=>(e[e.UnsignedInteger=0]="UnsignedInteger",e[e.NegativeInteger=1]="NegativeInteger",e[e.ByteString=2]="ByteString",e[e.TextString=3]="TextString",e[e.Array=4]="Array",e[e.Map=5]="Map",e[e.Tag=6]="Tag",e[e.Simple=7]="Simple",e))(ut||{}),ba=23,ga=255,xa=65535,wa=4294967295,Ea=BigInt("0xffffffffffffffff"),Yt=(e=>(e[e.Value=23]="Value",e[e.OneByte=24]="OneByte",e[e.TwoBytes=25]="TwoBytes",e[e.FourBytes=26]="FourBytes",e[e.EightBytes=27]="EightBytes",e[e.Indefinite=31]="Indefinite",e))(Yt||{}),Tr=!1;function _a(e){return e==null}function Zi(e,t){let r=new Uint8Array(t);return r.set(e),r}var Ba=new TextDecoder;function va(e){return(e&224)>>5}function Ia(e){return e&31}var an=new Uint8Array,on,zt=0;function Yi(e,t){an=e,zt=0;let r=sr(t);return t?.(r)??r}function sr(e){let[t,r]=rs();switch(t){case ut.UnsignedInteger:return Sr(r);case ut.NegativeInteger:return Oa(r);case ut.ByteString:return Xi(r);case ut.TextString:return Ks(r);case ut.Array:return Ta(r,e);case ut.Map:return Aa(r,e);case ut.Tag:return Ca(r,e);case ut.Simple:return Sa(r)}throw new me(`Unsupported major type: ${t}`)}function rs(){let e=an.at(zt);if(_a(e))throw new me("Provided CBOR data is empty");let t=va(e),r=Ia(e);return zt++,[t,r]}function Ta(e,t){let r=Sr(e);if(r===1/0){let s=[],o=sr(t);for(;o!==Gi;)s.push(t?.(o)??o),o=sr(t);return s}let n=new Array(r);for(let s=0;s<r;s++){let o=sr(t);n[s]=t?.(o)??o}return n}function Sa(e){switch(e){case Xt.False:return!1;case Xt.True:return!0;case Xt.Null:return null;case Xt.Undefined:return;case Xt.Break:return Gi}throw new me(`Unrecognized simple type: ${e.toString(2)}`)}function Aa(e,t){let r=Sr(e),n={};if(r===1/0){let[s,o]=rs();for(;s!==ut.Simple&&o!==Xt.Break;){let i=Ks(o),c=sr(t);n[i]=t?.(c,i)??c,[s,o]=rs()}return n}for(let s=0;s<r;s++){let[o,i]=rs();if(o!==ut.TextString)throw new me("Map keys must be text strings");let c=Ks(i),a=sr(t);n[c]=t?.(a,c)??a}return n}function Sr(e){if(e<=Yt.Value)return e;switch(on=new DataView(an.buffer,an.byteOffset+zt),e){case Yt.OneByte:return zt++,on.getUint8(0);case Yt.TwoBytes:return zt+=2,on.getUint16(0,Tr);case Yt.FourBytes:return zt+=4,on.getUint32(0,Tr);case Yt.EightBytes:return zt+=8,on.getBigUint64(0,Tr);case Yt.Indefinite:return 1/0;default:throw new me(`Unsupported integer info: ${e.toString(2)}`)}}function Oa(e){let t=Sr(e);return typeof t=="number"?-1-t:-1n-t}function Xi(e){let t=Sr(e);if(t>Number.MAX_SAFE_INTEGER)throw new me("Byte length is too large");let r=Number(t);return zt+=r,an.slice(zt-r,zt)}function Ks(e){let t=Xi(e);return Ba.decode(t)}function Ca(e,t){let r=Sr(e);if(r===Ki)return sr(t);throw new me(`Unsupported tag: ${r}.`)}var fn=class extends Error{constructor(t){super(t),this.name="SerializationError"}},Ra=2*1024,Na=100,Ua=new TextEncoder;function cn(e){return e<<5}var Nt=new Uint8Array(Ra),Zt=new DataView(Nt.buffer),ft=0,Hs=[];function zi(e,t){ft=0;let r=t?.(e)??e;return Va(Ki,r,t),Nt.slice(0,ft)}function Gs(e,t){if(ft>Nt.length-Na&&(Nt=Zi(Nt,Nt.length*2),Zt=new DataView(Nt.buffer)),e===!1||e===!0||e===null||e===void 0){Pa(e);return}if(typeof e=="number"||typeof e=="bigint"){Fa(e);return}if(typeof e=="string"){Ji(e);return}if(e instanceof Uint8Array){Hi(e);return}if(e instanceof ArrayBuffer){Hi(new Uint8Array(e));return}if(Array.isArray(e)){qa(e,t);return}if(typeof e=="object"){La(e,t);return}throw new fn(`Unsupported type: ${typeof e}`)}function qa(e,t){Ar(ut.Array,e.length),e.forEach((r,n)=>{Gs(t?.(r,n.toString())??r,t)})}function La(e,t){Hs=Object.entries(e),Ar(ut.Map,Hs.length),Hs.forEach(([r,n])=>{Ji(r),Gs(t?.(n,r)??n,t)})}function Ar(e,t){if(t<=ba){Zt.setUint8(ft++,cn(e)|Number(t));return}if(t<=ga){Zt.setUint8(ft++,cn(e)|Yt.OneByte),Zt.setUint8(ft,Number(t)),ft+=1;return}if(t<=xa){Zt.setUint8(ft++,cn(e)|Yt.TwoBytes),Zt.setUint16(ft,Number(t),Tr),ft+=2;return}if(t<=wa){Zt.setUint8(ft++,cn(e)|Yt.FourBytes),Zt.setUint32(ft,Number(t),Tr),ft+=4;return}if(t<=Ea){Zt.setUint8(ft++,cn(e)|Yt.EightBytes),Zt.setBigUint64(ft,BigInt(t),Tr),ft+=8;return}throw new fn(`Value too large to encode: ${t}`)}function Pa(e){Ar(ut.Simple,Da(e))}function Da(e){if(e===!1)return Xt.False;if(e===!0)return Xt.True;if(e===null)return Xt.Null;if(e===void 0)return Xt.Undefined;throw new fn(`Unrecognized simple value: ${e.toString()}`)}function Wi(e,t){Ar(e,t.length),ft>Nt.length-t.length&&(Nt=Zi(Nt,Nt.length+t.length),Zt=new DataView(Nt.buffer)),Nt.set(t,ft),ft+=t.length}function Qi(e,t){Ar(e,t)}function Ma(e){Qi(ut.UnsignedInteger,e)}function ka(e){Qi(ut.NegativeInteger,typeof e=="bigint"?-1n-e:-1-e)}function Fa(e){e>=0?Ma(e):ka(e)}function Ji(e){Wi(ut.TextString,Ua.encode(e))}function Hi(e){Wi(ut.ByteString,e)}function Va(e,t,r){Ar(ut.Tag,e),Gs(t,r)}function ja(e){return typeof e=="object"&&e!==null&&"toCborValue"in e}function ns(e){try{return zi(e,t=>H.isPrincipal(t)?t.toUint8Array():Or.isExpiry(t)?t.toBigInt():ja(t)?t.toCborValue():t)}catch(t){throw G.fromCode(new Pn(t,e))}}function Ut(e){try{return Yi(e)}catch(t){throw G.fromCode(new Ln(t,e))}}var un=()=>{if(typeof window<"u"&&window.crypto&&window.crypto.getRandomValues){let e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0]}if(typeof crypto<"u"&&crypto.getRandomValues){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}return typeof crypto<"u"&&crypto.randomInt?crypto.randomInt(0,4294967295):Math.floor(Math.random()*4294967295)};var ye;(function(e){e.Query="read",e.ReadState="read_state",e.Call="call"})(ye||(ye={}));var ss;(function(e){e.Call="call"})(ss||(ss={}));var or;(function(e){e.Query="query",e.ReadState="read_state"})(or||(or={}));function dn(){let e=new ArrayBuffer(16),t=new DataView(e),r=un(),n=un(),s=un(),o=un();return t.setUint32(0,r),t.setUint32(4,n),t.setUint32(8,s),t.setUint32(12,o),Object.assign(new Uint8Array(e),{__nonce__:void 0})}var os="__expiry__",Ys=BigInt(1e6),is=Ys*BigInt(1e3),tc=BigInt(60),Ha=60*1e3,Or=class e{constructor(t){this.__expiry__=t,this._isExpiry=!0}static fromDeltaInMilliseconds(t){if(t<90*1e3){let c=BigInt(Date.now()+t)*Ys/is;return new e(c*is)}let o=BigInt(Math.floor(Date.now()+t-Ha))*Ys/is/tc*tc*is;return new e(o)}toBigInt(){return this.__expiry__}toHash(){return J(this.__expiry__)}toString(){return this.__expiry__.toString()}toJSON(){return{[os]:this.toString()}}static fromJSON(t){let r=JSON.parse(t);if(r[os])try{let n=BigInt(r[os]);return new e(n)}catch(n){throw new G(new Wr(`Not a valid BigInt: ${n}`))}throw new G(new Wr(`The input does not contain the key ${os}`))}static isExpiry(t){return t instanceof e||typeof t=="object"&&t!==null&&"_isExpiry"in t&&t._isExpiry===!0&&"__expiry__"in t&&typeof t.__expiry__=="bigint"}};function Xs(e=dn){return async t=>{let r=t.request.headers;t.request.headers=r,t.endpoint===ye.Call&&(t.body.nonce=e())}}function cs(e){let t=[];return e.forEach((r,n)=>{t.push([n,r])}),t}var Ws=BigInt(0),as=BigInt(1);function ir(e,t=""){if(typeof e!="boolean"){let r=t&&`"${t}"`;throw new Error(r+"expected boolean, got type="+typeof e)}return e}function Me(e,t,r=""){let n=te(e),s=e?.length,o=t!==void 0;if(!n||o&&s!==t){let i=r&&`"${r}" `,c=o?` of length ${t}`:"",a=n?`length=${s}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return e}function ec(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Ws:BigInt("0x"+e)}function Ot(e){return ec(K(e))}function be(e){return nt(e),ec(K(Uint8Array.from(e).reverse()))}function dt(e,t){return $t(e.toString(16).padStart(t*2,"0"))}function Qs(e,t){return dt(e,t).reverse()}function rt(e,t,r){let n;if(typeof t=="string")try{n=$t(t)}catch(o){throw new Error(e+" must be hex string or Uint8Array, cause: "+o)}else if(te(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let s=n.length;if(typeof r=="number"&&s!==r)throw new Error(e+" of length "+r+" expected, got "+s);return n}function rc(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return r===0}function Js(e){return Uint8Array.from(e)}var zs=e=>typeof e=="bigint"&&Ws<=e;function to(e,t,r){return zs(e)&&zs(t)&&zs(r)&&t<=e&&e<r}function fs(e,t,r,n){if(!to(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function ge(e){let t;for(t=0;e>Ws;e>>=as,t+=1);return t}function nc(e,t){return e>>BigInt(t)&as}var Wt=e=>(as<<BigInt(e))-as;function sc(e){return typeof e=="function"&&Number.isSafeInteger(e.outputLen)}function xe(e,t,r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(s,o,i){let c=e[s];if(i&&c===void 0)return;let a=typeof c;if(a!==o||c===null)throw new Error(`param "${s}" is invalid: expected ${o}, got ${a}`)}Object.entries(t).forEach(([s,o])=>n(s,o,!1)),Object.entries(r).forEach(([s,o])=>n(s,o,!0))}var Cr=()=>{throw new Error("not implemented")};function ke(e){let t=new WeakMap;return(r,...n)=>{let s=t.get(r);if(s!==void 0)return s;let o=e(r,...n);return t.set(r,o),o}}var vt=BigInt(0),ht=BigInt(1),cr=BigInt(2),ic=BigInt(3),cc=BigInt(4),ac=BigInt(5),Ka=BigInt(7),fc=BigInt(8),Ga=BigInt(9),uc=BigInt(16);function tt(e,t){let r=e%t;return r>=vt?r:t+r}function Qt(e,t,r){let n=e;for(;t-- >vt;)n*=n,n%=r;return n}function oc(e,t){if(e===vt)throw new Error("invert: expected non-zero number");if(t<=vt)throw new Error("invert: expected positive modulus, got "+t);let r=tt(e,t),n=t,s=vt,o=ht,i=ht,c=vt;for(;r!==vt;){let u=n/r,h=n%r,d=s-i*u,f=o-c*u;n=r,r=h,s=i,o=c,i=d,c=f}if(n!==ht)throw new Error("invert: does not exist");return tt(s,t)}function eo(e,t,r){if(!e.eql(e.sqr(t),r))throw new Error("Cannot find square root")}function dc(e,t){let r=(e.ORDER+ht)/cc,n=e.pow(t,r);return eo(e,n,t),n}function Za(e,t){let r=(e.ORDER-ac)/fc,n=e.mul(t,cr),s=e.pow(n,r),o=e.mul(t,s),i=e.mul(e.mul(o,cr),s),c=e.mul(o,e.sub(i,e.ONE));return eo(e,c,t),c}function Ya(e){let t=It(e),r=lc(e),n=r(t,t.neg(t.ONE)),s=r(t,n),o=r(t,t.neg(n)),i=(e+Ka)/uc;return(c,a)=>{let u=c.pow(a,i),h=c.mul(u,n),d=c.mul(u,s),f=c.mul(u,o),l=c.eql(c.sqr(h),a),p=c.eql(c.sqr(d),a);u=c.cmov(u,h,l),h=c.cmov(f,d,p);let b=c.eql(c.sqr(h),a),g=c.cmov(u,h,b);return eo(c,g,a),g}}function lc(e){if(e<ic)throw new Error("sqrt is not defined for small field");let t=e-ht,r=0;for(;t%cr===vt;)t/=cr,r++;let n=cr,s=It(e);for(;ln(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return dc;let o=s.pow(n,t),i=(t+ht)/cr;return function(a,u){if(a.is0(u))return u;if(ln(a,u)!==1)throw new Error("Cannot find square root");let h=r,d=a.mul(a.ONE,o),f=a.pow(u,t),l=a.pow(u,i);for(;!a.eql(f,a.ONE);){if(a.is0(f))return a.ZERO;let p=1,b=a.sqr(f);for(;!a.eql(b,a.ONE);)if(p++,b=a.sqr(b),p===h)throw new Error("Cannot find square root");let g=ht<<BigInt(h-p-1),m=a.pow(d,g);h=p,d=a.sqr(m),f=a.mul(f,d),l=a.mul(l,m)}return l}}function Xa(e){return e%cc===ic?dc:e%fc===ac?Za:e%uc===Ga?Ya(e):lc(e)}var we=(e,t)=>(tt(e,t)&ht)===ht,za=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function us(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=za.reduce((n,s)=>(n[s]="function",n),t);return xe(e,r),e}function hn(e,t,r){if(r<vt)throw new Error("invalid exponent, negatives unsupported");if(r===vt)return e.ONE;if(r===ht)return t;let n=e.ONE,s=t;for(;r>vt;)r&ht&&(n=e.mul(n,s)),s=e.sqr(s),r>>=ht;return n}function Lt(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),s=t.reduce((i,c,a)=>e.is0(c)?i:(n[a]=i,e.mul(i,c)),e.ONE),o=e.inv(s);return t.reduceRight((i,c,a)=>e.is0(c)?i:(n[a]=e.mul(i,n[a]),e.mul(i,c)),o),n}function ln(e,t){let r=(e.ORDER-ht)/cr,n=e.pow(t,r),s=e.eql(n,e.ONE),o=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!s&&!o&&!i)throw new Error("invalid Legendre symbol result");return s?1:o?0:-1}function ro(e,t){t!==void 0&&Ss(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function It(e,t,r=!1,n={}){if(e<=vt)throw new Error("invalid field: expected ORDER > 0, got "+e);let s,o,i=!1,c;if(typeof t=="object"&&t!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=t;f.BITS&&(s=f.BITS),f.sqrt&&(o=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(i=f.modFromBytes),c=f.allowedLengths}else typeof t=="number"&&(s=t),n.sqrt&&(o=n.sqrt);let{nBitLength:a,nByteLength:u}=ro(e,s);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h,d=Object.freeze({ORDER:e,isLE:r,BITS:a,BYTES:u,MASK:Wt(a),ZERO:vt,ONE:ht,allowedLengths:c,create:f=>tt(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return vt<=f&&f<e},is0:f=>f===vt,isValidNot0:f=>!d.is0(f)&&d.isValid(f),isOdd:f=>(f&ht)===ht,neg:f=>tt(-f,e),eql:(f,l)=>f===l,sqr:f=>tt(f*f,e),add:(f,l)=>tt(f+l,e),sub:(f,l)=>tt(f-l,e),mul:(f,l)=>tt(f*l,e),pow:(f,l)=>hn(d,f,l),div:(f,l)=>tt(f*oc(l,e),e),sqrN:f=>f*f,addN:(f,l)=>f+l,subN:(f,l)=>f-l,mulN:(f,l)=>f*l,inv:f=>oc(f,e),sqrt:o||(f=>(h||(h=Xa(e)),h(d,f))),toBytes:f=>r?Qs(f,u):dt(f,u),fromBytes:(f,l=!0)=>{if(c){if(!c.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);let b=new Uint8Array(u);b.set(f,r?0:b.length-f.length),f=b}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let p=r?be(f):Ot(f);if(i&&(p=tt(p,e)),!l&&!d.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>Lt(d,f),cmov:(f,l,p)=>p?l:f});return Object.freeze(d)}function hc(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function ds(e){let t=hc(e);return t+Math.ceil(t/2)}function no(e,t,r=!1){let n=e.length,s=hc(t),o=ds(t);if(n<16||n<o||n>1024)throw new Error("expected "+o+"-1024 bytes of input, got "+n);let i=r?be(e):Ot(e),c=tt(i,t-ht)+ht;return r?Qs(c,s):dt(c,s)}var Rr=BigInt(0),ar=BigInt(1);function pn(e,t){let r=t.negate();return e?r:t}function Pt(e,t){let r=Lt(e.Fp,t.map(n=>n.Z));return t.map((n,s)=>e.fromAffine(n.toAffine(r[s])))}function bc(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function so(e,t){bc(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),s=2**e,o=Wt(e),i=BigInt(e);return{windows:r,windowSize:n,mask:o,maxNumber:s,shiftBy:i}}function pc(e,t,r){let{windowSize:n,mask:s,maxNumber:o,shiftBy:i}=r,c=Number(e&s),a=e>>i;c>n&&(c-=o,a+=ar);let u=t*n,h=u+Math.abs(c)-1,d=c===0,f=c<0,l=t%2!==0;return{nextN:a,offset:h,isZero:d,isNeg:f,isNegF:l,offsetF:u}}function Qa(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function Ja(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}var oo=new WeakMap,gc=new WeakMap;function io(e){return gc.get(e)||1}function mc(e){if(e!==Rr)throw new Error("invalid wNAF")}var Nr=class{constructor(t,r){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=r}_unsafeLadder(t,r,n=this.ZERO){let s=t;for(;r>Rr;)r&ar&&(n=n.add(s)),s=s.double(),r>>=ar;return n}precomputeWindow(t,r){let{windows:n,windowSize:s}=so(r,this.bits),o=[],i=t,c=i;for(let a=0;a<n;a++){c=i,o.push(c);for(let u=1;u<s;u++)c=c.add(i),o.push(c);i=c.double()}return o}wNAF(t,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,o=this.BASE,i=so(t,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:u,isZero:h,isNeg:d,isNegF:f,offsetF:l}=pc(n,c,i);n=a,h?o=o.add(pn(f,r[l])):s=s.add(pn(d,r[u]))}return mc(n),{p:s,f:o}}wNAFUnsafe(t,r,n,s=this.ZERO){let o=so(t,this.bits);for(let i=0;i<o.windows&&n!==Rr;i++){let{nextN:c,offset:a,isZero:u,isNeg:h}=pc(n,i,o);if(n=c,!u){let d=r[a];s=s.add(h?d.negate():d)}}return mc(n),s}getPrecomputes(t,r,n){let s=oo.get(r);return s||(s=this.precomputeWindow(r,t),t!==1&&(typeof n=="function"&&(s=n(s)),oo.set(r,s))),s}cached(t,r,n){let s=io(t);return this.wNAF(s,this.getPrecomputes(s,t,n),r)}unsafe(t,r,n,s){let o=io(t);return o===1?this._unsafeLadder(t,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,n),r,s)}createCache(t,r){bc(r,this.bits),gc.set(t,r),oo.delete(t)}hasCache(t){return io(t)!==1}};function xc(e,t,r,n){let s=t,o=e.ZERO,i=e.ZERO;for(;r>Rr||n>Rr;)r&ar&&(o=o.add(s)),n&ar&&(i=i.add(s)),s=s.double(),r>>=ar,n>>=ar;return{p1:o,p2:i}}function Ur(e,t,r,n){Qa(r,e),Ja(n,t);let s=r.length,o=n.length;if(s!==o)throw new Error("arrays of points and scalars must have equal length");let i=e.ZERO,c=ge(BigInt(s)),a=1;c>12?a=c-3:c>4?a=c-2:c>0&&(a=2);let u=Wt(a),h=new Array(Number(u)+1).fill(i),d=Math.floor((t.BITS-1)/a)*a,f=i;for(let l=d;l>=0;l-=a){h.fill(i);for(let b=0;b<o;b++){let g=n[b],m=Number(g>>BigInt(l)&u);h[m]=h[m].add(r[b])}let p=i;for(let b=h.length-1,g=i;b>0;b--)g=g.add(h[b]),p=p.add(g);if(f=f.add(p),l!==0)for(let b=0;b<a;b++)f=f.double()}return f}function yc(e,t,r){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return us(t),t}else return It(e,{isLE:r})}function ls(e,t,r={},n){if(n===void 0&&(n=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let u=t[a];if(!(typeof u=="bigint"&&u>Rr))throw new Error(`CURVE.${a} must be positive bigint`)}let s=yc(t.p,r.Fp,n),o=yc(t.n,r.Fn,n),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of c)if(!s.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:s,Fn:o}}var tf=Ot;function Fe(e,t){if(mn(e),mn(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);let r=Array.from({length:t}).fill(0);for(let n=t-1;n>=0;n--)r[n]=e&255,e>>>=8;return new Uint8Array(r)}function ef(e,t){let r=new Uint8Array(e.length);for(let n=0;n<e.length;n++)r[n]=e[n]^t[n];return r}function mn(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function wc(e){if(!te(e)&&typeof e!="string")throw new Error("DST must be Uint8Array or string");return typeof e=="string"?z(e):e}function rf(e,t,r,n){nt(e),mn(r),t=wc(t),t.length>255&&(t=n(F(z("H2C-OVERSIZE-DST-"),t)));let{outputLen:s,blockLen:o}=n,i=Math.ceil(r/s);if(r>65535||i>255)throw new Error("expand_message_xmd: invalid lenInBytes");let c=F(t,Fe(t.length,1)),a=Fe(0,o),u=Fe(r,2),h=new Array(i),d=n(F(a,e,u,Fe(0,1),c));h[0]=n(F(d,Fe(1,1),c));for(let l=1;l<=i;l++){let p=[ef(d,h[l-1]),Fe(l+1,1),c];h[l]=n(F(...p))}return F(...h).slice(0,r)}function nf(e,t,r,n,s){if(nt(e),mn(r),t=wc(t),t.length>255){let o=Math.ceil(2*n/8);t=s.create({dkLen:o}).update(z("H2C-OVERSIZE-DST-")).update(t).digest()}if(r>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return s.create({dkLen:r}).update(e).update(Fe(r,2)).update(t).update(Fe(t.length,1)).digest()}function co(e,t,r){xe(r,{p:"bigint",m:"number",k:"number",hash:"function"});let{p:n,k:s,m:o,hash:i,expand:c,DST:a}=r;if(!sc(r.hash))throw new Error("expected valid hash");nt(e),mn(t);let u=n.toString(2).length,h=Math.ceil((u+s)/8),d=t*o*h,f;if(c==="xmd")f=rf(e,a,d,i);else if(c==="xof")f=nf(e,a,d,s,i);else if(c==="_internal_pass")f=e;else throw new Error('expand must be "xmd" or "xof"');let l=new Array(t);for(let p=0;p<t;p++){let b=new Array(o);for(let g=0;g<o;g++){let m=h*(g+p*o),w=f.subarray(m,m+h);b[g]=tt(tf(w),n)}l[p]=b}return l}function ao(e,t){let r=t.map(n=>Array.from(n).reverse());return(n,s)=>{let[o,i,c,a]=r.map(d=>d.reduce((f,l)=>e.add(e.mul(f,n),l))),[u,h]=Lt(e,[i,a],!0);return n=e.mul(o,u),s=e.mul(s,e.mul(c,h)),{x:n,y:s}}}var sf=z("HashToScalar-");function fo(e,t,r){if(typeof t!="function")throw new Error("mapToCurve() must be defined");function n(o){return e.fromAffine(t(o))}function s(o){let i=o.clearCofactor();return i.equals(e.ZERO)?e.ZERO:(i.assertValidity(),i)}return{defaults:r,hashToCurve(o,i){let c=Object.assign({},r,i),a=co(o,2,c),u=n(a[0]),h=n(a[1]);return s(u.add(h))},encodeToCurve(o,i){let c=r.encodeDST?{DST:r.encodeDST}:{},a=Object.assign({},r,c,i),u=co(o,1,a),h=n(u[0]);return s(h)},mapToCurve(o){if(!Array.isArray(o))throw new Error("expected array of bigints");for(let i of o)if(typeof i!="bigint")throw new Error("expected array of bigints");return s(n(o))},hashToScalar(o,i){let c=e.Fn.ORDER,a=Object.assign({},r,{p:c,m:1,DST:sf},i);return co(o,1,a)[0][0]}}}var Ec=(e,t)=>(e+(e>=0?t:-t)/Ee)/t;function of(e,t,r){let[[n,s],[o,i]]=t,c=Ec(i*e,r),a=Ec(-s*e,r),u=e-c*n-a*o,h=-c*s-a*i,d=u<fr,f=h<fr;d&&(u=-u),f&&(h=-h);let l=Wt(Math.ceil(ge(r)/2))+Tt;if(u<fr||u>=l||h<fr||h>=l)throw new Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:d,k1:u,k2neg:f,k2:h}}var fr=BigInt(0),Tt=BigInt(1),Ee=BigInt(2),qr=BigInt(3),uo=BigInt(4);function yn(e,t){let{BYTES:r}=e,n;if(typeof t=="bigint")n=t;else{let s=rt("private key",t);try{n=e.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof t}`)}}if(!e.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function cf(e,t={}){let r=ls("weierstrass",e,t),{Fp:n,Fn:s}=r,o=r.CURVE,{h:i,n:c}=o;xe(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:a}=t;if(a&&(!n.is0(o.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=uf(n,s);function h(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(C,x,B){let{x:R,y:P}=x.toAffine(),V=n.toBytes(R);if(ir(B,"isCompressed"),B){h();let O=!n.isOdd(P);return F(af(O),V)}else return F(Uint8Array.of(4),V,n.toBytes(P))}function f(C){Me(C,void 0,"Point");let{publicKey:x,publicKeyUncompressed:B}=u,R=C.length,P=C[0],V=C.subarray(1);if(R===x&&(P===2||P===3)){let O=n.fromBytes(V);if(!n.isValid(O))throw new Error("bad point: is not on curve, wrong x");let N=b(O),q;try{q=n.sqrt(N)}catch(mt){let ct=mt instanceof Error?": "+mt.message:"";throw new Error("bad point: is not on curve, sqrt error"+ct)}h();let D=n.isOdd(q);return(P&1)===1!==D&&(q=n.neg(q)),{x:O,y:q}}else if(R===B&&P===4){let O=n.BYTES,N=n.fromBytes(V.subarray(0,O)),q=n.fromBytes(V.subarray(O,O*2));if(!g(N,q))throw new Error("bad point: is not on curve");return{x:N,y:q}}else throw new Error(`bad point: got length ${R}, expected compressed=${x} or uncompressed=${B}`)}let l=t.toBytes||d,p=t.fromBytes||f;function b(C){let x=n.sqr(C),B=n.mul(x,C);return n.add(n.add(B,n.mul(C,o.a)),o.b)}function g(C,x){let B=n.sqr(x),R=b(C);return n.eql(B,R)}if(!g(o.Gx,o.Gy))throw new Error("bad curve params: generator point");let m=n.mul(n.pow(o.a,qr),uo),w=n.mul(n.sqr(o.b),BigInt(27));if(n.is0(n.add(m,w)))throw new Error("bad curve params: a or b");function y(C,x,B=!1){if(!n.isValid(x)||B&&n.is0(x))throw new Error(`bad point coordinate ${C}`);return x}function _(C){if(!(C instanceof E))throw new Error("ProjectivePoint expected")}function v(C){if(!a||!a.basises)throw new Error("no endo");return of(C,a.basises,s.ORDER)}let I=ke((C,x)=>{let{X:B,Y:R,Z:P}=C;if(n.eql(P,n.ONE))return{x:B,y:R};let V=C.is0();x==null&&(x=V?n.ONE:n.inv(P));let O=n.mul(B,x),N=n.mul(R,x),q=n.mul(P,x);if(V)return{x:n.ZERO,y:n.ZERO};if(!n.eql(q,n.ONE))throw new Error("invZ was invalid");return{x:O,y:N}}),T=ke(C=>{if(C.is0()){if(t.allowInfinityPoint&&!n.is0(C.Y))return;throw new Error("bad point: ZERO")}let{x,y:B}=C.toAffine();if(!n.isValid(x)||!n.isValid(B))throw new Error("bad point: x or y not field elements");if(!g(x,B))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function A(C,x,B,R,P){return B=new E(n.mul(B.X,C),B.Y,B.Z),x=pn(R,x),B=pn(P,B),x.add(B)}class E{constructor(x,B,R){this.X=y("x",x),this.Y=y("y",B,!0),this.Z=y("z",R),Object.freeze(this)}static CURVE(){return o}static fromAffine(x){let{x:B,y:R}=x||{};if(!x||!n.isValid(B)||!n.isValid(R))throw new Error("invalid affine point");if(x instanceof E)throw new Error("projective point not allowed");return n.is0(B)&&n.is0(R)?E.ZERO:new E(B,R,n.ONE)}static fromBytes(x){let B=E.fromAffine(p(Me(x,void 0,"point")));return B.assertValidity(),B}static fromHex(x){return E.fromBytes(rt("pointHex",x))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,B=!0){return U.createCache(this,x),B||this.multiply(qr),this}assertValidity(){T(this)}hasEvenY(){let{y:x}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(x)}equals(x){_(x);let{X:B,Y:R,Z:P}=this,{X:V,Y:O,Z:N}=x,q=n.eql(n.mul(B,N),n.mul(V,P)),D=n.eql(n.mul(R,N),n.mul(O,P));return q&&D}negate(){return new E(this.X,n.neg(this.Y),this.Z)}double(){let{a:x,b:B}=o,R=n.mul(B,qr),{X:P,Y:V,Z:O}=this,N=n.ZERO,q=n.ZERO,D=n.ZERO,M=n.mul(P,P),mt=n.mul(V,V),ct=n.mul(O,O),W=n.mul(P,V);return W=n.add(W,W),D=n.mul(P,O),D=n.add(D,D),N=n.mul(x,D),q=n.mul(R,ct),q=n.add(N,q),N=n.sub(mt,q),q=n.add(mt,q),q=n.mul(N,q),N=n.mul(W,N),D=n.mul(R,D),ct=n.mul(x,ct),W=n.sub(M,ct),W=n.mul(x,W),W=n.add(W,D),D=n.add(M,M),M=n.add(D,M),M=n.add(M,ct),M=n.mul(M,W),q=n.add(q,M),ct=n.mul(V,O),ct=n.add(ct,ct),M=n.mul(ct,W),N=n.sub(N,M),D=n.mul(ct,mt),D=n.add(D,D),D=n.add(D,D),new E(N,q,D)}add(x){_(x);let{X:B,Y:R,Z:P}=this,{X:V,Y:O,Z:N}=x,q=n.ZERO,D=n.ZERO,M=n.ZERO,mt=o.a,ct=n.mul(o.b,qr),W=n.mul(B,V),kt=n.mul(R,O),Ft=n.mul(P,N),pr=n.add(B,R),Et=n.add(V,O);pr=n.mul(pr,Et),Et=n.add(W,kt),pr=n.sub(pr,Et),Et=n.add(B,P);let Jt=n.add(V,N);return Et=n.mul(Et,Jt),Jt=n.add(W,Ft),Et=n.sub(Et,Jt),Jt=n.add(R,P),q=n.add(O,N),Jt=n.mul(Jt,q),q=n.add(kt,Ft),Jt=n.sub(Jt,q),M=n.mul(mt,Et),q=n.mul(ct,Ft),M=n.add(q,M),q=n.sub(kt,M),M=n.add(kt,M),D=n.mul(q,M),kt=n.add(W,W),kt=n.add(kt,W),Ft=n.mul(mt,Ft),Et=n.mul(ct,Et),kt=n.add(kt,Ft),Ft=n.sub(W,Ft),Ft=n.mul(mt,Ft),Et=n.add(Et,Ft),W=n.mul(kt,Et),D=n.add(D,W),W=n.mul(Jt,Et),q=n.mul(pr,q),q=n.sub(q,W),W=n.mul(pr,kt),M=n.mul(Jt,M),M=n.add(M,W),new E(q,D,M)}subtract(x){return this.add(x.negate())}is0(){return this.equals(E.ZERO)}multiply(x){let{endo:B}=t;if(!s.isValidNot0(x))throw new Error("invalid scalar: out of range");let R,P,V=O=>U.cached(this,O,N=>Pt(E,N));if(B){let{k1neg:O,k1:N,k2neg:q,k2:D}=v(x),{p:M,f:mt}=V(N),{p:ct,f:W}=V(D);P=mt.add(W),R=A(B.beta,M,ct,O,q)}else{let{p:O,f:N}=V(x);R=O,P=N}return Pt(E,[R,P])[0]}multiplyUnsafe(x){let{endo:B}=t,R=this;if(!s.isValid(x))throw new Error("invalid scalar: out of range");if(x===fr||R.is0())return E.ZERO;if(x===Tt)return R;if(U.hasCache(this))return this.multiply(x);if(B){let{k1neg:P,k1:V,k2neg:O,k2:N}=v(x),{p1:q,p2:D}=xc(E,R,V,N);return A(B.beta,q,D,P,O)}else return U.unsafe(R,x)}multiplyAndAddUnsafe(x,B,R){let P=this.multiplyUnsafe(B).add(x.multiplyUnsafe(R));return P.is0()?void 0:P}toAffine(x){return I(this,x)}isTorsionFree(){let{isTorsionFree:x}=t;return i===Tt?!0:x?x(E,this):U.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:x}=t;return i===Tt?this:x?x(E,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(x=!0){return ir(x,"isCompressed"),this.assertValidity(),l(E,this,x)}toHex(x=!0){return K(this.toBytes(x))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(x=!0){return this.toBytes(x)}_setWindowSize(x){this.precompute(x)}static normalizeZ(x){return Pt(E,x)}static msm(x,B){return Ur(E,s,x,B)}static fromPrivateKey(x){return E.BASE.multiply(yn(s,x))}}E.BASE=new E(o.Gx,o.Gy,n.ONE),E.ZERO=new E(n.ZERO,n.ONE,n.ZERO),E.Fp=n,E.Fn=s;let S=s.BITS,U=new Nr(E,t.endo?Math.ceil(S/2):S);return E.BASE.precompute(8),E}function af(e){return Uint8Array.of(e?2:3)}function ff(e,t){let r=e.ORDER,n=fr;for(let p=r-Tt;p%Ee===fr;p/=Ee)n+=Tt;let s=n,o=Ee<<s-Tt-Tt,i=o*Ee,c=(r-Tt)/i,a=(c-Tt)/Ee,u=i-Tt,h=o,d=e.pow(t,c),f=e.pow(t,(c+Tt)/Ee),l=(p,b)=>{let g=d,m=e.pow(b,u),w=e.sqr(m);w=e.mul(w,b);let y=e.mul(p,w);y=e.pow(y,a),y=e.mul(y,m),m=e.mul(y,b),w=e.mul(y,p);let _=e.mul(w,m);y=e.pow(_,h);let v=e.eql(y,e.ONE);m=e.mul(w,f),y=e.mul(_,g),w=e.cmov(m,w,v),_=e.cmov(y,_,v);for(let I=s;I>Tt;I--){let T=I-Ee;T=Ee<<T-Tt;let A=e.pow(_,T),E=e.eql(A,e.ONE);m=e.mul(w,g),g=e.mul(g,g),A=e.mul(_,g),w=e.cmov(m,w,E),_=e.cmov(A,_,E)}return{isValid:v,value:w}};if(e.ORDER%uo===qr){let p=(e.ORDER-qr)/uo,b=e.sqrt(e.neg(t));l=(g,m)=>{let w=e.sqr(m),y=e.mul(g,m);w=e.mul(w,y);let _=e.pow(w,p);_=e.mul(_,y);let v=e.mul(_,b),I=e.mul(e.sqr(_),m),T=e.eql(I,g),A=e.cmov(v,_,T);return{isValid:T,value:A}}}return l}function lo(e,t){us(e);let{A:r,B:n,Z:s}=t;if(!e.isValid(r)||!e.isValid(n)||!e.isValid(s))throw new Error("mapToCurveSimpleSWU: invalid opts");let o=ff(e,s);if(!e.isOdd)throw new Error("Field does not have .isOdd()");return i=>{let c,a,u,h,d,f,l,p;c=e.sqr(i),c=e.mul(c,s),a=e.sqr(c),a=e.add(a,c),u=e.add(a,e.ONE),u=e.mul(u,n),h=e.cmov(s,e.neg(a),!e.eql(a,e.ZERO)),h=e.mul(h,r),a=e.sqr(u),f=e.sqr(h),d=e.mul(f,r),a=e.add(a,d),a=e.mul(a,u),f=e.mul(f,h),d=e.mul(f,n),a=e.add(a,d),l=e.mul(c,u);let{isValid:b,value:g}=o(a,f);p=e.mul(c,i),p=e.mul(p,g),l=e.cmov(l,u,b),p=e.cmov(p,g,b);let m=e.isOdd(i)===e.isOdd(p);p=e.cmov(e.neg(p),p,m);let w=Lt(e,[h],!0)[0];return l=e.mul(l,w),{x:l,y:p}}}function uf(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function ho(e){let{CURVE:t,curveOpts:r}=df(e),n=cf(t,r);return hf(e,n)}function df(e){let t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(i=>Math.ceil(i/2)))):void 0,s=It(t.n,{BITS:e.nBitLength,allowedLengths:n,modFromBytes:e.wrapPrivateKey}),o={Fp:r,Fn:s,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:o}}function lf(e,t,r){function n(s){let o=e.sqr(s),i=e.mul(o,s);return e.add(e.add(i,e.mul(s,t)),r)}return n}function hf(e,t){let{Fp:r,Fn:n}=t;function s(i){return to(i,Tt,n.ORDER)}let o=lf(r,e.a,e.b);return Object.assign({},{CURVE:e,Point:t,ProjectivePoint:t,normPrivateKeyToScalar:i=>yn(n,i),weierstrassEquation:o,isWithinCurveOrder:s})}var pf=BigInt(0),hs=BigInt(1),_c=BigInt(2),Lr=BigInt(3);function mf(e){let t=[];for(;e>hs;e>>=hs)(e&hs)===pf?t.unshift(0):(e&Lr)===Lr?(t.unshift(-1),e+=hs):t.unshift(1);return t}function po(e){if(!Array.isArray(e)||e.length===0)throw new Error("expected non-empty array")}function yf(e,t,r,n){let{Fp2:s,Fp12:o}=e,{twistType:i,ateLoopSize:c,xNegative:a,postPrecompute:u}=n,h;if(i==="multiplicative")h=(y,_,v,I,T,A)=>o.mul014(I,y,s.mul(_,T),s.mul(v,A));else if(i==="divisive")h=(y,_,v,I,T,A)=>o.mul034(I,s.mul(v,A),s.mul(_,T),y);else throw new Error("bls: unknown twist type");let d=s.div(s.ONE,s.mul(s.ONE,_c));function f(y,_,v,I){let T=s.sqr(v),A=s.sqr(I),E=s.mulByB(s.mul(A,Lr)),S=s.mul(E,Lr),U=s.sub(s.sub(s.sqr(s.add(v,I)),A),T),C=s.sub(E,T),x=s.mul(s.sqr(_),Lr),B=s.neg(U);return y.push([C,x,B]),_=s.mul(s.mul(s.mul(s.sub(T,S),_),v),d),v=s.sub(s.sqr(s.mul(s.add(T,S),d)),s.mul(s.sqr(E),Lr)),I=s.mul(T,U),{Rx:_,Ry:v,Rz:I}}function l(y,_,v,I,T,A){let E=s.sub(v,s.mul(A,I)),S=s.sub(_,s.mul(T,I)),U=s.sub(s.mul(E,T),s.mul(S,A)),C=s.neg(E),x=S;y.push([U,C,x]);let B=s.sqr(S),R=s.mul(B,S),P=s.mul(B,_),V=s.add(s.sub(R,s.mul(P,_c)),s.mul(s.sqr(E),I));return _=s.mul(S,V),v=s.sub(s.mul(s.sub(P,V),E),s.mul(R,v)),I=s.mul(I,R),{Rx:_,Ry:v,Rz:I}}let p=mf(c),b=ke(y=>{let _=y,{x:v,y:I}=_.toAffine(),T=v,A=I,E=s.neg(I),S=T,U=A,C=s.ONE,x=[];for(let B of p){let R=[];({Rx:S,Ry:U,Rz:C}=f(R,S,U,C)),B&&({Rx:S,Ry:U,Rz:C}=l(R,S,U,C,T,B===-1?E:A)),x.push(R)}if(u){let B=x[x.length-1];u(S,U,C,T,A,l.bind(null,B))}return x});function g(y,_=!1){let v=o.ONE;if(y.length){let I=y[0][0].length;for(let T=0;T<I;T++){v=o.sqr(v);for(let[A,E,S]of y)for(let[U,C,x]of A[T])v=h(U,C,x,v,E,S)}}return a&&(v=o.conjugate(v)),_?o.finalExponentiate(v):v}function m(y,_=!0){let v=[];Pt(t,y.map(({g1:I})=>I)),Pt(r,y.map(({g2:I})=>I));for(let{g1:I,g2:T}of y){if(I.is0()||T.is0())throw new Error("pairing is not available for ZERO point");I.assertValidity(),T.assertValidity();let A=I.toAffine();v.push([b(T),A.x,A.y])}return g(v,_)}function w(y,_,v=!0){return m([{g1:y,g2:_}],v)}return{Fp12:o,millerLoopBatch:g,pairing:w,pairingBatch:m,calcPairingPrecomputes:b}}function Bc(e,t,r,n,s){let{Fp12:o,pairingBatch:i}=e;function c(d){return d instanceof t.Point?d:t.Point.fromHex(d)}function a(d){return d instanceof r.Point?d:r.Point.fromHex(d)}function u(d){if(!(d instanceof r.Point))throw new Error(`expected valid message hashed to ${s?"G1":"G2"} curve`);return d}let h=s?(d,f)=>({g1:f,g2:d}):(d,f)=>({g1:d,g2:f});return{getPublicKey(d){let f=yn(t.Point.Fn,d);return t.Point.BASE.multiply(f)},sign(d,f,l){if(l!=null)throw new Error("sign() expects 2 arguments");let p=yn(t.Point.Fn,f);return u(d).assertValidity(),d.multiply(p)},verify(d,f,l,p){if(p!=null)throw new Error("verify() expects 3 arguments");d=a(d),l=c(l);let b=l.negate(),g=t.Point.BASE,m=u(f),w=d,y=i([h(b,m),h(g,w)]);return o.eql(y,o.ONE)},verifyBatch(d,f,l){if(po(f),l.length!==f.length)throw new Error("amount of public keys and messages should be equal");let p=a(d),b=f,g=l.map(c),m=new Map;for(let _=0;_<g.length;_++){let v=g[_],I=b[_],T=m.get(I);T===void 0&&(T=[],m.set(I,T)),T.push(v)}let w=[],y=t.Point.BASE;try{for(let[_,v]of m){let I=v.reduce((T,A)=>T.add(A));w.push(h(I,_))}return w.push(h(y.negate(),p)),o.eql(i(w),o.ONE)}catch{return!1}},aggregatePublicKeys(d){po(d),d=d.map(l=>c(l));let f=d.reduce((l,p)=>l.add(p),t.Point.ZERO);return f.assertValidity(),f},aggregateSignatures(d){po(d),d=d.map(l=>a(l));let f=d.reduce((l,p)=>l.add(p),r.Point.ZERO);return f.assertValidity(),f},hash(d,f){nt(d);let l=f?{DST:f}:void 0;return r.hashToCurve(d,l)},Signature:n}}function vc(e){let{Fp:t,Fr:r,Fp2:n,Fp6:s,Fp12:o}=e.fields,i=ho(e.G1),c=Object.assign(i,fo(i.Point,e.G1.mapToCurve,{...e.htfDefaults,...e.G1.htfDefaults})),a=ho(e.G2),u=Object.assign(a,fo(a.Point,e.G2.mapToCurve,{...e.htfDefaults,...e.G2.htfDefaults})),h=yf(e.fields,c.Point,u.Point,{...e.params,postPrecompute:e.postPrecompute}),{millerLoopBatch:d,pairing:f,pairingBatch:l,calcPairingPrecomputes:p}=h,b=Bc(h,c,u,e.G2.Signature,!1),g=Bc(h,u,c,e.G1.ShortSignature,!0),m=e.randomBytes||yr,w=()=>{let O=ds(r.ORDER);return no(m(O),r.ORDER)},y={randomSecretKey:w,randomPrivateKey:w,calcPairingPrecomputes:p},{ShortSignature:_}=e.G1,{Signature:v}=e.G2;function I(O,N){return O instanceof c.Point?O:g.hash(rt("point",O),N?.DST)}function T(O,N){return O instanceof u.Point?O:b.hash(rt("point",O),N?.DST)}function A(O){return b.getPublicKey(O).toBytes(!0)}function E(O){return g.getPublicKey(O).toBytes(!0)}function S(O,N,q){let D=T(O,q),M=b.sign(D,N);return O instanceof u.Point?M:v.toBytes(M)}function U(O,N,q){let D=I(O,q),M=g.sign(D,N);return O instanceof c.Point?M:_.toBytes(M)}function C(O,N,q,D){let M=T(N,D);return b.verify(O,M,q)}function x(O,N,q,D){let M=I(N,D);return g.verify(O,M,q)}function B(O){let N=b.aggregatePublicKeys(O);return O[0]instanceof c.Point?N:N.toBytes(!0)}function R(O){let N=b.aggregateSignatures(O);return O[0]instanceof u.Point?N:v.toBytes(N)}function P(O){let N=g.aggregateSignatures(O);return O[0]instanceof c.Point?N:_.toBytes(N)}function V(O,N,q,D){let M=N.map(mt=>T(mt,D));return b.verifyBatch(O,M,q)}return c.Point.BASE.precompute(4),{longSignatures:b,shortSignatures:g,millerLoopBatch:d,pairing:f,pairingBatch:l,verifyBatch:V,fields:{Fr:r,Fp:t,Fp2:n,Fp6:s,Fp12:o},params:{ateLoopSize:e.params.ateLoopSize,twistType:e.params.twistType,r:e.params.r,G1b:e.G1.b,G2b:e.G2.b},utils:y,getPublicKey:A,getPublicKeyForShortSignatures:E,sign:S,signShortSignature:U,verify:C,verifyShortSignature:x,aggregatePublicKeys:B,aggregateSignatures:R,aggregateShortSignatures:P,G1:c,G2:u,Signature:v,ShortSignature:_}}var Ic=BigInt(0),_e=BigInt(1),St=BigInt(2),Tc=BigInt(3);function go(e,t,r,n,s=1,o){let i=BigInt(o===void 0?n:o),c=r**BigInt(n),a=[];for(let u=0;u<s;u++){let h=BigInt(u+1),d=[];for(let f=0,l=_e;f<n;f++){let p=(h*l-h)/i%c;d.push(e.pow(t,p)),l*=r}a.push(d)}return a}function Ac(e,t,r){let n=t.pow(r,(e.ORDER-_e)/Tc),s=t.pow(r,(e.ORDER-_e)/St);function o(f,l){let p=t.mul(t.frobeniusMap(f,1),n),b=t.mul(t.frobeniusMap(l,1),s);return[p,b]}let i=t.pow(r,(e.ORDER**St-_e)/Tc),c=t.pow(r,(e.ORDER**St-_e)/St);if(!t.eql(c,t.neg(t.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function a(f,l){return[t.mul(f,i),t.neg(l)]}let u=f=>(l,p)=>{let b=p.toAffine(),g=f(b.x,b.y);return l.fromAffine({x:g[0],y:g[1]})},h=u(o),d=u(a);return{psi:o,psi2:a,G2psi:h,G2psi2:d,PSI_X:n,PSI_Y:s,PSI2_X:i,PSI2_Y:c}}var Sc=(e,t)=>{if(t.length!==2)throw new Error("invalid tuple");let r=t.map(n=>e.create(n));return{c0:r[0],c1:r[1]}},mo=class{constructor(t,r={}){this.MASK=_e;let n=t.ORDER,s=n*n;this.Fp=t,this.ORDER=s,this.BITS=ge(s),this.BYTES=Math.ceil(ge(s)/8),this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO},this.Fp_NONRESIDUE=t.create(r.NONRESIDUE||BigInt(-1)),this.Fp_div2=t.div(t.ONE,St),this.NONRESIDUE=Sc(t,r.FP2_NONRESIDUE),this.FROBENIUS_COEFFICIENTS=go(t,this.Fp_NONRESIDUE,t.ORDER,2)[0],this.mulByB=r.Fp2mulByB,Object.seal(this)}fromBigTuple(t){return Sc(this.Fp,t)}create(t){return t}isValid({c0:t,c1:r}){function n(s,o){return typeof s=="bigint"&&Ic<=s&&s<o}return n(t,this.ORDER)&&n(r,this.ORDER)}is0({c0:t,c1:r}){return this.Fp.is0(t)&&this.Fp.is0(r)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}eql({c0:t,c1:r},{c0:n,c1:s}){return this.Fp.eql(t,n)&&this.Fp.eql(r,s)}neg({c0:t,c1:r}){return{c0:this.Fp.neg(t),c1:this.Fp.neg(r)}}pow(t,r){return hn(this,t,r)}invertBatch(t){return Lt(this,t)}add(t,r){let{c0:n,c1:s}=t,{c0:o,c1:i}=r;return{c0:this.Fp.add(n,o),c1:this.Fp.add(s,i)}}sub({c0:t,c1:r},{c0:n,c1:s}){return{c0:this.Fp.sub(t,n),c1:this.Fp.sub(r,s)}}mul({c0:t,c1:r},n){let{Fp:s}=this;if(typeof n=="bigint")return{c0:s.mul(t,n),c1:s.mul(r,n)};let{c0:o,c1:i}=n,c=s.mul(t,o),a=s.mul(r,i),u=s.sub(c,a),h=s.sub(s.mul(s.add(t,r),s.add(o,i)),s.add(c,a));return{c0:u,c1:h}}sqr({c0:t,c1:r}){let{Fp:n}=this,s=n.add(t,r),o=n.sub(t,r),i=n.add(t,t);return{c0:n.mul(s,o),c1:n.mul(i,r)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}div(t,r){let{Fp:n}=this;return this.mul(t,typeof r=="bigint"?n.inv(n.create(r)):this.inv(r))}inv({c0:t,c1:r}){let{Fp:n}=this,s=n.inv(n.create(t*t+r*r));return{c0:n.mul(s,n.create(t)),c1:n.mul(s,n.create(-r))}}sqrt(t){let{Fp:r}=this,n=this,{c0:s,c1:o}=t;if(r.is0(o))return ln(r,s)===1?n.create({c0:r.sqrt(s),c1:r.ZERO}):n.create({c0:r.ZERO,c1:r.sqrt(r.div(s,this.Fp_NONRESIDUE))});let i=r.sqrt(r.sub(r.sqr(s),r.mul(r.sqr(o),this.Fp_NONRESIDUE))),c=r.mul(r.add(i,s),this.Fp_div2);ln(r,c)===-1&&(c=r.sub(c,i));let u=r.sqrt(c),h=n.create({c0:u,c1:r.div(r.mul(o,this.Fp_div2),u)});if(!n.eql(n.sqr(h),t))throw new Error("Cannot find square root");let d=h,f=n.neg(d),{re:l,im:p}=n.reim(d),{re:b,im:g}=n.reim(f);return p>g||p===g&&l>b?d:f}isOdd(t){let{re:r,im:n}=this.reim(t),s=r%St,o=r===Ic,i=n%St;return BigInt(s||o&&i)==_e}fromBytes(t){let{Fp:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);return{c0:r.fromBytes(t.subarray(0,r.BYTES)),c1:r.fromBytes(t.subarray(r.BYTES))}}toBytes({c0:t,c1:r}){return F(this.Fp.toBytes(t),this.Fp.toBytes(r))}cmov({c0:t,c1:r},{c0:n,c1:s},o){return{c0:this.Fp.cmov(t,n,o),c1:this.Fp.cmov(r,s,o)}}reim({c0:t,c1:r}){return{re:t,im:r}}Fp4Square(t,r){let n=this,s=n.sqr(t),o=n.sqr(r);return{first:n.add(n.mulByNonresidue(o),s),second:n.sub(n.sub(n.sqr(n.add(t,r)),s),o)}}mulByNonresidue({c0:t,c1:r}){return this.mul({c0:t,c1:r},this.NONRESIDUE)}frobeniusMap({c0:t,c1:r},n){return{c0:t,c1:this.Fp.mul(r,this.FROBENIUS_COEFFICIENTS[n%2])}}},yo=class{constructor(t){this.MASK=_e,this.Fp2=t,this.ORDER=t.ORDER,this.BITS=3*t.BITS,this.BYTES=3*t.BYTES,this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO,c2:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO,c2:t.ZERO};let{Fp:r}=t,n=go(t,t.NONRESIDUE,r.ORDER,6,2,3);this.FROBENIUS_COEFFICIENTS_1=n[0],this.FROBENIUS_COEFFICIENTS_2=n[1],Object.seal(this)}add({c0:t,c1:r,c2:n},{c0:s,c1:o,c2:i}){let{Fp2:c}=this;return{c0:c.add(t,s),c1:c.add(r,o),c2:c.add(n,i)}}sub({c0:t,c1:r,c2:n},{c0:s,c1:o,c2:i}){let{Fp2:c}=this;return{c0:c.sub(t,s),c1:c.sub(r,o),c2:c.sub(n,i)}}mul({c0:t,c1:r,c2:n},s){let{Fp2:o}=this;if(typeof s=="bigint")return{c0:o.mul(t,s),c1:o.mul(r,s),c2:o.mul(n,s)};let{c0:i,c1:c,c2:a}=s,u=o.mul(t,i),h=o.mul(r,c),d=o.mul(n,a);return{c0:o.add(u,o.mulByNonresidue(o.sub(o.mul(o.add(r,n),o.add(c,a)),o.add(h,d)))),c1:o.add(o.sub(o.mul(o.add(t,r),o.add(i,c)),o.add(u,h)),o.mulByNonresidue(d)),c2:o.sub(o.add(h,o.mul(o.add(t,n),o.add(i,a))),o.add(u,d))}}sqr({c0:t,c1:r,c2:n}){let{Fp2:s}=this,o=s.sqr(t),i=s.mul(s.mul(t,r),St),c=s.mul(s.mul(r,n),St),a=s.sqr(n);return{c0:s.add(s.mulByNonresidue(c),o),c1:s.add(s.mulByNonresidue(a),i),c2:s.sub(s.sub(s.add(s.add(i,s.sqr(s.add(s.sub(t,r),n))),c),o),a)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}create(t){return t}isValid({c0:t,c1:r,c2:n}){let{Fp2:s}=this;return s.isValid(t)&&s.isValid(r)&&s.isValid(n)}is0({c0:t,c1:r,c2:n}){let{Fp2:s}=this;return s.is0(t)&&s.is0(r)&&s.is0(n)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}neg({c0:t,c1:r,c2:n}){let{Fp2:s}=this;return{c0:s.neg(t),c1:s.neg(r),c2:s.neg(n)}}eql({c0:t,c1:r,c2:n},{c0:s,c1:o,c2:i}){let{Fp2:c}=this;return c.eql(t,s)&&c.eql(r,o)&&c.eql(n,i)}sqrt(t){return Cr()}div(t,r){let{Fp2:n}=this,{Fp:s}=n;return this.mul(t,typeof r=="bigint"?s.inv(s.create(r)):this.inv(r))}pow(t,r){return hn(this,t,r)}invertBatch(t){return Lt(this,t)}inv({c0:t,c1:r,c2:n}){let{Fp2:s}=this,o=s.sub(s.sqr(t),s.mulByNonresidue(s.mul(n,r))),i=s.sub(s.mulByNonresidue(s.sqr(n)),s.mul(t,r)),c=s.sub(s.sqr(r),s.mul(t,n)),a=s.inv(s.add(s.mulByNonresidue(s.add(s.mul(n,i),s.mul(r,c))),s.mul(t,o)));return{c0:s.mul(a,o),c1:s.mul(a,i),c2:s.mul(a,c)}}fromBytes(t){let{Fp2:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);let n=r.BYTES;return{c0:r.fromBytes(t.subarray(0,n)),c1:r.fromBytes(t.subarray(n,n*2)),c2:r.fromBytes(t.subarray(2*n))}}toBytes({c0:t,c1:r,c2:n}){let{Fp2:s}=this;return F(s.toBytes(t),s.toBytes(r),s.toBytes(n))}cmov({c0:t,c1:r,c2:n},{c0:s,c1:o,c2:i},c){let{Fp2:a}=this;return{c0:a.cmov(t,s,c),c1:a.cmov(r,o,c),c2:a.cmov(n,i,c)}}fromBigSix(t){let{Fp2:r}=this;if(!Array.isArray(t)||t.length!==6)throw new Error("invalid Fp6 usage");return{c0:r.fromBigTuple(t.slice(0,2)),c1:r.fromBigTuple(t.slice(2,4)),c2:r.fromBigTuple(t.slice(4,6))}}frobeniusMap({c0:t,c1:r,c2:n},s){let{Fp2:o}=this;return{c0:o.frobeniusMap(t,s),c1:o.mul(o.frobeniusMap(r,s),this.FROBENIUS_COEFFICIENTS_1[s%6]),c2:o.mul(o.frobeniusMap(n,s),this.FROBENIUS_COEFFICIENTS_2[s%6])}}mulByFp2({c0:t,c1:r,c2:n},s){let{Fp2:o}=this;return{c0:o.mul(t,s),c1:o.mul(r,s),c2:o.mul(n,s)}}mulByNonresidue({c0:t,c1:r,c2:n}){let{Fp2:s}=this;return{c0:s.mulByNonresidue(n),c1:t,c2:r}}mul1({c0:t,c1:r,c2:n},s){let{Fp2:o}=this;return{c0:o.mulByNonresidue(o.mul(n,s)),c1:o.mul(t,s),c2:o.mul(r,s)}}mul01({c0:t,c1:r,c2:n},s,o){let{Fp2:i}=this,c=i.mul(t,s),a=i.mul(r,o);return{c0:i.add(i.mulByNonresidue(i.sub(i.mul(i.add(r,n),o),a)),c),c1:i.sub(i.sub(i.mul(i.add(s,o),i.add(t,r)),c),a),c2:i.add(i.sub(i.mul(i.add(t,n),s),c),a)}}},bo=class{constructor(t,r){this.MASK=_e;let{Fp2:n}=t,{Fp:s}=n;this.Fp6=t,this.ORDER=n.ORDER,this.BITS=2*t.BITS,this.BYTES=2*t.BYTES,this.isLE=t.isLE,this.ZERO={c0:t.ZERO,c1:t.ZERO},this.ONE={c0:t.ONE,c1:t.ZERO},this.FROBENIUS_COEFFICIENTS=go(n,n.NONRESIDUE,s.ORDER,12,1,6)[0],this.X_LEN=r.X_LEN,this.finalExponentiate=r.Fp12finalExponentiate}create(t){return t}isValid({c0:t,c1:r}){let{Fp6:n}=this;return n.isValid(t)&&n.isValid(r)}is0({c0:t,c1:r}){let{Fp6:n}=this;return n.is0(t)&&n.is0(r)}isValidNot0(t){return!this.is0(t)&&this.isValid(t)}neg({c0:t,c1:r}){let{Fp6:n}=this;return{c0:n.neg(t),c1:n.neg(r)}}eql({c0:t,c1:r},{c0:n,c1:s}){let{Fp6:o}=this;return o.eql(t,n)&&o.eql(r,s)}sqrt(t){Cr()}inv({c0:t,c1:r}){let{Fp6:n}=this,s=n.inv(n.sub(n.sqr(t),n.mulByNonresidue(n.sqr(r))));return{c0:n.mul(t,s),c1:n.neg(n.mul(r,s))}}div(t,r){let{Fp6:n}=this,{Fp2:s}=n,{Fp:o}=s;return this.mul(t,typeof r=="bigint"?o.inv(o.create(r)):this.inv(r))}pow(t,r){return hn(this,t,r)}invertBatch(t){return Lt(this,t)}add({c0:t,c1:r},{c0:n,c1:s}){let{Fp6:o}=this;return{c0:o.add(t,n),c1:o.add(r,s)}}sub({c0:t,c1:r},{c0:n,c1:s}){let{Fp6:o}=this;return{c0:o.sub(t,n),c1:o.sub(r,s)}}mul({c0:t,c1:r},n){let{Fp6:s}=this;if(typeof n=="bigint")return{c0:s.mul(t,n),c1:s.mul(r,n)};let{c0:o,c1:i}=n,c=s.mul(t,o),a=s.mul(r,i);return{c0:s.add(c,s.mulByNonresidue(a)),c1:s.sub(s.mul(s.add(t,r),s.add(o,i)),s.add(c,a))}}sqr({c0:t,c1:r}){let{Fp6:n}=this,s=n.mul(t,r);return{c0:n.sub(n.sub(n.mul(n.add(n.mulByNonresidue(r),t),n.add(t,r)),s),n.mulByNonresidue(s)),c1:n.add(s,s)}}addN(t,r){return this.add(t,r)}subN(t,r){return this.sub(t,r)}mulN(t,r){return this.mul(t,r)}sqrN(t){return this.sqr(t)}fromBytes(t){let{Fp6:r}=this;if(t.length!==this.BYTES)throw new Error("fromBytes invalid length="+t.length);return{c0:r.fromBytes(t.subarray(0,r.BYTES)),c1:r.fromBytes(t.subarray(r.BYTES))}}toBytes({c0:t,c1:r}){let{Fp6:n}=this;return F(n.toBytes(t),n.toBytes(r))}cmov({c0:t,c1:r},{c0:n,c1:s},o){let{Fp6:i}=this;return{c0:i.cmov(t,n,o),c1:i.cmov(r,s,o)}}fromBigTwelve(t){let{Fp6:r}=this;return{c0:r.fromBigSix(t.slice(0,6)),c1:r.fromBigSix(t.slice(6,12))}}frobeniusMap(t,r){let{Fp6:n}=this,{Fp2:s}=n,{c0:o,c1:i,c2:c}=n.frobeniusMap(t.c1,r),a=this.FROBENIUS_COEFFICIENTS[r%12];return{c0:n.frobeniusMap(t.c0,r),c1:n.create({c0:s.mul(o,a),c1:s.mul(i,a),c2:s.mul(c,a)})}}mulByFp2({c0:t,c1:r},n){let{Fp6:s}=this;return{c0:s.mulByFp2(t,n),c1:s.mulByFp2(r,n)}}conjugate({c0:t,c1:r}){return{c0:t,c1:this.Fp6.neg(r)}}mul014({c0:t,c1:r},n,s,o){let{Fp6:i}=this,{Fp2:c}=i,a=i.mul01(t,n,s),u=i.mul1(r,o);return{c0:i.add(i.mulByNonresidue(u),a),c1:i.sub(i.sub(i.mul01(i.add(r,t),n,c.add(s,o)),a),u)}}mul034({c0:t,c1:r},n,s,o){let{Fp6:i}=this,{Fp2:c}=i,a=i.create({c0:c.mul(t.c0,n),c1:c.mul(t.c1,n),c2:c.mul(t.c2,n)}),u=i.mul01(r,s,o),h=i.mul01(i.add(t,r),c.add(n,s),o);return{c0:i.add(i.mulByNonresidue(u),a),c1:i.sub(h,i.add(a,u))}}_cyclotomicSquare({c0:t,c1:r}){let{Fp6:n}=this,{Fp2:s}=n,{c0:o,c1:i,c2:c}=t,{c0:a,c1:u,c2:h}=r,{first:d,second:f}=s.Fp4Square(o,u),{first:l,second:p}=s.Fp4Square(a,c),{first:b,second:g}=s.Fp4Square(i,h),m=s.mulByNonresidue(g);return{c0:n.create({c0:s.add(s.mul(s.sub(d,o),St),d),c1:s.add(s.mul(s.sub(l,i),St),l),c2:s.add(s.mul(s.sub(b,c),St),b)}),c1:n.create({c0:s.add(s.mul(s.add(m,a),St),m),c1:s.add(s.mul(s.add(f,u),St),f),c2:s.add(s.mul(s.add(p,h),St),p)})}}_cyclotomicExp(t,r){let n=this.ONE;for(let s=this.X_LEN-1;s>=0;s--)n=this._cyclotomicSquare(n),nc(r,s)&&(n=this.mul(n,t));return n}};function Oc(e){let t=It(e.ORDER),r=new mo(t,e),n=new yo(r),s=new bo(n,e);return{Fp:t,Fp2:r,Fp6:n,Fp12:s}}var xt=BigInt(0),ps=BigInt(1),Dt=BigInt(2),ms=BigInt(3),bn=BigInt(4),Ve=BigInt("0xd201000000010000"),bf=ge(Ve),ur={p:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),n:BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001"),h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),a:xt,b:bn,Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1")},gf=It(ur.n,{modFromBytes:!0,isLE:!0}),{Fp:L,Fp2:j,Fp6:xf,Fp12:Y}=Oc({ORDER:ur.p,X_LEN:bf,FP2_NONRESIDUE:[ps,ps],Fp2mulByB:({c0:e,c1:t})=>{let r=L.mul(e,bn),n=L.mul(t,bn);return{c0:L.sub(r,n),c1:L.add(r,n)}},Fp12finalExponentiate:e=>{let t=Ve,r=Y.div(Y.frobeniusMap(e,6),e),n=Y.mul(Y.frobeniusMap(r,2),r),s=Y.conjugate(Y._cyclotomicExp(n,t)),o=Y.mul(Y.conjugate(Y._cyclotomicSquare(n)),s),i=Y.conjugate(Y._cyclotomicExp(o,t)),c=Y.conjugate(Y._cyclotomicExp(i,t)),a=Y.mul(Y.conjugate(Y._cyclotomicExp(c,t)),Y._cyclotomicSquare(s)),u=Y.conjugate(Y._cyclotomicExp(a,t)),h=Y.frobeniusMap(Y.mul(s,c),2),d=Y.frobeniusMap(Y.mul(i,n),3),f=Y.frobeniusMap(Y.mul(a,Y.conjugate(n)),1),l=Y.mul(Y.mul(u,Y.conjugate(o)),n);return Y.mul(Y.mul(Y.mul(h,d),f),l)}}),{G2psi:Cc,G2psi2:wf}=Ac(L,j,j.div(j.ONE,j.NONRESIDUE)),xo=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:L.ORDER,m:2,k:128,expand:"xmd",hash:gt}),_o={p:j.ORDER,n:ur.n,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),a:j.ZERO,b:j.fromBigTuple([bn,bn]),Gx:j.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:j.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")])},ys=gn(L.toBytes(xt),{infinity:!0,compressed:!0});function bs(e){e=e.slice();let t=e[0]&224,r=!!(t>>7&1),n=!!(t>>6&1),s=!!(t>>5&1);return e[0]&=31,{compressed:r,infinity:n,sort:s,value:e}}function gn(e,t){if(e[0]&224)throw new Error("setMask: non-empty mask");return t.compressed&&(e[0]|=128),t.infinity&&(e[0]|=64),t.sort&&(e[0]|=32),e}function Ef(e,t,r){let{BYTES:n,ORDER:s}=L,o=t.is0(),{x:i,y:c}=t.toAffine();if(r){if(o)return ys.slice();let a=!!(c*Dt/s);return gn(dt(i,n),{compressed:!0,sort:a})}else return o?F(Uint8Array.of(64),new Uint8Array(2*n-1)):F(dt(i,n),dt(c,n))}function wo(e){e.assertValidity();let{BYTES:t,ORDER:r}=L,{x:n,y:s}=e.toAffine();if(e.is0())return ys.slice();let o=!!(s*Dt/r);return gn(dt(n,t),{compressed:!0,sort:o})}function _f(e){let{compressed:t,infinity:r,sort:n,value:s}=bs(e),{BYTES:o,ORDER:i}=L;if(s.length===48&&t){let c=Ot(s),a=L.create(c&Wt(L.BITS));if(r){if(a!==xt)throw new Error("invalid G1 point: non-empty, at infinity, with compression");return{x:xt,y:xt}}let u=L.add(L.pow(a,ms),L.create(ur.b)),h=L.sqrt(u);if(!h)throw new Error("invalid G1 point: compressed point");return h*Dt/i!==BigInt(n)&&(h=L.neg(h)),{x:L.create(a),y:L.create(h)}}else if(s.length===96&&!t){let c=Ot(s.subarray(0,o)),a=Ot(s.subarray(o));if(r){if(c!==xt||a!==xt)throw new Error("G1: non-empty point at infinity");return xn.G1.Point.ZERO.toAffine()}return{x:L.create(c),y:L.create(a)}}else throw new Error("invalid G1 point: expected 48/96 bytes")}function Rc(e){let{infinity:t,sort:r,value:n}=bs(rt("signatureHex",e,48)),s=L.ORDER,o=xn.G1.Point,i=Ot(n);if(t)return o.ZERO;let c=L.create(i&Wt(L.BITS)),a=L.add(L.pow(c,ms),L.create(ur.b)),u=L.sqrt(a);if(!u)throw new Error("invalid G1 point: compressed");let h=BigInt(r);u*Dt/s!==h&&(u=L.neg(u));let d=o.fromAffine({x:c,y:u});return d.assertValidity(),d}function Bf(e,t,r){let{BYTES:n,ORDER:s}=L,o=t.is0(),{x:i,y:c}=t.toAffine();if(r){if(o)return F(ys,dt(xt,n));let a=!!(c.c1===xt?c.c0*Dt/s:c.c1*Dt/s);return F(gn(dt(i.c1,n),{compressed:!0,sort:a}),dt(i.c0,n))}else{if(o)return F(Uint8Array.of(64),new Uint8Array(4*n-1));let{re:a,im:u}=j.reim(i),{re:h,im:d}=j.reim(c);return F(dt(u,n),dt(a,n),dt(d,n),dt(h,n))}}function Eo(e){e.assertValidity();let{BYTES:t}=L;if(e.is0())return F(ys,dt(xt,t));let{x:r,y:n}=e.toAffine(),{re:s,im:o}=j.reim(r),{re:i,im:c}=j.reim(n),u=!!((c>xt?c*Dt:i*Dt)/L.ORDER&ps),h=s;return F(gn(dt(o,t),{sort:u,compressed:!0}),dt(h,t))}function vf(e){let{BYTES:t,ORDER:r}=L,{compressed:n,infinity:s,sort:o,value:i}=bs(e);if(!n&&!s&&o||!n&&s&&o||o&&s&&n)throw new Error("invalid encoding flag: "+(e[0]&224));let c=(a,u,h)=>Ot(a.slice(u,h));if(i.length===96&&n){if(s){if(i.reduce((p,b)=>p!==0?b+1:b,0)>0)throw new Error("invalid G2 point: compressed");return{x:j.ZERO,y:j.ZERO}}let a=c(i,0,t),u=c(i,t,2*t),h=j.create({c0:L.create(u),c1:L.create(a)}),d=j.add(j.pow(h,ms),_o.b),f=j.sqrt(d),l=f.c1===xt?f.c0*Dt/r:f.c1*Dt/r?ps:xt;return f=o&&l>0?f:j.neg(f),{x:h,y:f}}else if(i.length===192&&!n){if(s){if(i.reduce((f,l)=>f!==0?l+1:l,0)>0)throw new Error("invalid G2 point: uncompressed");return{x:j.ZERO,y:j.ZERO}}let a=c(i,0*t,1*t),u=c(i,1*t,2*t),h=c(i,2*t,3*t),d=c(i,3*t,4*t);return{x:j.fromBigTuple([u,a]),y:j.fromBigTuple([d,h])}}else throw new Error("invalid G2 point: expected 96/192 bytes")}function Nc(e){let{ORDER:t}=L,{infinity:r,sort:n,value:s}=bs(rt("signatureHex",e)),o=xn.G2.Point,i=s.length/2;if(i!==48&&i!==96)throw new Error("invalid compressed signature length, expected 96/192 bytes");let c=Ot(s.slice(0,i)),a=Ot(s.slice(i));if(r)return o.ZERO;let u=L.create(c&Wt(L.BITS)),h=L.create(a),d=j.create({c0:h,c1:u}),f=j.add(j.pow(d,ms),_o.b),l=j.sqrt(f);if(!l)throw new Error("Failed to find a square root");let{re:p,im:b}=j.reim(l),g=BigInt(n),m=b>xt&&b*Dt/t!==g,w=b===xt&&p*Dt/t!==g;(m||w)&&(l=j.neg(l));let y=o.fromAffine({x:d,y:l});return y.assertValidity(),y}var xn=vc({fields:{Fp:L,Fp2:j,Fp6:xf,Fp12:Y,Fr:gf},G1:{...ur,Fp:L,htfDefaults:{...xo,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(e,t)=>{let r=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),n=new e(L.mul(t.X,r),t.Y,t.Z);return t.multiplyUnsafe(Ve).negate().multiplyUnsafe(Ve).equals(n)},clearCofactor:(e,t)=>t.multiplyUnsafe(Ve).add(t),mapToCurve:Of,fromBytes:_f,toBytes:Ef,ShortSignature:{fromBytes(e){return nt(e),Rc(e)},fromHex(e){return Rc(e)},toBytes(e){return wo(e)},toRawBytes(e){return wo(e)},toHex(e){return K(wo(e))}}},G2:{..._o,Fp:j,hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...xo},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:Cf,isTorsionFree:(e,t)=>t.multiplyUnsafe(Ve).negate().equals(Cc(e,t)),clearCofactor:(e,t)=>{let r=Ve,n=t.multiplyUnsafe(r).negate(),s=Cc(e,t),o=t.double();return o=wf(e,o),o=o.subtract(s),s=n.add(s),s=s.multiplyUnsafe(r).negate(),o=o.add(s),o=o.subtract(n),o.subtract(t)},fromBytes:vf,toBytes:Bf,Signature:{fromBytes(e){return nt(e),Nc(e)},fromHex(e){return Nc(e)},toBytes(e){return Eo(e)},toRawBytes(e){return Eo(e)},toHex(e){return K(Eo(e))}}},params:{ateLoopSize:Ve,r:ur.n,xNegative:!0,twistType:"multiplicative"},htfDefaults:xo,hash:gt}),If=ao(j,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(e=>e.map(t=>j.fromBigTuple(t.map(BigInt))))),Tf=ao(L,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(t=>BigInt(t)))),Sf=lo(L,{A:L.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:L.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:L.create(BigInt(11))}),Af=lo(j,{A:j.create({c0:L.create(xt),c1:L.create(BigInt(240))}),B:j.create({c0:L.create(BigInt(1012)),c1:L.create(BigInt(1012))}),Z:j.create({c0:L.create(BigInt(-2)),c1:L.create(BigInt(-1))})});function Of(e){let{x:t,y:r}=Sf(L.create(e[0]));return Tf(t,r)}function Cf(e){let{x:t,y:r}=Af(j.fromBigTuple(e));return If(t,r)}function Uc(e,t,r){let n=typeof e=="string"?e:K(e),s=typeof t=="string"?t:K(t),o=typeof r=="string"?r:K(r);return xn.verifyShortSignature(s,o,n)}var Bo=e=>ot(new Gt(e)),Pr=e=>{let t=Bo(e);return new Date(Number(t)/1e6)};var bt;(function(e){e[e.Empty=0]="Empty",e[e.Fork=1]="Fork",e[e.Labeled=2]="Labeled",e[e.Leaf=3]="Leaf",e[e.Pruned=4]="Pruned"})(bt||(bt={}));function Nf(e,t){for(let r=0;r<e.length;r++)if(e[r]>t[r])return!0;return!1}var $e=class e{#t=!1;static async create(t){let r=e.createUnverified(t);return await r.verify(),r}static createUnverified(t){return new e(t.certificate,t.rootKey,t.canisterId,t.blsVerify??Uc,t.maxAgeInMinutes,t.disableTimeVerification)}constructor(t,r,n,s,o=5,i=!1){this._rootKey=r,this._canisterId=n,this._blsVerify=s,this._maxAgeInMinutes=o,this.#t=i,this.cert=Ut(t)}lookup_path(t){return lr(t,this.cert.tree)}lookup_subtree(t){return ws(t,this.cert.tree)}async verify(){let t=await gs(this.cert.tree),r=await this._checkDelegationAndGetKey(this.cert.delegation),n=this.cert.signature,s=qf(r),o=F(En("ic-state-root"),t),i=!1,c=wt(this.lookup_path(["time"]));if(!c)throw Q.fromCode(new Xe("Certificate does not contain a time"));if(!this.#t){let u=this._maxAgeInMinutes*60*1e3,h=Date.now(),d=h-u,f=h+3e5,l=Pr(c);if(l.getTime()<d)throw _t.fromCode(new Hr(this._maxAgeInMinutes,l,new Date(h),"past"));if(l.getTime()>f)throw _t.fromCode(new Hr(5,l,new Date(h),"future"))}try{i=await this._blsVerify(new Uint8Array(s),new Uint8Array(n),new Uint8Array(o))}catch{i=!1}if(!i)throw _t.fromCode(new Xe("Signature verification failed"))}async _checkDelegationAndGetKey(t){if(!t)return this._rootKey;let r=e.createUnverified({certificate:t.certificate,rootKey:this._rootKey,canisterId:this._canisterId,blsVerify:this._blsVerify,disableTimeVerification:!0});if(r.cert.delegation)throw Q.fromCode(new Rn);if(await r.verify(),this._canisterId.toString()!==Lc&&!vo({canisterId:this._canisterId,subnetId:H.fromUint8Array(new Uint8Array(t.subnet_id)),tree:r.cert.tree}))throw _t.fromCode(new br(this._canisterId,t.subnet_id));let n=wt(r.lookup_path(["subnet",t.subnet_id,"public_key"]));if(!n)throw _t.fromCode(new Nn(`Could not find subnet key for subnet 0x${K(t.subnet_id)}`));return n}},wn=$t("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100"),Uf=96;function qf(e){let t=wn.byteLength+Uf;if(e.byteLength!==t)throw Q.fromCode(new xr(t,e.byteLength));let r=e.slice(0,wn.byteLength);if(!nr(r,wn))throw Q.fromCode(new Un(wn,r));return e.slice(wn.byteLength)}function wt(e){if(e.status===Ct.Found&&e.value instanceof Uint8Array)return e.value}async function gs(e){switch(e[0]){case bt.Empty:return gt(En("ic-hashtree-empty"));case bt.Pruned:return e[1];case bt.Leaf:return gt(F(En("ic-hashtree-leaf"),e[1]));case bt.Labeled:return gt(F(En("ic-hashtree-labeled"),e[1],await gs(e[2])));case bt.Fork:return gt(F(En("ic-hashtree-fork"),await gs(e[1]),await gs(e[2])));default:throw qe}}function En(e){let t=new Uint8Array([e.length]),r=new TextEncoder().encode(e);return F(t,r)}function qc(e){return typeof e[0]=="string"?z(e[0]):e[0]}var Ct;(function(e){e.Unknown="Unknown",e.Absent="Absent",e.Found="Found",e.Error="Error"})(Ct||(Ct={}));var dr;(function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found"})(dr||(dr={}));var et;(function(e){e.Absent="Absent",e.Unknown="Unknown",e.Found="Found",e.Less="Less",e.Greater="Greater"})(et||(et={}));function lr(e,t){if(e.length===0)switch(t[0]){case bt.Empty:return{status:Ct.Absent};case bt.Leaf:{if(!t[1])throw lt.fromCode(new Ue("Invalid tree structure for leaf"));if(t[1]instanceof Uint8Array)return{status:Ct.Found,value:t[1].slice(t[1].byteOffset,t[1].byteLength+t[1].byteOffset)};throw qe}case bt.Pruned:return{status:Ct.Unknown};case bt.Labeled:case bt.Fork:return{status:Ct.Error};default:throw qe}let r=qc(e),n=_n(r,t);switch(n.status){case et.Found:return lr(e.slice(1),n.value);case et.Absent:case et.Greater:case et.Less:return{status:Ct.Absent};case et.Unknown:return{status:Ct.Unknown};default:throw qe}}function ws(e,t){if(e.length===0)return{status:dr.Found,value:t};let r=qc(e),n=_n(r,t);switch(n.status){case et.Found:return ws(e.slice(1),n.value);case et.Unknown:return{status:dr.Unknown};case et.Absent:case et.Greater:case et.Less:return{status:dr.Absent};default:throw qe}}function xs(e){switch(e[0]){case bt.Empty:return[];case bt.Fork:return xs(e[1]).concat(xs(e[2]));default:return[e]}}function _n(e,t){switch(t[0]){case bt.Labeled:return Nf(e,t[1])?{status:et.Greater}:nr(e,t[1])?{status:et.Found,value:t[2]}:{status:et.Less};case bt.Fork:{let r=_n(e,t[1]);switch(r.status){case et.Greater:{let n=_n(e,t[2]);return n.status===et.Less?{status:et.Absent}:n}case et.Unknown:{let n=_n(e,t[2]);return n.status===et.Less?{status:et.Unknown}:n}default:return r}}case bt.Pruned:return{status:et.Unknown};default:return{status:et.Absent}}}function vo(e){let{canisterId:t,subnetId:r,tree:n}=e,s=lr(["subnet",r.toUint8Array(),"canister_ranges"],n);if(s.status!==Ct.Found)throw Q.fromCode(new de(`Could not find canister ranges for subnet ${r.toText()}`,s.status));if(!(s.value instanceof Uint8Array))throw Q.fromCode(new gr(`Could not find canister ranges for subnet ${r.toText()}`));return Ut(s.value).map(a=>[H.fromUint8Array(a[0]),H.fromUint8Array(a[1])]).some(a=>a[0].ltEq(t)&&a[1].gtEq(t))}var Io=async e=>{let{agent:t,paths:r}=e,n=H.from(e.canisterId),s=[...new Set(r)],o=new Map,i=s.map((c,a)=>{let u=Pf(c,n);return(async()=>{try{let h=await t.readState(n,{paths:[u]});if(t.rootKey==null)throw at.fromCode(new Kt);let d=await $e.create({certificate:h.certificate,rootKey:t.rootKey,canisterId:n,disableTimeVerification:!0}),f=(b,g)=>{if(g==="subnet"){if(t.rootKey==null)throw at.fromCode(new Kt);let m=Lf(h.certificate,n,t.rootKey);return{path:g,data:m}}else return{path:g,data:wt(b.lookup_path(u))}},{path:l,data:p}=f(d,s[a]);if(!p)console.warn(`Expected to find result for path ${l}, but instead found nothing.`),typeof l=="string"?o.set(l,null):o.set(l.key,null);else switch(l){case"time":{o.set(l,Pr(p));break}case"controllers":{o.set(l,Df(p));break}case"module_hash":{o.set(l,K(p));break}case"subnet":{o.set(l,p);break}case"candid":{o.set(l,new TextDecoder().decode(p));break}default:if(typeof l!="string"&&"key"in l&&"path"in l)switch(l.decodeStrategy){case"raw":o.set(l.key,p);break;case"leb128":{o.set(l.key,Bo(p));break}case"cbor":{o.set(l.key,Ut(p));break}case"hex":{o.set(l.key,K(p));break}case"utf-8":o.set(l.key,new TextDecoder().decode(p))}}}catch(h){if(h instanceof jt&&h.hasCode(Xe))throw h;typeof c!="string"&&"key"in c&&"path"in c?o.set(c.key,null):o.set(c,null),console.group(),console.warn(`Expected to find result for path ${c}, but instead found nothing.`),console.warn(h),console.groupEnd()}})()});return await Promise.all(i),o},Lf=(e,t,r)=>{if(!t._isPrincipal)throw G.fromCode(new Rt("Invalid canisterId"));let n=Ut(e),s=n.tree,o=n.delegation,i;if(o&&o.subnet_id?i=H.fromUint8Array(new Uint8Array(o.subnet_id)):!o&&typeof r<"u"?(i=H.selfAuthenticating(new Uint8Array(r)),o={subnet_id:i.toUint8Array(),certificate:new Uint8Array(0)}):(i=H.selfAuthenticating(H.fromText("tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe").toUint8Array()),o={subnet_id:i.toUint8Array(),certificate:new Uint8Array(0)}),!vo({canisterId:t,subnetId:i,tree:s}))throw _t.fromCode(new br(t,o.subnet_id));let a=ws(["subnet",o.subnet_id,"node"],s);if(a.status!==dr.Found)throw Q.fromCode(new de("Node not found",a.status));if(a.value instanceof Uint8Array)throw lt.fromCode(new Ue("Invalid node tree"));let u=xs(a.value),h=new Map;return u.forEach(d=>{let f=H.from(d[1]).toText(),l=lr(["public_key"],d[2]);if(l.status!==Ct.Found)throw Q.fromCode(new de("Public key not found",l.status));let p=l.value;if(p.byteLength!==44)throw Q.fromCode(new xr(44,p.byteLength));h.set(f,p)}),{subnetId:H.fromUint8Array(new Uint8Array(o.subnet_id)).toText(),nodeKeys:h}},Pf=(e,t)=>{let r=t.toUint8Array();switch(e){case"time":return[z("time")];case"controllers":return[z("canister"),r,z("controllers")];case"module_hash":return[z("canister"),r,z("module_hash")];case"subnet":return[z("subnet")];case"candid":return[z("canister"),r,z("metadata"),z("candid:service")];default:if("key"in e&&"path"in e)if(typeof e.path=="string"||e.path instanceof Uint8Array){let n=e.path,s=typeof n=="string"?z(n):n;return[z("canister"),r,z("metadata"),s]}else return e.path}throw lt.fromCode(new Rt(`Error while encoding your path for canister status. Please ensure that your path ${e} was formatted correctly.`))},Df=e=>Ut(e).map(r=>H.fromUint8Array(r));var je=BigInt(0),pt=BigInt(1),To=BigInt(2),Mf=BigInt(8);function kf(e,t,r,n){let s=e.sqr(r),o=e.sqr(n),i=e.add(e.mul(t.a,s),o),c=e.add(e.ONE,e.mul(t.d,e.mul(s,o)));return e.eql(i,c)}function Ff(e,t={}){let r=ls("edwards",e,t,t.FpFnLE),{Fp:n,Fn:s}=r,o=r.CURVE,{h:i}=o;xe(t,{},{uvRatio:"function"});let c=To<<BigInt(s.BYTES*8)-pt,a=g=>n.create(g),u=t.uvRatio||((g,m)=>{try{return{isValid:!0,value:n.sqrt(n.div(g,m))}}catch{return{isValid:!1,value:je}}});if(!kf(n,o,o.Gx,o.Gy))throw new Error("bad curve params: generator point");function h(g,m,w=!1){let y=w?pt:je;return fs("coordinate "+g,m,y,c),m}function d(g){if(!(g instanceof p))throw new Error("ExtendedPoint expected")}let f=ke((g,m)=>{let{X:w,Y:y,Z:_}=g,v=g.is0();m==null&&(m=v?Mf:n.inv(_));let I=a(w*m),T=a(y*m),A=n.mul(_,m);if(v)return{x:je,y:pt};if(A!==pt)throw new Error("invZ was invalid");return{x:I,y:T}}),l=ke(g=>{let{a:m,d:w}=o;if(g.is0())throw new Error("bad point: ZERO");let{X:y,Y:_,Z:v,T:I}=g,T=a(y*y),A=a(_*_),E=a(v*v),S=a(E*E),U=a(T*m),C=a(E*a(U+A)),x=a(S+a(w*a(T*A)));if(C!==x)throw new Error("bad point: equation left != right (1)");let B=a(y*_),R=a(v*I);if(B!==R)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(m,w,y,_){this.X=h("x",m),this.Y=h("y",w),this.Z=h("z",y,!0),this.T=h("t",_),Object.freeze(this)}static CURVE(){return o}static fromAffine(m){if(m instanceof p)throw new Error("extended point not allowed");let{x:w,y}=m||{};return h("x",w),h("y",y),new p(w,y,pt,a(w*y))}static fromBytes(m,w=!1){let y=n.BYTES,{a:_,d:v}=o;m=Js(Me(m,y,"point")),ir(w,"zip215");let I=Js(m),T=m[y-1];I[y-1]=T&-129;let A=be(I),E=w?c:n.ORDER;fs("point.y",A,je,E);let S=a(A*A),U=a(S-pt),C=a(v*S-_),{isValid:x,value:B}=u(U,C);if(!x)throw new Error("bad point: invalid y coordinate");let R=(B&pt)===pt,P=(T&128)!==0;if(!w&&B===je&&P)throw new Error("bad point: x=0 and x_0=1");return P!==R&&(B=a(-B)),p.fromAffine({x:B,y:A})}static fromHex(m,w=!1){return p.fromBytes(rt("point",m),w)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,w=!0){return b.createCache(this,m),w||this.multiply(To),this}assertValidity(){l(this)}equals(m){d(m);let{X:w,Y:y,Z:_}=this,{X:v,Y:I,Z:T}=m,A=a(w*T),E=a(v*_),S=a(y*T),U=a(I*_);return A===E&&S===U}is0(){return this.equals(p.ZERO)}negate(){return new p(a(-this.X),this.Y,this.Z,a(-this.T))}double(){let{a:m}=o,{X:w,Y:y,Z:_}=this,v=a(w*w),I=a(y*y),T=a(To*a(_*_)),A=a(m*v),E=w+y,S=a(a(E*E)-v-I),U=A+I,C=U-T,x=A-I,B=a(S*C),R=a(U*x),P=a(S*x),V=a(C*U);return new p(B,R,V,P)}add(m){d(m);let{a:w,d:y}=o,{X:_,Y:v,Z:I,T}=this,{X:A,Y:E,Z:S,T:U}=m,C=a(_*A),x=a(v*E),B=a(T*y*U),R=a(I*S),P=a((_+v)*(A+E)-C-x),V=R-B,O=R+B,N=a(x-w*C),q=a(P*V),D=a(O*N),M=a(P*N),mt=a(V*O);return new p(q,D,mt,M)}subtract(m){return this.add(m.negate())}multiply(m){if(!s.isValidNot0(m))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:w,f:y}=b.cached(this,m,_=>Pt(p,_));return Pt(p,[w,y])[0]}multiplyUnsafe(m,w=p.ZERO){if(!s.isValid(m))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return m===je?p.ZERO:this.is0()||m===pt?this:b.unsafe(this,m,y=>Pt(p,y),w)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return b.unsafe(this,o.n).is0()}toAffine(m){return f(this,m)}clearCofactor(){return i===pt?this:this.multiplyUnsafe(i)}toBytes(){let{x:m,y:w}=this.toAffine(),y=n.toBytes(w);return y[y.length-1]|=m&pt?128:0,y}toHex(){return K(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(m){return Pt(p,m)}static msm(m,w){return Ur(p,s,m,w)}_setWindowSize(m){this.precompute(m)}toRawBytes(){return this.toBytes()}}p.BASE=new p(o.Gx,o.Gy,pt,a(o.Gx*o.Gy)),p.ZERO=new p(je,pt,pt,je),p.Fp=n,p.Fn=s;let b=new Nr(p,s.BITS);return p.BASE.precompute(8),p}var Es=class{constructor(t){this.ep=t}static fromBytes(t){Cr()}static fromHex(t){Cr()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(t){return this.ep.toAffine(t)}toHex(){return K(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(t){return this.assertSame(t),this.init(this.ep.add(t.ep))}subtract(t){return this.assertSame(t),this.init(this.ep.subtract(t.ep))}multiply(t){return this.init(this.ep.multiply(t))}multiplyUnsafe(t){return this.init(this.ep.multiplyUnsafe(t))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(t,r){return this.init(this.ep.precompute(t,r))}toRawBytes(){return this.toBytes()}};function Vf(e,t,r={}){if(typeof t!="function")throw new Error('"hash" function param is required');xe(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:s,Fp:o,Fn:i}=e,c=r.randomBytes||yr,a=r.adjustScalarBytes||(E=>E),u=r.domain||((E,S,U)=>{if(ir(U,"phflag"),S.length||U)throw new Error("Contexts/pre-hash are not supported");return E});function h(E){return i.create(be(E))}function d(E){let S=y.secretKey;E=rt("private key",E,S);let U=rt("hashed private key",t(E),2*S),C=a(U.slice(0,S)),x=U.slice(S,2*S),B=h(C);return{head:C,prefix:x,scalar:B}}function f(E){let{head:S,prefix:U,scalar:C}=d(E),x=s.multiply(C),B=x.toBytes();return{head:S,prefix:U,scalar:C,point:x,pointBytes:B}}function l(E){return f(E).pointBytes}function p(E=Uint8Array.of(),...S){let U=F(...S);return h(t(u(U,rt("context",E),!!n)))}function b(E,S,U={}){E=rt("message",E),n&&(E=n(E));let{prefix:C,scalar:x,pointBytes:B}=f(S),R=p(U.context,C,E),P=s.multiply(R).toBytes(),V=p(U.context,P,B,E),O=i.create(R+V*x);if(!i.isValid(O))throw new Error("sign failed: invalid s");let N=F(P,i.toBytes(O));return Me(N,y.signature,"result")}let g={zip215:!0};function m(E,S,U,C=g){let{context:x,zip215:B}=C,R=y.signature;E=rt("signature",E,R),S=rt("message",S),U=rt("publicKey",U,y.publicKey),B!==void 0&&ir(B,"zip215"),n&&(S=n(S));let P=R/2,V=E.subarray(0,P),O=be(E.subarray(P,R)),N,q,D;try{N=e.fromBytes(U,B),q=e.fromBytes(V,B),D=s.multiplyUnsafe(O)}catch{return!1}if(!B&&N.isSmallOrder())return!1;let M=p(x,q.toBytes(),N.toBytes(),S);return q.add(N.multiplyUnsafe(M)).subtract(D).clearCofactor().is0()}let w=o.BYTES,y={secretKey:w,publicKey:w,signature:2*w,seed:w};function _(E=c(y.seed)){return Me(E,y.seed,"seed")}function v(E){let S=A.randomSecretKey(E);return{secretKey:S,publicKey:l(S)}}function I(E){return te(E)&&E.length===i.BYTES}function T(E,S){try{return!!e.fromBytes(E,S)}catch{return!1}}let A={getExtendedPublicKey:f,randomSecretKey:_,isValidSecretKey:I,isValidPublicKey:T,toMontgomery(E){let{y:S}=e.fromBytes(E),U=y.publicKey,C=U===32;if(!C&&U!==57)throw new Error("only defined for 25519 and 448");let x=C?o.div(pt+S,pt-S):o.div(S-pt,S+pt);return o.toBytes(x)},toMontgomeryPriv(E){let S=y.secretKey;Me(E,S);let U=t(E.subarray(0,S));return a(U).subarray(0,S)},randomPrivateKey:_,precompute(E=8,S=e.BASE){return S.precompute(E,!1)}};return Object.freeze({keygen:v,getPublicKey:l,sign:b,verify:m,utils:A,Point:e,lengths:y})}function $f(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=It(t.n,e.nBitLength,!0),s={Fp:r,Fn:n,uvRatio:e.uvRatio},o={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:s,hash:e.hash,eddsaOpts:o}}function jf(e,t){let r=t.Point;return Object.assign({},t,{ExtendedPoint:r,CURVE:e,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}function Pc(e){let{CURVE:t,curveOpts:r,hash:n,eddsaOpts:s}=$f(e),o=Ff(t,r),i=Vf(o,n,s);return jf(e,i)}var Hf=BigInt(0),Be=BigInt(1),Dc=BigInt(2),Kl=BigInt(3),Kf=BigInt(5),Gf=BigInt(8),Dr=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Bn={p:Dr,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Gf,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Zf(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),s=BigInt(80),o=Dr,c=e*e%o*e%o,a=Qt(c,Dc,o)*c%o,u=Qt(a,Be,o)*e%o,h=Qt(u,Kf,o)*u%o,d=Qt(h,t,o)*h%o,f=Qt(d,r,o)*d%o,l=Qt(f,n,o)*f%o,p=Qt(l,s,o)*l%o,b=Qt(p,s,o)*l%o,g=Qt(b,t,o)*h%o;return{pow_p_5_8:Qt(g,Dc,o)*e%o,b2:c}}function Yf(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var So=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Co(e,t){let r=Dr,n=tt(t*t*t,r),s=tt(n*n*t,r),o=Zf(e*s).pow_p_5_8,i=tt(e*n*o,r),c=tt(t*i*i,r),a=i,u=tt(i*So,r),h=c===e,d=c===tt(-e,r),f=c===tt(-e*So,r);return h&&(i=a),(d||f)&&(i=u),we(i,r)&&(i=tt(-i,r)),{isValid:h||d,value:i}}var He=It(Bn.p,{isLE:!0}),Xf=It(Bn.n,{isLE:!0}),zf={...Bn,Fp:He,hash:ci,adjustScalarBytes:Yf,uvRatio:Co},ve=Pc(zf);var Ao=So,Wf=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Qf=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Jf=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),tu=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Mc=e=>Co(Be,e),eu=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Oo=e=>ve.Point.Fp.create(be(e)&eu);function kc(e){let{d:t}=Bn,r=Dr,n=m=>He.create(m),s=n(Ao*e*e),o=n((s+Be)*Jf),i=BigInt(-1),c=n((i-t*s)*n(s+t)),{isValid:a,value:u}=Co(o,c),h=n(u*e);we(h,r)||(h=n(-h)),a||(u=h),a||(i=s);let d=n(i*(s-Be)*tu-c),f=u*u,l=n((u+u)*c),p=n(d*Wf),b=n(Be-f),g=n(Be+f);return new ve.Point(n(l*g),n(b*p),n(p*g),n(l*b))}function ru(e){nt(e,64);let t=Oo(e.subarray(0,32)),r=kc(t),n=Oo(e.subarray(32,64)),s=kc(n);return new Ie(r.add(s))}var Ie=class e extends Es{constructor(t){super(t)}static fromAffine(t){return new e(ve.Point.fromAffine(t))}assertSame(t){if(!(t instanceof e))throw new Error("RistrettoPoint expected")}init(t){return new e(t)}static hashToCurve(t){return ru(rt("ristrettoHash",t,64))}static fromBytes(t){nt(t,32);let{a:r,d:n}=Bn,s=Dr,o=_=>He.create(_),i=Oo(t);if(!rc(He.toBytes(i),t)||we(i,s))throw new Error("invalid ristretto255 encoding 1");let c=o(i*i),a=o(Be+r*c),u=o(Be-r*c),h=o(a*a),d=o(u*u),f=o(r*n*h-d),{isValid:l,value:p}=Mc(o(f*d)),b=o(p*u),g=o(p*b*f),m=o((i+i)*b);we(m,s)&&(m=o(-m));let w=o(a*g),y=o(m*w);if(!l||we(y,s)||w===Hf)throw new Error("invalid ristretto255 encoding 2");return new e(new ve.Point(m,w,Be,y))}static fromHex(t){return e.fromBytes(rt("ristrettoHex",t,32))}static msm(t,r){return Ur(e,ve.Point.Fn,t,r)}toBytes(){let{X:t,Y:r,Z:n,T:s}=this.ep,o=Dr,i=g=>He.create(g),c=i(i(n+r)*i(n-r)),a=i(t*r),u=i(a*a),{value:h}=Mc(i(c*u)),d=i(h*c),f=i(h*a),l=i(d*f*s),p;if(we(s*l,o)){let g=i(r*Ao),m=i(t*Ao);t=g,r=m,p=i(d*Qf)}else p=f;we(t*l,o)&&(r=i(-r));let b=i((n-r)*p);return we(b,o)&&(b=i(-b)),He.toBytes(b)}equals(t){this.assertSame(t);let{X:r,Y:n}=this.ep,{X:s,Y:o}=t.ep,i=u=>He.create(u),c=i(r*o)===i(n*s),a=i(n*o)===i(r*s);return c||a}is0(){return this.equals(e.ZERO)}};Ie.BASE=new Ie(ve.Point.BASE);Ie.ZERO=new Ie(ve.Point.ZERO);Ie.Fp=He;Ie.Fn=Xf;var Fc,Vc,_s=class{static{Fc=Symbol.iterator,Vc=Symbol.toStringTag}#t;#e;constructor(t={}){this[Fc]=this.entries.bind(this),this[Vc]="ExpirableMap";let{source:r=[],expirationTime:n=600*1e3}=t,s=Date.now();this.#t=new Map([...r].map(([o,i])=>[o,{value:i,timestamp:s}])),this.#e=n}prune(){let t=Date.now();for(let[r,n]of this.#t.entries())t-n.timestamp>this.#e&&this.#t.delete(r);return this}set(t,r){this.prune();let n={value:r,timestamp:Date.now()};return this.#t.set(t,n),this}get(t){let r=this.#t.get(t);if(r!==void 0){if(Date.now()-r.timestamp>this.#e){this.#t.delete(t);return}return r.value}}clear(){this.#t.clear()}entries(){let t=this.#t.entries();return function*(){for(let[n,s]of t)yield[n,s.value]}()}values(){let t=this.#t.values();return function*(){for(let n of t)yield n.value}()}keys(){return this.#t.keys()}forEach(t,r){for(let[n,s]of this.#t.entries())t.call(r,s.value,n,this)}has(t){return this.#t.has(t)}delete(t){return this.#t.delete(t)}get size(){return this.#t.size}};var $c=e=>{if(e<=127)return 1;if(e<=255)return 2;if(e<=65535)return 3;if(e<=16777215)return 4;throw G.fromCode(new Kr("Length too long (> 4 bytes)"))},jc=(e,t,r)=>{if(r<=127)return e[t]=r,1;if(r<=255)return e[t]=129,e[t+1]=r,2;if(r<=65535)return e[t]=130,e[t+1]=r>>8,e[t+2]=r,3;if(r<=16777215)return e[t]=131,e[t+1]=r>>16,e[t+2]=r>>8,e[t+3]=r,4;throw G.fromCode(new Kr("Length too long (> 4 bytes)"))},Ro=(e,t)=>{if(e[t]<128)return 1;if(e[t]===128)throw G.fromCode(new Ht("Invalid length 0"));if(e[t]===129)return 2;if(e[t]===130)return 3;if(e[t]===131)return 4;throw G.fromCode(new Ht("Length too long (> 4 bytes)"))},nu=(e,t)=>{let r=Ro(e,t);if(r===1)return e[t];if(r===2)return e[t+1];if(r===3)return(e[t+1]<<8)+e[t+2];if(r===4)return(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];throw G.fromCode(new Ht("Length too long (> 4 bytes)"))},zl=Uint8Array.from([48,12,6,10,43,6,1,4,1,131,184,67,1,1]),No=Uint8Array.from([48,5,6,3,43,101,112]),Wl=Uint8Array.from([48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10]),Ql=Uint8Array.from([48,29,6,13,43,6,1,4,1,130,220,124,5,3,1,2,1,6,12,43,6,1,4,1,130,220,124,5,3,2,1]);function Hc(e,t){let r=2+$c(e.byteLength+1),n=t.byteLength+r+e.byteLength,s=0,o=new Uint8Array(1+$c(n)+n);return o[s++]=48,s+=jc(o,s,n),o.set(t,s),s+=t.byteLength,o[s++]=3,s+=jc(o,s,e.byteLength+1),o[s++]=0,o.set(new Uint8Array(e),s),o}var Kc=(e,t)=>{let r=0,n=(c,a)=>{if(s[r++]!==c)throw G.fromCode(new Ht(`Expected ${a} at offset ${r}`))},s=new Uint8Array(e);if(n(48,"sequence"),r+=Ro(s,r),!nr(s.slice(r,r+t.byteLength),t))throw G.fromCode(new Ht("Not the expected OID."));r+=t.byteLength,n(3,"bit string");let o=nu(s,r)-1;r+=Ro(s,r),n(0,"0 padding");let i=s.slice(r);if(o!==i.length)throw G.fromCode(new qn(o,i.length));return i};var Bs=class e{static from(t){return this.fromDer(t.toDer())}static fromRaw(t){return new e(t)}static fromDer(t){return new e(this.derDecode(t))}static{this.RAW_KEY_LENGTH=32}static derEncode(t){return Hc(t,No)}static derDecode(t){let r=Kc(t,No);if(r.length!==this.RAW_KEY_LENGTH)throw G.fromCode(new Ht("An Ed25519 public key must be exactly 32 bytes long"));return r}#t;get rawKey(){return this.#t}#e;get derKey(){return this.#e}constructor(t){if(t.byteLength!==e.RAW_KEY_LENGTH)throw G.fromCode(new Ht("An Ed25519 public key must be exactly 32 bytes long"));this.#t=t,this.#e=e.derEncode(t)}toDer(){return this.derKey}toRaw(){return this.rawKey}};var Uo=class{constructor(){this.observers=[]}subscribe(t){this.observers.push(t)}unsubscribe(t){this.observers=this.observers.filter(r=>r!==t)}notify(t,...r){this.observers.forEach(n=>n(t,...r))}},vs=class extends Uo{constructor(){super()}print(t,...r){this.notify({message:t,level:"info"},...r)}warn(t,...r){this.notify({message:t,level:"warn"},...r)}error(t,r,...n){this.notify({message:t,level:"error",error:r},...n)}};var Is=class e{#t;#e;#n;#i;#u;#r;#s;#c;#a=0;static{this.default={initialInterval:500,randomizationFactor:.5,multiplier:1.5,maxInterval:6e4,maxElapsedTime:9e5,maxIterations:10,date:Date}}constructor(t=e.default){let{initialInterval:r=500,randomizationFactor:n=.5,multiplier:s=1.5,maxInterval:o=6e4,maxElapsedTime:i=9e5,maxIterations:c=10,date:a=Date}=t;this.#t=r,this.#e=n,this.#n=s,this.#i=o,this.#c=a,this.#u=a.now(),this.#r=i,this.#s=c}get ellapsedTimeInMsec(){return this.#c.now()-this.#u}get currentInterval(){return this.#t}get count(){return this.#a}get randomValueFromInterval(){let t=this.#e*this.#t,r=this.#t-t,n=this.#t+t;return Math.random()*(n-r)+r}incrementCurrentInterval(){return this.#t=Math.min(this.#t*this.#n,this.#i),this.#a++,this.#t}next(){return this.ellapsedTimeInMsec>=this.#r||this.#a>=this.#s?null:(this.incrementCurrentInterval(),this.randomValueFromInterval)}};var oe;(function(e){e.Received="received",e.Processing="processing",e.Replied="replied",e.Rejected="rejected",e.Unknown="unknown",e.Done="done"})(oe||(oe={}));var Gc=60*1e3,su=1e6,ou="308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d9685f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484b01291091c5f87b98883463f98091a0baaae",Lc="aaaaa-aa",iu="ic0.app",cu=".ic0.app",au="icp0.io",fu=".icp0.io",uu="icp-api.io",du=".icp-api.io",qo=200,lu=202,hu=404;function pu(){let e;if(typeof window<"u")if(window.fetch)e=window.fetch.bind(window);else throw at.fromCode(new wr("Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present."));else if(typeof global<"u")if(global.fetch)e=global.fetch.bind(global);else throw at.fromCode(new wr("Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available."));else typeof self<"u"&&self.fetch&&(e=self.fetch.bind(self));if(e)return e;throw at.fromCode(new wr("Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context."))}function mu(e){let t;if(e!==void 0)!e.match(/^[a-z]+:/)&&typeof window<"u"?t=new URL(window.location.protocol+"//"+e):t=new URL(e);else{let r=["ic0.app","icp0.io","127.0.0.1","localhost"],n=[".github.dev",".gitpod.io"],s=typeof window<"u"?window.location:void 0,o=s?.hostname,i;o&&typeof o=="string"&&(n.some(c=>o.endsWith(c))?i=o:i=r.find(c=>o.endsWith(c))),s&&i?t=new URL(`${s.protocol}//${i}${s.port?":"+s.port:""}`):t=new URL("https://icp-api.io")}return t.toString()}var hr=class e{#t;#e;#n;#i;#u;#r;#s;#c;#a;#o;#d;#p;#f;get#_(){return this.#f*Gc}#m;#y;#l;#h;constructor(t={}){this.#t=null,this.#e=!1,this.#n=0,this.#i=null,this.#u=!1,this._isAgent=!0,this.config={},this.log=new vs,this.#m=[],this.#y=[],this.#l=new _s({expirationTime:300*1e3}),this.#h=!0,this.#w=(s,o)=>{if(this.#h===!1)return s;if(!o)throw _t.fromCode(new Gr);let{status:i,signatures:c=[],requestId:a}=s;for(let u of c){let{timestamp:h,identity:d}=u,f=H.fromUint8Array(d).toText(),l;if(i===Se.Replied){let{reply:w}=s;l=nn({status:i,reply:w,timestamp:BigInt(h),request_id:a})}else if(i===Se.Rejected){let{reject_code:w,reject_message:y,error_code:_}=s;l=nn({status:i,reject_code:w,reject_message:y,error_code:_,timestamp:BigInt(h),request_id:a})}else throw lt.fromCode(new Rt(`Unknown status: ${i}`));let p=F(ji,l),b=o.nodeKeys.get(f);if(!b)throw Q.fromCode(new jn);let g=Bs.fromDer(b).rawKey;if(ve.verify(u.signature,p,g))return s;throw _t.fromCode(new Hn(f))}return s},this.config=t,this.#s=t.fetch||pu()||fetch.bind(global),this.#c=t.fetchOptions,this.#a=t.callOptions,this.#e=t.shouldFetchRootKey??!1,this.#u=t.shouldSyncTime??!1,t.rootKey?this.rootKey=t.rootKey:this.#e?this.rootKey=null:this.rootKey=$t(ou);let r=mu(t.host);this.host=new URL(r),t.verifyQuerySignatures!==void 0&&(this.#h=t.verifyQuerySignatures),this.#d=t.retryTimes??3;let n=()=>new Is({maxIterations:this.#d});if(this.#p=t.backoffStrategy||n,this.host.hostname.endsWith(cu)?this.host.hostname=iu:this.host.hostname.endsWith(fu)?this.host.hostname=au:this.host.hostname.endsWith(du)&&(this.host.hostname=uu),t.credentials){let{name:s,password:o}=t.credentials;this.#o=`${s}${o?":"+o:""}`}if(this.#r=Promise.resolve(t.identity||new sn),t.ingressExpiryInMinutes&&t.ingressExpiryInMinutes>5)throw G.fromCode(new Qe("The maximum ingress expiry time is 5 minutes.",t.ingressExpiryInMinutes));if(t.ingressExpiryInMinutes&&t.ingressExpiryInMinutes<=0)throw G.fromCode(new Qe("Ingress expiry time must be greater than 0.",t.ingressExpiryInMinutes));this.#f=t.ingressExpiryInMinutes||5,this.addTransform("update",Xs(dn)),t.useQueryNonces&&this.addTransform("query",Xs(dn)),t.logToConsole&&this.log.subscribe(s=>{s.level==="error"?console.error(s.message):s.level==="warn"?console.warn(s.message):console.log(s.message)})}static createSync(t={}){return new this({...t})}static async create(t={}){let r=e.createSync(t);return await r.#g(),r}static async from(t){try{return"config"in t?await e.create(t.config):await e.create({fetch:t._fetch,fetchOptions:t._fetchOptions,callOptions:t._callOptions,host:t._host.toString(),identity:t._identity??void 0})}catch{throw G.fromCode(new Vn)}}isLocal(){let t=this.host.hostname;return t==="127.0.0.1"||t.endsWith("127.0.0.1")}addTransform(t,r,n=r.priority||0){if(t==="update"){let s=this.#y.findIndex(o=>(o.priority||0)<n);this.#y.splice(s>=0?s:this.#y.length,0,Object.assign(r,{priority:n}))}else if(t==="query"){let s=this.#m.findIndex(o=>(o.priority||0)<n);this.#m.splice(s>=0?s:this.#m.length,0,Object.assign(r,{priority:n}))}}async getPrincipal(){if(!this.#r)throw at.fromCode(new Ne);return(await this.#r).getPrincipal()}async call(t,r,n){let s=r.callSync??!0,o=await(n??this.#r);if(!o)throw at.fromCode(new Ne);let i=H.from(t),c=r.effectiveCanisterId?H.from(r.effectiveCanisterId):i;await this.#g(c);let a=o.getPrincipal(),u=Lo(this.#f,this.#n),h={request_type:ss.Call,canister_id:i,method_name:r.methodName,arg:r.arg,sender:a,ingress_expiry:u},d=await this._transform({request:{body:null,method:"POST",headers:{"Content-Type":"application/cbor",...this.#o?{Authorization:"Basic "+btoa(this.#o)}:{}}},endpoint:ye.Call,body:h}),f;r?.nonce?f=l(r.nonce):d.body.nonce?f=l(d.body.nonce):f=void 0,h.nonce=f;function l(m){return Object.assign(m,{__nonce__:void 0})}d=await o.transformRequest(d);let p=ns(d.body),b=this.#p(),g=es(h);try{let y=s?()=>(this.log.print(`fetching "/api/v3/canister/${c.toText()}/call" with request:`,d),this.#s(""+new URL(`/api/v3/canister/${c.toText()}/call`,this.host),{...this.#a,...d.request,body:p})):()=>(this.log.print(`fetching "/api/v2/canister/${c.toText()}/call" with request:`,d),this.#s(""+new URL(`/api/v2/canister/${c.toText()}/call`,this.host),{...this.#a,...d.request,body:p})),{responseBodyBytes:_,...v}=await this.#b({requestFn:y,backoff:b,tries:0}),I=_.byteLength>0?Ut(_):null;return{requestId:g,response:{...v,body:I},requestDetails:h}}catch(m){let w;if(m instanceof jt){if(m.hasCode(Yr))return this.log.warn("v3 api not supported. Fall back to v2"),this.call(t,{...r,callSync:!1},n);if(m.hasCode(Qe))return await this.syncTime(i),this.call(i,r,n);m.code.requestContext={requestId:g,senderPubKey:d.body.sender_pubkey,senderSignature:d.body.sender_sig,ingressExpiry:d.body.content.ingress_expiry},w=m}else w=lt.fromCode(new Rt(m));throw this.log.error(`Error while making call: ${w.message}`,w),w}}async#x(t){let{ecid:r,transformedRequest:n,body:s,requestId:o,backoff:i,tries:c}=t,a=c===0?0:i.next();if(this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with tries:`,{tries:c,backoff:i,delay:a}),a===null)throw lt.fromCode(new ze(`Backoff strategy exhausted after ${c} attempts.`,o));a>0&&await new Promise(l=>setTimeout(l,a));let u;try{this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with request:`,n);let l=await this.#s(""+new URL(`/api/v2/canister/${r.toString()}/query`,this.host),{...this.#c,...n.request,body:s});if(l.status===qo)u={...Ut(Ir(await l.arrayBuffer())),httpDetails:{ok:l.ok,status:l.status,statusText:l.statusText,headers:cs(l.headers)},requestId:o};else throw Q.fromCode(new Zr(l.status,l.statusText,cs(l.headers),await l.text()))}catch(l){if(c<this.#d)return this.log.warn(`Caught exception while attempting to make query:
  ${l}
  Retrying query.`),await this.#x({...t,tries:c+1});throw l instanceof jt?l:jr.fromCode(new Xr(l))}if(!this.#h)return u;let h=u.signatures?.[0]?.timestamp;if(!h)throw Q.fromCode(new $n("Timestamp not found in query response. This suggests a malformed or malicious response."));let d=Number(BigInt(h)/BigInt(su));if(Date.now()+this.#n-d>this.#_){if(c<this.#d)return this.log.warn("Timestamp is older than the max ingress expiry. Retrying query.",{requestId:o,signatureTimestampMs:d}),await this.#x({...t,tries:c+1});throw _t.fromCode(new Dn(this.#f,o,c))}return u}async#b(t){let{requestFn:r,backoff:n,tries:s}=t,o=s===0?0:n.next();if(o===null)throw Q.fromCode(new ze(`Retry strategy exhausted after ${s} attempts.`));o>0&&await new Promise(h=>setTimeout(h,o));let i,c=new Uint8Array;try{i=await r(),i.status===qo&&(c=Ir(await i.clone().arrayBuffer()))}catch(h){if(s<this.#d)return this.log.warn(`Caught exception while attempting to make request:
  ${h}
  Retrying request.`),await this.#b({requestFn:r,backoff:n,tries:s+1});throw jr.fromCode(new Xr(h))}let a=cs(i.headers);if(i.status===qo||i.status===lu)return{ok:i.ok,status:i.status,statusText:i.statusText,responseBodyBytes:c,headers:a};let u=await i.text();if(i.status===hu&&i.url.includes("api/v3"))throw Q.fromCode(new Yr);if(u.startsWith("Invalid request expiry: "))throw G.fromCode(new Qe(u,this.#f));if(s<this.#d)return await this.#b({requestFn:r,backoff:n,tries:s+1});throw Q.fromCode(new Zr(i.status,i.statusText,a,u))}async query(t,r,n){let s=this.#p(),o=r.effectiveCanisterId?H.from(r.effectiveCanisterId):H.from(t);await this.#g(o),this.log.print(`ecid ${o.toString()}`),this.log.print(`canisterId ${t.toString()}`);let i,c=await(n??this.#r);if(!c)throw at.fromCode(new Ne);let a=H.from(t),u=c.getPrincipal(),h=Lo(this.#f,this.#n),d={request_type:or.Query,canister_id:a,method_name:r.methodName,arg:r.arg,sender:u,ingress_expiry:h},f=es(d);i=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#o?{Authorization:"Basic "+btoa(this.#o)}:{}}},endpoint:ye.Query,body:d}),i=await c.transformRequest(i);let l=ns(i.body),p={canister:a.toText(),ecid:o,transformedRequest:i,body:l,requestId:f,backoff:s,tries:0},b=async()=>({requestDetails:d,query:await this.#x(p)}),g=async()=>{if(!this.#h)return;let m=this.#l.get(o.toString());return m||(await this.fetchSubnetKeys(o.toString()),this.#l.get(o.toString()))};try{let[m,w]=await Promise.all([b(),g()]),{requestDetails:y,query:_}=m,v={..._,requestDetails:y};if(this.log.print("Query response:",v),!this.#h)return v;try{return this.#w(v,w)}catch{this.log.warn("Query response verification failed. Retrying with fresh subnet keys."),this.#l.delete(t.toString()),await this.fetchSubnetKeys(o.toString());let I=this.#l.get(t.toString());if(!I)throw _t.fromCode(new Gr);return this.#w(v,I)}}catch(m){let w;throw m instanceof jt?(m.code.requestContext={requestId:f,senderPubKey:i.body.sender_pubkey,senderSignature:i.body.sender_sig,ingressExpiry:i.body.content.ingress_expiry},w=m):w=lt.fromCode(new Rt(m)),this.log.error(`Error while making query: ${w.message}`,w),w}}#w;async createReadStateRequest(t,r){await this.#g();let n=await(r??this.#r);if(!n)throw at.fromCode(new Ne);let s=n.getPrincipal(),o=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#o?{Authorization:"Basic "+btoa(this.#o)}:{}}},endpoint:ye.ReadState,body:{request_type:or.ReadState,paths:t.paths,sender:s,ingress_expiry:Lo(this.#f,this.#n)}});return n.transformRequest(o)}async readState(t,r,n,s){await this.#E();let o=H.from(t);function i(h){for(let d of h.paths){let[f,l]=d,p=new TextEncoder().encode("request_status");if(nr(f,p))return l}}let c,a;if(s)c=s,a=es(c);else{a=i(r);let h=await this.#r;if(!h)throw at.fromCode(new Ne);c=await this.createReadStateRequest(r,h)}this.log.print(`fetching "/api/v2/canister/${o}/read_state" with request:`,c);let u=this.#p();try{let{responseBodyBytes:h}=await this.#b({requestFn:()=>this.#s(""+new URL(`/api/v2/canister/${o.toString()}/read_state`,this.host),{...this.#c,...c.request,body:ns(c.body)}),backoff:u,tries:0}),d=Ut(h);return this.log.print("Read state response:",d),d}catch(h){let d;throw h instanceof jt?(h.code.requestContext={requestId:a,senderPubKey:c.body.sender_pubkey,senderSignature:c.body.sender_sig,ingressExpiry:c.body.content.ingress_expiry},d=h):d=lt.fromCode(new Rt(h)),this.log.error(`Error while making read state: ${d.message}`,d),d}}parseTimeFromResponse(t){let r;if(t.certificate){let n=Ut(t.certificate);if(n&&"tree"in n)r=n.tree;else throw Q.fromCode(new Ue("Could not decode time from response"));let s=lr(["time"],r);if(s.status!==Ct.Found)throw Q.fromCode(new de("Time was not found in the response or was not in its expected format.",s.status));if(!(s.value instanceof Uint8Array)&&!ArrayBuffer.isView(s))throw Q.fromCode(new gr("Time was not in its expected format."));let o=Pr(s.value);return this.log.print("Time from response:",o),this.log.print("Time from response in milliseconds:",Number(o)),Number(o)}else this.log.warn("No certificate found in response");return 0}async syncTime(t){this.#i=this.#i??(async()=>{await this.#E();let r=Date.now();try{t||this.log.print("Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai");let n=t??H.from("ryjl3-tyaaa-aaaaa-aaaba-cai"),s=e.createSync({identity:new sn,host:this.host.toString(),fetch:this.#s,retryTimes:0,rootKey:this.rootKey??void 0}),i=(await Promise.all(Array(3).fill(null).map(async()=>{let a=(await Io({canisterId:n,agent:s,paths:["time"]})).get("time");if(a instanceof Date)return a.getTime()},[]))).reduce((c,a)=>typeof a=="number"&&a>c?a:c,0);i>BigInt(0)&&(this.#n=Number(i)-Number(r),this.log.notify({message:`Syncing time: offset of ${this.#n}`,level:"info"}))}catch(n){let s=n instanceof jt?n:lt.fromCode(new Rt(n));throw this.log.error("Caught exception while attempting to sync time",s),s}})(),await this.#i.finally(()=>{this.#i=null})}async status(){let t=this.#o?{Authorization:"Basic "+btoa(this.#o)}:{};this.log.print('fetching "/api/v2/status"');let r=this.#p(),{responseBodyBytes:n}=await this.#b({backoff:r,requestFn:()=>this.#s(""+new URL("/api/v2/status",this.host),{headers:t,...this.#c}),tries:0});return Ut(n)}async fetchRootKey(){return this.#t=this.#t??(async()=>{let t=await this.status();return this.rootKey=t.root_key,this.rootKey})(),await this.#t.finally(()=>{this.#t=null})}async#g(t){await Promise.all([this.#E(),this.#B(t)])}async#E(){if(!this.rootKey)if(this.rootKey===null&&this.host.toString()!=="https://icp-api.io"&&this.#e)await this.fetchRootKey();else throw at.fromCode(new Kt(this.#e))}async#B(t){this.#u&&this.#n===0&&await this.syncTime(t)}invalidateIdentity(){this.#r=null}replaceIdentity(t){this.#r=Promise.resolve(t)}async fetchSubnetKeys(t){let r=H.from(t);await this.#g(r);let s=(await Io({canisterId:r,paths:["subnet"],agent:this})).get("subnet");if(s&&typeof s=="object"&&"nodeKeys"in s)return this.#l.set(r.toText(),s),s}_transform(t){let r=Promise.resolve(t);if(t.endpoint===ye.Call)for(let n of this.#y)r=r.then(s=>n(s).then(o=>o||s));else for(let n of this.#m)r=r.then(s=>n(s).then(o=>o||s));return r}};function Lo(e,t){return Or.fromDeltaInMilliseconds(e*Gc+t)}var yu=300*1e3;function Po(){return Eu(gu(bu(),1e3),wu(1e3,1.2),xu(yu))}function bu(){let e=!0;return async()=>e?(e=!1,!0):!1}function gu(e,t){return async(r,n,s)=>{if(await e(r,n,s))return new Promise(o=>setTimeout(o,t))}}function xu(e){let t=Date.now()+e;return async(r,n,s)=>{if(Date.now()>t)throw Q.fromCode(new ze(`Request timed out after ${e} msec`,n,s))}}function wu(e,t){let r=e;return()=>new Promise(n=>setTimeout(()=>{r*=t,n()},r))}function Eu(...e){return async(t,r,n)=>{for(let s of e)await s(t,r,n)}}var Yc={strategy:Po(),preSignReadStateRequest:!1};function Xc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Do(e,t){return e!==null&&typeof e=="object"&&Xc(e,t)}function Bu(e,t){return Xc(e,t)&&typeof e[t]=="function"}function Zc(e){return Do(e,"body")&&Do(e.body,"content")&&e.body.content.request_type===or.ReadState&&Do(e.body.content,"ingress_expiry")&&typeof e.body.content.ingress_expiry=="object"&&e.body.content.ingress_expiry!==null&&Bu(e.body.content.ingress_expiry,"toHash")}async function Mo(e,t,r,n={}){let s=[z("request_status"),r],o,i;if(n.preSignReadStateRequest??!1?(i=await vu({paths:[s],agent:e,pollingOptions:n}),o=await e.readState(t,{paths:[s]},void 0,i)):o=await e.readState(t,{paths:[s]}),e.rootKey==null)throw at.fromCode(new Kt);let a=await $e.create({certificate:o.certificate,rootKey:e.rootKey,canisterId:t,blsVerify:n.blsVerify}),u=wt(a.lookup_path([...s,z("status")])),h;switch(typeof u>"u"?h=oe.Unknown:h=new TextDecoder().decode(u),h){case oe.Replied:return{reply:wt(a.lookup_path([...s,"reply"])),certificate:a};case oe.Received:case oe.Unknown:case oe.Processing:return await(n.strategy??Po())(t,r,h),Mo(e,t,r,{...n,request:i});case oe.Rejected:{let d=new Uint8Array(wt(a.lookup_path([...s,"reject_code"])))[0],f=new TextDecoder().decode(wt(a.lookup_path([...s,"reject_message"]))),l=wt(a.lookup_path([...s,"error_code"])),p=l?new TextDecoder().decode(l):void 0;throw Re.fromCode(new We(r,d,f,p))}case oe.Done:throw lt.fromCode(new kn(r))}throw qe}async function vu(e){let{paths:t,agent:r,pollingOptions:n}=e;if(n.request&&Zc(n.request))return n.request;let s=await r.createReadStateRequest?.({paths:t},void 0);if(!Zc(s))throw G.fromCode(new Kn(s));return s}var Mt=Symbol.for("ic-agent-metadata"),Ts=class e{static agentOf(t){return t[Mt].config.agent}static interfaceOf(t){return t[Mt].service}static canisterIdOf(t){return H.from(t[Mt].config.canisterId)}static createActorClass(t,r){let n=t({IDL:rr});class s extends e{constructor(i){if(!i.canisterId)throw G.fromCode(new zr(i.canisterId));let c=typeof i.canisterId=="string"?H.fromText(i.canisterId):i.canisterId;super({config:{...zc,...i,canisterId:c},service:n});for(let[a,u]of n._fields)r?.httpDetails&&u.annotations.push(ko),r?.certificate&&u.annotations.push(Wc),this[a]=Iu(this,a,u,i.blsVerify)}}return s}static createActor(t,r){if(!r.canisterId)throw G.fromCode(new zr(r.canisterId));return new(this.createActorClass(t))(r)}static createActorWithHttpDetails(t,r){return new(this.createActorClass(t,{httpDetails:!0}))(r)}static createActorWithExtendedDetails(t,r,n={httpDetails:!0,certificate:!0}){return new(this.createActorClass(t,n))(r)}constructor(t){this[Mt]=Object.freeze(t)}};function Mr(e,t){let r=rr.decode(e,t);switch(r.length){case 0:return;case 1:return r[0];default:return r}}var zc={pollingOptions:Yc},ko="http-details",Wc="certificate";function Iu(e,t,r,n){let s;r.annotations.includes("query")||r.annotations.includes("composite_query")?s=async(i,...c)=>{i={...i,...e[Mt].config.queryTransform?.(t,c,{...e[Mt].config,...i})};let a=i.agent||e[Mt].config.agent||new hr,u=H.from(i.canisterId||e[Mt].config.canisterId),h=rr.encode(r.argTypes,c),d=await a.query(u,{methodName:t,arg:h,effectiveCanisterId:i.effectiveCanisterId}),f={...d.httpDetails,requestDetails:d.requestDetails};switch(d.status){case Se.Rejected:{let l=new Mn(d.requestId,d.reject_code,d.reject_message,d.error_code,d.signatures);throw l.callContext={canisterId:u,methodName:t,httpDetails:f},Re.fromCode(l)}case Se.Replied:return r.annotations.includes(ko)?{httpDetails:f,result:Mr(r.retTypes,d.reply.arg)}:Mr(r.retTypes,d.reply.arg)}}:s=async(i,...c)=>{i={...i,...e[Mt].config.callTransform?.(t,c,{...e[Mt].config,...i})};let a=i.agent||e[Mt].config.agent||hr.createSync(),{canisterId:u,effectiveCanisterId:h,pollingOptions:d}={...zc,...e[Mt].config,...i},f=H.from(u),l=h!==void 0?H.from(h):f,p=rr.encode(r.argTypes,c),{requestId:b,response:g,requestDetails:m}=await a.call(f,{methodName:t,arg:p,effectiveCanisterId:l,nonce:i.nonce}),w,y;if($o(g.body)){if(a.rootKey==null)throw at.fromCode(new Kt);let T=g.body.certificate;y=await $e.create({certificate:T,rootKey:a.rootKey,canisterId:H.from(u),blsVerify:n});let A=[z("request_status"),b];switch(new TextDecoder().decode(wt(y.lookup_path([...A,"status"])))){case"replied":w=wt(y.lookup_path([...A,"reply"]));break;case"rejected":{let S=new Uint8Array(wt(y.lookup_path([...A,"reject_code"])))[0],U=new TextDecoder().decode(wt(y.lookup_path([...A,"reject_message"]))),C=wt(y.lookup_path([...A,"error_code"])),x=C?new TextDecoder().decode(C):void 0,B=new We(b,S,U,x);throw B.callContext={canisterId:f,methodName:t,httpDetails:g},Re.fromCode(B)}}}else if(Vo(g.body)){let{reject_code:T,reject_message:A,error_code:E}=g.body,S=new We(b,T,A,E);throw S.callContext={canisterId:f,methodName:t,httpDetails:g},Re.fromCode(S)}if(g.status===202){let T={...d,blsVerify:n},A=await Mo(a,l,b,T);y=A.certificate,w=A.reply}let _=r.annotations.includes(ko),v=r.annotations.includes(Wc),I={...g,requestDetails:m};if(w!==void 0)return _&&v?{httpDetails:I,certificate:y,result:Mr(r.retTypes,w)}:v?{certificate:y,result:Mr(r.retTypes,w)}:_?{httpDetails:I,result:Mr(r.retTypes,w)}:Mr(r.retTypes,w);if(r.retTypes.length===0)return _?{httpDetails:g,result:void 0}:void 0;throw lt.fromCode(new Rt(`Call was returned undefined, but type [${r.retTypes.map(T=>T.display()).join(",")}].`))};let o=(...i)=>s({},...i);return o.withOptions=i=>(...c)=>s(i,...c),o}var Qc=({IDL:e})=>e.Service({get_balance:e.Func([e.Text],[e.Nat64],[]),get_deposit_address:e.Func([e.Text],[e.Text],["query"]),get_nonce:e.Func([e.Text],[e.Nat64],["query"]),get_pid:e.Func([e.Text],[e.Text],["query"]),transfer:e.Func([e.Text,e.Nat64,e.Text,e.Vec(e.Nat8),e.Nat64],[e.Text],[])});var Tu="https://ic0.app",Su="f4kcz-fqaaa-aaaap-an3hq-cai",Au=new hr({host:Tu}),kr=Ts.createActor(Qc,{agent:Au,canisterId:Su});function Ou(){if("phantom"in window){let e=window.phantom?.solana;if(e?.isPhantom)return e}window.open("https://phantom.app/","_blank")}var Jc=Ou(),Te=null;document.getElementById("connect").onclick=async()=>{try{Te=(await Jc.connect()).publicKey.toString(),document.getElementById("pubkey").innerText=`Sol Pubkey: ${Te}`;let t=await kr.get_deposit_address(Te);document.getElementById("deposit").innerText=`Deposit to: ${t} (Send ICP here manually)`;let r=await kr.get_pid(Te);document.getElementById("pid").innerText=`ICP PID: ${r}`;let n=await kr.get_balance(Te);document.getElementById("balance").innerText=`Balance: ${n} e8s`}catch(e){document.getElementById("status").innerText=`Error: ${e.message}`}};document.getElementById("send").onclick=async()=>{if(!Te)return alert("Connect first");let e=document.getElementById("to").value,t=BigInt(document.getElementById("amount").value),r=await kr.get_nonce(Te),n=`transfer to ${e} amount ${t} nonce ${r}`,s=new TextEncoder().encode(n);try{let i=(await Jc.signMessage(s,"utf8")).signature,c=await kr.transfer(e,t,Te,Array.from(i),r);document.getElementById("status").innerText=c;let a=await kr.get_balance(Te);document.getElementById("balance").innerText=`Balance: ${a} e8s`}catch(o){document.getElementById("status").innerText=`Error: ${o.message}`}};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/abstract/bls.js:
@noble/curves/esm/abstract/tower.js:
@noble/curves/esm/bls12-381.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
