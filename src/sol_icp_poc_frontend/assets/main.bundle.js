var Cf=Object.defineProperty;var Rf=(t,e)=>{for(var r in e)Cf(t,r,{get:e[r],enumerable:!0})};var ta;(function(t){t[t.SysFatal=1]="SysFatal",t[t.SysTransient=2]="SysTransient",t[t.DestinationInvalid=3]="DestinationInvalid",t[t.CanisterReject=4]="CanisterReject",t[t.CanisterError=5]="CanisterError"})(ta||(ta={}));var Vt;(function(t){t.Replied="replied",t.Rejected="rejected"})(Vt||(Vt={}));function ra(t){return t!=null&&"reject_code"in t}function na(t){return t!=null&&"certificate"in t}var ao="abcdefghijklmnopqrstuvwxyz234567",Dr=Object.create(null);for(let t=0;t<ao.length;t++)Dr[ao[t]]=t;Dr[0]=Dr.o;Dr[1]=Dr.i;function oa(t){let e=0,r=0,n="";function o(s){return e<0?r|=s>>-e:r=s<<e&248,e>3?(e-=8,1):(e<4&&(n+=ao[r>>3],e+=5),0)}for(let s=0;s<t.length;)s+=o(t[s]);return n+(e<0?ao[r>>3]:"")}function sa(t){let e=0,r=0,n=new Uint8Array(t.length*4/3|0),o=0;function s(i){let c=Dr[i.toLowerCase()];if(c===void 0)throw new Error(`Invalid character: ${JSON.stringify(i)}`);c<<=3,r|=c>>>e,e+=5,e>=8&&(n[o++]=r,e-=8,e>0?r=c<<5-e&255:r=0)}for(let i of t)s(i);return n.slice(0,o)}var Nf=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function ia(t){let e=-1;for(let r=0;r<t.length;r++){let o=(t[r]^e)&255;e=Nf[o]^e>>>8}return(e^-1)>>>0}var ur=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ft(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Is(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function se(t,...e){if(!ft(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function vs(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ca(t,e){se(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function dr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function fo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function We(t,e){return t<<32-e|t>>>e}var fa=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Pf=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function F(t){if(se(t),fa)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Pf[t[r]];return e}var xt={_0:48,_9:57,A:65,F:70,a:97,f:102};function aa(t){if(t>=xt._0&&t<=xt._9)return t-xt._0;if(t>=xt.A&&t<=xt.F)return t-(xt.A-10);if(t>=xt.a&&t<=xt.f)return t-(xt.a-10)}function me(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(fa)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=aa(t.charCodeAt(s)),c=aa(t.charCodeAt(s+1));if(i===void 0||c===void 0){let a=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function X(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Bs(t){return typeof t=="string"&&(t=X(t)),se(t),t}function $(...t){let e=0;for(let n=0;n<t.length;n++){let o=t[n];se(o),e+=o.length}let r=new Uint8Array(e);for(let n=0,o=0;n<t.length;n++){let s=t[n];r.set(s,o),o+=s.length}return r}var co=class{};function uo(t){let e=n=>t().update(Bs(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function kr(t=32){if(ur&&typeof ur.getRandomValues=="function")return ur.getRandomValues(new Uint8Array(t));if(ur&&typeof ur.randomBytes=="function")return Uint8Array.from(ur.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function Uf(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),c=Number(r&s),a=n?4:0,u=n?0:4;t.setUint32(e+a,i,n),t.setUint32(e+u,c,n)}function ua(t,e,r){return t&e^~t&r}function da(t,e,r){return t&e^t&r^e&r}var ln=class extends co{constructor(e,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=fo(this.buffer)}update(e){vs(this),e=Bs(e),se(e);let{view:r,buffer:n,blockLen:o}=this,s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=fo(e);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){vs(this),ca(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,dr(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let d=i;d<o;d++)r[d]=0;Uf(n,o-8,BigInt(this.length*8),s),this.process(n,0);let c=fo(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=a/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)c.setUint32(4*d,l[d],s)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return e.destroyed=i,e.finished=s,e.length=o,e.pos=c,o%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}},_t=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Et=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]);var xe=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var lo=BigInt(4294967295),la=BigInt(32);function Df(t,e=!1){return e?{h:Number(t&lo),l:Number(t>>la&lo)}:{h:Number(t>>la&lo)|0,l:Number(t&lo)|0}}function ha(t,e=!1){let r=t.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:c}=Df(t[s],e);[n[s],o[s]]=[i,c]}return[n,o]}var Ts=(t,e,r)=>t>>>r,Ss=(t,e,r)=>t<<32-r|e>>>r,lr=(t,e,r)=>t>>>r|e<<32-r,hr=(t,e,r)=>t<<32-r|e>>>r,hn=(t,e,r)=>t<<64-r|e>>>r-32,pn=(t,e,r)=>t>>>r-32|e<<64-r;function ut(t,e,r,n){let o=(e>>>0)+(n>>>0);return{h:t+r+(o/2**32|0)|0,l:o|0}}var pa=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),ma=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,ya=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),ba=(t,e,r,n,o)=>e+r+n+o+(t/2**32|0)|0,ga=(t,e,r,n,o)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(o>>>0),wa=(t,e,r,n,o,s)=>e+r+n+o+s+(t/2**32|0)|0;var Lf=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),jt=new Uint32Array(64),ho=class extends ln{constructor(e=32){super(64,e,8,!1),this.A=_t[0]|0,this.B=_t[1]|0,this.C=_t[2]|0,this.D=_t[3]|0,this.E=_t[4]|0,this.F=_t[5]|0,this.G=_t[6]|0,this.H=_t[7]|0}get(){let{A:e,B:r,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[e,r,n,o,s,i,c,a]}set(e,r,n,o,s,i,c,a){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,r){for(let d=0;d<16;d++,r+=4)jt[d]=e.getUint32(r,!1);for(let d=16;d<64;d++){let f=jt[d-15],h=jt[d-2],p=We(f,7)^We(f,18)^f>>>3,y=We(h,17)^We(h,19)^h>>>10;jt[d]=y+jt[d-7]+p+jt[d-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:u,H:l}=this;for(let d=0;d<64;d++){let f=We(c,6)^We(c,11)^We(c,25),h=l+f+ua(c,a,u)+Lf[d]+jt[d]|0,y=(We(n,2)^We(n,13)^We(n,22))+da(n,o,s)|0;l=u,u=a,a=c,c=i+h|0,i=s,s=o,o=n,n=h+y|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,c,a,u,l)}roundClean(){dr(jt)}destroy(){this.set(0,0,0,0,0,0,0,0),dr(this.buffer)}},As=class extends ho{constructor(){super(28),this.A=Et[0]|0,this.B=Et[1]|0,this.C=Et[2]|0,this.D=Et[3]|0,this.E=Et[4]|0,this.F=Et[5]|0,this.G=Et[6]|0,this.H=Et[7]|0}},xa=ha(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Mf=xa[0],qf=xa[1],Kt=new Uint32Array(80),Ht=new Uint32Array(80),Os=class extends ln{constructor(e=64){super(128,e,16,!1),this.Ah=xe[0]|0,this.Al=xe[1]|0,this.Bh=xe[2]|0,this.Bl=xe[3]|0,this.Ch=xe[4]|0,this.Cl=xe[5]|0,this.Dh=xe[6]|0,this.Dl=xe[7]|0,this.Eh=xe[8]|0,this.El=xe[9]|0,this.Fh=xe[10]|0,this.Fl=xe[11]|0,this.Gh=xe[12]|0,this.Gl=xe[13]|0,this.Hh=xe[14]|0,this.Hl=xe[15]|0}get(){let{Ah:e,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:u,El:l,Fh:d,Fl:f,Gh:h,Gl:p,Hh:y,Hl:g}=this;return[e,r,n,o,s,i,c,a,u,l,d,f,h,p,y,g]}set(e,r,n,o,s,i,c,a,u,l,d,f,h,p,y,g){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=u|0,this.El=l|0,this.Fh=d|0,this.Fl=f|0,this.Gh=h|0,this.Gl=p|0,this.Hh=y|0,this.Hl=g|0}process(e,r){for(let b=0;b<16;b++,r+=4)Kt[b]=e.getUint32(r),Ht[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){let E=Kt[b-15]|0,v=Ht[b-15]|0,T=lr(E,v,1)^lr(E,v,8)^Ts(E,v,7),B=hr(E,v,1)^hr(E,v,8)^Ss(E,v,7),A=Kt[b-2]|0,_=Ht[b-2]|0,S=lr(A,_,19)^hn(A,_,61)^Ts(A,_,6),P=hr(A,_,19)^pn(A,_,61)^Ss(A,_,6),C=ya(B,P,Ht[b-7],Ht[b-16]),x=ba(C,T,S,Kt[b-7],Kt[b-16]);Kt[b]=x|0,Ht[b]=C|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:u,Dl:l,Eh:d,El:f,Fh:h,Fl:p,Gh:y,Gl:g,Hh:m,Hl:w}=this;for(let b=0;b<80;b++){let E=lr(d,f,14)^lr(d,f,18)^hn(d,f,41),v=hr(d,f,14)^hr(d,f,18)^pn(d,f,41),T=d&h^~d&y,B=f&p^~f&g,A=ga(w,v,B,qf[b],Ht[b]),_=wa(A,m,E,T,Mf[b],Kt[b]),S=A|0,P=lr(n,o,28)^hn(n,o,34)^hn(n,o,39),C=hr(n,o,28)^pn(n,o,34)^pn(n,o,39),x=n&s^n&c^s&c,I=o&i^o&a^i&a;m=y|0,w=g|0,y=h|0,g=p|0,h=d|0,p=f|0,{h:d,l:f}=ut(u|0,l|0,_|0,S|0),u=c|0,l=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let R=pa(S,C,I);n=ma(R,_,P,x),o=R|0}({h:n,l:o}=ut(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=ut(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=ut(this.Ch|0,this.Cl|0,c|0,a|0),{h:u,l}=ut(this.Dh|0,this.Dl|0,u|0,l|0),{h:d,l:f}=ut(this.Eh|0,this.El|0,d|0,f|0),{h,l:p}=ut(this.Fh|0,this.Fl|0,h|0,p|0),{h:y,l:g}=ut(this.Gh|0,this.Gl|0,y|0,g|0),{h:m,l:w}=ut(this.Hh|0,this.Hl|0,m|0,w|0),this.set(n,o,s,i,c,a,u,l,d,f,h,p,y,g,m,w)}roundClean(){dr(Kt,Ht)}destroy(){dr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var Ie=uo(()=>new ho),_a=uo(()=>new As),Ea=uo(()=>new Os);var po="__principal__",Ff=2,Ia=4,$f="aaaaa-aa",M=class t{static anonymous(){return new this(new Uint8Array([Ia]))}static managementCanister(){return this.fromText($f)}static selfAuthenticating(e){let r=_a(e);return new this(new Uint8Array([...r,Ff]))}static from(e){if(typeof e=="string")return t.fromText(e);if(Object.getPrototypeOf(e)===Uint8Array.prototype)return new t(e);if(t.isPrincipal(e))return new t(e._arr);throw new Error(`Impossible to convert ${JSON.stringify(e)} to Principal.`)}static fromHex(e){return new this(me(e))}static fromText(e){let r=e;if(e.includes(po)){let i=JSON.parse(e);po in i&&(r=i[po])}let n=r.toLowerCase().replace(/-/g,""),o=sa(n);o=o.slice(4,o.length);let s=new this(o);if(s.toText()!==r)throw new Error(`Principal "${s.toText()}" does not have a valid checksum (original value "${r}" may not be a valid Principal ID).`);return s}static fromUint8Array(e){return new this(e)}static isPrincipal(e){return e instanceof t||typeof e=="object"&&e!==null&&"_isPrincipal"in e&&e._isPrincipal===!0&&"_arr"in e&&e._arr instanceof Uint8Array}constructor(e){this._arr=e,this._isPrincipal=!0}isAnonymous(){return this._arr.byteLength===1&&this._arr[0]===Ia}toUint8Array(){return this._arr}toHex(){return F(this._arr).toUpperCase()}toText(){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,ia(this._arr));let n=new Uint8Array(e),o=new Uint8Array([...n,...this._arr]),i=oa(o).match(/.{1,5}/g);if(!i)throw new Error;return i.join("-")}toString(){return this.toText()}toJSON(){return{[po]:this.toText()}}compareTo(e){for(let r=0;r<Math.min(this._arr.length,e._arr.length);r++){if(this._arr[r]<e._arr[r])return"lt";if(this._arr[r]>e._arr[r])return"gt"}return this._arr.length<e._arr.length?"lt":this._arr.length>e._arr.length?"gt":"eq"}ltEq(e){let r=this.compareTo(e);return r=="lt"||r=="eq"}gtEq(e){let r=this.compareTo(e);return r=="gt"||r=="eq"}};var It;(function(t){t.Trust="Trust",t.Protocol="Protocol",t.Reject="Reject",t.Transport="Transport",t.External="External",t.Limit="Limit",t.Input="Input",t.Unknown="Unknown"})(It||(It={}));var K=class{constructor(e=!1){this.isCertified=e}toString(){let e=this.toErrorMessage();return this.requestContext&&(e+=`
Request context:
  Request ID (hex): ${this.requestContext.requestId?F(this.requestContext.requestId):"undefined"}
  Sender pubkey (hex): ${F(this.requestContext.senderPubKey)}
  Sender signature (hex): ${F(this.requestContext.senderSignature)}
  Ingress expiry: ${this.requestContext.ingressExpiry.toString()}`),this.callContext&&(e+=`
Call context:
  Canister ID: ${this.callContext.canisterId.toText()}
  Method name: ${this.callContext.methodName}
  HTTP details: ${JSON.stringify(this.callContext.httpDetails,null,2)}`),e}},ze=class t extends Error{get code(){return this.cause.code}set code(e){this.cause.code=e}get kind(){return this.cause.kind}set kind(e){this.cause.kind=e}get isCertified(){return this.code.isCertified}constructor(e,r){super(e.toString()),this.name="AgentError",this.cause={code:e,kind:r},Object.setPrototypeOf(this,t.prototype)}hasCode(e){return this.code instanceof e}toString(){return`${this.name} (${this.kind}): ${this.message}`}},vt=class extends ze{static fromCode(e){return new this(e)}},Se=class t extends vt{constructor(e){super(e,It.Trust),this.name="TrustError",Object.setPrototypeOf(this,t.prototype)}},Q=class t extends vt{constructor(e){super(e,It.Protocol),this.name="ProtocolError",Object.setPrototypeOf(this,t.prototype)}},Gt=class t extends vt{constructor(e){super(e,It.Reject),this.name="RejectError",Object.setPrototypeOf(this,t.prototype)}},mn=class t extends vt{constructor(e){super(e,It.Transport),this.name="TransportError",Object.setPrototypeOf(this,t.prototype)}},ye=class t extends vt{constructor(e){super(e,It.External),this.name="ExternalError",Object.setPrototypeOf(this,t.prototype)}};var G=class t extends vt{constructor(e){super(e,It.Input),this.name="InputError",Object.setPrototypeOf(this,t.prototype)}},ue=class t extends vt{constructor(e){super(e,It.Unknown),this.name="UnknownError",Object.setPrototypeOf(this,t.prototype)}},Zt=class t extends K{constructor(e,r){super(),this.reason=e,this.error=r,this.name="CertificateVerificationErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=this.reason;return this.error&&(e+=`: ${En(this.error)}`),`Certificate verification error: "${e}"`}},pr=class t extends K{constructor(e,r,n,o,s){super(),this.maxAgeInMinutes=e,this.certificateTime=r,this.currentTime=n,this.timeDiffMsecs=o,this.ageType=s,this.name="CertificateTimeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Certificate is signed more than ${this.maxAgeInMinutes} minutes in the ${this.ageType}. Certificate time: ${this.certificateTime.toISOString()} Current time: ${this.currentTime.toISOString()} Clock drift: ${this.timeDiffMsecs}ms`}},mo=class t extends K{constructor(){super(),this.name="CertificateHasTooManyDelegationsErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Certificate has too many delegations"}},Lr=class t extends K{constructor(e,r){super(),this.canisterId=e,this.subnetId=r,this.name="CertificateNotAuthorizedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The certificate contains a delegation that does not include the canister ${this.canisterId.toText()} in the canister_ranges field. Subnet ID: ${this.subnetId.toText()}`}},Bt=class t extends K{constructor(e,r){super(),this.message=e,this.lookupStatus=r,this.name="LookupErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`${this.message}. Lookup status: ${this.lookupStatus}`}},Mr=class t extends K{constructor(e){super(),this.message=e,this.name="MalformedLookupFoundValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.message}},yo=class t extends K{constructor(e){super(),this.message=e,this.name="MissingLookupValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.message}},qr=class t extends K{constructor(e,r){super(),this.expectedLength=e,this.actualLength=r,this.name="DerKeyLengthMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`BLS DER-encoded public key must be ${this.expectedLength} bytes long, but is ${this.actualLength} bytes long`}},bo=class t extends K{constructor(e,r){super(),this.expectedPrefix=e,this.actualPrefix=r,this.name="DerPrefixMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`BLS DER-encoded public key is invalid. Expected the following prefix: ${F(this.expectedPrefix)}, but got ${F(this.actualPrefix)}`}},go=class t extends K{constructor(e,r){super(),this.expectedLength=e,this.actualLength=r,this.name="DerDecodeLengthMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`DER payload mismatch: Expected length ${this.expectedLength}, actual length: ${this.actualLength}`}},Xe=class t extends K{constructor(e){super(),this.error=e,this.name="DerDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode DER: ${this.error}`}},yn=class t extends K{constructor(e){super(),this.error=e,this.name="DerEncodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to encode DER: ${this.error}`}},wo=class t extends K{constructor(e,r){super(),this.error=e,this.input=r,this.name="CborDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode CBOR: ${En(this.error)}, input: ${F(this.input)}`}},xo=class t extends K{constructor(e,r){super(),this.error=e,this.value=r,this.name="CborEncodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to encode CBOR: ${En(this.error)}, input: ${this.value}`}};var mr=class t extends K{constructor(e,r,n){super(),this.message=e,this.requestId=r,this.status=n,this.name="TimeoutWaitingForResponseErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`${this.message}
`;return this.requestId&&(e+=`  Request ID: ${F(this.requestId)}
`),this.status&&(e+=`  Request status: ${this.status}
`),e}},_o=class t extends K{constructor(e,r,n){super(),this.maxIngressExpiryInMinutes=e,this.requestId=r,this.retryTimes=n,this.name="CertificateOutdatedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`Certificate is stale (over ${this.maxIngressExpiryInMinutes} minutes). Is the computer's clock synchronized?
  Request ID: ${F(this.requestId)}
`;return this.retryTimes!==void 0&&(e+=`  Retried ${this.retryTimes} times.`),e}},Fr=class t extends K{constructor(e,r,n,o){super(!0),this.requestId=e,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=o,this.name="CertifiedRejectErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${F(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},Eo=class t extends K{constructor(e,r,n,o,s){super(),this.requestId=e,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=o,this.signatures=s,this.name="UncertifiedRejectErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${F(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},Io=class t extends K{constructor(e,r,n,o){super(),this.requestId=e,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=o,this.name="UncertifiedRejectUpdateErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${F(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},vo=class t extends K{constructor(e){super(),this.requestId=e,this.name="RequestStatusDoneNoReplyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Call was marked as done but we never saw the reply:
  Request ID: ${F(this.requestId)}
`}},dt=class t extends K{constructor(e){super(),this.shouldFetchRootKey=e,this.name="MissingRootKeyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.shouldFetchRootKey===void 0?"Agent is missing root key":`Agent is missing root key and the shouldFetchRootKey value is set to ${this.shouldFetchRootKey}. The root key should only be unknown if you are in local development. Otherwise you should avoid fetching and use the default IC Root Key or the known root key of your environment.`}},Bo=class t extends K{constructor(e){super(),this.value=e,this.name="HashValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Attempt to hash a value of unsupported type: ${this.value}`}},$r=class t extends K{constructor(e){super(),this.error=e,this.name="HttpDefaultFetchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.error}},Yt=class t extends K{constructor(){super(),this.name="IdentityInvalidErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"This identity has expired due this application's security policy. Please refresh your authentication."}},yr=class t extends K{constructor(e,r){super(),this.message=e,this.providedIngressExpiryInMinutes=r,this.name="IngressExpiryInvalidErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`${this.message}. Provided ingress expiry time is ${this.providedIngressExpiryInMinutes} minutes.`}},To=class t extends K{constructor(){super(),this.name="CreateHttpAgentErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Failed to create agent from provided agent"}},So=class t extends K{constructor(e){super(),this.error=e,this.name="MalformedSignatureErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Query response contained a malformed signature: ${this.error}`}},Ao=class t extends K{constructor(){super(),this.name="MissingSignatureErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Query response did not contain any node signatures"}},Oo=class t extends K{constructor(){super(),this.name="MalformedPublicKeyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Read state response contained a malformed public key"}},Co=class t extends K{constructor(e){super(),this.nodeId=e,this.name="QuerySignatureVerificationFailedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Query signature verification failed. Node ID: ${this.nodeId}`}},Ae=class t extends K{constructor(e){super(),this.error=e,this.name="UnexpectedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Unexpected error: ${En(this.error)}`}},Wt=class t extends K{constructor(e){super(),this.error=e,this.name="HashTreeDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode certificate: ${this.error}`}},bn=class t extends K{constructor(e,r,n,o){super(),this.status=e,this.statusText=r,this.headers=n,this.bodyText=o,this.name="HttpErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`HTTP request failed:
  Status: ${this.status} (${this.statusText})
  Headers: ${JSON.stringify(this.headers)}
`;return this.bodyText&&(e+=`  Body: ${this.bodyText}
`),e}},gn=class t extends K{constructor(){super(),this.name="HttpV3ApiNotSupportedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"HTTP request failed: v3 API is not supported"}},wn=class t extends K{constructor(e){super(),this.error=e,this.name="HttpFetchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to fetch HTTP request: ${En(this.error)}`}},xn=class t extends K{constructor(e){super(),this.receivedCanisterId=e,this.name="MissingCanisterIdErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Canister ID is required, but received ${typeof this.receivedCanisterId} instead. If you are using automatically generated declarations, this may be because your application is not setting the canister ID in process.env correctly.`}},Ro=class t extends K{constructor(e){super(),this.request=e,this.name="InvalidReadStateRequestErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Invalid read state request: ${this.request}`}},_n=class t extends K{constructor(e){super(),this.error=e,this.name="ExpiryJsonDeserializeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to deserialize expiry: ${this.error}`}};function En(t){if(t instanceof Error)return t.stack??t.message;try{return JSON.stringify(t)}catch{return String(t)}}var zt=new Error("unreachable");var xr={};Rf(xr,{Bool:()=>Na,BoolClass:()=>ko,ConstructType:()=>pt,Empty:()=>Ca,EmptyClass:()=>vn,FixedIntClass:()=>At,FixedNatClass:()=>ht,Float32:()=>La,Float64:()=>Ma,FloatClass:()=>Sn,Func:()=>ec,FuncClass:()=>wr,Int:()=>Da,Int16:()=>Fa,Int32:()=>$a,Int64:()=>Va,Int8:()=>qa,IntClass:()=>Bn,Nat:()=>ka,Nat16:()=>Ka,Nat32:()=>Ha,Nat64:()=>Ga,Nat8:()=>ja,NatClass:()=>Tn,Null:()=>Pa,NullClass:()=>br,Opt:()=>za,OptClass:()=>Qt,PrimitiveType:()=>ke,Principal:()=>Za,PrincipalClass:()=>qo,Rec:()=>Qa,RecClass:()=>Ve,Record:()=>Xa,RecordClass:()=>gr,Reserved:()=>Ra,ReservedClass:()=>mt,Service:()=>tc,ServiceClass:()=>Hr,Text:()=>Ua,TextClass:()=>Lo,Tuple:()=>Ya,TupleClass:()=>Mo,Type:()=>Vr,Unknown:()=>Hf,UnknownClass:()=>Do,Variant:()=>Ja,VariantClass:()=>Kr,Vec:()=>Wa,VecClass:()=>jr,Visitor:()=>ks,decode:()=>Kf,encode:()=>jf,resetSubtypeCache:()=>Ls,subtype:()=>qs});function Z(...t){let e=new Uint8Array(t.reduce((n,o)=>n+o.byteLength,0)),r=0;for(let n of t)e.set(n,r),r+=n.byteLength;return e}var Je=class{save(){return this._view}restore(e){if(!(e instanceof Uint8Array))throw new Error("Checkpoint must be a Uint8Array");this._view=e}constructor(e,r=e?.byteLength||0){if(e&&!(e instanceof Uint8Array))try{e=lt(e)}catch{throw new Error("Buffer must be a Uint8Array")}if(r<0||!Number.isInteger(r))throw new Error("Length must be a non-negative integer");if(e&&r>e.byteLength)throw new Error("Length cannot exceed buffer length");this._buffer=e||new Uint8Array(0),this._view=new Uint8Array(this._buffer.buffer,0,r)}get buffer(){return this._view.slice()}get byteLength(){return this._view.byteLength}read(e){let r=this._view.subarray(0,e);return this._view=this._view.subarray(e),r.slice()}readUint8(){if(this._view.byteLength===0)return;let e=this._view[0];return this._view=this._view.subarray(1),e}write(e){if(!(e instanceof Uint8Array))throw new Error("Buffer must be a Uint8Array");let r=this._view.byteLength;this._view.byteOffset+this._view.byteLength+e.byteLength>=this._buffer.byteLength?this.alloc(e.byteLength):this._view=new Uint8Array(this._buffer.buffer,this._view.byteOffset,this._view.byteLength+e.byteLength),this._view.set(e,r)}get end(){return this._view.byteLength===0}alloc(e){if(e<=0||!Number.isInteger(e))throw new Error("Amount must be a positive integer");let r=new Uint8Array((this._buffer.byteLength+e)*1.2|0),n=new Uint8Array(r.buffer,0,this._view.byteLength+e);n.set(this._view),this._buffer=r,this._view=n}};function lt(t){if(!t)throw new Error("Input cannot be null or undefined");return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):Array.isArray(t)?new Uint8Array(t):"buffer"in t?lt(t.buffer):new Uint8Array(t)}function Cs(t,e){if(t.byteLength!==e.byteLength)return t.byteLength-e.byteLength;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return t[r]-e[r];return 0}function va(t,e){return Cs(t,e)===0}function Ba(t){if(!(t instanceof Uint8Array))throw new Error("Input must be a Uint8Array");return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Vf(t){let r=new TextEncoder().encode(t),n=0;for(let o of r)n=(n*223+o)%2**32;return n}function Oe(t){if(/^_\d+_$/.test(t)||/^_0x[0-9a-fA-F]+_$/.test(t)){let e=+t.slice(1,-1);if(Number.isSafeInteger(e)&&e>=0&&e<2**32)return e}return Vf(t)}function Rs(t){let e=BigInt(t);if(t<=0)throw new RangeError("Input must be positive");return e.toString(2).length-1}function No(t){let e=BigInt(t);if(t<0)throw new RangeError("Input must be non-negative");return BigInt(1)<<e}function Ta(){throw new Error("unexpected end of buffer")}function Jt(t,e){return t.byteLength<e&&Ta(),t.read(e)}function Xt(t){let e=t.readUint8();return e===void 0&&Ta(),e}function ee(t){if(typeof t=="number"&&(t=BigInt(t)),t<BigInt(0))throw new Error("Cannot leb encode negative values.");let e=(t===BigInt(0)?0:Rs(t))+1,r=new Je(new Uint8Array(e),0);for(;;){let n=Number(t&BigInt(127));if(t/=BigInt(128),t===BigInt(0)){r.write(new Uint8Array([n]));break}else r.write(new Uint8Array([n|128]))}return r.buffer}function ae(t){let e=BigInt(1),r=BigInt(0),n;do n=Xt(t),r+=BigInt(n&127).valueOf()*e,e*=BigInt(128);while(n>=128);return r}function ce(t){typeof t=="number"&&(t=BigInt(t));let e=t<BigInt(0);e&&(t=-t-BigInt(1));let r=(t===BigInt(0)?0:Rs(t))+1,n=new Je(new Uint8Array(r),0);for(;;){let s=o(t);if(t/=BigInt(128),e&&t===BigInt(0)&&(s&64)!==0||!e&&t===BigInt(0)&&(s&64)===0){n.write(new Uint8Array([s]));break}else n.write(new Uint8Array([s|128]))}function o(s){let i=s%BigInt(128);return Number(e?BigInt(128)-i-BigInt(1):i)}return n.buffer}function Tt(t){let e=new Uint8Array(t.buffer),r=0;for(;r<e.byteLength;r++)if(e[r]<128){if((e[r]&64)===0)return ae(t);break}let n=new Uint8Array(Jt(t,r+1)),o=BigInt(0);for(let s=n.byteLength-1;s>=0;s--)o=o*BigInt(128)+BigInt(128-(n[s]&127)-1);return-o-BigInt(1)}function Sa(t,e){if(BigInt(t)<BigInt(0))throw new Error("Cannot write negative values.");return Ns(t,e)}function Ns(t,e){t=BigInt(t);let r=new Je(new Uint8Array(Math.min(1,e)),0),n=0,o=BigInt(256),s=BigInt(0),i=Number(t%o);for(r.write(new Uint8Array([i]));++n<e;)t<0&&s===BigInt(0)&&i!==0&&(s=BigInt(1)),i=Number((t/o-s)%BigInt(256)),r.write(new Uint8Array([i])),o*=BigInt(256);return r.buffer}function Ps(t,e){if(e<=0||!Number.isInteger(e))throw new Error("Byte length must be a positive integer");let r=BigInt(Xt(t)),n=BigInt(1),o=0;for(;++o<e;){n*=BigInt(256);let s=BigInt(Xt(t));r=r+n*s}return r}function Aa(t,e){if(e<=0||!Number.isInteger(e))throw new Error("Byte length must be a positive integer");let r=Ps(t,e),n=BigInt(2)**(BigInt(8)*BigInt(e-1)+BigInt(7));return r>=n&&(r-=n*BigInt(2)),r}var W;(function(t){t[t.Null=-1]="Null",t[t.Bool=-2]="Bool",t[t.Nat=-3]="Nat",t[t.Int=-4]="Int",t[t.Float32=-13]="Float32",t[t.Float64=-14]="Float64",t[t.Text=-15]="Text",t[t.Reserved=-16]="Reserved",t[t.Empty=-17]="Empty",t[t.Opt=-18]="Opt",t[t.Vector=-19]="Vector",t[t.Record=-20]="Record",t[t.Variant=-21]="Variant",t[t.Func=-22]="Func",t[t.Service=-23]="Service",t[t.Principal=-24]="Principal"})(W||(W={}));var Po="DIDL",Oa=400;function In(t,e,r){return t.map((n,o)=>r(n,e[o]))}var Ds=class{constructor(){this._typs=[],this._idx=new Map}has(e){return this._idx.has(e.name)}add(e,r){let n=this._typs.length;this._idx.set(e.name,n),this._typs.push(r)}merge(e,r){let n=this._idx.get(e.name),o=this._idx.get(r);if(n===void 0)throw new Error("Missing type index for "+e);if(o===void 0)throw new Error("Missing type index for "+r);this._typs[n]=this._typs[o],this._typs.splice(o,1),this._idx.delete(r)}encode(){let e=ee(this._typs.length),r=Z(...this._typs);return Z(e,r)}indexOf(e){if(!this._idx.has(e))throw new Error("Missing type index for "+e);return ce(this._idx.get(e)||0)}},ks=class{visitType(e,r){throw new Error("Not implemented")}visitPrimitive(e,r){return this.visitType(e,r)}visitEmpty(e,r){return this.visitPrimitive(e,r)}visitBool(e,r){return this.visitPrimitive(e,r)}visitNull(e,r){return this.visitPrimitive(e,r)}visitReserved(e,r){return this.visitPrimitive(e,r)}visitText(e,r){return this.visitPrimitive(e,r)}visitNumber(e,r){return this.visitPrimitive(e,r)}visitInt(e,r){return this.visitNumber(e,r)}visitNat(e,r){return this.visitNumber(e,r)}visitFloat(e,r){return this.visitPrimitive(e,r)}visitFixedInt(e,r){return this.visitNumber(e,r)}visitFixedNat(e,r){return this.visitNumber(e,r)}visitPrincipal(e,r){return this.visitPrimitive(e,r)}visitConstruct(e,r){return this.visitType(e,r)}visitVec(e,r,n){return this.visitConstruct(e,n)}visitOpt(e,r,n){return this.visitConstruct(e,n)}visitRecord(e,r,n){return this.visitConstruct(e,n)}visitTuple(e,r,n){let o=r.map((s,i)=>[`_${i}_`,s]);return this.visitRecord(e,o,n)}visitVariant(e,r,n){return this.visitConstruct(e,n)}visitRec(e,r,n){return this.visitConstruct(r,n)}visitFunc(e,r){return this.visitConstruct(e,r)}visitService(e,r){return this.visitConstruct(e,r)}},V;(function(t){t.EmptyClass="__IDL_EmptyClass__",t.UnknownClass="__IDL_UnknownClass__",t.BoolClass="__IDL_BoolClass__",t.NullClass="__IDL_NullClass__",t.ReservedClass="__IDL_ReservedClass__",t.TextClass="__IDL_TextClass__",t.IntClass="__IDL_IntClass__",t.NatClass="__IDL_NatClass__",t.FloatClass="__IDL_FloatClass__",t.FixedIntClass="__IDL_FixedIntClass__",t.FixedNatClass="__IDL_FixedNatClass__",t.VecClass="__IDL_VecClass__",t.OptClass="__IDL_OptClass__",t.RecordClass="__IDL_RecordClass__",t.TupleClass="__IDL_TupleClass__",t.VariantClass="__IDL_VariantClass__",t.RecClass="__IDL_RecClass__",t.PrincipalClass="__IDL_PrincipalClass__",t.FuncClass="__IDL_FuncClass__",t.ServiceClass="__IDL_ServiceClass__"})(V||(V={}));var Vr=class{display(){return this.name}valueToString(e){return ie(e)}buildTypeTable(e){e.has(this)||this._buildTypeTableImpl(e)}},ke=class extends Vr{checkType(e){if(this.name!==e.name)throw new Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`);return e}_buildTypeTableImpl(e){}},pt=class extends Vr{checkType(e){if(e instanceof Ve){let r=e.getType();if(typeof r>"u")throw new Error("type mismatch with uninitialized type");return r}throw new Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`)}encodeType(e){return e.indexOf(this.name)}},vn=class extends ke{get typeName(){return V.EmptyClass}static[Symbol.hasInstance](e){return e.typeName===V.EmptyClass}accept(e,r){return e.visitEmpty(this,r)}covariant(e){throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(){throw new Error("Empty cannot appear as a function argument")}valueToString(){throw new Error("Empty cannot appear as a value")}encodeType(){return ce(W.Empty)}decodeValue(){throw new Error("Empty cannot appear as an output")}get name(){return"empty"}},Do=class extends Vr{get typeName(){return V.UnknownClass}static[Symbol.hasInstance](e){return e.typeName===V.UnknownClass}checkType(e){throw new Error("Method not implemented for unknown.")}accept(e,r){throw e.visitType(this,r)}covariant(e){throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(){throw new Error("Unknown cannot appear as a function argument")}valueToString(){throw new Error("Unknown cannot appear as a value")}encodeType(){throw new Error("Unknown cannot be serialized")}decodeValue(e,r){let n=r.decodeValue(e,r);Object(n)!==n&&(n=Object(n));let o;return r instanceof Ve?o=()=>r.getType():o=()=>r,Object.defineProperty(n,"type",{value:o,writable:!0,enumerable:!1,configurable:!0}),n}_buildTypeTableImpl(){throw new Error("Unknown cannot be serialized")}get name(){return"Unknown"}},ko=class extends ke{get typeName(){return V.BoolClass}static[Symbol.hasInstance](e){return e.typeName===V.BoolClass}accept(e,r){return e.visitBool(this,r)}covariant(e){if(typeof e=="boolean")return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return new Uint8Array([e?1:0])}encodeType(){return ce(W.Bool)}decodeValue(e,r){switch(this.checkType(r),Xt(e)){case 0:return!1;case 1:return!0;default:throw new Error("Boolean value out of range")}}get name(){return"bool"}},br=class extends ke{get typeName(){return V.NullClass}static[Symbol.hasInstance](e){return e.typeName===V.NullClass}accept(e,r){return e.visitNull(this,r)}covariant(e){if(e===null)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(){return new Uint8Array(0)}encodeType(){return ce(W.Null)}decodeValue(e,r){return this.checkType(r),null}get name(){return"null"}},mt=class extends ke{get typeName(){return V.ReservedClass}static[Symbol.hasInstance](e){return e.typeName===V.ReservedClass}accept(e,r){return e.visitReserved(this,r)}covariant(e){return!0}encodeValue(){return new Uint8Array(0)}encodeType(){return ce(W.Reserved)}decodeValue(e,r){return r.name!==this.name&&r.decodeValue(e,r),null}get name(){return"reserved"}},Lo=class extends ke{get typeName(){return V.TextClass}static[Symbol.hasInstance](e){return e.typeName===V.TextClass}accept(e,r){return e.visitText(this,r)}covariant(e){if(typeof e=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=new TextEncoder().encode(e),n=ee(r.byteLength);return Z(n,r)}encodeType(){return ce(W.Text)}decodeValue(e,r){this.checkType(r);let n=ae(e),o=Jt(e,Number(n));return new TextDecoder("utf8",{fatal:!0}).decode(o)}get name(){return"text"}valueToString(e){return'"'+e+'"'}},Bn=class extends ke{get typeName(){return V.IntClass}static[Symbol.hasInstance](e){return e.typeName===V.IntClass}accept(e,r){return e.visitInt(this,r)}covariant(e){if(typeof e=="bigint"||Number.isInteger(e))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return ce(e)}encodeType(){return ce(W.Int)}decodeValue(e,r){return this.checkType(r),Tt(e)}get name(){return"int"}valueToString(e){return e.toString()}},Tn=class extends ke{get typeName(){return V.NatClass}static[Symbol.hasInstance](e){return e.typeName===V.NatClass}accept(e,r){return e.visitNat(this,r)}covariant(e){if(typeof e=="bigint"&&e>=BigInt(0)||Number.isInteger(e)&&e>=0)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return ee(e)}encodeType(){return ce(W.Nat)}decodeValue(e,r){return this.checkType(r),ae(e)}get name(){return"nat"}valueToString(e){return e.toString()}},Sn=class extends ke{get typeName(){return V.FloatClass}static[Symbol.hasInstance](e){return e.typeName===V.FloatClass}constructor(e){if(super(),this._bits=e,e!==32&&e!==64)throw new Error("not a valid float type")}accept(e,r){return e.visitFloat(this,r)}covariant(e){if(typeof e=="number"||e instanceof Number)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=new ArrayBuffer(this._bits/8),n=new DataView(r);return this._bits===32?n.setFloat32(0,e,!0):n.setFloat64(0,e,!0),new Uint8Array(r)}encodeType(){let e=this._bits===32?W.Float32:W.Float64;return ce(e)}decodeValue(e,r){this.checkType(r);let n=Jt(e,this._bits/8),o=Ba(n);return this._bits===32?o.getFloat32(0,!0):o.getFloat64(0,!0)}get name(){return"float"+this._bits}valueToString(e){return e.toString()}},At=class extends ke{get typeName(){return V.FixedIntClass}static[Symbol.hasInstance](e){return e.typeName===V.FixedIntClass}constructor(e){super(),this._bits=e}accept(e,r){return e.visitFixedInt(this,r)}covariant(e){let r=No(this._bits-1)*BigInt(-1),n=No(this._bits-1)-BigInt(1),o=!1;if(typeof e=="bigint")o=e>=r&&e<=n;else if(Number.isInteger(e)){let s=BigInt(e);o=s>=r&&s<=n}else o=!1;if(o)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return Ns(e,this._bits/8)}encodeType(){let e=Math.log2(this._bits)-3;return ce(-9-e)}decodeValue(e,r){this.checkType(r);let n=Aa(e,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`int${this._bits}`}valueToString(e){return e.toString()}},ht=class extends ke{get typeName(){return V.FixedNatClass}static[Symbol.hasInstance](e){return e.typeName===V.FixedNatClass}constructor(e){super(),this._bits=e}accept(e,r){return e.visitFixedNat(this,r)}covariant(e){let r=No(this._bits),n=!1;if(typeof e=="bigint"&&e>=BigInt(0)?n=e<r:Number.isInteger(e)&&e>=0?n=BigInt(e)<r:n=!1,n)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return Sa(e,this._bits/8)}encodeType(){let e=Math.log2(this._bits)-3;return ce(-5-e)}decodeValue(e,r){this.checkType(r);let n=Ps(e,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`nat${this._bits}`}valueToString(e){return e.toString()}},jr=class t extends pt{get typeName(){return V.VecClass}static[Symbol.hasInstance](e){return e.typeName===V.VecClass}constructor(e){super(),this._type=e,this._blobOptimization=!1,e instanceof ht&&e._bits===8&&(this._blobOptimization=!0)}accept(e,r){return e.visitVec(this,this._type,r)}covariant(e){let r=this._type instanceof ht?this._type._bits:this._type instanceof At?this._type._bits:0;if(ArrayBuffer.isView(e)&&r==e.BYTES_PER_ELEMENT*8||Array.isArray(e)&&e.every((n,o)=>{try{return this._type.covariant(n)}catch(s){throw new Error(`Invalid ${this.display()} argument: 

index ${o} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=ee(e.length);if(this._blobOptimization)return Z(r,new Uint8Array(e));if(ArrayBuffer.isView(e))if(e instanceof Int16Array||e instanceof Uint16Array){let o=new DataView(new ArrayBuffer(e.length*2));for(let s=0;s<e.length;s++)e instanceof Int16Array?o.setInt16(s*2,e[s],!0):o.setUint16(s*2,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else if(e instanceof Int32Array||e instanceof Uint32Array){let o=new DataView(new ArrayBuffer(e.length*4));for(let s=0;s<e.length;s++)e instanceof Int32Array?o.setInt32(s*4,e[s],!0):o.setUint32(s*4,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else if(e instanceof BigInt64Array||e instanceof BigUint64Array){let o=new DataView(new ArrayBuffer(e.length*8));for(let s=0;s<e.length;s++)e instanceof BigInt64Array?o.setBigInt64(s*8,e[s],!0):o.setBigUint64(s*8,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else return Z(r,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));let n=new Je(new Uint8Array(r.byteLength+e.length),0);n.write(r);for(let o of e){let s=this._type.encodeValue(o);n.write(new Uint8Array(s))}return n.buffer}_buildTypeTableImpl(e){this._type.buildTypeTable(e);let r=ce(W.Vector),n=this._type.encodeType(e);e.add(this,Z(r,n))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a vector type");let o=Number(ae(e));if(this._type instanceof ht){if(this._type._bits==8)return new Uint8Array(e.read(o));if(this._type._bits==16){let i=e.read(o*2);return new Uint16Array(i.buffer,i.byteOffset,o)}if(this._type._bits==32){let i=e.read(o*4);return new Uint32Array(i.buffer,i.byteOffset,o)}if(this._type._bits==64)return new BigUint64Array(e.read(o*8).buffer)}if(this._type instanceof At){if(this._type._bits==8)return new Int8Array(e.read(o));if(this._type._bits==16){let i=e.read(o*2),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new Int16Array(o);for(let u=0;u<o;u++)a[u]=c.getInt16(u*2,!0);return a}if(this._type._bits==32){let i=e.read(o*4),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new Int32Array(o);for(let u=0;u<o;u++)a[u]=c.getInt32(u*4,!0);return a}if(this._type._bits==64){let i=e.read(o*8),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new BigInt64Array(o);for(let u=0;u<o;u++)a[u]=c.getBigInt64(u*8,!0);return a}}let s=[];for(let i=0;i<o;i++)s.push(this._type.decodeValue(e,n._type));return s}get name(){return`vec ${this._type.name}`}display(){return`vec ${this._type.display()}`}valueToString(e){return"vec {"+e.map(n=>this._type.valueToString(n)).join("; ")+"}"}},Qt=class t extends pt{get typeName(){return V.OptClass}static[Symbol.hasInstance](e){return e.typeName===V.OptClass}constructor(e){super(),this._type=e}accept(e,r){return e.visitOpt(this,this._type,r)}covariant(e){try{if(Array.isArray(e)&&(e.length===0||e.length===1&&this._type.covariant(e[0])))return!0}catch(r){throw new Error(`Invalid ${this.display()} argument: ${ie(e)} 

-> ${r.message}`)}throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return e.length===0?new Uint8Array([0]):Z(new Uint8Array([1]),this._type.encodeValue(e[0]))}_buildTypeTableImpl(e){this._type.buildTypeTable(e);let r=ce(W.Opt),n=this._type.encodeType(e);e.add(this,Z(r,n))}decodeValue(e,r){if(r instanceof br)return[];if(r instanceof mt)return[];let n=r;if(r instanceof Ve){let o=r.getType();if(typeof o>"u")throw new Error("type mismatch with uninitialized type");n=o}if(n instanceof t)switch(Xt(e)){case 0:return[];case 1:{let o=e.save();try{return[this._type.decodeValue(e,n._type)]}catch{return e.restore(o),n._type.decodeValue(e,n._type),[]}}default:throw new Error("Not an option value")}else{if(this._type instanceof br||this._type instanceof t||this._type instanceof mt)return n.decodeValue(e,n),[];{let o=e.save();try{return[this._type.decodeValue(e,r)]}catch{return e.restore(o),n.decodeValue(e,r),[]}}}}get name(){return`opt ${this._type.name}`}display(){return`opt ${this._type.display()}`}valueToString(e){return e.length===0?"null":`opt ${this._type.valueToString(e[0])}`}},gr=class t extends pt{get typeName(){return V.RecordClass}static[Symbol.hasInstance](e){return e.typeName===V.RecordClass||e.typeName===V.TupleClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((r,n)=>Oe(r[0])-Oe(n[0]))}accept(e,r){return e.visitRecord(this,this._fields,r)}tryAsTuple(){let e=[];for(let r=0;r<this._fields.length;r++){let[n,o]=this._fields[r];if(n!==`_${r}_`)return null;e.push(o)}return e}covariant(e){if(typeof e=="object"&&this._fields.every(([r,n])=>{if(!e.hasOwnProperty(r))throw new Error(`Record is missing key "${r}".`);try{return n.covariant(e[r])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

field ${r} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=this._fields.map(([o])=>e[o]),n=In(this._fields,r,([,o],s)=>o.encodeValue(s));return Z(...n)}_buildTypeTableImpl(e){this._fields.forEach(([s,i])=>i.buildTypeTable(e));let r=ce(W.Record),n=ee(this._fields.length),o=this._fields.map(([s,i])=>Z(ee(Oe(s)),i.encodeType(e)));e.add(this,Z(r,n,Z(...o)))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a record type");let o={},s=0,i=0;for(;i<n._fields.length;){let[c,a]=n._fields[i];if(s>=this._fields.length){a.decodeValue(e,a),i++;continue}let[u,l]=this._fields[s],d=Oe(this._fields[s][0]),f=Oe(c);if(d===f)o[u]=l.decodeValue(e,a),s++,i++;else if(f>d)if(l instanceof Qt||l instanceof mt)o[u]=[],s++;else throw new Error("Cannot find required field "+u);else a.decodeValue(e,a),i++}for(let[c,a]of this._fields.slice(s))if(a instanceof Qt||a instanceof mt)o[c]=[];else throw new Error("Cannot find required field "+c);return o}get fieldsAsObject(){let e={};for(let[r,n]of this._fields)e[Oe(r)]=n;return e}get name(){return`record {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`record {${this._fields.map(([r,n])=>r+":"+n.display()).join("; ")}}`}valueToString(e){let r=this._fields.map(([o])=>e[o]);return`record {${In(this._fields,r,([o,s],i)=>o+"="+s.valueToString(i)).join("; ")}}`}},Mo=class t extends gr{get typeName(){return V.TupleClass}static[Symbol.hasInstance](e){return e.typeName===V.TupleClass}constructor(e){let r={};e.forEach((n,o)=>r["_"+o+"_"]=n),super(r),this._components=e}accept(e,r){return e.visitTuple(this,this._components,r)}covariant(e){if(Array.isArray(e)&&e.length>=this._fields.length&&this._components.every((r,n)=>{try{return r.covariant(e[n])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

index ${n} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=In(this._components,e,(n,o)=>n.encodeValue(o));return Z(...r)}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("not a tuple type");if(n._components.length<this._components.length)throw new Error("tuple mismatch");let o=[];for(let[s,i]of n._components.entries())s>=this._components.length?i.decodeValue(e,i):o.push(this._components[s].decodeValue(e,i));return o}display(){return`record {${this._components.map(r=>r.display()).join("; ")}}`}valueToString(e){return`record {${In(this._components,e,(n,o)=>n.valueToString(o)).join("; ")}}`}},Kr=class t extends pt{get typeName(){return V.VariantClass}static[Symbol.hasInstance](e){return e.typeName===V.VariantClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((r,n)=>Oe(r[0])-Oe(n[0]))}accept(e,r){return e.visitVariant(this,this._fields,r)}covariant(e){if(typeof e=="object"&&Object.entries(e).length===1&&this._fields.every(([r,n])=>{try{return!e.hasOwnProperty(r)||n.covariant(e[r])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

variant ${r} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){for(let r=0;r<this._fields.length;r++){let[n,o]=this._fields[r];if(e.hasOwnProperty(n)){let s=ee(r),i=o.encodeValue(e[n]);return Z(s,i)}}throw Error("Variant has no data: "+e)}_buildTypeTableImpl(e){this._fields.forEach(([,s])=>{s.buildTypeTable(e)});let r=ce(W.Variant),n=ee(this._fields.length),o=this._fields.map(([s,i])=>Z(ee(Oe(s)),i.encodeType(e)));e.add(this,Z(r,n,...o))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a variant type");let o=Number(ae(e));if(o>=n._fields.length)throw Error("Invalid variant index: "+o);let[s,i]=n._fields[o];for(let[c,a]of this._fields)if(Oe(s)===Oe(c)){let u=a.decodeValue(e,i);return{[c]:u}}throw new Error("Cannot find field hash "+s)}get name(){return`variant {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`variant {${this._fields.map(([r,n])=>r+(n.name==="null"?"":`:${n.display()}`)).join("; ")}}`}valueToString(e){for(let[r,n]of this._fields)if(e.hasOwnProperty(r)){let o=n.valueToString(e[r]);return o==="null"?`variant {${r}}`:`variant {${r}=${o}}`}throw new Error("Variant has no data: "+e)}get alternativesAsObject(){let e={};for(let[r,n]of this._fields)e[Oe(r)]=n;return e}},Ve=class t extends pt{constructor(){super(...arguments),this._id=t._counter++}get typeName(){return V.RecClass}static{this._counter=0}static[Symbol.hasInstance](e){return e.typeName===V.RecClass}accept(e,r){if(!this._type)throw Error("Recursive type uninitialized.");return e.visitRec(this,this._type,r)}fill(e){this._type=e}getType(){return this._type}covariant(e){if(this._type&&this._type.covariant(e))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.encodeValue(e)}_buildTypeTableImpl(e){if(!this._type)throw Error("Recursive type uninitialized.");e.add(this,new Uint8Array([])),this._type.buildTypeTable(e),e.merge(this,this._type.name)}decodeValue(e,r){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.decodeValue(e,r)}get name(){return`rec_${this._id}`}display(){if(!this._type)throw Error("Recursive type uninitialized.");return`\u03BC${this.name}.${this._type.name}`}valueToString(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.valueToString(e)}};function Ms(t){if(Xt(t)!==1)throw new Error("Cannot decode principal");let r=Number(ae(t));return M.fromUint8Array(new Uint8Array(Jt(t,r)))}var qo=class extends ke{get typeName(){return V.PrincipalClass}static[Symbol.hasInstance](e){return e.typeName===V.PrincipalClass}accept(e,r){return e.visitPrincipal(this,r)}covariant(e){if(e&&e._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=e.toUint8Array(),n=ee(r.byteLength);return Z(new Uint8Array([1]),n,r)}encodeType(){return ce(W.Principal)}decodeValue(e,r){return this.checkType(r),Ms(e)}get name(){return"principal"}valueToString(e){return`${this.name} "${e.toText()}"`}},wr=class extends pt{get typeName(){return V.FuncClass}static[Symbol.hasInstance](e){return e.typeName===V.FuncClass}static argsToString(e,r){if(e.length!==r.length)throw new Error("arity mismatch");return"("+e.map((n,o)=>n.valueToString(r[o])).join(", ")+")"}constructor(e,r,n=[]){super(),this.argTypes=e,this.retTypes=r,this.annotations=n}accept(e,r){return e.visitFunc(this,r)}covariant(e){if(Array.isArray(e)&&e.length===2&&e[0]&&e[0]._isPrincipal&&typeof e[1]=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue([e,r]){let n=e.toUint8Array(),o=ee(n.byteLength),s=Z(new Uint8Array([1]),o,n),i=new TextEncoder().encode(r),c=ee(i.byteLength);return Z(new Uint8Array([1]),s,c,i)}_buildTypeTableImpl(e){this.argTypes.forEach(u=>u.buildTypeTable(e)),this.retTypes.forEach(u=>u.buildTypeTable(e));let r=ce(W.Func),n=ee(this.argTypes.length),o=Z(...this.argTypes.map(u=>u.encodeType(e))),s=ee(this.retTypes.length),i=Z(...this.retTypes.map(u=>u.encodeType(e))),c=ee(this.annotations.length),a=Z(...this.annotations.map(u=>this.encodeAnnotation(u)));e.add(this,Z(r,n,o,s,i,c,a))}decodeValue(e,r){let n=r instanceof Ve?r.getType()??r:r;if(!qs(n,this))throw new Error(`Cannot decode function reference at type ${this.display()} from wire type ${n.display()}`);if(Xt(e)!==1)throw new Error("Cannot decode function reference");let s=Ms(e),i=Number(ae(e)),c=Jt(e,i),u=new TextDecoder("utf8",{fatal:!0}).decode(c);return[s,u]}get name(){let e=this.argTypes.map(o=>o.name).join(", "),r=this.retTypes.map(o=>o.name).join(", "),n=" "+this.annotations.join(" ");return`(${e}) -> (${r})${n}`}valueToString([e,r]){return`func "${e.toText()}".${r}`}display(){let e=this.argTypes.map(o=>o.display()).join(", "),r=this.retTypes.map(o=>o.display()).join(", "),n=" "+this.annotations.join(" ");return`(${e}) \u2192 (${r})${n}`}encodeAnnotation(e){if(e==="query")return new Uint8Array([1]);if(e==="oneway")return new Uint8Array([2]);if(e==="composite_query")return new Uint8Array([3]);throw new Error("Illegal function annotation")}},Hr=class extends pt{get typeName(){return V.ServiceClass}static[Symbol.hasInstance](e){return e.typeName===V.ServiceClass}constructor(e){super(),this._fields=Object.entries(e).sort((r,n)=>r[0]<n[0]?-1:r[0]>n[0]?1:0)}accept(e,r){return e.visitService(this,r)}covariant(e){if(e&&e._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=e.toUint8Array(),n=ee(r.length);return Z(new Uint8Array([1]),n,r)}_buildTypeTableImpl(e){this._fields.forEach(([s,i])=>i.buildTypeTable(e));let r=ce(W.Service),n=ee(this._fields.length),o=this._fields.map(([s,i])=>{let c=new TextEncoder().encode(s),a=ee(c.length);return Z(a,c,i.encodeType(e))});e.add(this,Z(r,n,...o))}decodeValue(e,r){let n=r instanceof Ve?r.getType()??r:r;if(!qs(n,this))throw new Error(`Cannot decode service reference at type ${this.display()} from wire type ${n.display()}`);return Ms(e)}get name(){return`service {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}valueToString(e){return`service "${e.toText()}"`}fieldsAsObject(){let e={};for(let[r,n]of this._fields)e[r]=n;return e}};function ie(t){let e=JSON.stringify(t,(r,n)=>typeof n=="bigint"?`BigInt(${n})`:n);return e&&e.length>Oa?e.substring(0,Oa-3)+"...":e}function jf(t,e){if(e.length<t.length)throw Error("Wrong number of message arguments");let r=new Ds;t.forEach(a=>a.buildTypeTable(r));let n=new TextEncoder().encode(Po),o=r.encode(),s=ee(e.length),i=Z(...t.map(a=>a.encodeType(r))),c=Z(...In(t,e,(a,u)=>{try{a.covariant(u)}catch(l){throw new Error(l.message+`

`)}return a.encodeValue(u)}));return Z(n,o,s,i,c)}function Kf(t,e){let r=new Je(e);if(e.byteLength<Po.length)throw new Error("Message length smaller than magic number");let n=Jt(r,Po.length),o=new TextDecoder().decode(n);if(o!==Po)throw new Error("Wrong magic number: "+JSON.stringify(o));function s(f){let h=[],p=Number(ae(f));for(let m=0;m<p;m++){let w=Number(Tt(f));switch(w){case W.Opt:case W.Vector:{let b=Number(Tt(f));h.push([w,b]);break}case W.Record:case W.Variant:{let b=[],E=Number(ae(f)),v;for(;E--;){let T=Number(ae(f));if(T>=Math.pow(2,32))throw new Error("field id out of 32-bit range");if(typeof v=="number"&&v>=T)throw new Error("field id collision or not sorted");v=T;let B=Number(Tt(f));b.push([T,B])}h.push([w,b]);break}case W.Func:{let b=[],E=Number(ae(f));for(;E--;)b.push(Number(Tt(f)));let v=[],T=Number(ae(f));for(;T--;)v.push(Number(Tt(f)));let B=[],A=Number(ae(f));for(;A--;)switch(Number(ae(f))){case 1:{B.push("query");break}case 2:{B.push("oneway");break}case 3:{B.push("composite_query");break}default:throw new Error("unknown annotation")}h.push([w,[b,v,B]]);break}case W.Service:{let b=Number(ae(f)),E=[];for(;b--;){let v=Number(ae(f)),T=new TextDecoder().decode(Jt(f,v)),B=Tt(f);E.push([T,B])}h.push([w,E]);break}default:throw new Error("Illegal op_code: "+w)}}let y=[],g=Number(ae(f));for(let m=0;m<g;m++)y.push(Number(Tt(f)));return[h,y]}let[i,c]=s(r);if(c.length<t.length)throw new Error("Wrong number of return values");let a=i.map(f=>Qa());function u(f){if(f<-24)throw new Error("future value not supported");if(f<0)switch(f){case-1:return Pa;case-2:return Na;case-3:return ka;case-4:return Da;case-5:return ja;case-6:return Ka;case-7:return Ha;case-8:return Ga;case-9:return qa;case-10:return Fa;case-11:return $a;case-12:return Va;case-13:return La;case-14:return Ma;case-15:return Ua;case-16:return Ra;case-17:return Ca;case-24:return Za;default:throw new Error("Illegal op_code: "+f)}if(f>=i.length)throw new Error("type index out of range");return a[f]}function l(f){switch(f[0]){case W.Vector:{let h=u(f[1]);return Wa(h)}case W.Opt:{let h=u(f[1]);return za(h)}case W.Record:{let h={};for(let[g,m]of f[1]){let w=`_${g}_`;h[w]=u(m)}let p=Xa(h),y=p.tryAsTuple();return Array.isArray(y)?Ya(...y):p}case W.Variant:{let h={};for(let[p,y]of f[1]){let g=`_${p}_`;h[g]=u(y)}return Ja(h)}case W.Func:{let[h,p,y]=f[1];return ec(h.map(g=>u(g)),p.map(g=>u(g)),y)}case W.Service:{let h={},p=f[1];for(let[y,g]of p){let m=u(g);if(m instanceof Ve&&(m=m.getType()),!(m instanceof wr))throw new Error("Illegal service definition: services can only contain functions");h[y]=m}return tc(h)}default:throw new Error("Illegal op_code: "+f[0])}}i.forEach((f,h)=>{if(f[0]===W.Func){let p=l(f);a[h].fill(p)}}),i.forEach((f,h)=>{if(f[0]!==W.Func){let p=l(f);a[h].fill(p)}}),Ls();let d=c.map(f=>u(f));try{let f=t.map((h,p)=>h.decodeValue(r,d[p]));for(let h=t.length;h<d.length;h++)d[h].decodeValue(r,d[h]);if(r.byteLength>0)throw new Error("decode: Left-over bytes");return f}finally{Ls()}}var Ca=new vn,Ra=new mt,Hf=new Do,Na=new ko,Pa=new br,Ua=new Lo,Da=new Bn,ka=new Tn,La=new Sn(32),Ma=new Sn(64),qa=new At(8),Fa=new At(16),$a=new At(32),Va=new At(64),ja=new ht(8),Ka=new ht(16),Ha=new ht(32),Ga=new ht(64),Za=new qo;function Ya(...t){return new Mo(t)}function Wa(t){return new jr(t)}function za(t){return new Qt(t)}function Xa(t){return new gr(t)}function Ja(t){return new Kr(t)}function Qa(){return new Ve}function ec(t,e,r=[]){return new wr(t,e,r)}function tc(t){return new Hr(t)}var Fo=class t{constructor(e=new Map){this.rels=e}copy(){let e=new Map;for(let[r,n]of this.rels.entries()){let o=new Map(n);e.set(r,o)}return new t(e)}known(e,r){return this.rels.get(e.name)?.get(r.name)}addNegative(e,r){this.addNames(e.name,r.name,!1)}add(e,r){this.addNames(e.name,r.name,!0)}display(){let e="";for(let[r,n]of this.rels)for(let[o,s]of n)e+=`${r} ${s?":<":"!<:"} ${o}
`;return e}addNames(e,r,n){let o=this.rels.get(e);if(o==null){let s=new Map;s.set(r,n),this.rels.set(e,s)}else o.set(r,n)}},Uo=new Fo;function Ls(){Uo=new Fo}function Gf(t,e){let r=new Set(t.annotations),n=new Set(e.annotations);if(r.size!==n.size)return!1;for(let o of r)if(!n.has(o))return!1;return!0}function Us(t){return t instanceof Qt||t instanceof br||t instanceof mt}function qs(t,e){let r=Uo.copy(),n=St(r,t,e);return n?Uo.add(t,e):Uo.addNegative(t,e),n}function St(t,e,r){if(e.name===r.name)return!0;let n=t.known(e,r);if(n!==void 0)return n;if(t.add(e,r),r instanceof mt||e instanceof vn||e instanceof Tn&&r instanceof Bn)return!0;if(e instanceof jr&&r instanceof jr)return St(t,e._type,r._type);if(r instanceof Qt)return!0;if(e instanceof gr&&r instanceof gr){let o=e.fieldsAsObject;for(let[s,i]of r._fields){let c=o[Oe(s)];if(c){if(!St(t,c,i))return!1}else if(!Us(i))return!1}return!0}if(e instanceof wr&&r instanceof wr){if(!Gf(e,r))return!1;for(let o=0;o<e.argTypes.length;o++){let s=e.argTypes[o];if(o<r.argTypes.length){if(!St(t,r.argTypes[o],s))return!1}else if(!Us(s))return!1}for(let o=0;o<r.retTypes.length;o++){let s=r.retTypes[o];if(o<e.retTypes.length){if(!St(t,e.retTypes[o],s))return!1}else if(!Us(s))return!1}return!0}if(e instanceof Kr&&r instanceof Kr){let o=r.alternativesAsObject;for(let[s,i]of e._fields){let c=o[Oe(s)];if(!c||!St(t,i,c))return!1}return!0}if(e instanceof Hr&&r instanceof Hr){let o=e.fieldsAsObject();for(let[s,i]of r._fields){let c=o[s];if(!c||!St(t,c,i))return!1}return!0}return e instanceof Ve?St(t,e.getType(),r):r instanceof Ve?St(t,e,r.getType()):!1}function Gr(t){if(!t)throw new Error("Input cannot be null or undefined");return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):Array.isArray(t)?new Uint8Array(t):"buffer"in t?Gr(t.buffer):new Uint8Array(t)}function _r(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Fs(t){if(typeof t=="string")return rc(t);if(typeof t=="number")return Ie(ee(t));if(t instanceof Uint8Array||ArrayBuffer.isView(t))return Ie(Gr(t));if(Array.isArray(t)){let e=t.map(Fs);return Ie($(...e))}else{if(t&&typeof t=="object"&&t._isPrincipal)return Ie(t.toUint8Array());if(typeof t=="object"&&t!==null&&typeof t.toHash=="function")return Fs(t.toHash());if(typeof t=="object")return An(t);if(typeof t=="bigint")return Ie(ee(t))}throw G.fromCode(new Bo(t))}var rc=t=>{let e=new TextEncoder().encode(t);return Ie(e)};function Ot(t){return An(t)}function An(t){let n=Object.entries(t).filter(([,i])=>i!==void 0).map(([i,c])=>{let a=rc(i),u=Fs(c);return[a,u]}).sort(([i],[c])=>Cs(i,c)),o=$(...n.map(i=>$(...i)));return Ie(o)}var On=new TextEncoder().encode(`
ic-request`),$s=new TextEncoder().encode("\vic-response"),Vs=new TextEncoder().encode("ic-request-auth-delegation");var er=class{getPrincipal(){return this._principal||(this._principal=M.selfAuthenticating(new Uint8Array(this.getPublicKey().toDer()))),this._principal}async transformRequest(e){let{body:r,...n}=e,o=Ot(r);return{...n,body:{content:r,sender_pubkey:this.getPublicKey().toDer(),sender_sig:await this.sign($(On,o))}}}},tr=class{getPrincipal(){return M.anonymous()}async transformRequest(e){return{...e,body:{content:e.body}}}};var Ct=class extends Error{constructor(e){super(e),this.name="DecodingError"}},oc=55799,sc=Symbol("CBOR_STOP_CODE"),tt=(t=>(t[t.False=20]="False",t[t.True=21]="True",t[t.Null=22]="Null",t[t.Undefined=23]="Undefined",t[t.Break=31]="Break",t))(tt||{}),le=(t=>(t[t.UnsignedInteger=0]="UnsignedInteger",t[t.NegativeInteger=1]="NegativeInteger",t[t.ByteString=2]="ByteString",t[t.TextString=3]="TextString",t[t.Array=4]="Array",t[t.Map=5]="Map",t[t.Tag=6]="Tag",t[t.Simple=7]="Simple",t))(le||{}),Zf=23,Yf=255,Wf=65535,zf=4294967295,Xf=BigInt("0xffffffffffffffff"),et=(t=>(t[t.Value=23]="Value",t[t.OneByte=24]="OneByte",t[t.TwoBytes=25]="TwoBytes",t[t.FourBytes=26]="FourBytes",t[t.EightBytes=27]="EightBytes",t[t.Indefinite=31]="Indefinite",t))(et||{}),Zr=!1;function Jf(t){return t==null}function ic(t,e){let r=new Uint8Array(e);return r.set(t),r}var Qf=new TextDecoder;function eu(t){return(t&224)>>5}function tu(t){return t&31}var Nn=new Uint8Array,Cn,rt=0;function ac(t,e){Nn=t,rt=0;let r=Er(e);return e?.(r)??r}function Er(t){let[e,r]=$o();switch(e){case le.UnsignedInteger:return Yr(r);case le.NegativeInteger:return su(r);case le.ByteString:return cc(r);case le.TextString:return Ks(r);case le.Array:return ru(r,t);case le.Map:return ou(r,t);case le.Tag:return iu(r,t);case le.Simple:return nu(r)}throw new Ct(`Unsupported major type: ${e}`)}function $o(){let t=Nn.at(rt);if(Jf(t))throw new Ct("Provided CBOR data is empty");let e=eu(t),r=tu(t);return rt++,[e,r]}function ru(t,e){let r=Yr(t);if(r===1/0){let o=[],s=Er(e);for(;s!==sc;)o.push(e?.(s)??s),s=Er(e);return o}let n=new Array(r);for(let o=0;o<r;o++){let s=Er(e);n[o]=e?.(s)??s}return n}function nu(t){switch(t){case tt.False:return!1;case tt.True:return!0;case tt.Null:return null;case tt.Undefined:return;case tt.Break:return sc}throw new Ct(`Unrecognized simple type: ${t.toString(2)}`)}function ou(t,e){let r=Yr(t),n={};if(r===1/0){let[o,s]=$o();for(;o!==le.Simple&&s!==tt.Break;){let i=Ks(s),c=Er(e);n[i]=e?.(c,i)??c,[o,s]=$o()}return n}for(let o=0;o<r;o++){let[s,i]=$o();if(s!==le.TextString)throw new Ct("Map keys must be text strings");let c=Ks(i),a=Er(e);n[c]=e?.(a,c)??a}return n}function Yr(t){if(t<=et.Value)return t;switch(Cn=new DataView(Nn.buffer,Nn.byteOffset+rt),t){case et.OneByte:return rt++,Cn.getUint8(0);case et.TwoBytes:return rt+=2,Cn.getUint16(0,Zr);case et.FourBytes:return rt+=4,Cn.getUint32(0,Zr);case et.EightBytes:return rt+=8,Cn.getBigUint64(0,Zr);case et.Indefinite:return 1/0;default:throw new Ct(`Unsupported integer info: ${t.toString(2)}`)}}function su(t){let e=Yr(t);return typeof e=="number"?-1-e:-1n-e}function cc(t){let e=Yr(t);if(e>Number.MAX_SAFE_INTEGER)throw new Ct("Byte length is too large");let r=Number(e);return rt+=r,Nn.slice(rt-r,rt)}function Ks(t){let e=cc(t);return Qf.decode(e)}function iu(t,e){let r=Yr(t);if(r===oc)return Er(e);throw new Ct(`Unsupported tag: ${r}.`)}var Pn=class extends Error{constructor(e){super(e),this.name="SerializationError"}},au=2*1024,cu=100,fu=new TextEncoder;function Rn(t){return t<<5}var qe=new Uint8Array(au),Qe=new DataView(qe.buffer),de=0,js=[];function fc(t,e){de=0;let r=e?.(t)??t;return bu(oc,r,e),qe.slice(0,de)}function Hs(t,e){if(de>qe.length-cu&&(qe=ic(qe,qe.length*2),Qe=new DataView(qe.buffer)),t===!1||t===!0||t===null||t===void 0){lu(t);return}if(typeof t=="number"||typeof t=="bigint"){yu(t);return}if(typeof t=="string"){lc(t);return}if(t instanceof Uint8Array){nc(t);return}if(t instanceof ArrayBuffer){nc(new Uint8Array(t));return}if(Array.isArray(t)){uu(t,e);return}if(typeof t=="object"){du(t,e);return}throw new Pn(`Unsupported type: ${typeof t}`)}function uu(t,e){Wr(le.Array,t.length),t.forEach((r,n)=>{Hs(e?.(r,n.toString())??r,e)})}function du(t,e){js=Object.entries(t),Wr(le.Map,js.length),js.forEach(([r,n])=>{lc(r),Hs(e?.(n,r)??n,e)})}function Wr(t,e){if(e<=Zf){Qe.setUint8(de++,Rn(t)|Number(e));return}if(e<=Yf){Qe.setUint8(de++,Rn(t)|et.OneByte),Qe.setUint8(de,Number(e)),de+=1;return}if(e<=Wf){Qe.setUint8(de++,Rn(t)|et.TwoBytes),Qe.setUint16(de,Number(e),Zr),de+=2;return}if(e<=zf){Qe.setUint8(de++,Rn(t)|et.FourBytes),Qe.setUint32(de,Number(e),Zr),de+=4;return}if(e<=Xf){Qe.setUint8(de++,Rn(t)|et.EightBytes),Qe.setBigUint64(de,BigInt(e),Zr),de+=8;return}throw new Pn(`Value too large to encode: ${e}`)}function lu(t){Wr(le.Simple,hu(t))}function hu(t){if(t===!1)return tt.False;if(t===!0)return tt.True;if(t===null)return tt.Null;if(t===void 0)return tt.Undefined;throw new Pn(`Unrecognized simple value: ${t.toString()}`)}function uc(t,e){Wr(t,e.length),de>qe.length-e.length&&(qe=ic(qe,qe.length+e.length),Qe=new DataView(qe.buffer)),qe.set(e,de),de+=e.length}function dc(t,e){Wr(t,e)}function pu(t){dc(le.UnsignedInteger,t)}function mu(t){dc(le.NegativeInteger,typeof t=="bigint"?-1n-t:-1-t)}function yu(t){t>=0?pu(t):mu(t)}function lc(t){uc(le.TextString,fu.encode(t))}function nc(t){uc(le.ByteString,t)}function bu(t,e,r){Wr(le.Tag,t),Hs(e,r)}function wu(t){return typeof t=="object"&&t!==null&&"toCborValue"in t}function Vo(t){try{return fc(t,e=>M.isPrincipal(e)?e.toUint8Array():zr.isExpiry(e)?e.toBigInt():wu(e)?e.toCborValue():e)}catch(e){throw G.fromCode(new xo(e,t))}}function Fe(t){try{return ac(t)}catch(e){throw G.fromCode(new wo(e,t))}}var Un=()=>{if(typeof window<"u"&&window.crypto&&window.crypto.getRandomValues){let t=new Uint32Array(1);return window.crypto.getRandomValues(t),t[0]}if(typeof crypto<"u"&&crypto.getRandomValues){let t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]}return typeof crypto<"u"&&crypto.randomInt?crypto.randomInt(0,4294967295):Math.floor(Math.random()*4294967295)};var Rt;(function(t){t.Query="read",t.ReadState="read_state",t.Call="call"})(Rt||(Rt={}));var jo;(function(t){t.Call="call"})(jo||(jo={}));var Ir;(function(t){t.Query="query",t.ReadState="read_state"})(Ir||(Ir={}));function Dn(){let t=new ArrayBuffer(16),e=new DataView(t),r=Un(),n=Un(),o=Un(),s=Un();return e.setUint32(0,r),e.setUint32(4,n),e.setUint32(8,o),e.setUint32(12,s),Object.assign(new Uint8Array(t),{__nonce__:void 0})}var Ko="__expiry__",Zs=BigInt(1e3),xu=BigInt(1e6),hc=BigInt(60),_u=BigInt(90)*Zs;function pc(t){return t/Zs}function Eu(t){return pc(t)/hc}var zr=class t{constructor(e){this.__expiry__=e,this._isExpiry=!0}static fromDeltaInMilliseconds(e,r=0){let n=BigInt(e),o=BigInt(Date.now())+n+BigInt(r),s;return n<_u?s=pc(o):s=Eu(o)*hc,new t(s*Zs*xu)}toBigInt(){return this.__expiry__}toHash(){return ee(this.__expiry__)}toString(){return this.__expiry__.toString()}toJSON(){return{[Ko]:this.toString()}}static fromJSON(e){let r=JSON.parse(e);if(r[Ko])try{let n=BigInt(r[Ko]);return new t(n)}catch(n){throw new G(new _n(`Not a valid BigInt: ${n}`))}throw new G(new _n(`The input does not contain the key ${Ko}`))}static isExpiry(e){return e instanceof t||typeof e=="object"&&e!==null&&"_isExpiry"in e&&e._isExpiry===!0&&"__expiry__"in e&&typeof e.__expiry__=="bigint"}};function Ys(t=Dn){return async e=>{let r=e.request.headers;e.request.headers=r,e.endpoint===Rt.Call&&(e.body.nonce=t())}}function Ho(t){let e=[];return t.forEach((r,n)=>{e.push([n,r])}),e}var zs=BigInt(0),Go=BigInt(1);function vr(t,e=""){if(typeof t!="boolean"){let r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function rr(t,e,r=""){let n=ft(t),o=t?.length,s=e!==void 0;if(!n||s&&o!==e){let i=r&&`"${r}" `,c=s?` of length ${e}`:"",a=n?`length=${o}`:`type=${typeof t}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return t}function mc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?zs:BigInt("0x"+t)}function Le(t){return mc(F(t))}function Nt(t){return se(t),mc(F(Uint8Array.from(t).reverse()))}function he(t,e){return me(t.toString(16).padStart(e*2,"0"))}function Xs(t,e){return he(t,e).reverse()}function ne(t,e,r){let n;if(typeof e=="string")try{n=me(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ft(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(t+" of length "+r+" expected, got "+o);return n}function yc(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}function Js(t){return Uint8Array.from(t)}var Ws=t=>typeof t=="bigint"&&zs<=t;function Qs(t,e,r){return Ws(t)&&Ws(e)&&Ws(r)&&e<=t&&t<r}function Zo(t,e,r,n){if(!Qs(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Pt(t){let e;for(e=0;t>zs;t>>=Go,e+=1);return e}function bc(t,e){return t>>BigInt(e)&Go}var nt=t=>(Go<<BigInt(t))-Go;function gc(t){return typeof t=="function"&&Number.isSafeInteger(t.outputLen)}function Ut(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(o,s,i){let c=t[o];if(i&&c===void 0)return;let a=typeof c;if(a!==s||c===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${a}`)}Object.entries(e).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}var Xr=()=>{throw new Error("not implemented")};function nr(t){let e=new WeakMap;return(r,...n)=>{let o=e.get(r);if(o!==void 0)return o;let s=t(r,...n);return e.set(r,s),s}}var Ce=BigInt(0),be=BigInt(1),Br=BigInt(2),xc=BigInt(3),_c=BigInt(4),Ec=BigInt(5),Iu=BigInt(7),Ic=BigInt(8),vu=BigInt(9),vc=BigInt(16);function te(t,e){let r=t%e;return r>=Ce?r:e+r}function ot(t,e,r){let n=t;for(;e-- >Ce;)n*=n,n%=r;return n}function wc(t,e){if(t===Ce)throw new Error("invert: expected non-zero number");if(e<=Ce)throw new Error("invert: expected positive modulus, got "+e);let r=te(t,e),n=e,o=Ce,s=be,i=be,c=Ce;for(;r!==Ce;){let u=n/r,l=n%r,d=o-i*u,f=s-c*u;n=r,r=l,o=i,s=c,i=d,c=f}if(n!==be)throw new Error("invert: does not exist");return te(o,e)}function ei(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Bc(t,e){let r=(t.ORDER+be)/_c,n=t.pow(e,r);return ei(t,n,e),n}function Bu(t,e){let r=(t.ORDER-Ec)/Ic,n=t.mul(e,Br),o=t.pow(n,r),s=t.mul(e,o),i=t.mul(t.mul(s,Br),o),c=t.mul(s,t.sub(i,t.ONE));return ei(t,c,e),c}function Tu(t){let e=Re(t),r=Tc(t),n=r(e,e.neg(e.ONE)),o=r(e,n),s=r(e,e.neg(n)),i=(t+Iu)/vc;return(c,a)=>{let u=c.pow(a,i),l=c.mul(u,n),d=c.mul(u,o),f=c.mul(u,s),h=c.eql(c.sqr(l),a),p=c.eql(c.sqr(d),a);u=c.cmov(u,l,h),l=c.cmov(f,d,p);let y=c.eql(c.sqr(l),a),g=c.cmov(u,l,y);return ei(c,g,a),g}}function Tc(t){if(t<xc)throw new Error("sqrt is not defined for small field");let e=t-be,r=0;for(;e%Br===Ce;)e/=Br,r++;let n=Br,o=Re(t);for(;kn(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Bc;let s=o.pow(n,e),i=(e+be)/Br;return function(a,u){if(a.is0(u))return u;if(kn(a,u)!==1)throw new Error("Cannot find square root");let l=r,d=a.mul(a.ONE,s),f=a.pow(u,e),h=a.pow(u,i);for(;!a.eql(f,a.ONE);){if(a.is0(f))return a.ZERO;let p=1,y=a.sqr(f);for(;!a.eql(y,a.ONE);)if(p++,y=a.sqr(y),p===l)throw new Error("Cannot find square root");let g=be<<BigInt(l-p-1),m=a.pow(d,g);l=p,d=a.sqr(m),f=a.mul(f,d),h=a.mul(h,m)}return h}}function Su(t){return t%_c===xc?Bc:t%Ic===Ec?Bu:t%vc===vu?Tu(t):Tc(t)}var Dt=(t,e)=>(te(t,e)&be)===be,Au=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Yo(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Au.reduce((n,o)=>(n[o]="function",n),e);return Ut(t,r),t}function Ln(t,e,r){if(r<Ce)throw new Error("invalid exponent, negatives unsupported");if(r===Ce)return t.ONE;if(r===be)return e;let n=t.ONE,o=e;for(;r>Ce;)r&be&&(n=t.mul(n,o)),o=t.sqr(o),r>>=be;return n}function je(t,e,r=!1){let n=new Array(e.length).fill(r?t.ZERO:void 0),o=e.reduce((i,c,a)=>t.is0(c)?i:(n[a]=i,t.mul(i,c)),t.ONE),s=t.inv(o);return e.reduceRight((i,c,a)=>t.is0(c)?i:(n[a]=t.mul(i,n[a]),t.mul(i,c)),s),n}function kn(t,e){let r=(t.ORDER-be)/Br,n=t.pow(e,r),o=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),i=t.eql(n,t.neg(t.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function ti(t,e){e!==void 0&&Is(e);let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Re(t,e,r=!1,n={}){if(t<=Ce)throw new Error("invalid field: expected ORDER > 0, got "+t);let o,s,i=!1,c;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=e;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(i=f.modFromBytes),c=f.allowedLengths}else typeof e=="number"&&(o=e),n.sqrt&&(s=n.sqrt);let{nBitLength:a,nByteLength:u}=ti(t,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l,d=Object.freeze({ORDER:t,isLE:r,BITS:a,BYTES:u,MASK:nt(a),ZERO:Ce,ONE:be,allowedLengths:c,create:f=>te(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ce<=f&&f<t},is0:f=>f===Ce,isValidNot0:f=>!d.is0(f)&&d.isValid(f),isOdd:f=>(f&be)===be,neg:f=>te(-f,t),eql:(f,h)=>f===h,sqr:f=>te(f*f,t),add:(f,h)=>te(f+h,t),sub:(f,h)=>te(f-h,t),mul:(f,h)=>te(f*h,t),pow:(f,h)=>Ln(d,f,h),div:(f,h)=>te(f*wc(h,t),t),sqrN:f=>f*f,addN:(f,h)=>f+h,subN:(f,h)=>f-h,mulN:(f,h)=>f*h,inv:f=>wc(f,t),sqrt:s||(f=>(l||(l=Su(t)),l(d,f))),toBytes:f=>r?Xs(f,u):he(f,u),fromBytes:(f,h=!0)=>{if(c){if(!c.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);let y=new Uint8Array(u);y.set(f,r?0:y.length-f.length),f=y}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let p=r?Nt(f):Le(f);if(i&&(p=te(p,t)),!h&&!d.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>je(d,f),cmov:(f,h,p)=>p?h:f});return Object.freeze(d)}function Sc(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function Wo(t){let e=Sc(t);return e+Math.ceil(e/2)}function ri(t,e,r=!1){let n=t.length,o=Sc(e),s=Wo(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?Nt(t):Le(t),c=te(i,e-be)+be;return r?Xs(c,o):he(c,o)}var Jr=BigInt(0),Tr=BigInt(1);function Mn(t,e){let r=e.negate();return t?r:e}function Ke(t,e){let r=je(t.Fp,e.map(n=>n.Z));return e.map((n,o)=>t.fromAffine(n.toAffine(r[o])))}function Rc(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ni(t,e){Rc(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1),o=2**t,s=nt(t),i=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function Ac(t,e,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,c=Number(t&o),a=t>>i;c>n&&(c-=s,a+=Tr);let u=e*n,l=u+Math.abs(c)-1,d=c===0,f=c<0,h=e%2!==0;return{nextN:a,offset:l,isZero:d,isNeg:f,isNegF:h,offsetF:u}}function Cu(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Ru(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}var oi=new WeakMap,Nc=new WeakMap;function si(t){return Nc.get(t)||1}function Oc(t){if(t!==Jr)throw new Error("invalid wNAF")}var Qr=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let o=e;for(;r>Jr;)r&Tr&&(n=n.add(o)),o=o.double(),r>>=Tr;return n}precomputeWindow(e,r){let{windows:n,windowSize:o}=ni(r,this.bits),s=[],i=e,c=i;for(let a=0;a<n;a++){c=i,s.push(c);for(let u=1;u<o;u++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=ni(e,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:u,isZero:l,isNeg:d,isNegF:f,offsetF:h}=Ac(n,c,i);n=a,l?s=s.add(Mn(f,r[h])):o=o.add(Mn(d,r[u]))}return Oc(n),{p:o,f:s}}wNAFUnsafe(e,r,n,o=this.ZERO){let s=ni(e,this.bits);for(let i=0;i<s.windows&&n!==Jr;i++){let{nextN:c,offset:a,isZero:u,isNeg:l}=Ac(n,i,s);if(n=c,!u){let d=r[a];o=o.add(l?d.negate():d)}}return Oc(n),o}getPrecomputes(e,r,n){let o=oi.get(r);return o||(o=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(o=n(o)),oi.set(r,o))),o}cached(e,r,n){let o=si(e);return this.wNAF(o,this.getPrecomputes(o,e,n),r)}unsafe(e,r,n,o){let s=si(e);return s===1?this._unsafeLadder(e,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,o)}createCache(e,r){Rc(r,this.bits),Nc.set(e,r),oi.delete(e)}hasCache(e){return si(e)!==1}};function Pc(t,e,r,n){let o=e,s=t.ZERO,i=t.ZERO;for(;r>Jr||n>Jr;)r&Tr&&(s=s.add(o)),n&Tr&&(i=i.add(o)),o=o.double(),r>>=Tr,n>>=Tr;return{p1:s,p2:i}}function en(t,e,r,n){Cu(r,t),Ru(n,e);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=t.ZERO,c=Pt(BigInt(o)),a=1;c>12?a=c-3:c>4?a=c-2:c>0&&(a=2);let u=nt(a),l=new Array(Number(u)+1).fill(i),d=Math.floor((e.BITS-1)/a)*a,f=i;for(let h=d;h>=0;h-=a){l.fill(i);for(let y=0;y<s;y++){let g=n[y],m=Number(g>>BigInt(h)&u);l[m]=l[m].add(r[y])}let p=i;for(let y=l.length-1,g=i;y>0;y--)g=g.add(l[y]),p=p.add(g);if(f=f.add(p),h!==0)for(let y=0;y<a;y++)f=f.double()}return f}function Cc(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Yo(e),e}else return Re(t,{isLE:r})}function zo(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let a of["p","n","h"]){let u=e[a];if(!(typeof u=="bigint"&&u>Jr))throw new Error(`CURVE.${a} must be positive bigint`)}let o=Cc(e.p,r.Fp,n),s=Cc(e.n,r.Fn,n),c=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let a of c)if(!o.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:s}}var Nu=Le;function or(t,e){if(qn(t),qn(e),t<0||t>=1<<8*e)throw new Error("invalid I2OSP input: "+t);let r=Array.from({length:e}).fill(0);for(let n=e-1;n>=0;n--)r[n]=t&255,t>>>=8;return new Uint8Array(r)}function Pu(t,e){let r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t[n]^e[n];return r}function qn(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function Uc(t){if(!ft(t)&&typeof t!="string")throw new Error("DST must be Uint8Array or string");return typeof t=="string"?X(t):t}function Uu(t,e,r,n){se(t),qn(r),e=Uc(e),e.length>255&&(e=n($(X("H2C-OVERSIZE-DST-"),e)));let{outputLen:o,blockLen:s}=n,i=Math.ceil(r/o);if(r>65535||i>255)throw new Error("expand_message_xmd: invalid lenInBytes");let c=$(e,or(e.length,1)),a=or(0,s),u=or(r,2),l=new Array(i),d=n($(a,t,u,or(0,1),c));l[0]=n($(d,or(1,1),c));for(let h=1;h<=i;h++){let p=[Pu(d,l[h-1]),or(h+1,1),c];l[h]=n($(...p))}return $(...l).slice(0,r)}function Du(t,e,r,n,o){if(se(t),qn(r),e=Uc(e),e.length>255){let s=Math.ceil(2*n/8);e=o.create({dkLen:s}).update(X("H2C-OVERSIZE-DST-")).update(e).digest()}if(r>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return o.create({dkLen:r}).update(t).update(or(r,2)).update(e).update(or(e.length,1)).digest()}function ii(t,e,r){Ut(r,{p:"bigint",m:"number",k:"number",hash:"function"});let{p:n,k:o,m:s,hash:i,expand:c,DST:a}=r;if(!gc(r.hash))throw new Error("expected valid hash");se(t),qn(e);let u=n.toString(2).length,l=Math.ceil((u+o)/8),d=e*s*l,f;if(c==="xmd")f=Uu(t,a,d,i);else if(c==="xof")f=Du(t,a,d,o,i);else if(c==="_internal_pass")f=t;else throw new Error('expand must be "xmd" or "xof"');let h=new Array(e);for(let p=0;p<e;p++){let y=new Array(s);for(let g=0;g<s;g++){let m=l*(g+p*s),w=f.subarray(m,m+l);y[g]=te(Nu(w),n)}h[p]=y}return h}function ai(t,e){let r=e.map(n=>Array.from(n).reverse());return(n,o)=>{let[s,i,c,a]=r.map(d=>d.reduce((f,h)=>t.add(t.mul(f,n),h))),[u,l]=je(t,[i,a],!0);return n=t.mul(s,u),o=t.mul(o,t.mul(c,l)),{x:n,y:o}}}var ku=X("HashToScalar-");function ci(t,e,r){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function n(s){return t.fromAffine(e(s))}function o(s){let i=s.clearCofactor();return i.equals(t.ZERO)?t.ZERO:(i.assertValidity(),i)}return{defaults:r,hashToCurve(s,i){let c=Object.assign({},r,i),a=ii(s,2,c),u=n(a[0]),l=n(a[1]);return o(u.add(l))},encodeToCurve(s,i){let c=r.encodeDST?{DST:r.encodeDST}:{},a=Object.assign({},r,c,i),u=ii(s,1,a),l=n(u[0]);return o(l)},mapToCurve(s){if(!Array.isArray(s))throw new Error("expected array of bigints");for(let i of s)if(typeof i!="bigint")throw new Error("expected array of bigints");return o(n(s))},hashToScalar(s,i){let c=t.Fn.ORDER,a=Object.assign({},r,{p:c,m:1,DST:ku},i);return ii(s,1,a)[0][0]}}}var Dc=(t,e)=>(t+(t>=0?e:-e)/kt)/e;function Lu(t,e,r){let[[n,o],[s,i]]=e,c=Dc(i*t,r),a=Dc(-o*t,r),u=t-c*n-a*s,l=-c*o-a*i,d=u<Sr,f=l<Sr;d&&(u=-u),f&&(l=-l);let h=nt(Math.ceil(Pt(r)/2))+Ne;if(u<Sr||u>=h||l<Sr||l>=h)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:d,k1:u,k2neg:f,k2:l}}var Sr=BigInt(0),Ne=BigInt(1),kt=BigInt(2),tn=BigInt(3),fi=BigInt(4);function Fn(t,e){let{BYTES:r}=t,n;if(typeof e=="bigint")n=e;else{let o=ne("private key",e);try{n=t.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function Mu(t,e={}){let r=zo("weierstrass",t,e),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:c}=s;Ut(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:a}=e;if(a&&(!n.is0(s.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=$u(n,o);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(C,x,I){let{x:R,y:k}=x.toAffine(),j=n.toBytes(R);if(vr(I,"isCompressed"),I){l();let O=!n.isOdd(k);return $(qu(O),j)}else return $(Uint8Array.of(4),j,n.toBytes(k))}function f(C){rr(C,void 0,"Point");let{publicKey:x,publicKeyUncompressed:I}=u,R=C.length,k=C[0],j=C.subarray(1);if(R===x&&(k===2||k===3)){let O=n.fromBytes(j);if(!n.isValid(O))throw new Error("bad point: is not on curve, wrong x");let N=y(O),U;try{U=n.sqrt(N)}catch(we){let fe=we instanceof Error?": "+we.message:"";throw new Error("bad point: is not on curve, sqrt error"+fe)}l();let L=n.isOdd(U);return(k&1)===1!==L&&(U=n.neg(U)),{x:O,y:U}}else if(R===I&&k===4){let O=n.BYTES,N=n.fromBytes(j.subarray(0,O)),U=n.fromBytes(j.subarray(O,O*2));if(!g(N,U))throw new Error("bad point: is not on curve");return{x:N,y:U}}else throw new Error(`bad point: got length ${R}, expected compressed=${x} or uncompressed=${I}`)}let h=e.toBytes||d,p=e.fromBytes||f;function y(C){let x=n.sqr(C),I=n.mul(x,C);return n.add(n.add(I,n.mul(C,s.a)),s.b)}function g(C,x){let I=n.sqr(x),R=y(C);return n.eql(I,R)}if(!g(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let m=n.mul(n.pow(s.a,tn),fi),w=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(m,w)))throw new Error("bad curve params: a or b");function b(C,x,I=!1){if(!n.isValid(x)||I&&n.is0(x))throw new Error(`bad point coordinate ${C}`);return x}function E(C){if(!(C instanceof _))throw new Error("ProjectivePoint expected")}function v(C){if(!a||!a.basises)throw new Error("no endo");return Lu(C,a.basises,o.ORDER)}let T=nr((C,x)=>{let{X:I,Y:R,Z:k}=C;if(n.eql(k,n.ONE))return{x:I,y:R};let j=C.is0();x==null&&(x=j?n.ONE:n.inv(k));let O=n.mul(I,x),N=n.mul(R,x),U=n.mul(k,x);if(j)return{x:n.ZERO,y:n.ZERO};if(!n.eql(U,n.ONE))throw new Error("invZ was invalid");return{x:O,y:N}}),B=nr(C=>{if(C.is0()){if(e.allowInfinityPoint&&!n.is0(C.Y))return;throw new Error("bad point: ZERO")}let{x,y:I}=C.toAffine();if(!n.isValid(x)||!n.isValid(I))throw new Error("bad point: x or y not field elements");if(!g(x,I))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function A(C,x,I,R,k){return I=new _(n.mul(I.X,C),I.Y,I.Z),x=Mn(R,x),I=Mn(k,I),x.add(I)}class _{constructor(x,I,R){this.X=b("x",x),this.Y=b("y",I,!0),this.Z=b("z",R),Object.freeze(this)}static CURVE(){return s}static fromAffine(x){let{x:I,y:R}=x||{};if(!x||!n.isValid(I)||!n.isValid(R))throw new Error("invalid affine point");if(x instanceof _)throw new Error("projective point not allowed");return n.is0(I)&&n.is0(R)?_.ZERO:new _(I,R,n.ONE)}static fromBytes(x){let I=_.fromAffine(p(rr(x,void 0,"point")));return I.assertValidity(),I}static fromHex(x){return _.fromBytes(ne("pointHex",x))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,I=!0){return P.createCache(this,x),I||this.multiply(tn),this}assertValidity(){B(this)}hasEvenY(){let{y:x}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(x)}equals(x){E(x);let{X:I,Y:R,Z:k}=this,{X:j,Y:O,Z:N}=x,U=n.eql(n.mul(I,N),n.mul(j,k)),L=n.eql(n.mul(R,N),n.mul(O,k));return U&&L}negate(){return new _(this.X,n.neg(this.Y),this.Z)}double(){let{a:x,b:I}=s,R=n.mul(I,tn),{X:k,Y:j,Z:O}=this,N=n.ZERO,U=n.ZERO,L=n.ZERO,q=n.mul(k,k),we=n.mul(j,j),fe=n.mul(O,O),J=n.mul(k,j);return J=n.add(J,J),L=n.mul(k,O),L=n.add(L,L),N=n.mul(x,L),U=n.mul(R,fe),U=n.add(N,U),N=n.sub(we,U),U=n.add(we,U),U=n.mul(N,U),N=n.mul(J,N),L=n.mul(R,L),fe=n.mul(x,fe),J=n.sub(q,fe),J=n.mul(x,J),J=n.add(J,L),L=n.add(q,q),q=n.add(L,q),q=n.add(q,fe),q=n.mul(q,J),U=n.add(U,q),fe=n.mul(j,O),fe=n.add(fe,fe),q=n.mul(fe,J),N=n.sub(N,q),L=n.mul(fe,we),L=n.add(L,L),L=n.add(L,L),new _(N,U,L)}add(x){E(x);let{X:I,Y:R,Z:k}=this,{X:j,Y:O,Z:N}=x,U=n.ZERO,L=n.ZERO,q=n.ZERO,we=s.a,fe=n.mul(s.b,tn),J=n.mul(I,j),Ze=n.mul(R,O),Ye=n.mul(k,N),Ur=n.add(I,R),Te=n.add(j,O);Ur=n.mul(Ur,Te),Te=n.add(J,Ze),Ur=n.sub(Ur,Te),Te=n.add(I,k);let ct=n.add(j,N);return Te=n.mul(Te,ct),ct=n.add(J,Ye),Te=n.sub(Te,ct),ct=n.add(R,k),U=n.add(O,N),ct=n.mul(ct,U),U=n.add(Ze,Ye),ct=n.sub(ct,U),q=n.mul(we,Te),U=n.mul(fe,Ye),q=n.add(U,q),U=n.sub(Ze,q),q=n.add(Ze,q),L=n.mul(U,q),Ze=n.add(J,J),Ze=n.add(Ze,J),Ye=n.mul(we,Ye),Te=n.mul(fe,Te),Ze=n.add(Ze,Ye),Ye=n.sub(J,Ye),Ye=n.mul(we,Ye),Te=n.add(Te,Ye),J=n.mul(Ze,Te),L=n.add(L,J),J=n.mul(ct,Te),U=n.mul(Ur,U),U=n.sub(U,J),J=n.mul(Ur,Ze),q=n.mul(ct,q),q=n.add(q,J),new _(U,L,q)}subtract(x){return this.add(x.negate())}is0(){return this.equals(_.ZERO)}multiply(x){let{endo:I}=e;if(!o.isValidNot0(x))throw new Error("invalid scalar: out of range");let R,k,j=O=>P.cached(this,O,N=>Ke(_,N));if(I){let{k1neg:O,k1:N,k2neg:U,k2:L}=v(x),{p:q,f:we}=j(N),{p:fe,f:J}=j(L);k=we.add(J),R=A(I.beta,q,fe,O,U)}else{let{p:O,f:N}=j(x);R=O,k=N}return Ke(_,[R,k])[0]}multiplyUnsafe(x){let{endo:I}=e,R=this;if(!o.isValid(x))throw new Error("invalid scalar: out of range");if(x===Sr||R.is0())return _.ZERO;if(x===Ne)return R;if(P.hasCache(this))return this.multiply(x);if(I){let{k1neg:k,k1:j,k2neg:O,k2:N}=v(x),{p1:U,p2:L}=Pc(_,R,j,N);return A(I.beta,U,L,k,O)}else return P.unsafe(R,x)}multiplyAndAddUnsafe(x,I,R){let k=this.multiplyUnsafe(I).add(x.multiplyUnsafe(R));return k.is0()?void 0:k}toAffine(x){return T(this,x)}isTorsionFree(){let{isTorsionFree:x}=e;return i===Ne?!0:x?x(_,this):P.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:x}=e;return i===Ne?this:x?x(_,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(x=!0){return vr(x,"isCompressed"),this.assertValidity(),h(_,this,x)}toHex(x=!0){return F(this.toBytes(x))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(x=!0){return this.toBytes(x)}_setWindowSize(x){this.precompute(x)}static normalizeZ(x){return Ke(_,x)}static msm(x,I){return en(_,o,x,I)}static fromPrivateKey(x){return _.BASE.multiply(Fn(o,x))}}_.BASE=new _(s.Gx,s.Gy,n.ONE),_.ZERO=new _(n.ZERO,n.ONE,n.ZERO),_.Fp=n,_.Fn=o;let S=o.BITS,P=new Qr(_,e.endo?Math.ceil(S/2):S);return _.BASE.precompute(8),_}function qu(t){return Uint8Array.of(t?2:3)}function Fu(t,e){let r=t.ORDER,n=Sr;for(let p=r-Ne;p%kt===Sr;p/=kt)n+=Ne;let o=n,s=kt<<o-Ne-Ne,i=s*kt,c=(r-Ne)/i,a=(c-Ne)/kt,u=i-Ne,l=s,d=t.pow(e,c),f=t.pow(e,(c+Ne)/kt),h=(p,y)=>{let g=d,m=t.pow(y,u),w=t.sqr(m);w=t.mul(w,y);let b=t.mul(p,w);b=t.pow(b,a),b=t.mul(b,m),m=t.mul(b,y),w=t.mul(b,p);let E=t.mul(w,m);b=t.pow(E,l);let v=t.eql(b,t.ONE);m=t.mul(w,f),b=t.mul(E,g),w=t.cmov(m,w,v),E=t.cmov(b,E,v);for(let T=o;T>Ne;T--){let B=T-kt;B=kt<<B-Ne;let A=t.pow(E,B),_=t.eql(A,t.ONE);m=t.mul(w,g),g=t.mul(g,g),A=t.mul(E,g),w=t.cmov(m,w,_),E=t.cmov(A,E,_)}return{isValid:v,value:w}};if(t.ORDER%fi===tn){let p=(t.ORDER-tn)/fi,y=t.sqrt(t.neg(e));h=(g,m)=>{let w=t.sqr(m),b=t.mul(g,m);w=t.mul(w,b);let E=t.pow(w,p);E=t.mul(E,b);let v=t.mul(E,y),T=t.mul(t.sqr(E),m),B=t.eql(T,g),A=t.cmov(v,E,B);return{isValid:B,value:A}}}return h}function ui(t,e){Yo(t);let{A:r,B:n,Z:o}=e;if(!t.isValid(r)||!t.isValid(n)||!t.isValid(o))throw new Error("mapToCurveSimpleSWU: invalid opts");let s=Fu(t,o);if(!t.isOdd)throw new Error("Field does not have .isOdd()");return i=>{let c,a,u,l,d,f,h,p;c=t.sqr(i),c=t.mul(c,o),a=t.sqr(c),a=t.add(a,c),u=t.add(a,t.ONE),u=t.mul(u,n),l=t.cmov(o,t.neg(a),!t.eql(a,t.ZERO)),l=t.mul(l,r),a=t.sqr(u),f=t.sqr(l),d=t.mul(f,r),a=t.add(a,d),a=t.mul(a,u),f=t.mul(f,l),d=t.mul(f,n),a=t.add(a,d),h=t.mul(c,u);let{isValid:y,value:g}=s(a,f);p=t.mul(c,i),p=t.mul(p,g),h=t.cmov(h,u,y),p=t.cmov(p,g,y);let m=t.isOdd(i)===t.isOdd(p);p=t.cmov(t.neg(p),p,m);let w=je(t,[l],!0)[0];return h=t.mul(h,w),{x:h,y:p}}}function $u(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function di(t){let{CURVE:e,curveOpts:r}=Vu(t),n=Mu(e,r);return Ku(t,n)}function Vu(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(i=>Math.ceil(i/2)))):void 0,o=Re(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:o,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function ju(t,e,r){function n(o){let s=t.sqr(o),i=t.mul(s,o);return t.add(t.add(i,t.mul(o,e)),r)}return n}function Ku(t,e){let{Fp:r,Fn:n}=e;function o(i){return Qs(i,Ne,n.ORDER)}let s=ju(r,t.a,t.b);return Object.assign({},{CURVE:t,Point:e,ProjectivePoint:e,normPrivateKeyToScalar:i=>Fn(n,i),weierstrassEquation:s,isWithinCurveOrder:o})}var Hu=BigInt(0),Xo=BigInt(1),kc=BigInt(2),rn=BigInt(3);function Gu(t){let e=[];for(;t>Xo;t>>=Xo)(t&Xo)===Hu?e.unshift(0):(t&rn)===rn?(e.unshift(-1),t+=Xo):e.unshift(1);return e}function li(t){if(!Array.isArray(t)||t.length===0)throw new Error("expected non-empty array")}function Zu(t,e,r,n){let{Fp2:o,Fp12:s}=t,{twistType:i,ateLoopSize:c,xNegative:a,postPrecompute:u}=n,l;if(i==="multiplicative")l=(b,E,v,T,B,A)=>s.mul014(T,b,o.mul(E,B),o.mul(v,A));else if(i==="divisive")l=(b,E,v,T,B,A)=>s.mul034(T,o.mul(v,A),o.mul(E,B),b);else throw new Error("bls: unknown twist type");let d=o.div(o.ONE,o.mul(o.ONE,kc));function f(b,E,v,T){let B=o.sqr(v),A=o.sqr(T),_=o.mulByB(o.mul(A,rn)),S=o.mul(_,rn),P=o.sub(o.sub(o.sqr(o.add(v,T)),A),B),C=o.sub(_,B),x=o.mul(o.sqr(E),rn),I=o.neg(P);return b.push([C,x,I]),E=o.mul(o.mul(o.mul(o.sub(B,S),E),v),d),v=o.sub(o.sqr(o.mul(o.add(B,S),d)),o.mul(o.sqr(_),rn)),T=o.mul(B,P),{Rx:E,Ry:v,Rz:T}}function h(b,E,v,T,B,A){let _=o.sub(v,o.mul(A,T)),S=o.sub(E,o.mul(B,T)),P=o.sub(o.mul(_,B),o.mul(S,A)),C=o.neg(_),x=S;b.push([P,C,x]);let I=o.sqr(S),R=o.mul(I,S),k=o.mul(I,E),j=o.add(o.sub(R,o.mul(k,kc)),o.mul(o.sqr(_),T));return E=o.mul(S,j),v=o.sub(o.mul(o.sub(k,j),_),o.mul(R,v)),T=o.mul(T,R),{Rx:E,Ry:v,Rz:T}}let p=Gu(c),y=nr(b=>{let E=b,{x:v,y:T}=E.toAffine(),B=v,A=T,_=o.neg(T),S=B,P=A,C=o.ONE,x=[];for(let I of p){let R=[];({Rx:S,Ry:P,Rz:C}=f(R,S,P,C)),I&&({Rx:S,Ry:P,Rz:C}=h(R,S,P,C,B,I===-1?_:A)),x.push(R)}if(u){let I=x[x.length-1];u(S,P,C,B,A,h.bind(null,I))}return x});function g(b,E=!1){let v=s.ONE;if(b.length){let T=b[0][0].length;for(let B=0;B<T;B++){v=s.sqr(v);for(let[A,_,S]of b)for(let[P,C,x]of A[B])v=l(P,C,x,v,_,S)}}return a&&(v=s.conjugate(v)),E?s.finalExponentiate(v):v}function m(b,E=!0){let v=[];Ke(e,b.map(({g1:T})=>T)),Ke(r,b.map(({g2:T})=>T));for(let{g1:T,g2:B}of b){if(T.is0()||B.is0())throw new Error("pairing is not available for ZERO point");T.assertValidity(),B.assertValidity();let A=T.toAffine();v.push([y(B),A.x,A.y])}return g(v,E)}function w(b,E,v=!0){return m([{g1:b,g2:E}],v)}return{Fp12:s,millerLoopBatch:g,pairing:w,pairingBatch:m,calcPairingPrecomputes:y}}function Lc(t,e,r,n,o){let{Fp12:s,pairingBatch:i}=t;function c(d){return d instanceof e.Point?d:e.Point.fromHex(d)}function a(d){return d instanceof r.Point?d:r.Point.fromHex(d)}function u(d){if(!(d instanceof r.Point))throw new Error(`expected valid message hashed to ${o?"G1":"G2"} curve`);return d}let l=o?(d,f)=>({g1:f,g2:d}):(d,f)=>({g1:d,g2:f});return{getPublicKey(d){let f=Fn(e.Point.Fn,d);return e.Point.BASE.multiply(f)},sign(d,f,h){if(h!=null)throw new Error("sign() expects 2 arguments");let p=Fn(e.Point.Fn,f);return u(d).assertValidity(),d.multiply(p)},verify(d,f,h,p){if(p!=null)throw new Error("verify() expects 3 arguments");d=a(d),h=c(h);let y=h.negate(),g=e.Point.BASE,m=u(f),w=d,b=i([l(y,m),l(g,w)]);return s.eql(b,s.ONE)},verifyBatch(d,f,h){if(li(f),h.length!==f.length)throw new Error("amount of public keys and messages should be equal");let p=a(d),y=f,g=h.map(c),m=new Map;for(let E=0;E<g.length;E++){let v=g[E],T=y[E],B=m.get(T);B===void 0&&(B=[],m.set(T,B)),B.push(v)}let w=[],b=e.Point.BASE;try{for(let[E,v]of m){let T=v.reduce((B,A)=>B.add(A));w.push(l(T,E))}return w.push(l(b.negate(),p)),s.eql(i(w),s.ONE)}catch{return!1}},aggregatePublicKeys(d){li(d),d=d.map(h=>c(h));let f=d.reduce((h,p)=>h.add(p),e.Point.ZERO);return f.assertValidity(),f},aggregateSignatures(d){li(d),d=d.map(h=>a(h));let f=d.reduce((h,p)=>h.add(p),r.Point.ZERO);return f.assertValidity(),f},hash(d,f){se(d);let h=f?{DST:f}:void 0;return r.hashToCurve(d,h)},Signature:n}}function Mc(t){let{Fp:e,Fr:r,Fp2:n,Fp6:o,Fp12:s}=t.fields,i=di(t.G1),c=Object.assign(i,ci(i.Point,t.G1.mapToCurve,{...t.htfDefaults,...t.G1.htfDefaults})),a=di(t.G2),u=Object.assign(a,ci(a.Point,t.G2.mapToCurve,{...t.htfDefaults,...t.G2.htfDefaults})),l=Zu(t.fields,c.Point,u.Point,{...t.params,postPrecompute:t.postPrecompute}),{millerLoopBatch:d,pairing:f,pairingBatch:h,calcPairingPrecomputes:p}=l,y=Lc(l,c,u,t.G2.Signature,!1),g=Lc(l,u,c,t.G1.ShortSignature,!0),m=t.randomBytes||kr,w=()=>{let O=Wo(r.ORDER);return ri(m(O),r.ORDER)},b={randomSecretKey:w,randomPrivateKey:w,calcPairingPrecomputes:p},{ShortSignature:E}=t.G1,{Signature:v}=t.G2;function T(O,N){return O instanceof c.Point?O:g.hash(ne("point",O),N?.DST)}function B(O,N){return O instanceof u.Point?O:y.hash(ne("point",O),N?.DST)}function A(O){return y.getPublicKey(O).toBytes(!0)}function _(O){return g.getPublicKey(O).toBytes(!0)}function S(O,N,U){let L=B(O,U),q=y.sign(L,N);return O instanceof u.Point?q:v.toBytes(q)}function P(O,N,U){let L=T(O,U),q=g.sign(L,N);return O instanceof c.Point?q:E.toBytes(q)}function C(O,N,U,L){let q=B(N,L);return y.verify(O,q,U)}function x(O,N,U,L){let q=T(N,L);return g.verify(O,q,U)}function I(O){let N=y.aggregatePublicKeys(O);return O[0]instanceof c.Point?N:N.toBytes(!0)}function R(O){let N=y.aggregateSignatures(O);return O[0]instanceof u.Point?N:v.toBytes(N)}function k(O){let N=g.aggregateSignatures(O);return O[0]instanceof c.Point?N:E.toBytes(N)}function j(O,N,U,L){let q=N.map(we=>B(we,L));return y.verifyBatch(O,q,U)}return c.Point.BASE.precompute(4),{longSignatures:y,shortSignatures:g,millerLoopBatch:d,pairing:f,pairingBatch:h,verifyBatch:j,fields:{Fr:r,Fp:e,Fp2:n,Fp6:o,Fp12:s},params:{ateLoopSize:t.params.ateLoopSize,twistType:t.params.twistType,r:t.params.r,G1b:t.G1.b,G2b:t.G2.b},utils:b,getPublicKey:A,getPublicKeyForShortSignatures:_,sign:S,signShortSignature:P,verify:C,verifyShortSignature:x,aggregatePublicKeys:I,aggregateSignatures:R,aggregateShortSignatures:k,G1:c,G2:u,Signature:v,ShortSignature:E}}var qc=BigInt(0),Lt=BigInt(1),Pe=BigInt(2),Fc=BigInt(3);function yi(t,e,r,n,o=1,s){let i=BigInt(s===void 0?n:s),c=r**BigInt(n),a=[];for(let u=0;u<o;u++){let l=BigInt(u+1),d=[];for(let f=0,h=Lt;f<n;f++){let p=(l*h-l)/i%c;d.push(t.pow(e,p)),h*=r}a.push(d)}return a}function Vc(t,e,r){let n=e.pow(r,(t.ORDER-Lt)/Fc),o=e.pow(r,(t.ORDER-Lt)/Pe);function s(f,h){let p=e.mul(e.frobeniusMap(f,1),n),y=e.mul(e.frobeniusMap(h,1),o);return[p,y]}let i=e.pow(r,(t.ORDER**Pe-Lt)/Fc),c=e.pow(r,(t.ORDER**Pe-Lt)/Pe);if(!e.eql(c,e.neg(e.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function a(f,h){return[e.mul(f,i),e.neg(h)]}let u=f=>(h,p)=>{let y=p.toAffine(),g=f(y.x,y.y);return h.fromAffine({x:g[0],y:g[1]})},l=u(s),d=u(a);return{psi:s,psi2:a,G2psi:l,G2psi2:d,PSI_X:n,PSI_Y:o,PSI2_X:i,PSI2_Y:c}}var $c=(t,e)=>{if(e.length!==2)throw new Error("invalid tuple");let r=e.map(n=>t.create(n));return{c0:r[0],c1:r[1]}},hi=class{constructor(e,r={}){this.MASK=Lt;let n=e.ORDER,o=n*n;this.Fp=e,this.ORDER=o,this.BITS=Pt(o),this.BYTES=Math.ceil(Pt(o)/8),this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.Fp_NONRESIDUE=e.create(r.NONRESIDUE||BigInt(-1)),this.Fp_div2=e.div(e.ONE,Pe),this.NONRESIDUE=$c(e,r.FP2_NONRESIDUE),this.FROBENIUS_COEFFICIENTS=yi(e,this.Fp_NONRESIDUE,e.ORDER,2)[0],this.mulByB=r.Fp2mulByB,Object.seal(this)}fromBigTuple(e){return $c(this.Fp,e)}create(e){return e}isValid({c0:e,c1:r}){function n(o,s){return typeof o=="bigint"&&qc<=o&&o<s}return n(e,this.ORDER)&&n(r,this.ORDER)}is0({c0:e,c1:r}){return this.Fp.is0(e)&&this.Fp.is0(r)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}eql({c0:e,c1:r},{c0:n,c1:o}){return this.Fp.eql(e,n)&&this.Fp.eql(r,o)}neg({c0:e,c1:r}){return{c0:this.Fp.neg(e),c1:this.Fp.neg(r)}}pow(e,r){return Ln(this,e,r)}invertBatch(e){return je(this,e)}add(e,r){let{c0:n,c1:o}=e,{c0:s,c1:i}=r;return{c0:this.Fp.add(n,s),c1:this.Fp.add(o,i)}}sub({c0:e,c1:r},{c0:n,c1:o}){return{c0:this.Fp.sub(e,n),c1:this.Fp.sub(r,o)}}mul({c0:e,c1:r},n){let{Fp:o}=this;if(typeof n=="bigint")return{c0:o.mul(e,n),c1:o.mul(r,n)};let{c0:s,c1:i}=n,c=o.mul(e,s),a=o.mul(r,i),u=o.sub(c,a),l=o.sub(o.mul(o.add(e,r),o.add(s,i)),o.add(c,a));return{c0:u,c1:l}}sqr({c0:e,c1:r}){let{Fp:n}=this,o=n.add(e,r),s=n.sub(e,r),i=n.add(e,e);return{c0:n.mul(o,s),c1:n.mul(i,r)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}div(e,r){let{Fp:n}=this;return this.mul(e,typeof r=="bigint"?n.inv(n.create(r)):this.inv(r))}inv({c0:e,c1:r}){let{Fp:n}=this,o=n.inv(n.create(e*e+r*r));return{c0:n.mul(o,n.create(e)),c1:n.mul(o,n.create(-r))}}sqrt(e){let{Fp:r}=this,n=this,{c0:o,c1:s}=e;if(r.is0(s))return kn(r,o)===1?n.create({c0:r.sqrt(o),c1:r.ZERO}):n.create({c0:r.ZERO,c1:r.sqrt(r.div(o,this.Fp_NONRESIDUE))});let i=r.sqrt(r.sub(r.sqr(o),r.mul(r.sqr(s),this.Fp_NONRESIDUE))),c=r.mul(r.add(i,o),this.Fp_div2);kn(r,c)===-1&&(c=r.sub(c,i));let u=r.sqrt(c),l=n.create({c0:u,c1:r.div(r.mul(s,this.Fp_div2),u)});if(!n.eql(n.sqr(l),e))throw new Error("Cannot find square root");let d=l,f=n.neg(d),{re:h,im:p}=n.reim(d),{re:y,im:g}=n.reim(f);return p>g||p===g&&h>y?d:f}isOdd(e){let{re:r,im:n}=this.reim(e),o=r%Pe,s=r===qc,i=n%Pe;return BigInt(o||s&&i)==Lt}fromBytes(e){let{Fp:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);return{c0:r.fromBytes(e.subarray(0,r.BYTES)),c1:r.fromBytes(e.subarray(r.BYTES))}}toBytes({c0:e,c1:r}){return $(this.Fp.toBytes(e),this.Fp.toBytes(r))}cmov({c0:e,c1:r},{c0:n,c1:o},s){return{c0:this.Fp.cmov(e,n,s),c1:this.Fp.cmov(r,o,s)}}reim({c0:e,c1:r}){return{re:e,im:r}}Fp4Square(e,r){let n=this,o=n.sqr(e),s=n.sqr(r);return{first:n.add(n.mulByNonresidue(s),o),second:n.sub(n.sub(n.sqr(n.add(e,r)),o),s)}}mulByNonresidue({c0:e,c1:r}){return this.mul({c0:e,c1:r},this.NONRESIDUE)}frobeniusMap({c0:e,c1:r},n){return{c0:e,c1:this.Fp.mul(r,this.FROBENIUS_COEFFICIENTS[n%2])}}},pi=class{constructor(e){this.MASK=Lt,this.Fp2=e,this.ORDER=e.ORDER,this.BITS=3*e.BITS,this.BYTES=3*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO,c2:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO,c2:e.ZERO};let{Fp:r}=e,n=yi(e,e.NONRESIDUE,r.ORDER,6,2,3);this.FROBENIUS_COEFFICIENTS_1=n[0],this.FROBENIUS_COEFFICIENTS_2=n[1],Object.seal(this)}add({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:c}=this;return{c0:c.add(e,o),c1:c.add(r,s),c2:c.add(n,i)}}sub({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:c}=this;return{c0:c.sub(e,o),c1:c.sub(r,s),c2:c.sub(n,i)}}mul({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;if(typeof o=="bigint")return{c0:s.mul(e,o),c1:s.mul(r,o),c2:s.mul(n,o)};let{c0:i,c1:c,c2:a}=o,u=s.mul(e,i),l=s.mul(r,c),d=s.mul(n,a);return{c0:s.add(u,s.mulByNonresidue(s.sub(s.mul(s.add(r,n),s.add(c,a)),s.add(l,d)))),c1:s.add(s.sub(s.mul(s.add(e,r),s.add(i,c)),s.add(u,l)),s.mulByNonresidue(d)),c2:s.sub(s.add(l,s.mul(s.add(e,n),s.add(i,a))),s.add(u,d))}}sqr({c0:e,c1:r,c2:n}){let{Fp2:o}=this,s=o.sqr(e),i=o.mul(o.mul(e,r),Pe),c=o.mul(o.mul(r,n),Pe),a=o.sqr(n);return{c0:o.add(o.mulByNonresidue(c),s),c1:o.add(o.mulByNonresidue(a),i),c2:o.sub(o.sub(o.add(o.add(i,o.sqr(o.add(o.sub(e,r),n))),c),s),a)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}create(e){return e}isValid({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return o.isValid(e)&&o.isValid(r)&&o.isValid(n)}is0({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return o.is0(e)&&o.is0(r)&&o.is0(n)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return{c0:o.neg(e),c1:o.neg(r),c2:o.neg(n)}}eql({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:c}=this;return c.eql(e,o)&&c.eql(r,s)&&c.eql(n,i)}sqrt(e){return Xr()}div(e,r){let{Fp2:n}=this,{Fp:o}=n;return this.mul(e,typeof r=="bigint"?o.inv(o.create(r)):this.inv(r))}pow(e,r){return Ln(this,e,r)}invertBatch(e){return je(this,e)}inv({c0:e,c1:r,c2:n}){let{Fp2:o}=this,s=o.sub(o.sqr(e),o.mulByNonresidue(o.mul(n,r))),i=o.sub(o.mulByNonresidue(o.sqr(n)),o.mul(e,r)),c=o.sub(o.sqr(r),o.mul(e,n)),a=o.inv(o.add(o.mulByNonresidue(o.add(o.mul(n,i),o.mul(r,c))),o.mul(e,s)));return{c0:o.mul(a,s),c1:o.mul(a,i),c2:o.mul(a,c)}}fromBytes(e){let{Fp2:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);let n=r.BYTES;return{c0:r.fromBytes(e.subarray(0,n)),c1:r.fromBytes(e.subarray(n,n*2)),c2:r.fromBytes(e.subarray(2*n))}}toBytes({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return $(o.toBytes(e),o.toBytes(r),o.toBytes(n))}cmov({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i},c){let{Fp2:a}=this;return{c0:a.cmov(e,o,c),c1:a.cmov(r,s,c),c2:a.cmov(n,i,c)}}fromBigSix(e){let{Fp2:r}=this;if(!Array.isArray(e)||e.length!==6)throw new Error("invalid Fp6 usage");return{c0:r.fromBigTuple(e.slice(0,2)),c1:r.fromBigTuple(e.slice(2,4)),c2:r.fromBigTuple(e.slice(4,6))}}frobeniusMap({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.frobeniusMap(e,o),c1:s.mul(s.frobeniusMap(r,o),this.FROBENIUS_COEFFICIENTS_1[o%6]),c2:s.mul(s.frobeniusMap(n,o),this.FROBENIUS_COEFFICIENTS_2[o%6])}}mulByFp2({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.mul(e,o),c1:s.mul(r,o),c2:s.mul(n,o)}}mulByNonresidue({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return{c0:o.mulByNonresidue(n),c1:e,c2:r}}mul1({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.mulByNonresidue(s.mul(n,o)),c1:s.mul(e,o),c2:s.mul(r,o)}}mul01({c0:e,c1:r,c2:n},o,s){let{Fp2:i}=this,c=i.mul(e,o),a=i.mul(r,s);return{c0:i.add(i.mulByNonresidue(i.sub(i.mul(i.add(r,n),s),a)),c),c1:i.sub(i.sub(i.mul(i.add(o,s),i.add(e,r)),c),a),c2:i.add(i.sub(i.mul(i.add(e,n),o),c),a)}}},mi=class{constructor(e,r){this.MASK=Lt;let{Fp2:n}=e,{Fp:o}=n;this.Fp6=e,this.ORDER=n.ORDER,this.BITS=2*e.BITS,this.BYTES=2*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.FROBENIUS_COEFFICIENTS=yi(n,n.NONRESIDUE,o.ORDER,12,1,6)[0],this.X_LEN=r.X_LEN,this.finalExponentiate=r.Fp12finalExponentiate}create(e){return e}isValid({c0:e,c1:r}){let{Fp6:n}=this;return n.isValid(e)&&n.isValid(r)}is0({c0:e,c1:r}){let{Fp6:n}=this;return n.is0(e)&&n.is0(r)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:r}){let{Fp6:n}=this;return{c0:n.neg(e),c1:n.neg(r)}}eql({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return s.eql(e,n)&&s.eql(r,o)}sqrt(e){Xr()}inv({c0:e,c1:r}){let{Fp6:n}=this,o=n.inv(n.sub(n.sqr(e),n.mulByNonresidue(n.sqr(r))));return{c0:n.mul(e,o),c1:n.neg(n.mul(r,o))}}div(e,r){let{Fp6:n}=this,{Fp2:o}=n,{Fp:s}=o;return this.mul(e,typeof r=="bigint"?s.inv(s.create(r)):this.inv(r))}pow(e,r){return Ln(this,e,r)}invertBatch(e){return je(this,e)}add({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return{c0:s.add(e,n),c1:s.add(r,o)}}sub({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return{c0:s.sub(e,n),c1:s.sub(r,o)}}mul({c0:e,c1:r},n){let{Fp6:o}=this;if(typeof n=="bigint")return{c0:o.mul(e,n),c1:o.mul(r,n)};let{c0:s,c1:i}=n,c=o.mul(e,s),a=o.mul(r,i);return{c0:o.add(c,o.mulByNonresidue(a)),c1:o.sub(o.mul(o.add(e,r),o.add(s,i)),o.add(c,a))}}sqr({c0:e,c1:r}){let{Fp6:n}=this,o=n.mul(e,r);return{c0:n.sub(n.sub(n.mul(n.add(n.mulByNonresidue(r),e),n.add(e,r)),o),n.mulByNonresidue(o)),c1:n.add(o,o)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}fromBytes(e){let{Fp6:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);return{c0:r.fromBytes(e.subarray(0,r.BYTES)),c1:r.fromBytes(e.subarray(r.BYTES))}}toBytes({c0:e,c1:r}){let{Fp6:n}=this;return $(n.toBytes(e),n.toBytes(r))}cmov({c0:e,c1:r},{c0:n,c1:o},s){let{Fp6:i}=this;return{c0:i.cmov(e,n,s),c1:i.cmov(r,o,s)}}fromBigTwelve(e){let{Fp6:r}=this;return{c0:r.fromBigSix(e.slice(0,6)),c1:r.fromBigSix(e.slice(6,12))}}frobeniusMap(e,r){let{Fp6:n}=this,{Fp2:o}=n,{c0:s,c1:i,c2:c}=n.frobeniusMap(e.c1,r),a=this.FROBENIUS_COEFFICIENTS[r%12];return{c0:n.frobeniusMap(e.c0,r),c1:n.create({c0:o.mul(s,a),c1:o.mul(i,a),c2:o.mul(c,a)})}}mulByFp2({c0:e,c1:r},n){let{Fp6:o}=this;return{c0:o.mulByFp2(e,n),c1:o.mulByFp2(r,n)}}conjugate({c0:e,c1:r}){return{c0:e,c1:this.Fp6.neg(r)}}mul014({c0:e,c1:r},n,o,s){let{Fp6:i}=this,{Fp2:c}=i,a=i.mul01(e,n,o),u=i.mul1(r,s);return{c0:i.add(i.mulByNonresidue(u),a),c1:i.sub(i.sub(i.mul01(i.add(r,e),n,c.add(o,s)),a),u)}}mul034({c0:e,c1:r},n,o,s){let{Fp6:i}=this,{Fp2:c}=i,a=i.create({c0:c.mul(e.c0,n),c1:c.mul(e.c1,n),c2:c.mul(e.c2,n)}),u=i.mul01(r,o,s),l=i.mul01(i.add(e,r),c.add(n,o),s);return{c0:i.add(i.mulByNonresidue(u),a),c1:i.sub(l,i.add(a,u))}}_cyclotomicSquare({c0:e,c1:r}){let{Fp6:n}=this,{Fp2:o}=n,{c0:s,c1:i,c2:c}=e,{c0:a,c1:u,c2:l}=r,{first:d,second:f}=o.Fp4Square(s,u),{first:h,second:p}=o.Fp4Square(a,c),{first:y,second:g}=o.Fp4Square(i,l),m=o.mulByNonresidue(g);return{c0:n.create({c0:o.add(o.mul(o.sub(d,s),Pe),d),c1:o.add(o.mul(o.sub(h,i),Pe),h),c2:o.add(o.mul(o.sub(y,c),Pe),y)}),c1:n.create({c0:o.add(o.mul(o.add(m,a),Pe),m),c1:o.add(o.mul(o.add(f,u),Pe),f),c2:o.add(o.mul(o.add(p,l),Pe),p)})}}_cyclotomicExp(e,r){let n=this.ONE;for(let o=this.X_LEN-1;o>=0;o--)n=this._cyclotomicSquare(n),bc(r,o)&&(n=this.mul(n,e));return n}};function jc(t){let e=Re(t.ORDER),r=new hi(e,t),n=new pi(r),o=new mi(n,t);return{Fp:e,Fp2:r,Fp6:n,Fp12:o}}var ve=BigInt(0),Jo=BigInt(1),He=BigInt(2),Qo=BigInt(3),$n=BigInt(4),sr=BigInt("0xd201000000010000"),Yu=Pt(sr),Ar={p:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),n:BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001"),h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),a:ve,b:$n,Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1")},Wu=Re(Ar.n,{modFromBytes:!0,isLE:!0}),{Fp:D,Fp2:H,Fp6:zu,Fp12:Y}=jc({ORDER:Ar.p,X_LEN:Yu,FP2_NONRESIDUE:[Jo,Jo],Fp2mulByB:({c0:t,c1:e})=>{let r=D.mul(t,$n),n=D.mul(e,$n);return{c0:D.sub(r,n),c1:D.add(r,n)}},Fp12finalExponentiate:t=>{let e=sr,r=Y.div(Y.frobeniusMap(t,6),t),n=Y.mul(Y.frobeniusMap(r,2),r),o=Y.conjugate(Y._cyclotomicExp(n,e)),s=Y.mul(Y.conjugate(Y._cyclotomicSquare(n)),o),i=Y.conjugate(Y._cyclotomicExp(s,e)),c=Y.conjugate(Y._cyclotomicExp(i,e)),a=Y.mul(Y.conjugate(Y._cyclotomicExp(c,e)),Y._cyclotomicSquare(o)),u=Y.conjugate(Y._cyclotomicExp(a,e)),l=Y.frobeniusMap(Y.mul(o,c),2),d=Y.frobeniusMap(Y.mul(i,n),3),f=Y.frobeniusMap(Y.mul(a,Y.conjugate(n)),1),h=Y.mul(Y.mul(u,Y.conjugate(s)),n);return Y.mul(Y.mul(Y.mul(l,d),f),h)}}),{G2psi:Kc,G2psi2:Xu}=Vc(D,H,H.div(H.ONE,H.NONRESIDUE)),bi=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:D.ORDER,m:2,k:128,expand:"xmd",hash:Ie}),xi={p:H.ORDER,n:Ar.n,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),a:H.ZERO,b:H.fromBigTuple([$n,$n]),Gx:H.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:H.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")])},es=Vn(D.toBytes(ve),{infinity:!0,compressed:!0});function ts(t){t=t.slice();let e=t[0]&224,r=!!(e>>7&1),n=!!(e>>6&1),o=!!(e>>5&1);return t[0]&=31,{compressed:r,infinity:n,sort:o,value:t}}function Vn(t,e){if(t[0]&224)throw new Error("setMask: non-empty mask");return e.compressed&&(t[0]|=128),e.infinity&&(t[0]|=64),e.sort&&(t[0]|=32),t}function Ju(t,e,r){let{BYTES:n,ORDER:o}=D,s=e.is0(),{x:i,y:c}=e.toAffine();if(r){if(s)return es.slice();let a=!!(c*He/o);return Vn(he(i,n),{compressed:!0,sort:a})}else return s?$(Uint8Array.of(64),new Uint8Array(2*n-1)):$(he(i,n),he(c,n))}function gi(t){t.assertValidity();let{BYTES:e,ORDER:r}=D,{x:n,y:o}=t.toAffine();if(t.is0())return es.slice();let s=!!(o*He/r);return Vn(he(n,e),{compressed:!0,sort:s})}function Qu(t){let{compressed:e,infinity:r,sort:n,value:o}=ts(t),{BYTES:s,ORDER:i}=D;if(o.length===48&&e){let c=Le(o),a=D.create(c&nt(D.BITS));if(r){if(a!==ve)throw new Error("invalid G1 point: non-empty, at infinity, with compression");return{x:ve,y:ve}}let u=D.add(D.pow(a,Qo),D.create(Ar.b)),l=D.sqrt(u);if(!l)throw new Error("invalid G1 point: compressed point");return l*He/i!==BigInt(n)&&(l=D.neg(l)),{x:D.create(a),y:D.create(l)}}else if(o.length===96&&!e){let c=Le(o.subarray(0,s)),a=Le(o.subarray(s));if(r){if(c!==ve||a!==ve)throw new Error("G1: non-empty point at infinity");return jn.G1.Point.ZERO.toAffine()}return{x:D.create(c),y:D.create(a)}}else throw new Error("invalid G1 point: expected 48/96 bytes")}function Hc(t){let{infinity:e,sort:r,value:n}=ts(ne("signatureHex",t,48)),o=D.ORDER,s=jn.G1.Point,i=Le(n);if(e)return s.ZERO;let c=D.create(i&nt(D.BITS)),a=D.add(D.pow(c,Qo),D.create(Ar.b)),u=D.sqrt(a);if(!u)throw new Error("invalid G1 point: compressed");let l=BigInt(r);u*He/o!==l&&(u=D.neg(u));let d=s.fromAffine({x:c,y:u});return d.assertValidity(),d}function ed(t,e,r){let{BYTES:n,ORDER:o}=D,s=e.is0(),{x:i,y:c}=e.toAffine();if(r){if(s)return $(es,he(ve,n));let a=!!(c.c1===ve?c.c0*He/o:c.c1*He/o);return $(Vn(he(i.c1,n),{compressed:!0,sort:a}),he(i.c0,n))}else{if(s)return $(Uint8Array.of(64),new Uint8Array(4*n-1));let{re:a,im:u}=H.reim(i),{re:l,im:d}=H.reim(c);return $(he(u,n),he(a,n),he(d,n),he(l,n))}}function wi(t){t.assertValidity();let{BYTES:e}=D;if(t.is0())return $(es,he(ve,e));let{x:r,y:n}=t.toAffine(),{re:o,im:s}=H.reim(r),{re:i,im:c}=H.reim(n),u=!!((c>ve?c*He:i*He)/D.ORDER&Jo),l=o;return $(Vn(he(s,e),{sort:u,compressed:!0}),he(l,e))}function td(t){let{BYTES:e,ORDER:r}=D,{compressed:n,infinity:o,sort:s,value:i}=ts(t);if(!n&&!o&&s||!n&&o&&s||s&&o&&n)throw new Error("invalid encoding flag: "+(t[0]&224));let c=(a,u,l)=>Le(a.slice(u,l));if(i.length===96&&n){if(o){if(i.reduce((p,y)=>p!==0?y+1:y,0)>0)throw new Error("invalid G2 point: compressed");return{x:H.ZERO,y:H.ZERO}}let a=c(i,0,e),u=c(i,e,2*e),l=H.create({c0:D.create(u),c1:D.create(a)}),d=H.add(H.pow(l,Qo),xi.b),f=H.sqrt(d),h=f.c1===ve?f.c0*He/r:f.c1*He/r?Jo:ve;return f=s&&h>0?f:H.neg(f),{x:l,y:f}}else if(i.length===192&&!n){if(o){if(i.reduce((f,h)=>f!==0?h+1:h,0)>0)throw new Error("invalid G2 point: uncompressed");return{x:H.ZERO,y:H.ZERO}}let a=c(i,0*e,1*e),u=c(i,1*e,2*e),l=c(i,2*e,3*e),d=c(i,3*e,4*e);return{x:H.fromBigTuple([u,a]),y:H.fromBigTuple([d,l])}}else throw new Error("invalid G2 point: expected 96/192 bytes")}function Gc(t){let{ORDER:e}=D,{infinity:r,sort:n,value:o}=ts(ne("signatureHex",t)),s=jn.G2.Point,i=o.length/2;if(i!==48&&i!==96)throw new Error("invalid compressed signature length, expected 96/192 bytes");let c=Le(o.slice(0,i)),a=Le(o.slice(i));if(r)return s.ZERO;let u=D.create(c&nt(D.BITS)),l=D.create(a),d=H.create({c0:l,c1:u}),f=H.add(H.pow(d,Qo),xi.b),h=H.sqrt(f);if(!h)throw new Error("Failed to find a square root");let{re:p,im:y}=H.reim(h),g=BigInt(n),m=y>ve&&y*He/e!==g,w=y===ve&&p*He/e!==g;(m||w)&&(h=H.neg(h));let b=s.fromAffine({x:d,y:h});return b.assertValidity(),b}var jn=Mc({fields:{Fp:D,Fp2:H,Fp6:zu,Fp12:Y,Fr:Wu},G1:{...Ar,Fp:D,htfDefaults:{...bi,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(t,e)=>{let r=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),n=new t(D.mul(e.X,r),e.Y,e.Z);return e.multiplyUnsafe(sr).negate().multiplyUnsafe(sr).equals(n)},clearCofactor:(t,e)=>e.multiplyUnsafe(sr).add(e),mapToCurve:id,fromBytes:Qu,toBytes:Ju,ShortSignature:{fromBytes(t){return se(t),Hc(t)},fromHex(t){return Hc(t)},toBytes(t){return gi(t)},toRawBytes(t){return gi(t)},toHex(t){return F(gi(t))}}},G2:{...xi,Fp:H,hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...bi},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:ad,isTorsionFree:(t,e)=>e.multiplyUnsafe(sr).negate().equals(Kc(t,e)),clearCofactor:(t,e)=>{let r=sr,n=e.multiplyUnsafe(r).negate(),o=Kc(t,e),s=e.double();return s=Xu(t,s),s=s.subtract(o),o=n.add(o),o=o.multiplyUnsafe(r).negate(),s=s.add(o),s=s.subtract(n),s.subtract(e)},fromBytes:td,toBytes:ed,Signature:{fromBytes(t){return se(t),Gc(t)},fromHex(t){return Gc(t)},toBytes(t){return wi(t)},toRawBytes(t){return wi(t)},toHex(t){return F(wi(t))}}},params:{ateLoopSize:sr,r:Ar.n,xNegative:!0,twistType:"multiplicative"},htfDefaults:bi,hash:Ie}),rd=ai(H,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(t=>t.map(e=>H.fromBigTuple(e.map(BigInt))))),nd=ai(D,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(e=>BigInt(e)))),od=ui(D,{A:D.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:D.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:D.create(BigInt(11))}),sd=ui(H,{A:H.create({c0:D.create(ve),c1:D.create(BigInt(240))}),B:H.create({c0:D.create(BigInt(1012)),c1:D.create(BigInt(1012))}),Z:H.create({c0:D.create(BigInt(-2)),c1:D.create(BigInt(-1))})});function id(t){let{x:e,y:r}=od(D.create(t[0]));return nd(e,r)}function ad(t){let{x:e,y:r}=sd(H.fromBigTuple(t));return rd(e,r)}function Zc(t,e,r){let n=typeof t=="string"?t:F(t),o=typeof e=="string"?e:F(e),s=typeof r=="string"?r:F(r);return jn.verifyShortSignature(o,s,n)}var fd=BigInt(1e6),_i=t=>ae(new Je(t)),nn=t=>{let r=_i(t)/fd;return new Date(Number(r))};var Yc=60*1e3,ud=60,dd=24,ld=dd*ud,hd=5,pd=5,md=30*ld,_e;(function(t){t[t.Empty=0]="Empty",t[t.Fork=1]="Fork",t[t.Labeled=2]="Labeled",t[t.Leaf=3]="Leaf",t[t.Pruned=4]="Pruned"})(_e||(_e={}));function yd(t,e){for(let r=0;r<t.length;r++)if(t[r]>e[r])return!0;return!1}var ir=class t{#e=!1;#t=void 0;static async create(e){let r=t.createUnverified(e);return await r.verify(),r}static createUnverified(e){return new t(e.certificate,e.rootKey,e.canisterId,e.blsVerify??Zc,e.maxAgeInMinutes,e.disableTimeVerification,e.agent)}constructor(e,r,n,o,s=hd,i=!1,c){this._rootKey=r,this._canisterId=n,this._blsVerify=o,this._maxAgeInMinutes=s,this.#e=i,this.cert=Fe(e),c&&"getTimeDiffMsecs"in c&&"hasSyncedTime"in c&&"syncTime"in c&&(this.#t=c)}lookup_path(e){return Cr(e,this.cert.tree)}lookup_subtree(e){return os(e,this.cert.tree)}async verify(){let e=await rs(this.cert.tree),r=await this._checkDelegationAndGetKey(this.cert.delegation),n=this.cert.signature,o=gd(r),s=$(Hn("ic-state-root"),e),i=Be(this.lookup_path(["time"]));if(!i)throw Q.fromCode(new Zt("Certificate does not contain a time"));if(!this.#e){let c=this.#t?.getTimeDiffMsecs()??0,a=this._maxAgeInMinutes*Yc,u=new Date,l=u.getTime()+c,d=l-a,f=l+pd*Yc,h=nn(i),p=h.getTime()<d,y=h.getTime()>f;if((p||y)&&this.#t&&!this.#t.hasSyncedTime())return await this.#t.syncTime(this._canisterId),await this.verify();if(p)throw Se.fromCode(new pr(this._maxAgeInMinutes,h,u,c,"past"));if(y)throw this.#t?.hasSyncedTime()?ue.fromCode(new Ae("System time has been synced with the IC network, but certificate is still too far in the future.")):Se.fromCode(new pr(5,h,u,c,"future"))}try{if(!await this._blsVerify(o,n,s))throw Se.fromCode(new Zt("Invalid signature"))}catch(c){throw Se.fromCode(new Zt("Signature verification failed",c))}}async _checkDelegationAndGetKey(e){if(!e)return this._rootKey;let r=t.createUnverified({certificate:e.certificate,rootKey:this._rootKey,canisterId:this._canisterId,blsVerify:this._blsVerify,disableTimeVerification:this.#e,maxAgeInMinutes:md,agent:this.#t});if(r.cert.delegation)throw Q.fromCode(new mo);await r.verify();let n=e.subnet_id,o=M.fromUint8Array(n);if(!Ei({canisterId:this._canisterId,subnetId:o,tree:r.cert.tree}))throw Se.fromCode(new Lr(this._canisterId,o));let i=Be(r.lookup_path(["subnet",n,"public_key"]));if(!i)throw Se.fromCode(new yo(`Could not find subnet key for subnet ID ${o.toText()}`));return i}},Kn=me("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100"),bd=96;function gd(t){let e=Kn.byteLength+bd;if(t.byteLength!==e)throw Q.fromCode(new qr(e,t.byteLength));let r=t.slice(0,Kn.byteLength);if(!_r(r,Kn))throw Q.fromCode(new bo(Kn,r));return t.slice(Kn.byteLength)}function Be(t){if(t.status===Me.Found&&t.value instanceof Uint8Array)return t.value}async function rs(t){switch(t[0]){case _e.Empty:return Ie(Hn("ic-hashtree-empty"));case _e.Pruned:return t[1];case _e.Leaf:return Ie($(Hn("ic-hashtree-leaf"),t[1]));case _e.Labeled:return Ie($(Hn("ic-hashtree-labeled"),t[1],await rs(t[2])));case _e.Fork:return Ie($(Hn("ic-hashtree-fork"),await rs(t[1]),await rs(t[2])));default:throw zt}}function Hn(t){let e=new Uint8Array([t.length]),r=new TextEncoder().encode(t);return $(e,r)}function Wc(t){return typeof t[0]=="string"?X(t[0]):t[0]}var Me;(function(t){t.Unknown="Unknown",t.Absent="Absent",t.Found="Found",t.Error="Error"})(Me||(Me={}));var Or;(function(t){t.Absent="Absent",t.Unknown="Unknown",t.Found="Found"})(Or||(Or={}));var re;(function(t){t.Absent="Absent",t.Unknown="Unknown",t.Found="Found",t.Less="Less",t.Greater="Greater"})(re||(re={}));function Cr(t,e){if(t.length===0)switch(e[0]){case _e.Empty:return{status:Me.Absent};case _e.Leaf:{if(!e[1])throw ue.fromCode(new Wt("Invalid tree structure for leaf"));if(e[1]instanceof Uint8Array)return{status:Me.Found,value:e[1].slice(e[1].byteOffset,e[1].byteLength+e[1].byteOffset)};throw zt}case _e.Pruned:return{status:Me.Unknown};case _e.Labeled:case _e.Fork:return{status:Me.Error};default:throw zt}let r=Wc(t),n=Gn(r,e);switch(n.status){case re.Found:return Cr(t.slice(1),n.value);case re.Absent:case re.Greater:case re.Less:return{status:Me.Absent};case re.Unknown:return{status:Me.Unknown};default:throw zt}}function os(t,e){if(t.length===0)return{status:Or.Found,value:e};let r=Wc(t),n=Gn(r,e);switch(n.status){case re.Found:return os(t.slice(1),n.value);case re.Unknown:return{status:Or.Unknown};case re.Absent:case re.Greater:case re.Less:return{status:Or.Absent};default:throw zt}}function ns(t){switch(t[0]){case _e.Empty:return[];case _e.Fork:return ns(t[1]).concat(ns(t[2]));default:return[t]}}function Gn(t,e){switch(e[0]){case _e.Labeled:return yd(t,e[1])?{status:re.Greater}:_r(t,e[1])?{status:re.Found,value:e[2]}:{status:re.Less};case _e.Fork:{let r=Gn(t,e[1]);switch(r.status){case re.Greater:{let n=Gn(t,e[2]);return n.status===re.Less?{status:re.Absent}:n}case re.Unknown:{let n=Gn(t,e[2]);return n.status===re.Less?{status:re.Unknown}:n}default:return r}}case _e.Pruned:return{status:re.Unknown};default:return{status:re.Absent}}}function Ei(t){let{canisterId:e,subnetId:r,tree:n}=t,o=Cr(["subnet",r.toUint8Array(),"canister_ranges"],n);if(o.status!==Me.Found)throw Q.fromCode(new Bt(`Could not find canister ranges for subnet ${r.toText()}`,o.status));if(!(o.value instanceof Uint8Array))throw Q.fromCode(new Mr(`Could not find canister ranges for subnet ${r.toText()}`));return Fe(o.value).map(a=>[M.fromUint8Array(a[0]),M.fromUint8Array(a[1])]).some(a=>a[0].ltEq(e)&&a[1].gtEq(e))}var Ii=async t=>{let{agent:e,paths:r,disableCertificateTimeVerification:n=!1}=t,o=M.from(t.canisterId),s=[...new Set(r)],i=new Map,c=s.map((a,u)=>{let l=xd(a,o);return(async()=>{try{if(e.rootKey===null)throw ye.fromCode(new dt);let d=e.rootKey,f=await e.readState(o,{paths:[l]}),h=await ir.create({certificate:f.certificate,rootKey:d,canisterId:o,disableTimeVerification:n,agent:e}),p=(m,w)=>{if(w==="subnet"){let b=wd(f.certificate,o,d);return{path:w,data:b}}else return{path:w,data:Be(m.lookup_path(l))}},{path:y,data:g}=p(h,s[u]);if(!g)console.warn(`Expected to find result for path ${y}, but instead found nothing.`),typeof y=="string"?i.set(y,null):i.set(y.key,null);else switch(y){case"time":{i.set(y,nn(g));break}case"controllers":{i.set(y,_d(g));break}case"module_hash":{i.set(y,F(g));break}case"subnet":{i.set(y,g);break}case"candid":{i.set(y,new TextDecoder().decode(g));break}default:if(typeof y!="string"&&"key"in y&&"path"in y)switch(y.decodeStrategy){case"raw":i.set(y.key,g);break;case"leb128":{i.set(y.key,_i(g));break}case"cbor":{i.set(y.key,Fe(g));break}case"hex":{i.set(y.key,F(g));break}case"utf-8":i.set(y.key,new TextDecoder().decode(g))}}}catch(d){if(d instanceof ze&&(d.hasCode(Zt)||d.hasCode(pr)))throw d;typeof a!="string"&&"key"in a&&"path"in a?i.set(a.key,null):i.set(a,null),console.group(),console.warn(`Expected to find result for path ${a}, but instead found nothing.`),console.warn(d),console.groupEnd()}})()});return await Promise.all(c),i},wd=(t,e,r)=>{if(!e._isPrincipal)throw G.fromCode(new Ae("Invalid canisterId"));let n=Fe(t),o=n.tree,s=n.delegation,i;if(s&&s.subnet_id?i=M.fromUint8Array(new Uint8Array(s.subnet_id)):!s&&typeof r<"u"?(i=M.selfAuthenticating(new Uint8Array(r)),s={subnet_id:i.toUint8Array(),certificate:new Uint8Array(0)}):(i=M.selfAuthenticating(M.fromText("tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe").toUint8Array()),s={subnet_id:i.toUint8Array(),certificate:new Uint8Array(0)}),!Ei({canisterId:e,subnetId:i,tree:o}))throw Se.fromCode(new Lr(e,i));let a=os(["subnet",s.subnet_id,"node"],o);if(a.status!==Or.Found)throw Q.fromCode(new Bt("Node not found",a.status));if(a.value instanceof Uint8Array)throw ue.fromCode(new Wt("Invalid node tree"));let u=ns(a.value),l=new Map;return u.forEach(d=>{let f=M.from(d[1]).toText(),h=Cr(["public_key"],d[2]);if(h.status!==Me.Found)throw Q.fromCode(new Bt("Public key not found",h.status));let p=h.value;if(p.byteLength!==44)throw Q.fromCode(new qr(44,p.byteLength));l.set(f,p)}),{subnetId:M.fromUint8Array(new Uint8Array(s.subnet_id)).toText(),nodeKeys:l}},xd=(t,e)=>{let r=e.toUint8Array();switch(t){case"time":return[X("time")];case"controllers":return[X("canister"),r,X("controllers")];case"module_hash":return[X("canister"),r,X("module_hash")];case"subnet":return[X("subnet")];case"candid":return[X("canister"),r,X("metadata"),X("candid:service")];default:if("key"in t&&"path"in t)if(typeof t.path=="string"||t.path instanceof Uint8Array){let n=t.path,o=typeof n=="string"?X(n):n;return[X("canister"),r,X("metadata"),o]}else return t.path}throw ue.fromCode(new Ae(`Error while encoding your path for canister status. Please ensure that your path ${t} was formatted correctly.`))},_d=t=>Fe(t).map(r=>M.fromUint8Array(r));var ar=BigInt(0),ge=BigInt(1),vi=BigInt(2),Ed=BigInt(8);function Id(t,e,r,n){let o=t.sqr(r),s=t.sqr(n),i=t.add(t.mul(e.a,o),s),c=t.add(t.ONE,t.mul(e.d,t.mul(o,s)));return t.eql(i,c)}function vd(t,e={}){let r=zo("edwards",t,e,e.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;Ut(e,{},{uvRatio:"function"});let c=vi<<BigInt(o.BYTES*8)-ge,a=g=>n.create(g),u=e.uvRatio||((g,m)=>{try{return{isValid:!0,value:n.sqrt(n.div(g,m))}}catch{return{isValid:!1,value:ar}}});if(!Id(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function l(g,m,w=!1){let b=w?ge:ar;return Zo("coordinate "+g,m,b,c),m}function d(g){if(!(g instanceof p))throw new Error("ExtendedPoint expected")}let f=nr((g,m)=>{let{X:w,Y:b,Z:E}=g,v=g.is0();m==null&&(m=v?Ed:n.inv(E));let T=a(w*m),B=a(b*m),A=n.mul(E,m);if(v)return{x:ar,y:ge};if(A!==ge)throw new Error("invZ was invalid");return{x:T,y:B}}),h=nr(g=>{let{a:m,d:w}=s;if(g.is0())throw new Error("bad point: ZERO");let{X:b,Y:E,Z:v,T}=g,B=a(b*b),A=a(E*E),_=a(v*v),S=a(_*_),P=a(B*m),C=a(_*a(P+A)),x=a(S+a(w*a(B*A)));if(C!==x)throw new Error("bad point: equation left != right (1)");let I=a(b*E),R=a(v*T);if(I!==R)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(m,w,b,E){this.X=l("x",m),this.Y=l("y",w),this.Z=l("z",b,!0),this.T=l("t",E),Object.freeze(this)}static CURVE(){return s}static fromAffine(m){if(m instanceof p)throw new Error("extended point not allowed");let{x:w,y:b}=m||{};return l("x",w),l("y",b),new p(w,b,ge,a(w*b))}static fromBytes(m,w=!1){let b=n.BYTES,{a:E,d:v}=s;m=Js(rr(m,b,"point")),vr(w,"zip215");let T=Js(m),B=m[b-1];T[b-1]=B&-129;let A=Nt(T),_=w?c:n.ORDER;Zo("point.y",A,ar,_);let S=a(A*A),P=a(S-ge),C=a(v*S-E),{isValid:x,value:I}=u(P,C);if(!x)throw new Error("bad point: invalid y coordinate");let R=(I&ge)===ge,k=(B&128)!==0;if(!w&&I===ar&&k)throw new Error("bad point: x=0 and x_0=1");return k!==R&&(I=a(-I)),p.fromAffine({x:I,y:A})}static fromHex(m,w=!1){return p.fromBytes(ne("point",m),w)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,w=!0){return y.createCache(this,m),w||this.multiply(vi),this}assertValidity(){h(this)}equals(m){d(m);let{X:w,Y:b,Z:E}=this,{X:v,Y:T,Z:B}=m,A=a(w*B),_=a(v*E),S=a(b*B),P=a(T*E);return A===_&&S===P}is0(){return this.equals(p.ZERO)}negate(){return new p(a(-this.X),this.Y,this.Z,a(-this.T))}double(){let{a:m}=s,{X:w,Y:b,Z:E}=this,v=a(w*w),T=a(b*b),B=a(vi*a(E*E)),A=a(m*v),_=w+b,S=a(a(_*_)-v-T),P=A+T,C=P-B,x=A-T,I=a(S*C),R=a(P*x),k=a(S*x),j=a(C*P);return new p(I,R,j,k)}add(m){d(m);let{a:w,d:b}=s,{X:E,Y:v,Z:T,T:B}=this,{X:A,Y:_,Z:S,T:P}=m,C=a(E*A),x=a(v*_),I=a(B*b*P),R=a(T*S),k=a((E+v)*(A+_)-C-x),j=R-I,O=R+I,N=a(x-w*C),U=a(k*j),L=a(O*N),q=a(k*N),we=a(j*O);return new p(U,L,we,q)}subtract(m){return this.add(m.negate())}multiply(m){if(!o.isValidNot0(m))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:w,f:b}=y.cached(this,m,E=>Ke(p,E));return Ke(p,[w,b])[0]}multiplyUnsafe(m,w=p.ZERO){if(!o.isValid(m))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return m===ar?p.ZERO:this.is0()||m===ge?this:y.unsafe(this,m,b=>Ke(p,b),w)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return y.unsafe(this,s.n).is0()}toAffine(m){return f(this,m)}clearCofactor(){return i===ge?this:this.multiplyUnsafe(i)}toBytes(){let{x:m,y:w}=this.toAffine(),b=n.toBytes(w);return b[b.length-1]|=m&ge?128:0,b}toHex(){return F(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(m){return Ke(p,m)}static msm(m,w){return en(p,o,m,w)}_setWindowSize(m){this.precompute(m)}toRawBytes(){return this.toBytes()}}p.BASE=new p(s.Gx,s.Gy,ge,a(s.Gx*s.Gy)),p.ZERO=new p(ar,ge,ge,ar),p.Fp=n,p.Fn=o;let y=new Qr(p,o.BITS);return p.BASE.precompute(8),p}var ss=class{constructor(e){this.ep=e}static fromBytes(e){Xr()}static fromHex(e){Xr()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(e){return this.ep.toAffine(e)}toHex(){return F(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(e){return this.assertSame(e),this.init(this.ep.add(e.ep))}subtract(e){return this.assertSame(e),this.init(this.ep.subtract(e.ep))}multiply(e){return this.init(this.ep.multiply(e))}multiplyUnsafe(e){return this.init(this.ep.multiplyUnsafe(e))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(e,r){return this.init(this.ep.precompute(e,r))}toRawBytes(){return this.toBytes()}};function Bd(t,e,r={}){if(typeof e!="function")throw new Error('"hash" function param is required');Ut(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=t,c=r.randomBytes||kr,a=r.adjustScalarBytes||(_=>_),u=r.domain||((_,S,P)=>{if(vr(P,"phflag"),S.length||P)throw new Error("Contexts/pre-hash are not supported");return _});function l(_){return i.create(Nt(_))}function d(_){let S=b.secretKey;_=ne("private key",_,S);let P=ne("hashed private key",e(_),2*S),C=a(P.slice(0,S)),x=P.slice(S,2*S),I=l(C);return{head:C,prefix:x,scalar:I}}function f(_){let{head:S,prefix:P,scalar:C}=d(_),x=o.multiply(C),I=x.toBytes();return{head:S,prefix:P,scalar:C,point:x,pointBytes:I}}function h(_){return f(_).pointBytes}function p(_=Uint8Array.of(),...S){let P=$(...S);return l(e(u(P,ne("context",_),!!n)))}function y(_,S,P={}){_=ne("message",_),n&&(_=n(_));let{prefix:C,scalar:x,pointBytes:I}=f(S),R=p(P.context,C,_),k=o.multiply(R).toBytes(),j=p(P.context,k,I,_),O=i.create(R+j*x);if(!i.isValid(O))throw new Error("sign failed: invalid s");let N=$(k,i.toBytes(O));return rr(N,b.signature,"result")}let g={zip215:!0};function m(_,S,P,C=g){let{context:x,zip215:I}=C,R=b.signature;_=ne("signature",_,R),S=ne("message",S),P=ne("publicKey",P,b.publicKey),I!==void 0&&vr(I,"zip215"),n&&(S=n(S));let k=R/2,j=_.subarray(0,k),O=Nt(_.subarray(k,R)),N,U,L;try{N=t.fromBytes(P,I),U=t.fromBytes(j,I),L=o.multiplyUnsafe(O)}catch{return!1}if(!I&&N.isSmallOrder())return!1;let q=p(x,U.toBytes(),N.toBytes(),S);return U.add(N.multiplyUnsafe(q)).subtract(L).clearCofactor().is0()}let w=s.BYTES,b={secretKey:w,publicKey:w,signature:2*w,seed:w};function E(_=c(b.seed)){return rr(_,b.seed,"seed")}function v(_){let S=A.randomSecretKey(_);return{secretKey:S,publicKey:h(S)}}function T(_){return ft(_)&&_.length===i.BYTES}function B(_,S){try{return!!t.fromBytes(_,S)}catch{return!1}}let A={getExtendedPublicKey:f,randomSecretKey:E,isValidSecretKey:T,isValidPublicKey:B,toMontgomery(_){let{y:S}=t.fromBytes(_),P=b.publicKey,C=P===32;if(!C&&P!==57)throw new Error("only defined for 25519 and 448");let x=C?s.div(ge+S,ge-S):s.div(S-ge,S+ge);return s.toBytes(x)},toMontgomeryPriv(_){let S=b.secretKey;rr(_,S);let P=e(_.subarray(0,S));return a(P).subarray(0,S)},randomPrivateKey:E,precompute(_=8,S=t.BASE){return S.precompute(_,!1)}};return Object.freeze({keygen:v,getPublicKey:h,sign:y,verify:m,utils:A,Point:t,lengths:b})}function Td(t){let e={a:t.a,d:t.d,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=Re(e.n,t.nBitLength,!0),o={Fp:r,Fn:n,uvRatio:t.uvRatio},s={randomBytes:t.randomBytes,adjustScalarBytes:t.adjustScalarBytes,domain:t.domain,prehash:t.prehash,mapToCurve:t.mapToCurve};return{CURVE:e,curveOpts:o,hash:t.hash,eddsaOpts:s}}function Sd(t,e){let r=e.Point;return Object.assign({},e,{ExtendedPoint:r,CURVE:t,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}function zc(t){let{CURVE:e,curveOpts:r,hash:n,eddsaOpts:o}=Td(t),s=vd(e,r),i=Bd(s,n,o);return Sd(t,i)}var Ad=BigInt(0),Mt=BigInt(1),Xc=BigInt(2),sp=BigInt(3),Od=BigInt(5),Cd=BigInt(8),on=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Zn={p:on,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Cd,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Rd(t){let e=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=on,c=t*t%s*t%s,a=ot(c,Xc,s)*c%s,u=ot(a,Mt,s)*t%s,l=ot(u,Od,s)*u%s,d=ot(l,e,s)*l%s,f=ot(d,r,s)*d%s,h=ot(f,n,s)*f%s,p=ot(h,o,s)*h%s,y=ot(p,o,s)*h%s,g=ot(y,e,s)*l%s;return{pow_p_5_8:ot(g,Xc,s)*t%s,b2:c}}function Nd(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}var Bi=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Ai(t,e){let r=on,n=te(e*e*e,r),o=te(n*n*e,r),s=Rd(t*o).pow_p_5_8,i=te(t*n*s,r),c=te(e*i*i,r),a=i,u=te(i*Bi,r),l=c===t,d=c===te(-t,r),f=c===te(-t*Bi,r);return l&&(i=a),(d||f)&&(i=u),Dt(i,r)&&(i=te(-i,r)),{isValid:l||d,value:i}}var cr=Re(Zn.p,{isLE:!0}),Pd=Re(Zn.n,{isLE:!0}),Ud={...Zn,Fp:cr,hash:Ea,adjustScalarBytes:Nd,uvRatio:Ai},Ue=zc(Ud);var Ti=Bi,Dd=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),kd=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Ld=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Md=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Jc=t=>Ai(Mt,t),qd=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Si=t=>Ue.Point.Fp.create(Nt(t)&qd);function Qc(t){let{d:e}=Zn,r=on,n=m=>cr.create(m),o=n(Ti*t*t),s=n((o+Mt)*Ld),i=BigInt(-1),c=n((i-e*o)*n(o+e)),{isValid:a,value:u}=Ai(s,c),l=n(u*t);Dt(l,r)||(l=n(-l)),a||(u=l),a||(i=o);let d=n(i*(o-Mt)*Md-c),f=u*u,h=n((u+u)*c),p=n(d*Dd),y=n(Mt-f),g=n(Mt+f);return new Ue.Point(n(h*g),n(y*p),n(p*g),n(h*y))}function Fd(t){se(t,64);let e=Si(t.subarray(0,32)),r=Qc(e),n=Si(t.subarray(32,64)),o=Qc(n);return new qt(r.add(o))}var qt=class t extends ss{constructor(e){super(e)}static fromAffine(e){return new t(Ue.Point.fromAffine(e))}assertSame(e){if(!(e instanceof t))throw new Error("RistrettoPoint expected")}init(e){return new t(e)}static hashToCurve(e){return Fd(ne("ristrettoHash",e,64))}static fromBytes(e){se(e,32);let{a:r,d:n}=Zn,o=on,s=E=>cr.create(E),i=Si(e);if(!yc(cr.toBytes(i),e)||Dt(i,o))throw new Error("invalid ristretto255 encoding 1");let c=s(i*i),a=s(Mt+r*c),u=s(Mt-r*c),l=s(a*a),d=s(u*u),f=s(r*n*l-d),{isValid:h,value:p}=Jc(s(f*d)),y=s(p*u),g=s(p*y*f),m=s((i+i)*y);Dt(m,o)&&(m=s(-m));let w=s(a*g),b=s(m*w);if(!h||Dt(b,o)||w===Ad)throw new Error("invalid ristretto255 encoding 2");return new t(new Ue.Point(m,w,Mt,b))}static fromHex(e){return t.fromBytes(ne("ristrettoHex",e,32))}static msm(e,r){return en(t,Ue.Point.Fn,e,r)}toBytes(){let{X:e,Y:r,Z:n,T:o}=this.ep,s=on,i=g=>cr.create(g),c=i(i(n+r)*i(n-r)),a=i(e*r),u=i(a*a),{value:l}=Jc(i(c*u)),d=i(l*c),f=i(l*a),h=i(d*f*o),p;if(Dt(o*h,s)){let g=i(r*Ti),m=i(e*Ti);e=g,r=m,p=i(d*kd)}else p=f;Dt(e*h,s)&&(r=i(-r));let y=i((n-r)*p);return Dt(y,s)&&(y=i(-y)),cr.toBytes(y)}equals(e){this.assertSame(e);let{X:r,Y:n}=this.ep,{X:o,Y:s}=e.ep,i=u=>cr.create(u),c=i(r*s)===i(n*o),a=i(n*s)===i(r*o);return c||a}is0(){return this.equals(t.ZERO)}};qt.BASE=new qt(Ue.Point.BASE);qt.ZERO=new qt(Ue.Point.ZERO);qt.Fp=cr;qt.Fn=Pd;var ef,tf,is=class{static{ef=Symbol.iterator,tf=Symbol.toStringTag}#e;#t;constructor(e={}){this[ef]=this.entries.bind(this),this[tf]="ExpirableMap";let{source:r=[],expirationTime:n=600*1e3}=e,o=Date.now();this.#e=new Map([...r].map(([s,i])=>[s,{value:i,timestamp:o}])),this.#t=n}prune(){let e=Date.now();for(let[r,n]of this.#e.entries())e-n.timestamp>this.#t&&this.#e.delete(r);return this}set(e,r){this.prune();let n={value:r,timestamp:Date.now()};return this.#e.set(e,n),this}get(e){let r=this.#e.get(e);if(r!==void 0){if(Date.now()-r.timestamp>this.#t){this.#e.delete(e);return}return r.value}}clear(){this.#e.clear()}entries(){let e=this.#e.entries();return function*(){for(let[n,o]of e)yield[n,o.value]}()}values(){let e=this.#e.values();return function*(){for(let n of e)yield n.value}()}keys(){return this.#e.keys()}forEach(e,r){for(let[n,o]of this.#e.entries())e.call(r,o.value,n,this)}has(e){return this.#e.has(e)}delete(e){return this.#e.delete(e)}get size(){return this.#e.size}};var rf=t=>{if(t<=127)return 1;if(t<=255)return 2;if(t<=65535)return 3;if(t<=16777215)return 4;throw G.fromCode(new yn("Length too long (> 4 bytes)"))},nf=(t,e,r)=>{if(r<=127)return t[e]=r,1;if(r<=255)return t[e]=129,t[e+1]=r,2;if(r<=65535)return t[e]=130,t[e+1]=r>>8,t[e+2]=r,3;if(r<=16777215)return t[e]=131,t[e+1]=r>>16,t[e+2]=r>>8,t[e+3]=r,4;throw G.fromCode(new yn("Length too long (> 4 bytes)"))},Oi=(t,e)=>{if(t[e]<128)return 1;if(t[e]===128)throw G.fromCode(new Xe("Invalid length 0"));if(t[e]===129)return 2;if(t[e]===130)return 3;if(t[e]===131)return 4;throw G.fromCode(new Xe("Length too long (> 4 bytes)"))},$d=(t,e)=>{let r=Oi(t,e);if(r===1)return t[e];if(r===2)return t[e+1];if(r===3)return(t[e+1]<<8)+t[e+2];if(r===4)return(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];throw G.fromCode(new Xe("Length too long (> 4 bytes)"))},up=Uint8Array.from([48,12,6,10,43,6,1,4,1,131,184,67,1,1]),sn=Uint8Array.from([48,5,6,3,43,101,112]),dp=Uint8Array.from([48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10]),lp=Uint8Array.from([48,29,6,13,43,6,1,4,1,130,220,124,5,3,1,2,1,6,12,43,6,1,4,1,130,220,124,5,3,2,1]);function as(t,e){let r=2+rf(t.byteLength+1),n=e.byteLength+r+t.byteLength,o=0,s=new Uint8Array(1+rf(n)+n);return s[o++]=48,o+=nf(s,o,n),s.set(e,o),o+=e.byteLength,s[o++]=3,o+=nf(s,o,t.byteLength+1),s[o++]=0,s.set(new Uint8Array(t),o),s}var cs=(t,e)=>{let r=0,n=(c,a)=>{if(o[r++]!==c)throw G.fromCode(new Xe(`Expected ${a} at offset ${r}`))},o=new Uint8Array(t);if(n(48,"sequence"),r+=Oi(o,r),!_r(o.slice(r,r+e.byteLength),e))throw G.fromCode(new Xe("Not the expected OID."));r+=e.byteLength,n(3,"bit string");let s=$d(o,r)-1;r+=Oi(o,r),n(0,"0 padding");let i=o.slice(r);if(s!==i.length)throw G.fromCode(new go(s,i.length));return i};var fs=class t{static from(e){return this.fromDer(e.toDer())}static fromRaw(e){return new t(e)}static fromDer(e){return new t(this.derDecode(e))}static{this.RAW_KEY_LENGTH=32}static derEncode(e){return as(e,sn)}static derDecode(e){let r=cs(e,sn);if(r.length!==this.RAW_KEY_LENGTH)throw G.fromCode(new Xe("An Ed25519 public key must be exactly 32 bytes long"));return r}#e;get rawKey(){return this.#e}#t;get derKey(){return this.#t}constructor(e){if(e.byteLength!==t.RAW_KEY_LENGTH)throw G.fromCode(new Xe("An Ed25519 public key must be exactly 32 bytes long"));this.#e=e,this.#t=t.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}};var Ci=class{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}unsubscribe(e){this.observers=this.observers.filter(r=>r!==e)}notify(e,...r){this.observers.forEach(n=>n(e,...r))}},us=class extends Ci{constructor(){super()}print(e,...r){this.notify({message:e,level:"info"},...r)}warn(e,...r){this.notify({message:e,level:"warn"},...r)}error(e,r,...n){this.notify({message:e,level:"error",error:r},...n)}};var ds=class t{#e;#t;#n;#c;#i;#u;#r;#o;#a=0;static{this.default={initialInterval:500,randomizationFactor:.5,multiplier:1.5,maxInterval:6e4,maxElapsedTime:9e5,maxIterations:10,date:Date}}constructor(e=t.default){let{initialInterval:r=500,randomizationFactor:n=.5,multiplier:o=1.5,maxInterval:s=6e4,maxElapsedTime:i=9e5,maxIterations:c=10,date:a=Date}=e;this.#e=r,this.#t=n,this.#n=o,this.#c=s,this.#o=a,this.#i=a.now(),this.#u=i,this.#r=c}get ellapsedTimeInMsec(){return this.#o.now()-this.#i}get currentInterval(){return this.#e}get count(){return this.#a}get randomValueFromInterval(){let e=this.#t*this.#e,r=this.#e-e,n=this.#e+e;return Math.random()*(n-r)+r}incrementCurrentInterval(){return this.#e=Math.min(this.#e*this.#n,this.#c),this.#a++,this.#e}next(){return this.ellapsedTimeInMsec>=this.#u||this.#a>=this.#r?null:(this.incrementCurrentInterval(),this.randomValueFromInterval)}};var yt;(function(t){t.Received="received",t.Processing="processing",t.Replied="replied",t.Rejected="rejected",t.Unknown="unknown",t.Done="done"})(yt||(yt={}));var Pi=60*1e3,Vd=1e6,jd=0,Kd="308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d9685f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484b01291091c5f87b98883463f98091a0baaae";var Hd="ic0.app",Gd=".ic0.app",Zd="icp0.io",Yd=".icp0.io",Wd="icp-api.io",zd=".icp-api.io",Ri=200,Xd=202,Jd=404;function Qd(){let t;if(typeof window<"u")if(window.fetch)t=window.fetch.bind(window);else throw ye.fromCode(new $r("Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present."));else if(typeof global<"u")if(global.fetch)t=global.fetch.bind(global);else throw ye.fromCode(new $r("Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available."));else typeof self<"u"&&self.fetch&&(t=self.fetch.bind(self));if(t)return t;throw ye.fromCode(new $r("Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context."))}function el(t){let e;if(t!==void 0)!t.match(/^[a-z]+:/)&&typeof window<"u"?e=new URL(window.location.protocol+"//"+t):e=new URL(t);else{let r=["ic0.app","icp0.io","127.0.0.1","localhost"],n=[".github.dev",".gitpod.io"],o=typeof window<"u"?window.location:void 0,s=o?.hostname,i;s&&typeof s=="string"&&(n.some(c=>s.endsWith(c))?i=s:i=r.find(c=>s.endsWith(c))),o&&i?e=new URL(`${o.protocol}//${i}${o.port?":"+o.port:""}`):e=new URL("https://icp-api.io")}return e.toString()}var Rr=class t{#e;#t;#n;#c;#i;#u;#r;#o;#a;#w;#s;#d;#l;#f;get#I(){return this.#f*Pi}#h;#p;#m;#y;constructor(e={}){this.#e=null,this.#t=!1,this.#n=jd,this.#c=!1,this.#i=null,this.#u=!1,this._isAgent=!0,this.config={},this.log=new us,this.#h=[],this.#p=[],this.#m=new is({expirationTime:5*Pi}),this.#y=!0,this.#_=(o,s)=>{if(this.#y===!1)return o;let{status:i,signatures:c=[],requestId:a}=o;for(let u of c){let{timestamp:l,identity:d}=u,f=M.fromUint8Array(d).toText(),h;if(i===Vt.Replied){let{reply:w}=o;h=An({status:i,reply:w,timestamp:BigInt(l),request_id:a})}else if(i===Vt.Rejected){let{reject_code:w,reject_message:b,error_code:E}=o;h=An({status:i,reject_code:w,reject_message:b,error_code:E,timestamp:BigInt(l),request_id:a})}else throw ue.fromCode(new Ae(`Unknown status: ${i}`));let p=$($s,h),y=s.nodeKeys.get(f);if(!y)throw Q.fromCode(new Oo);let g=fs.fromDer(y).rawKey;if(Ue.verify(u.signature,p,g))return o;throw Se.fromCode(new Co(f))}return o},this.config=e,this.#o=e.fetch||Qd()||fetch.bind(global),this.#a=e.fetchOptions,this.#w=e.callOptions,this.#t=e.shouldFetchRootKey??!1,this.#u=e.shouldSyncTime??!1,e.rootKey?this.rootKey=e.rootKey:this.#t?this.rootKey=null:this.rootKey=me(Kd);let r=el(e.host);this.host=new URL(r),e.verifyQuerySignatures!==void 0&&(this.#y=e.verifyQuerySignatures),this.#d=e.retryTimes??3;let n=()=>new ds({maxIterations:this.#d});if(this.#l=e.backoffStrategy||n,this.host.hostname.endsWith(Gd)?this.host.hostname=Hd:this.host.hostname.endsWith(Yd)?this.host.hostname=Zd:this.host.hostname.endsWith(zd)&&(this.host.hostname=Wd),e.credentials){let{name:o,password:s}=e.credentials;this.#s=`${o}${s?":"+s:""}`}if(this.#r=Promise.resolve(e.identity||new tr),e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes>5)throw G.fromCode(new yr("The maximum ingress expiry time is 5 minutes.",e.ingressExpiryInMinutes));if(e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes<=0)throw G.fromCode(new yr("Ingress expiry time must be greater than 0.",e.ingressExpiryInMinutes));this.#f=e.ingressExpiryInMinutes||5,this.addTransform("update",Ys(Dn)),e.useQueryNonces&&this.addTransform("query",Ys(Dn)),e.logToConsole&&this.log.subscribe(o=>{o.level==="error"?console.error(o.message):o.level==="warn"?console.warn(o.message):console.log(o.message)})}static createSync(e={}){return new this({...e})}static async create(e={}){let r=t.createSync(e);return await r.#g(),r}static async from(e){try{return"config"in e?await t.create(e.config):await t.create({fetch:e._fetch,fetchOptions:e._fetchOptions,callOptions:e._callOptions,host:e._host.toString(),identity:e._identity??void 0})}catch{throw G.fromCode(new To)}}isLocal(){let e=this.host.hostname;return e==="127.0.0.1"||e.endsWith("127.0.0.1")}addTransform(e,r,n=r.priority||0){if(e==="update"){let o=this.#p.findIndex(s=>(s.priority||0)<n);this.#p.splice(o>=0?o:this.#p.length,0,Object.assign(r,{priority:n}))}else if(e==="query"){let o=this.#h.findIndex(s=>(s.priority||0)<n);this.#h.splice(o>=0?o:this.#h.length,0,Object.assign(r,{priority:n}))}}async getPrincipal(){if(!this.#r)throw ye.fromCode(new Yt);return(await this.#r).getPrincipal()}async call(e,r,n){let o=r.callSync??!0,s=await(n??this.#r);if(!s)throw ye.fromCode(new Yt);let i=M.from(e),c=r.effectiveCanisterId?M.from(r.effectiveCanisterId):i;await this.#g(c);let a=s.getPrincipal(),u=Ni(this.#f,this.#n),l={request_type:jo.Call,canister_id:i,method_name:r.methodName,arg:r.arg,sender:a,ingress_expiry:u},d=await this._transform({request:{body:null,method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:Rt.Call,body:l}),f;r?.nonce?f=h(r.nonce):d.body.nonce?f=h(d.body.nonce):f=void 0,l.nonce=f;function h(m){return Object.assign(m,{__nonce__:void 0})}d=await s.transformRequest(d);let p=Vo(d.body),y=this.#l(),g=Ot(l);try{let b=o?()=>(this.log.print(`fetching "/api/v3/canister/${c.toText()}/call" with request:`,d),this.#o(""+new URL(`/api/v3/canister/${c.toText()}/call`,this.host),{...this.#w,...d.request,body:p})):()=>(this.log.print(`fetching "/api/v2/canister/${c.toText()}/call" with request:`,d),this.#o(""+new URL(`/api/v2/canister/${c.toText()}/call`,this.host),{...this.#w,...d.request,body:p})),{responseBodyBytes:E,...v}=await this.#b({requestFn:b,backoff:y,tries:0}),T=E.byteLength>0?Fe(E):null;return{requestId:g,response:{...v,body:T},requestDetails:l}}catch(m){let w;if(m instanceof ze){if(m.hasCode(gn))return this.log.warn("v3 api not supported. Fall back to v2"),this.call(e,{...r,callSync:!1},n);if(m.hasCode(yr)&&!this.#c)return await this.syncTime(i),this.call(i,r,n);m.code.requestContext={requestId:g,senderPubKey:d.body.sender_pubkey,senderSignature:d.body.sender_sig,ingressExpiry:d.body.content.ingress_expiry},w=m}else w=ue.fromCode(new Ae(m));throw this.log.error(`Error while making call: ${w.message}`,w),w}}async#x(e){let{ecid:r,transformedRequest:n,body:o,requestId:s,backoff:i,tries:c}=e,a=c===0?0:i.next();if(this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with tries:`,{tries:c,backoff:i,delay:a}),a===null)throw ue.fromCode(new mr(`Backoff strategy exhausted after ${c} attempts.`,s));a>0&&await new Promise(h=>setTimeout(h,a));let u;try{this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with request:`,n);let h=await this.#o(""+new URL(`/api/v2/canister/${r.toString()}/query`,this.host),{...this.#a,...n.request,body:o});if(h.status===Ri)u={...Fe(Gr(await h.arrayBuffer())),httpDetails:{ok:h.ok,status:h.status,statusText:h.statusText,headers:Ho(h.headers)},requestId:s};else throw Q.fromCode(new bn(h.status,h.statusText,Ho(h.headers),await h.text()))}catch(h){if(c<this.#d)return this.log.warn(`Caught exception while attempting to make query:
  ${h}
  Retrying query.`),await this.#x({...e,tries:c+1});throw h instanceof ze?h:mn.fromCode(new wn(h))}if(!this.#y)return u;let l=u.signatures?.[0]?.timestamp;if(!l)throw Q.fromCode(new So("Timestamp not found in query response. This suggests a malformed or malicious response."));let d=Number(BigInt(l)/BigInt(Vd));if(Date.now()+this.#n-d>this.#I){if(c<this.#d)return this.log.warn("Timestamp is older than the max ingress expiry. Retrying query.",{requestId:s,signatureTimestampMs:d}),await this.#x({...e,tries:c+1});throw Se.fromCode(new _o(this.#f,s,c))}return u}async#b(e){let{requestFn:r,backoff:n,tries:o}=e,s=o===0?0:n.next();if(s===null)throw Q.fromCode(new mr(`Retry strategy exhausted after ${o} attempts.`));s>0&&await new Promise(l=>setTimeout(l,s));let i,c=new Uint8Array;try{i=await r(),i.status===Ri&&(c=Gr(await i.clone().arrayBuffer()))}catch(l){if(o<this.#d)return this.log.warn(`Caught exception while attempting to make request:
  ${l}
  Retrying request.`),await this.#b({requestFn:r,backoff:n,tries:o+1});throw mn.fromCode(new wn(l))}let a=Ho(i.headers);if(i.status===Ri||i.status===Xd)return{ok:i.ok,status:i.status,statusText:i.statusText,responseBodyBytes:c,headers:a};let u=await i.text();if(i.status===Jd&&i.url.includes("api/v3"))throw Q.fromCode(new gn);if(u.startsWith("Invalid request expiry: "))throw G.fromCode(new yr(u,this.#f));if(o<this.#d)return await this.#b({requestFn:r,backoff:n,tries:o+1});throw Q.fromCode(new bn(i.status,i.statusText,a,u))}async query(e,r,n){let o=this.#l(),s=r.effectiveCanisterId?M.from(r.effectiveCanisterId):M.from(e);await this.#g(s),this.log.print(`ecid ${s.toString()}`),this.log.print(`canisterId ${e.toString()}`);let i,c=await(n??this.#r);if(!c)throw ye.fromCode(new Yt);let a=M.from(e),u=c.getPrincipal(),l=Ni(this.#f,this.#n),d={request_type:Ir.Query,canister_id:a,method_name:r.methodName,arg:r.arg,sender:u,ingress_expiry:l},f=Ot(d);i=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:Rt.Query,body:d}),i=await c.transformRequest(i);let h=Vo(i.body),p={canister:a.toText(),ecid:s,transformedRequest:i,body:h,requestId:f,backoff:o,tries:0},y=async()=>{let m=await this.#x(p);return{requestDetails:d,...m}},g=async()=>{let m=this.#m.get(s.toString());if(m)return m;await this.fetchSubnetKeys(s.toString());let w=this.#m.get(s.toString());if(!w)throw Se.fromCode(new Ao);return w};try{if(!this.#y)return await y();let[m,w]=await Promise.all([y(),g()]);try{return this.#_(m,w)}catch{this.log.warn("Query response verification failed. Retrying with fresh subnet keys."),this.#m.delete(s.toString());let b=await g();return this.#_(m,b)}}catch(m){let w;throw m instanceof ze?(m.code.requestContext={requestId:f,senderPubKey:i.body.sender_pubkey,senderSignature:i.body.sender_sig,ingressExpiry:i.body.content.ingress_expiry},w=m):w=ue.fromCode(new Ae(m)),this.log.error(`Error while making query: ${w.message}`,w),w}}#_;async createReadStateRequest(e,r){await this.#g();let n=await(r??this.#r);if(!n)throw ye.fromCode(new Yt);let o=n.getPrincipal(),s=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:Rt.ReadState,body:{request_type:Ir.ReadState,paths:e.paths,sender:o,ingress_expiry:Ni(this.#f,this.#n)}});return n.transformRequest(s)}async readState(e,r,n,o){await this.#E();let s=M.from(e);function i(l){for(let d of l.paths){let[f,h]=d,p=new TextEncoder().encode("request_status");if(_r(f,p))return h}}let c,a;if(o)c=o,a=Ot(c);else{a=i(r);let l=await this.#r;if(!l)throw ye.fromCode(new Yt);c=await this.createReadStateRequest(r,l)}this.log.print(`fetching "/api/v2/canister/${s}/read_state" with request:`,c);let u=this.#l();try{let{responseBodyBytes:l}=await this.#b({requestFn:()=>this.#o(""+new URL(`/api/v2/canister/${s.toString()}/read_state`,this.host),{...this.#a,...c.request,body:Vo(c.body)}),backoff:u,tries:0}),d=Fe(l);return this.log.print("Read state response:",d),d}catch(l){let d;throw l instanceof ze?(l.code.requestContext={requestId:a,senderPubKey:c.body.sender_pubkey,senderSignature:c.body.sender_sig,ingressExpiry:c.body.content.ingress_expiry},d=l):d=ue.fromCode(new Ae(l)),this.log.error(`Error while making read state: ${d.message}`,d),d}}parseTimeFromResponse(e){let r;if(e.certificate){let n=Fe(e.certificate);if(n&&"tree"in n)r=n.tree;else throw Q.fromCode(new Wt("Could not decode time from response"));let o=Cr(["time"],r);if(o.status!==Me.Found)throw Q.fromCode(new Bt("Time was not found in the response or was not in its expected format.",o.status));if(!(o.value instanceof Uint8Array)&&!ArrayBuffer.isView(o))throw Q.fromCode(new Mr("Time was not in its expected format."));let s=nn(o.value);return this.log.print("Time from response:",s),this.log.print("Time from response in milliseconds:",s.getTime()),s.getTime()}else this.log.warn("No certificate found in response");return 0}async syncTime(e){this.#i=this.#i??(async()=>{await this.#E();let r=Date.now();try{e||this.log.print("Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai");let n=e??M.from("ryjl3-tyaaa-aaaaa-aaaba-cai"),o=t.createSync({identity:new tr,host:this.host.toString(),fetch:this.#o,retryTimes:0,rootKey:this.rootKey??void 0,shouldSyncTime:!1}),i=(await Promise.all(Array(3).fill(null).map(async()=>{let a=(await Ii({canisterId:n,agent:o,paths:["time"],disableCertificateTimeVerification:!0})).get("time");if(a instanceof Date)return a.getTime()},[]))).reduce((c,a)=>typeof a=="number"&&a>c?a:c,0);i>0&&(this.#n=i-r,this.#c=!0,this.log.notify({message:`Syncing time: offset of ${this.#n}`,level:"info"}))}catch(n){let o=n instanceof ze?n:ue.fromCode(new Ae(n));throw this.log.error("Caught exception while attempting to sync time",o),o}})(),await this.#i.finally(()=>{this.#i=null})}async status(){let e=this.#s?{Authorization:"Basic "+btoa(this.#s)}:{};this.log.print('fetching "/api/v2/status"');let r=this.#l(),{responseBodyBytes:n}=await this.#b({backoff:r,requestFn:()=>this.#o(""+new URL("/api/v2/status",this.host),{headers:e,...this.#a}),tries:0});return Fe(n)}async fetchRootKey(){return this.#e=this.#e??(async()=>{let e=await this.status();return this.rootKey=e.root_key,this.rootKey})(),await this.#e.finally(()=>{this.#e=null})}async#g(e){await Promise.all([this.#E(),this.#v(e)])}async#E(){if(!this.rootKey)if(this.rootKey===null&&this.host.toString()!=="https://icp-api.io"&&this.#t)await this.fetchRootKey();else throw ye.fromCode(new dt(this.#t))}async#v(e){this.#u&&!this.hasSyncedTime()&&await this.syncTime(e)}invalidateIdentity(){this.#r=null}replaceIdentity(e){this.#r=Promise.resolve(e)}async fetchSubnetKeys(e){let r=M.from(e);await this.#g(r);let o=(await Ii({canisterId:r,paths:["subnet"],agent:this})).get("subnet");if(o&&typeof o=="object"&&"nodeKeys"in o)return this.#m.set(r.toText(),o),o}_transform(e){let r=Promise.resolve(e);if(e.endpoint===Rt.Call)for(let n of this.#p)r=r.then(o=>n(o).then(s=>s||o));else for(let n of this.#h)r=r.then(o=>n(o).then(s=>s||o));return r}getTimeDiffMsecs(){return this.#n}hasSyncedTime(){return this.#c}};function Ni(t,e){let r=t*Pi;return zr.fromDeltaInMilliseconds(r,e)}var tl=300*1e3;function Ui(){return il(nl(rl(),1e3),sl(1e3,1.2),ol(tl))}function rl(){let t=!0;return async()=>t?(t=!1,!0):!1}function nl(t,e){return async(r,n,o)=>{if(await t(r,n,o))return new Promise(s=>setTimeout(s,e))}}function ol(t){let e=Date.now()+t;return async(r,n,o)=>{if(Date.now()>e)throw Q.fromCode(new mr(`Request timed out after ${t} msec`,n,o))}}function sl(t,e){let r=t;return()=>new Promise(n=>setTimeout(()=>{r*=e,n()},r))}function il(...t){return async(e,r,n)=>{for(let o of t)await o(e,r,n)}}var sf={strategy:Ui(),preSignReadStateRequest:!1};function af(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Di(t,e){return t!==null&&typeof t=="object"&&af(t,e)}function cl(t,e){return af(t,e)&&typeof t[e]=="function"}function of(t){return Di(t,"body")&&Di(t.body,"content")&&t.body.content.request_type===Ir.ReadState&&Di(t.body.content,"ingress_expiry")&&typeof t.body.content.ingress_expiry=="object"&&t.body.content.ingress_expiry!==null&&cl(t.body.content.ingress_expiry,"toHash")}async function ki(t,e,r,n={}){let o=[X("request_status"),r],s,i;if(n.preSignReadStateRequest??!1?(i=await fl({paths:[o],agent:t,pollingOptions:n}),s=await t.readState(e,{paths:[o]},void 0,i)):s=await t.readState(e,{paths:[o]}),t.rootKey==null)throw ye.fromCode(new dt);let a=await ir.create({certificate:s.certificate,rootKey:t.rootKey,canisterId:e,blsVerify:n.blsVerify,agent:t}),u=Be(a.lookup_path([...o,X("status")])),l;switch(typeof u>"u"?l=yt.Unknown:l=new TextDecoder().decode(u),l){case yt.Replied:return{reply:Be(a.lookup_path([...o,"reply"])),certificate:a};case yt.Received:case yt.Unknown:case yt.Processing:return await(n.strategy??Ui())(e,r,l),ki(t,e,r,{...n,request:i});case yt.Rejected:{let d=new Uint8Array(Be(a.lookup_path([...o,"reject_code"])))[0],f=new TextDecoder().decode(Be(a.lookup_path([...o,"reject_message"]))),h=Be(a.lookup_path([...o,"error_code"])),p=h?new TextDecoder().decode(h):void 0;throw Gt.fromCode(new Fr(r,d,f,p))}case yt.Done:throw ue.fromCode(new vo(r))}throw zt}async function fl(t){let{paths:e,agent:r,pollingOptions:n}=t;if(n.request&&of(n.request))return n.request;let o=await r.createReadStateRequest?.({paths:e},void 0);if(!of(o))throw G.fromCode(new Ro(o));return o}var Ge=Symbol.for("ic-agent-metadata"),ls=class t{static agentOf(e){return e[Ge].config.agent}static interfaceOf(e){return e[Ge].service}static canisterIdOf(e){return M.from(e[Ge].config.canisterId)}static createActorClass(e,r){let n=e({IDL:xr});class o extends t{constructor(i){if(!i.canisterId)throw G.fromCode(new xn(i.canisterId));let c=typeof i.canisterId=="string"?M.fromText(i.canisterId):i.canisterId;super({config:{...cf,...i,canisterId:c},service:n});for(let[a,u]of n._fields)r?.httpDetails&&u.annotations.push(Li),r?.certificate&&u.annotations.push(ff),this[a]=dl(this,a,u,i.blsVerify)}}return o}static createActor(e,r){if(!r.canisterId)throw G.fromCode(new xn(r.canisterId));return new(this.createActorClass(e))(r)}static createActorWithHttpDetails(e,r){return new(this.createActorClass(e,{httpDetails:!0}))(r)}static createActorWithExtendedDetails(e,r,n={httpDetails:!0,certificate:!0}){return new(this.createActorClass(e,n))(r)}constructor(e){this[Ge]=Object.freeze(e)}};function an(t,e){let r=xr.decode(t,e);switch(r.length){case 0:return;case 1:return r[0];default:return r}}var cf={pollingOptions:sf},Li="http-details",ff="certificate";function dl(t,e,r,n){let o;r.annotations.includes("query")||r.annotations.includes("composite_query")?o=async(i,...c)=>{i={...i,...t[Ge].config.queryTransform?.(e,c,{...t[Ge].config,...i})};let a=i.agent||t[Ge].config.agent||new Rr,u=M.from(i.canisterId||t[Ge].config.canisterId),l=xr.encode(r.argTypes,c),d=await a.query(u,{methodName:e,arg:l,effectiveCanisterId:i.effectiveCanisterId}),f={...d.httpDetails,requestDetails:d.requestDetails};switch(d.status){case Vt.Rejected:{let h=new Eo(d.requestId,d.reject_code,d.reject_message,d.error_code,d.signatures);throw h.callContext={canisterId:u,methodName:e,httpDetails:f},Gt.fromCode(h)}case Vt.Replied:return r.annotations.includes(Li)?{httpDetails:f,result:an(r.retTypes,d.reply.arg)}:an(r.retTypes,d.reply.arg)}}:o=async(i,...c)=>{i={...i,...t[Ge].config.callTransform?.(e,c,{...t[Ge].config,...i})};let a=i.agent||t[Ge].config.agent||Rr.createSync(),{canisterId:u,effectiveCanisterId:l,pollingOptions:d}={...cf,...t[Ge].config,...i},f=M.from(u),h=l!==void 0?M.from(l):f,p=xr.encode(r.argTypes,c),{requestId:y,response:g,requestDetails:m}=await a.call(f,{methodName:e,arg:p,effectiveCanisterId:h,nonce:i.nonce}),w,b;if(na(g.body)){if(a.rootKey==null)throw ye.fromCode(new dt);let B=g.body.certificate;b=await ir.create({certificate:B,rootKey:a.rootKey,canisterId:M.from(u),blsVerify:n,agent:a});let A=[X("request_status"),y];switch(new TextDecoder().decode(Be(b.lookup_path([...A,"status"])))){case"replied":w=Be(b.lookup_path([...A,"reply"]));break;case"rejected":{let S=new Uint8Array(Be(b.lookup_path([...A,"reject_code"])))[0],P=new TextDecoder().decode(Be(b.lookup_path([...A,"reject_message"]))),C=Be(b.lookup_path([...A,"error_code"])),x=C?new TextDecoder().decode(C):void 0,I=new Fr(y,S,P,x);throw I.callContext={canisterId:f,methodName:e,httpDetails:g},Gt.fromCode(I)}}}else if(ra(g.body)){let{reject_code:B,reject_message:A,error_code:_}=g.body,S=new Io(y,B,A,_);throw S.callContext={canisterId:f,methodName:e,httpDetails:g},Gt.fromCode(S)}if(g.status===202){let B={...d,blsVerify:n},A=await ki(a,h,y,B);b=A.certificate,w=A.reply}let E=r.annotations.includes(Li),v=r.annotations.includes(ff),T={...g,requestDetails:m};if(w!==void 0)return E&&v?{httpDetails:T,certificate:b,result:an(r.retTypes,w)}:v?{certificate:b,result:an(r.retTypes,w)}:E?{httpDetails:T,result:an(r.retTypes,w)}:an(r.retTypes,w);{let B=new Ae(`Call was returned undefined. We cannot determine if the call was successful or not. Return types: [${r.retTypes.map(A=>A.display()).join(",")}].`);throw B.callContext={canisterId:f,methodName:e,httpDetails:T},ue.fromCode(B)}};let s=(...i)=>o({},...i);return s.withOptions=i=>(...c)=>o(i,...c),s}function uf(t){return t!==null&&typeof t=="object"}var cn=class t{static from(e){if(typeof e=="string"){let r=me(e);return this.fromRaw(r)}else if(uf(e)){let r=e;if(uf(r)&&Object.hasOwnProperty.call(r,"__derEncodedPublicKey__"))return this.fromDer(r);if(ArrayBuffer.isView(r)){let n=r;return this.fromRaw(lt(n.buffer))}else{if(r instanceof ArrayBuffer)return this.fromRaw(lt(r));if("rawKey"in r&&r.rawKey instanceof Uint8Array)return this.fromRaw(r.rawKey);if("derKey"in r)return this.fromDer(r.derKey);if("toDer"in r)return this.fromDer(r.toDer())}}throw new Error("Cannot construct Ed25519PublicKey from the provided key.")}static fromRaw(e){return new t(e)}static fromDer(e){return new t(this.derDecode(e))}static{this.RAW_KEY_LENGTH=32}static derEncode(e){let r=as(e,sn);return r.__derEncodedPublicKey__=void 0,r}static derDecode(e){let r=cs(e,sn);if(r.length!==this.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");return r}#e;get rawKey(){return this.#e}#t;get derKey(){return this.#t}constructor(e){if(e.byteLength!==t.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");this.#e=e,this.#t=t.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}},Nr=class t extends er{static generate(e){if(e&&e.length!==32)throw new Error("Ed25519 Seed needs to be 32 bytes long.");e||(e=Ue.utils.randomPrivateKey()),va(e,new Uint8Array(new Array(32).fill(0)))&&console.warn("Seed is all zeros. This is not a secure seed. Please provide a seed with sufficient entropy if this is a production environment.");let r=new Uint8Array(32);for(let o=0;o<32;o++)r[o]=e[o];let n=Ue.getPublicKey(r);return t.fromKeyPair(n,r)}static fromParsedJson(e){let[r,n]=e;return new t(cn.fromDer(me(r)),me(n))}static fromJSON(e){let r=JSON.parse(e);if(Array.isArray(r)){if(typeof r[0]=="string"&&typeof r[1]=="string")return this.fromParsedJson([r[0],r[1]]);throw new Error("Deserialization error: JSON must have at least 2 items.")}throw new Error(`Deserialization error: Invalid JSON type for string: ${JSON.stringify(e)}`)}static fromKeyPair(e,r){return new t(cn.fromRaw(e),r)}static fromSecretKey(e){let r=Ue.getPublicKey(e);return t.fromKeyPair(r,e)}#e;#t;constructor(e,r){super(),this.#e=cn.from(e),this.#t=r}toJSON(){return[F(this.#e.toDer()),F(this.#t)]}getKeyPair(){return{secretKey:this.#t,publicKey:this.#e}}getPublicKey(){return this.#e}async sign(e){let r=Ue.sign(e,this.#t.slice(0,32));return Object.defineProperty(r,"__signature__",{enumerable:!1,value:void 0}),r}static verify(e,r,n){let[o,s,i]=[e,r,n].map(c=>(typeof c=="string"&&(c=me(c)),lt(c)));return Ue.verify(o,s,i)}};var Mi=class t extends Error{constructor(e){super(e),this.message=e,Object.setPrototypeOf(this,t.prototype)}};function df(t){if(typeof global<"u"&&global.crypto&&global.crypto.subtle)return global.crypto.subtle;if(t)return t;if(typeof crypto<"u"&&crypto.subtle)return crypto.subtle;throw new Mi("Global crypto was not available and none was provided. Please inlcude a SubtleCrypto implementation. See https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto")}var Yn=class t extends er{static async generate(e){let{extractable:r=!1,keyUsages:n=["sign","verify"],subtleCrypto:o}=e??{},s=df(o),i=await s.generateKey({name:"ECDSA",namedCurve:"P-256"},r,n),c=lt(await s.exportKey("spki",i.publicKey));return Object.assign(c,{__derEncodedPublicKey__:void 0}),new this(i,c,s)}static async fromKeyPair(e,r){let n=df(r),o=lt(await n.exportKey("spki",e.publicKey));return Object.assign(o,{__derEncodedPublicKey__:void 0}),new t(e,o,n)}constructor(e,r,n){super(),this._keyPair=e,this._derKey=r,this._subtleCrypto=n}getKeyPair(){return this._keyPair}getPublicKey(){let e=this._derKey,r=Object.create(this._keyPair.publicKey);return r.toDer=function(){return e},r}async sign(e){let r={name:"ECDSA",hash:{name:"SHA-256"}},n=lt(await this._subtleCrypto.sign(r,this._keyPair.privateKey,e));return Object.assign(n,{__signature__:void 0}),n}};var hs=class{#e;get rawKey(){return this.#e.rawKey}get derKey(){return this.#e.derKey}toDer(){return this.#e.toDer()}getPublicKey(){return this.#e}getPrincipal(){if(!this.#e.rawKey)throw new Error("Cannot get principal from a public key without a raw key.");return M.fromUint8Array(new Uint8Array(this.#e.rawKey))}transformRequest(){return Promise.reject("Not implemented. You are attempting to use a partial identity to sign calls, but this identity only has access to the public key.To sign calls, use a DelegationIdentity instead.")}constructor(e){this.#e=e}};function qi(t){if(typeof t!="string"||t.length<64)throw new Error("Invalid public key.");return me(t)}var fn=class{constructor(e,r,n){this.pubkey=e,this.expiration=r,this.targets=n}toCborValue(){return{pubkey:this.pubkey,expiration:this.expiration,...this.targets&&{targets:this.targets}}}toJSON(){return{expiration:this.expiration.toString(16),pubkey:F(this.pubkey),...this.targets&&{targets:this.targets.map(e=>e.toHex())}}}};async function ll(t,e,r,n){let o=new fn(e.toDer(),BigInt(+r)*BigInt(1e6),n),s=new Uint8Array([...Vs,...new Uint8Array(Ot({...o}))]),i=await t.sign(s);return{delegation:o,signature:i}}var Wn=class t{static async create(e,r,n=new Date(Date.now()+900*1e3),o={}){let s=await ll(e,r,n,o.targets);return new t([...o.previous?.delegations||[],s],o.previous?.publicKey||e.getPublicKey().toDer())}static fromJSON(e){let{publicKey:r,delegations:n}=typeof e=="string"?JSON.parse(e):e;if(!Array.isArray(n))throw new Error("Invalid delegations.");let o=n.map(s=>{let{delegation:i,signature:c}=s,{pubkey:a,expiration:u,targets:l}=i;if(l!==void 0&&!Array.isArray(l))throw new Error("Invalid targets.");return{delegation:new fn(qi(a),BigInt("0x"+u),l&&l.map(d=>{if(typeof d!="string")throw new Error("Invalid target.");return M.fromHex(d)})),signature:qi(c)}});return new this(o,qi(r))}static fromDelegations(e,r){return new this(e,r)}constructor(e,r){this.delegations=e,this.publicKey=r}toJSON(){return{delegations:this.delegations.map(e=>{let{delegation:r,signature:n}=e,{targets:o}=r;return{delegation:{expiration:r.expiration.toString(16),pubkey:F(r.pubkey),...o&&{targets:o.map(s=>s.toHex())}},signature:F(n)}}),publicKey:F(this.publicKey)}}},zn=class extends er{static fromDelegation(e,r){return new this(e,r)}constructor(e,r){super(),this._inner=e,this._delegation=r}getDelegation(){return this._delegation}getPublicKey(){return{derKey:this._delegation.publicKey,toDer:()=>this._delegation.publicKey}}sign(e){return this._inner.sign(e)}async transformRequest(e){let{body:r,...n}=e,o=await Ot(r);return{...n,body:{content:r,sender_sig:await this.sign(new Uint8Array([...On,...new Uint8Array(o)])),sender_delegation:this._delegation.delegations,sender_pubkey:this._delegation.publicKey}}}},Xn=class t extends hs{#e;get delegation(){return this.#e}constructor(e,r){super(e),this.#e=r}static fromDelegation(e,r){return new t(e,r)}};function Fi(t,e){for(let{delegation:o}of t.delegations)if(+new Date(Number(o.expiration/BigInt(1e6)))<=+Date.now())return!1;let r=[],n=e?.scope;n&&(Array.isArray(n)?r.push(...n.map(o=>typeof o=="string"?M.fromText(o):o)):r.push(typeof n=="string"?M.fromText(n):n));for(let o of r){let s=o.toText();for(let{delegation:i}of t.delegations){if(i.targets===void 0)continue;let c=!0;for(let a of i.targets)if(a.toText()===s){c=!1;break}if(c)return!1}}return!0}var lf=["mousedown","mousemove","keydown","touchstart","wheel"],Jn=class{callbacks=[];idleTimeout=600*1e3;timeoutID=void 0;static create(e={}){return new this(e)}constructor(e={}){let{onIdle:r,idleTimeout:n=600*1e3}=e||{};this.callbacks=r?[r]:[],this.idleTimeout=n;let o=this._resetTimer.bind(this);window.addEventListener("load",o,!0),lf.forEach(function(i){document.addEventListener(i,o,!0)});let s=(i,c)=>{let a;return(...u)=>{let l=this,d=function(){a=void 0,i.apply(l,u)};clearTimeout(a),a=window.setTimeout(d,c)}};if(e?.captureScroll){let i=s(o,e?.scrollDebounce??100);window.addEventListener("scroll",i,!0)}o()}registerCallback(e){this.callbacks.push(e)}exit(){clearTimeout(this.timeoutID),window.removeEventListener("load",this._resetTimer,!0);let e=this._resetTimer.bind(this);lf.forEach(function(r){document.removeEventListener(r,e,!0)}),this.callbacks.forEach(r=>r())}_resetTimer(){let e=this.exit.bind(this);window.clearTimeout(this.timeoutID),this.timeoutID=window.setTimeout(e,this.idleTimeout)}};var hl=(t,e)=>e.some(r=>t instanceof r),hf,pf;function pl(){return hf||(hf=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ml(){return pf||(pf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var mf=new WeakMap,Vi=new WeakMap,yf=new WeakMap,$i=new WeakMap,Ki=new WeakMap;function yl(t){let e=new Promise((r,n)=>{let o=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{r(bt(t.result)),o()},i=()=>{n(t.error),o()};t.addEventListener("success",s),t.addEventListener("error",i)});return e.then(r=>{r instanceof IDBCursor&&mf.set(r,t)}).catch(()=>{}),Ki.set(e,t),e}function bl(t){if(Vi.has(t))return;let e=new Promise((r,n)=>{let o=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{r(),o()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)});Vi.set(t,e)}var ji={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return Vi.get(t);if(e==="objectStoreNames")return t.objectStoreNames||yf.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return bt(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function bf(t){ji=t(ji)}function gl(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){let n=t.call(ps(this),e,...r);return yf.set(n,e.sort?e.sort():[e]),bt(n)}:ml().includes(t)?function(...e){return t.apply(ps(this),e),bt(mf.get(this))}:function(...e){return bt(t.apply(ps(this),e))}}function wl(t){return typeof t=="function"?gl(t):(t instanceof IDBTransaction&&bl(t),hl(t,pl())?new Proxy(t,ji):t)}function bt(t){if(t instanceof IDBRequest)return yl(t);if($i.has(t))return $i.get(t);let e=wl(t);return e!==t&&($i.set(t,e),Ki.set(e,t)),e}var ps=t=>Ki.get(t);function wf(t,e,{blocked:r,upgrade:n,blocking:o,terminated:s}={}){let i=indexedDB.open(t,e),c=bt(i);return n&&i.addEventListener("upgradeneeded",a=>{n(bt(i.result),a.oldVersion,a.newVersion,bt(i.transaction),a)}),r&&i.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),c.then(a=>{s&&a.addEventListener("close",()=>s()),o&&a.addEventListener("versionchange",u=>o(u.oldVersion,u.newVersion,u))}).catch(()=>{}),c}var xl=["get","getKey","getAll","getAllKeys","count"],_l=["put","add","delete","clear"],Hi=new Map;function gf(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Hi.get(e))return Hi.get(e);let r=e.replace(/FromIndex$/,""),n=e!==r,o=_l.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||xl.includes(r)))return;let s=async function(i,...c){let a=this.transaction(i,o?"readwrite":"readonly"),u=a.store;return n&&(u=u.index(c.shift())),(await Promise.all([u[r](...c),o&&a.done]))[0]};return Hi.set(e,s),s}bf(t=>({...t,get:(e,r,n)=>gf(e,r)||t.get(e,r,n),has:(e,r)=>!!gf(e,r)||t.has(e,r)}));var xf="auth-client-db",_f="ic-keyval",El=async(t=xf,e=_f,r)=>(ms&&localStorage?.getItem(st)&&(localStorage.removeItem(st),localStorage.removeItem(it)),await wf(t,r,{upgrade:n=>{n.objectStoreNames.contains(e)&&n.clear(e),n.createObjectStore(e)}}));async function Il(t,e,r){return await t.get(e,r)}async function vl(t,e,r,n){return await t.put(e,n,r)}async function Bl(t,e,r){return await t.delete(e,r)}var Qn=class t{_db;_storeName;static async create(e){let{dbName:r=xf,storeName:n=_f,version:o=Ef}=e??{},s=await El(r,n,o);return new t(s,n)}constructor(e,r){this._db=e,this._storeName=r}async set(e,r){return await vl(this._db,this._storeName,e,r)}async get(e){return await Il(this._db,this._storeName,e)??null}async remove(e){return await Bl(this._db,this._storeName,e)}};var it="identity",st="delegation",If="iv",Ef=1,ms=typeof window<"u",eo=class{prefix;_localStorage;constructor(e="ic-",r){this.prefix=e,this._localStorage=r}get(e){return Promise.resolve(this._getLocalStorage().getItem(this.prefix+e))}set(e,r){return this._getLocalStorage().setItem(this.prefix+e,r),Promise.resolve()}remove(e){return this._getLocalStorage().removeItem(this.prefix+e),Promise.resolve()}_getLocalStorage(){if(this._localStorage)return this._localStorage;let e=typeof window>"u"?typeof global>"u"?typeof self>"u"?void 0:self.localStorage:global.localStorage:window.localStorage;if(!e)throw new Error("Could not find local storage.");return e}},to=class{#e;constructor(e){this.#e=e??{}}initializedDb;get _db(){return new Promise(e=>{if(this.initializedDb){e(this.initializedDb);return}Qn.create(this.#e).then(r=>{this.initializedDb=r,e(r)})})}async get(e){return await(await this._db).get(e)}async set(e,r){await(await this._db).set(e,r)}async remove(e){await(await this._db).remove(e)}};var Tl=BigInt(1e9),Sl=BigInt(3600),Al=Tl*Sl,Ol="https://identity.internetcomputer.org",Cl="#authorize",Rl=BigInt(8)*Al,Gi="ECDSA",Zi="Ed25519",Nl=500,Pl="UserInterrupt",ys=class{_identity;_key;_chain;_storage;idleManager;_createOptions;_idpWindow;_eventHandler;static async create(e={}){let r=e.storage??new to,n=e.keyType??Gi,o=null;if(e.identity)o=e.identity;else{let a=await r.get(it);if(!a&&ms)try{let u=new eo,l=await u.get(st),d=await u.get(it);l&&d&&n===Gi&&(console.log("Discovered an identity stored in localstorage. Migrating to IndexedDB"),await r.set(st,l),await r.set(it,d),a=l,await u.remove(st),await u.remove(it))}catch(u){console.error("error while attempting to recover localstorage: "+u)}if(a)try{typeof a=="object"?n===Zi&&typeof a=="string"?o=Nr.fromJSON(a):o=await Yn.fromKeyPair(a):typeof a=="string"&&(o=Nr.fromJSON(a))}catch{}}let s=new tr,i=null;if(o)try{let a=await r.get(st);if(typeof a=="object"&&a!==null)throw new Error("Delegation chain is incorrectly stored. A delegation chain should be stored as a string.");e.identity?s=e.identity:a&&(i=Wn.fromJSON(a),Fi(i)?"toDer"in o?s=Xn.fromDelegation(o,i):s=zn.fromDelegation(o,i):(await Yi(r),o=null))}catch(a){console.error(a),await Yi(r),o=null}let c;return e.idleOptions?.disableIdle?c=void 0:(i||e.identity)&&(c=Jn.create(e.idleOptions)),o||(n===Zi?(o=Nr.generate(),await r.set(it,JSON.stringify(o.toJSON()))):(e.storage&&n===Gi&&console.warn(`You are using a custom storage provider that may not support CryptoKey storage. If you are using a custom storage provider that does not support CryptoKey storage, you should use '${Zi}' as the key type, as it can serialize to a string`),o=await Yn.generate(),await r.set(it,o.getKeyPair()))),new this(s,o,i,r,c,e)}constructor(e,r,n,o,s,i,c,a){this._identity=e,this._key=r,this._chain=n,this._storage=o,this.idleManager=s,this._createOptions=i,this._idpWindow=c,this._eventHandler=a,this._registerDefaultIdleCallback()}_registerDefaultIdleCallback(){let e=this._createOptions?.idleOptions;!e?.onIdle&&!e?.disableDefaultIdleCallback&&this.idleManager?.registerCallback(()=>{this.logout(),location.reload()})}async _handleSuccess(e,r){let n=e.delegations.map(c=>({delegation:new fn(c.delegation.pubkey,c.delegation.expiration,c.delegation.targets),signature:c.signature})),o=Wn.fromDelegations(n,e.userPublicKey),s=this._key;if(!s)return;this._chain=o,"toDer"in s?this._identity=Xn.fromDelegation(s,this._chain):this._identity=zn.fromDelegation(s,this._chain),this._idpWindow?.close();let i=this._createOptions?.idleOptions;!this.idleManager&&!i?.disableIdle&&(this.idleManager=Jn.create(i),this._registerDefaultIdleCallback()),this._removeEventListener(),delete this._idpWindow,this._chain&&await this._storage.set(st,JSON.stringify(this._chain.toJSON())),r?.(e)}getIdentity(){return this._identity}async isAuthenticated(){return!this.getIdentity().getPrincipal().isAnonymous()&&this._chain!==null&&Fi(this._chain)}async login(e){let r=Ul(this._createOptions?.loginOptions,e),n=r?.maxTimeToLive??Rl,o=new URL(r?.identityProvider?.toString()||Ol);o.hash=Cl,this._idpWindow?.close(),this._removeEventListener(),this._eventHandler=this._getEventHandler(o,{maxTimeToLive:n,...r}),window.addEventListener("message",this._eventHandler),this._idpWindow=window.open(o.toString(),"idpWindow",r?.windowOpenerFeatures)??void 0;let s=()=>{this._idpWindow&&(this._idpWindow.closed?this._handleFailure(Pl,r?.onError):setTimeout(s,Nl))};s()}_getEventHandler(e,r){return async n=>{if(n.origin!==e.origin)return;let o=n.data;switch(o.kind){case"authorize-ready":{let s={kind:"authorize-client",sessionPublicKey:new Uint8Array(this._key?.getPublicKey().toDer()),maxTimeToLive:r?.maxTimeToLive,allowPinAuthentication:r?.allowPinAuthentication,derivationOrigin:r?.derivationOrigin?.toString(),...r?.customValues};this._idpWindow?.postMessage(s,e.origin);break}case"authorize-client-success":try{await this._handleSuccess(o,r?.onSuccess)}catch(s){this._handleFailure(s.message,r?.onError)}break;case"authorize-client-failure":this._handleFailure(o.text,r?.onError);break;default:break}}}_handleFailure(e,r){this._idpWindow?.close(),r?.(e),this._removeEventListener(),delete this._idpWindow}_removeEventListener(){this._eventHandler&&window.removeEventListener("message",this._eventHandler),this._eventHandler=void 0}async logout(e={}){if(await Yi(this._storage),this._identity=new tr,this._chain=null,e.returnTo)try{window.history.pushState({},"",e.returnTo)}catch{window.location.href=e.returnTo}}};async function Yi(t){await t.remove(it),await t.remove(st),await t.remove(If)}function Ul(t,e){if(!t&&!e)return;let r=t?.customValues||e?.customValues?{...t?.customValues,...e?.customValues}:void 0;return{...t,...e,customValues:r}}var Dl=({IDL:t})=>t.Service({whoami:t.Func([],[t.Text],["query"]),link_sol_pubkey:t.Func([t.Text,t.Vec(t.Nat8)],[t.Text],[]),unlink_sol_pubkey:t.Func([],[t.Text],[]),get_deposit_address:t.Func([t.Text],[t.Text],["query"]),get_balance:t.Func([t.Text],[t.Nat64],[]),get_nonce:t.Func([t.Text],[t.Nat64],[]),get_pid:t.Func([t.Text],[t.Text],["query"]),get_sol_deposit_address:t.Func([t.Text],[t.Text],[]),get_sol_balance:t.Func([t.Text],[t.Nat64],[]),transfer:t.Func([t.Text,t.Nat64,t.Text,t.Vec(t.Nat8),t.Nat64],[t.Text],[]),transfer_sol:t.Func([t.Text,t.Nat64,t.Text,t.Vec(t.Nat8),t.Nat64],[t.Text],[]),get_sol_deposit_address_ii:t.Func([],[t.Text],[]),get_deposit_address_ii:t.Func([],[t.Text],[]),get_sol_balance_ii:t.Func([],[t.Nat64],[]),get_balance_ii:t.Func([],[t.Nat64],[]),get_nonce_ii:t.Func([],[t.Nat64],[]),transfer_ii:t.Func([t.Text,t.Nat64],[t.Text],[]),transfer_sol_ii:t.Func([t.Text,t.Nat64],[t.Text],[])}),vf=Dl;var kl="https://ic0.app",Ll="f4kcz-fqaaa-aaaap-an3hq-cai",Ft=null,Es=null,Bf=null,oe=null,De=null,pe=null;function xs(t,e){document.getElementById(t).style.display=e?"block":"none"}function Ee(t,e){document.getElementById(t).innerText=e}function un(t,e){let r=document.getElementById("alerts");r.className=t,r.textContent=e||""}var gt=t=>un("ok",t),z=t=>un("warn",t),wt=t=>un("err",t),$t=t=>un("muted",t);function at(t){let e=(t?.message||String(t||"")).trim();return/Request timed out after/i.test(e)?"Request timed out. This may be due to network delays or consensus issues. The operation may still succeed\u2014refresh balances in a few seconds.":/processing/i.test(e)&&/Request ID:/i.test(e)?"The network is processing the call. Refresh balances shortly.":/inconsistent/i.test(e)||/consensus/i.test(e)?"Network variance prevented consensus. Retry the operation.":/blockhash/i.test(e)?"Blockhash retrieval failed; network may be busy. Retry.":e}function $e(t,e){return t().catch(r=>{let n=at(r);throw e?e(n,r):wt(n),r})}async function fr(t,e=9e5){let r,n=new Promise((o,s)=>{r=setTimeout(()=>s(new Error(`Timed out after ${e} ms`)),e)});return Promise.race([t,n]).finally(()=>clearTimeout(r))}async function so(){Bf=new Rr({host:kl,identity:Es??void 0}),oe=ls.createActor(vf,{agent:Bf,canisterId:Ll})}async function io(){Ft||(Ft=await ys.create())}function Ml(){if("phantom"in window){let t=window.phantom?.solana;if(t?.isPhantom)return t}window.open("https://phantom.app/","_blank")}var dn=Ml(),ro=1e-4,no=2e-4,bs=1e-4,gs=2e-4,ws=5e-6,ql=BigInt(Math.round(ro*1e8)),Fl=BigInt(Math.round(no*1e8)),Wi=0,zi=!1,Xi=0,Ji=!1,_s=1e4;async function Tf(t=!1){let e=Date.now();if(!t&&e-Wi<_s){let i=Math.ceil((_s-(e-Wi))/1e3);z(`Please wait ~${i}s before refreshing SOL again.`);return}if(zi){$t("Refreshing SOL\u2026");return}zi=!0;let r=document.getElementById("get_sol");r&&(r.disabled=!0);let n=0,o=!1;try{if(De==="ii")n=await fr($e(()=>oe.get_sol_balance_ii(),i=>z(i)));else if(De==="phantom"){if(!pe)return z("Connect Phantom first");n=await fr($e(()=>oe.get_sol_balance(pe),i=>z(i)))}else{z("Pick an auth mode to refresh SOL.");return}$t("SOL balance updated."),Wi=Date.now()}catch(i){o=!0,String(i).includes("Timed out")?z("SOL refresh timed out. Network may be slow\u2014try again in a minute."):wt(at(i))}finally{zi=!1,r&&(r.disabled=!1)}let s=`SOL Balance: ${(Number(n)/1e9).toFixed(9)} SOL`;o&&(s+=" (fetch failed)"),Ee("sol_balance",s)}async function Sf(t=!1){let e=Date.now();if(!t&&e-Xi<_s){let i=Math.ceil((_s-(e-Xi))/1e3);z(`Please wait ~${i}s before refreshing ICP again.`);return}if(Ji){$t("Refreshing ICP\u2026");return}Ji=!0;let r=document.getElementById("refresh_icp");r&&(r.disabled=!0);let n=0,o=!1;try{if(De==="ii")n=await fr($e(()=>oe.get_balance_ii(),i=>z(i)));else if(De==="phantom"){if(!pe)return z("Connect Phantom first");n=await fr($e(()=>oe.get_balance(pe),i=>z(i)))}else{z("Pick an auth mode to refresh ICP.");return}$t("ICP balance updated."),Xi=Date.now()}catch(i){o=!0,String(i).includes("Timed out")?z("ICP refresh timed out. Network may be slow\u2014try again in a minute."):wt(at(i))}finally{Ji=!1,r&&(r.disabled=!1)}let s=`ICP Balance: ${(Number(n)/1e8).toFixed(8)} ICP`;o&&(s+=" (fetch failed)"),Ee("balance",s)}async function Pr(t=!1){await Promise.allSettled([Sf(t),Tf(t)])}function Af(){["deposit","balance","sol_deposit","sol_balance","pid","pubkey","ii_status","status"].forEach(t=>Ee(t,"")),["to","amount","to_sol","amount_sol"].forEach(t=>document.getElementById(t).value="")}function $l(){xs("ii_block",!0),xs("phantom_block",!1),Ee("mode_status","Mode: Internet Identity"),un("","")}function Vl(){xs("phantom_block",!0),xs("ii_block",!1),Ee("mode_status","Mode: Phantom"),un("","")}document.getElementById("mode_ii").onclick=async()=>{if(Af(),De==="phantom"){try{await dn.disconnect()}catch{}pe=null}De="ii",await io(),await so(),$l()};document.getElementById("mode_phantom").onclick=async()=>{if(Af(),De==="ii"){Ft||await io();try{await Ft.logout()}catch{}Es=null}De="phantom",await so(),Vl()};document.getElementById("ii_login").onclick=async()=>{if(De!=="ii")return alert("Switch to Internet Identity mode first");await io();let t={identityProvider:"https://identity.ic0.app"};Ft.login({...t,maxTimeToLive:BigInt(7)*BigInt(1440*60*1e9),onSuccess:async()=>{Es=Ft.getIdentity(),await so();try{let e=await oe.whoami();Ee("ii_status",`Signed in as: ${e}`);let r=await $e(()=>oe.get_deposit_address_ii(),o=>z(o));Ee("deposit",`ICP Deposit to: ${r}`);let n=await $e(()=>oe.get_sol_deposit_address_ii(),o=>z(o));Ee("sol_deposit",`SOL Deposit to: ${n}`),Ee("pid",`ICP Principal: ${e}`),await Pr(!0),gt("Logged in with Internet Identity.")}catch(e){Ee("ii_status","Signed in (fetch error)."),z(at(e))}},onError:e=>{wt(`II login failed: ${at(e)}`)}})};document.getElementById("ii_logout").onclick=async()=>{await io(),await Ft.logout(),Es=null,await so(),Ee("ii_status","Not signed in"),Ee("pid",""),$t("Logged out of Internet Identity.")};document.getElementById("connect").onclick=async()=>{if(De!=="phantom")return alert("Switch to Phantom mode first");try{pe=(await dn.connect()).publicKey.toString(),Ee("pubkey",`Sol Pubkey: ${pe} (Solana Mainnet)`);let e=await $e(()=>oe.get_deposit_address(pe),n=>z(n));Ee("deposit",`ICP Deposit to: ${e} (Send ICP here)`);let r=await $e(()=>oe.get_sol_deposit_address(pe),n=>z(n));Ee("sol_deposit",`SOL Deposit to: ${r} (Mainnet; send SOL here)`),await Pr(!0),gt("Connected to Phantom.")}catch(t){wt(`Phantom connect error: ${at(t)}`)}};document.getElementById("logout").onclick=async()=>{try{await dn.disconnect()}catch{}pe=null,["pubkey","pid","deposit","balance","sol_deposit","sol_balance"].forEach(t=>Ee(t,"")),$t("Disconnected Phantom. To prevent auto-reconnect, revoke in Phantom settings.")};document.getElementById("link_wallet").onclick=async()=>{if(!pe)return alert("Connect Phantom first");try{if(Ft||await io(),!await Ft.isAuthenticated())return alert("Login with Internet Identity (II mode) to link");let e=`link ${await oe.whoami()}`,r=new TextEncoder().encode(e),o=(await dn.signMessage(r,"utf8")).signature,s=await $e(()=>oe.link_sol_pubkey(pe,Array.from(o)));gt(s)}catch(t){wt(`Link error: ${at(t)}`)}};var Qi=!1;document.getElementById("send").onclick=async()=>{if(Qi)return z("ICP send already in progress.");Qi=!0;let t=document.getElementById("send");t.disabled=!0,t.innerText="Processing... (may take 30s)";let e;try{let r=document.getElementById("to").value,n=document.getElementById("amount").value;if(isNaN(parseFloat(n))||parseFloat(n)<0)throw new Error("Invalid amount");let o=BigInt(Math.round(parseFloat(n)*1e8));if(De==="ii"){e=await oe.get_nonce_ii();let s=parseFloat(n)+gs+ro,i=`Confirm transaction (II mode):
To: ${r}
Amount: ${n} ICP
Network fee: ${gs} ICP
Service fee: ${ro} ICP
Total deduction: ${s.toFixed(8)} ICP`;if(!window.confirm(i))throw new Error("Cancelled");let c=await fr($e(()=>oe.transfer_ii(r,o),a=>z(a)));oo(c),await Pr(!0),c.startsWith("Transfer successful")?(document.getElementById("to").value="",document.getElementById("amount").value="",gt("ICP transfer complete. Balances updated.")):z(c);return}if(De==="phantom"){if(!pe)throw new Error("Connect Phantom first");e=await oe.get_nonce(pe);let i=parseFloat(n)+gs+ro,c=`Confirm transaction (Phantom mode):
To: ${r}
Amount: ${n} ICP
Network fee: ${gs} ICP
Service fee: ${ro} ICP
Total deduction: ${i.toFixed(8)} ICP`;if(!window.confirm(c))throw new Error("Cancelled");let a=`transfer to ${r} amount ${o} nonce ${e} service_fee ${ql}`,u=new TextEncoder().encode(a),d=(await dn.signMessage(u,"utf8")).signature,f=await fr($e(()=>oe.transfer(r,o,pe,Array.from(d),e),h=>z(h)));oo(f),await Pr(!0),f.startsWith("Transfer successful")?(document.getElementById("to").value="",document.getElementById("amount").value="",gt("ICP transfer complete. Balances updated.")):z(f)}}catch(r){let n=(r?.message||String(r||"")).toLowerCase();n.includes("timed out")||n.includes("processing")?await Of(e,"ICP"):r.message==="Cancelled"||wt(`ICP send error: ${at(r)}`)}finally{Qi=!1,t.disabled=!1,t.innerText="Send ICP"}};document.getElementById("get_sol").onclick=async()=>{await Tf(!1)};document.getElementById("refresh_icp").onclick=async()=>{await Sf(!1)};var ea=!1;document.getElementById("send_sol").onclick=async()=>{if(ea)return z("SOL send already in progress.");ea=!0;let t=document.getElementById("send_sol");t.disabled=!0,t.innerText="Processing... (may take 30s)";let e;try{let r=document.getElementById("to_sol").value,n=document.getElementById("amount_sol").value;if(isNaN(parseFloat(n))||parseFloat(n)<0)throw new Error("Invalid amount");let o=BigInt(Math.round(parseFloat(n)*1e9));if(De==="ii"){e=await oe.get_nonce_ii();let s=parseFloat(n)+ws,i=no+bs,c=`Confirm SOL transaction (II mode):
To: ${r}
Amount: ${n} SOL
Solana fee: ~${ws} SOL
ICP ledger fee: ${bs} ICP
Service fee: ${no} ICP
Total SOL deduction: ${s.toFixed(9)} SOL
Total ICP deduction: ${i.toFixed(4)} ICP`;if(!window.confirm(c))throw new Error("Cancelled");let a=await fr($e(()=>oe.transfer_sol_ii(r,o),u=>z(u)));oo(a),await Pr(!0),a.startsWith("Transfer successful")?(document.getElementById("to_sol").value="",document.getElementById("amount_sol").value="",gt("SOL transfer complete. Balances updated.")):z(a);return}if(De==="phantom"){if(!pe)throw new Error("Connect first");e=await oe.get_nonce(pe);let i=parseFloat(n)+ws,c=no+bs,a=`Confirm SOL transaction (Phantom mode):
To: ${r}
Amount: ${n} SOL
Solana fee: ~${ws} SOL
ICP ledger fee: ${bs} ICP
Service fee: ${no} ICP
Total SOL deduction: ${i.toFixed(9)} SOL
Total ICP deduction: ${c.toFixed(4)} ICP`;if(!window.confirm(a))throw new Error("Cancelled");let u=`transfer_sol to ${r} amount ${o} nonce ${e} service_fee ${Fl}`,l=new TextEncoder().encode(u),f=(await dn.signMessage(l,"utf8")).signature,h=await fr($e(()=>oe.transfer_sol(r,o,pe,Array.from(f),e),p=>z(p)));oo(h),await Pr(!0),h.startsWith("Transfer successful")?(document.getElementById("to_sol").value="",document.getElementById("amount_sol").value="",gt("SOL transfer complete. Balances updated.")):z(h)}}catch(r){let n=(r?.message||String(r||"")).toLowerCase();n.includes("timed out")||n.includes("processing")?await Of(e,"SOL"):r.message==="Cancelled"||wt(`SOL send error: ${at(r)}`)}finally{ea=!1,t.disabled=!1,t.innerText="Send SOL"}};async function jl(t,e=10,r=15e3){for(let n=1;n<=e;n++){await new Promise(o=>setTimeout(o,r));try{if((De==="ii"?await oe.get_nonce_ii():await oe.get_nonce(pe))>t)return!0}catch{}$t(`Polling for confirmation (${n}/${e})...`)}return!1}async function Of(t,e="ICP"){$t(`${e} send submitted, waiting for network confirmation...`),await jl(t,12,1e4)?(oo("Transfer successful (confirmed via nonce change)"),await Pr(!0),gt(`${e} transfer complete (delayed confirmation). Balances updated.`)):z(`${e} send timed out and no confirmation detected. Check explorer or retry.`)}function oo(t){let e=document.getElementById("latest-tx"),r=t,n="muted",o=t.toLowerCase(),s=t.startsWith("Transfer successful"),i=t.startsWith("Transfer failed")||t.startsWith("Send failed"),c=!s&&/error/.test(o);if(s){n="ok";let a=t.match(/block (\d+)/);if(a){let l=a[1];r+=' <a href="https://dashboard.internetcomputer.org/" target="_blank">View on ICP Dashboard</a>'}let u=t.match(/txid (\S+)/);if(u){let d=`https://explorer.solana.com/tx/${u[1]}`;r+=` <a href="${d}" target="_blank">View on Solana Explorer</a>`}}else i?n="err":c&&(n="warn");e.className=n,e.innerHTML=r}await so();Ee("mode_status","Pick a mode: Internet Identity or Phantom");$t("Ready.");document.getElementById("latest-tx").innerHTML="No transactions yet.";document.getElementById("copy_icp").onclick=async()=>{let e=document.getElementById("deposit").innerText.trim();if(!e.startsWith("ICP Deposit to: ")){z("No ICP address loaded yet.");return}let r=e.split("ICP Deposit to: ")[1].trim();try{await navigator.clipboard.writeText(r);let n=document.getElementById("copy_icp");n.innerText="Copied!",setTimeout(()=>{n.innerText="Copy ICP Addr"},2e3),gt("ICP address copied to clipboard.")}catch(n){wt(`Failed to copy ICP address: ${at(n)}`)}};document.getElementById("copy_sol").onclick=async()=>{let e=document.getElementById("sol_deposit").innerText.trim();if(!e.startsWith("SOL Deposit to: ")){z("No SOL address loaded yet.");return}let r=e.split("SOL Deposit to: ")[1].trim();try{await navigator.clipboard.writeText(r);let n=document.getElementById("copy_sol");n.innerText="Copied!",setTimeout(()=>{n.innerText="Copy SOL Addr"},2e3),gt("SOL address copied to clipboard.")}catch(n){wt(`Failed to copy SOL address: ${at(n)}`)}};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/abstract/bls.js:
@noble/curves/esm/abstract/tower.js:
@noble/curves/esm/bls12-381.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
