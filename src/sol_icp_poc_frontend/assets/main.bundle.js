var oa=Object.defineProperty;var sa=(t,e)=>{for(var r in e)oa(t,r,{get:e[r],enumerable:!0})};var js;(function(t){t[t.SysFatal=1]="SysFatal",t[t.SysTransient=2]="SysTransient",t[t.DestinationInvalid=3]="DestinationInvalid",t[t.CanisterReject=4]="CanisterReject",t[t.CanisterError=5]="CanisterError"})(js||(js={}));var At;(function(t){t.Replied="replied",t.Rejected="rejected"})(At||(At={}));function Hs(t){return t!=null&&"reject_code"in t}function Ks(t){return t!=null&&"certificate"in t}var vn="abcdefghijklmnopqrstuvwxyz234567",yr=Object.create(null);for(let t=0;t<vn.length;t++)yr[vn[t]]=t;yr[0]=yr.o;yr[1]=yr.i;function Gs(t){let e=0,r=0,n="";function o(s){return e<0?r|=s>>-e:r=s<<e&248,e>3?(e-=8,1):(e<4&&(n+=vn[r>>3],e+=5),0)}for(let s=0;s<t.length;)s+=o(t[s]);return n+(e<0?vn[r>>3]:"")}function Zs(t){let e=0,r=0,n=new Uint8Array(t.length*4/3|0),o=0;function s(i){let c=yr[i.toLowerCase()];if(c===void 0)throw new Error(`Invalid character: ${JSON.stringify(i)}`);c<<=3,r|=c>>>e,e+=5,e>=8&&(n[o++]=r,e-=8,e>0?r=c<<5-e&255:r=0)}for(let i of t)s(i);return n.slice(0,o)}var ia=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function Ys(t){let e=-1;for(let r=0;r<t.length;r++){let o=(t[r]^e)&255;e=ia[o]^e>>>8}return(e^-1)>>>0}var Gt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function rt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Oo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ne(t,...e){if(!rt(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Co(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function zs(t,e){ne(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Zt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Tn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function je(t,e){return t<<32-e|t>>>e}var Ws=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",ca=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function K(t){if(ne(t),Ws)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=ca[t[r]];return e}var at={_0:48,_9:57,A:65,F:70,a:97,f:102};function Xs(t){if(t>=at._0&&t<=at._9)return t-at._0;if(t>=at.A&&t<=at.F)return t-(at.A-10);if(t>=at.a&&t<=at.f)return t-(at.a-10)}function He(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Ws)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=Xs(t.charCodeAt(s)),c=Xs(t.charCodeAt(s+1));if(i===void 0||c===void 0){let a=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function z(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ro(t){return typeof t=="string"&&(t=z(t)),ne(t),t}function F(...t){let e=0;for(let n=0;n<t.length;n++){let o=t[n];ne(o),e+=o.length}let r=new Uint8Array(e);for(let n=0,o=0;n<t.length;n++){let s=t[n];r.set(s,o),o+=s.length}return r}var In=class{};function Sn(t){let e=n=>t().update(Ro(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function br(t=32){if(Gt&&typeof Gt.getRandomValues=="function")return Gt.getRandomValues(new Uint8Array(t));if(Gt&&typeof Gt.randomBytes=="function")return Uint8Array.from(Gt.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function aa(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),c=Number(r&s),a=n?4:0,u=n?0:4;t.setUint32(e+a,i,n),t.setUint32(e+u,c,n)}function Qs(t,e,r){return t&e^~t&r}function Js(t,e,r){return t&e^t&r^e&r}var Fr=class extends In{constructor(e,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=Tn(this.buffer)}update(e){Co(this),e=Ro(e),ne(e);let{view:r,buffer:n,blockLen:o}=this,s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=Tn(e);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Co(this),zs(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,Zt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let d=i;d<o;d++)r[d]=0;aa(n,o-8,BigInt(this.length*8),s),this.process(n,0);let c=Tn(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=a/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)c.setUint32(4*d,h[d],s)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return e.destroyed=i,e.finished=s,e.length=o,e.pos=c,o%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}},ft=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ut=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]);var be=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var An=BigInt(4294967295),ei=BigInt(32);function fa(t,e=!1){return e?{h:Number(t&An),l:Number(t>>ei&An)}:{h:Number(t>>ei&An)|0,l:Number(t&An)|0}}function ti(t,e=!1){let r=t.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:c}=fa(t[s],e);[n[s],o[s]]=[i,c]}return[n,o]}var No=(t,e,r)=>t>>>r,Uo=(t,e,r)=>t<<32-r|e>>>r,Yt=(t,e,r)=>t>>>r|e<<32-r,Xt=(t,e,r)=>t<<32-r|e>>>r,$r=(t,e,r)=>t<<64-r|e>>>r-32,Vr=(t,e,r)=>t>>>r-32|e<<64-r;function nt(t,e,r,n){let o=(e>>>0)+(n>>>0);return{h:t+r+(o/2**32|0)|0,l:o|0}}var ri=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),ni=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,oi=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),si=(t,e,r,n,o)=>e+r+n+o+(t/2**32|0)|0,ii=(t,e,r,n,o)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(o>>>0),ci=(t,e,r,n,o,s)=>e+r+n+o+s+(t/2**32|0)|0;var da=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ot=new Uint32Array(64),On=class extends Fr{constructor(e=32){super(64,e,8,!1),this.A=ft[0]|0,this.B=ft[1]|0,this.C=ft[2]|0,this.D=ft[3]|0,this.E=ft[4]|0,this.F=ft[5]|0,this.G=ft[6]|0,this.H=ft[7]|0}get(){let{A:e,B:r,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[e,r,n,o,s,i,c,a]}set(e,r,n,o,s,i,c,a){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,r){for(let d=0;d<16;d++,r+=4)Ot[d]=e.getUint32(r,!1);for(let d=16;d<64;d++){let f=Ot[d-15],l=Ot[d-2],p=je(f,7)^je(f,18)^f>>>3,b=je(l,17)^je(l,19)^l>>>10;Ot[d]=b+Ot[d-7]+p+Ot[d-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:u,H:h}=this;for(let d=0;d<64;d++){let f=je(c,6)^je(c,11)^je(c,25),l=h+f+Qs(c,a,u)+da[d]+Ot[d]|0,b=(je(n,2)^je(n,13)^je(n,22))+Js(n,o,s)|0;h=u,u=a,a=c,c=i+l|0,i=s,s=o,o=n,n=l+b|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(n,o,s,i,c,a,u,h)}roundClean(){Zt(Ot)}destroy(){this.set(0,0,0,0,0,0,0,0),Zt(this.buffer)}},qo=class extends On{constructor(){super(28),this.A=ut[0]|0,this.B=ut[1]|0,this.C=ut[2]|0,this.D=ut[3]|0,this.E=ut[4]|0,this.F=ut[5]|0,this.G=ut[6]|0,this.H=ut[7]|0}},ai=ti(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),la=ai[0],ha=ai[1],Ct=new Uint32Array(80),Rt=new Uint32Array(80),Po=class extends Fr{constructor(e=64){super(128,e,16,!1),this.Ah=be[0]|0,this.Al=be[1]|0,this.Bh=be[2]|0,this.Bl=be[3]|0,this.Ch=be[4]|0,this.Cl=be[5]|0,this.Dh=be[6]|0,this.Dl=be[7]|0,this.Eh=be[8]|0,this.El=be[9]|0,this.Fh=be[10]|0,this.Fl=be[11]|0,this.Gh=be[12]|0,this.Gl=be[13]|0,this.Hh=be[14]|0,this.Hl=be[15]|0}get(){let{Ah:e,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:c,Dl:a,Eh:u,El:h,Fh:d,Fl:f,Gh:l,Gl:p,Hh:b,Hl:g}=this;return[e,r,n,o,s,i,c,a,u,h,d,f,l,p,b,g]}set(e,r,n,o,s,i,c,a,u,h,d,f,l,p,b,g){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=a|0,this.Eh=u|0,this.El=h|0,this.Fh=d|0,this.Fl=f|0,this.Gh=l|0,this.Gl=p|0,this.Hh=b|0,this.Hl=g|0}process(e,r){for(let y=0;y<16;y++,r+=4)Ct[y]=e.getUint32(r),Rt[y]=e.getUint32(r+=4);for(let y=16;y<80;y++){let _=Ct[y-15]|0,v=Rt[y-15]|0,I=Yt(_,v,1)^Yt(_,v,8)^No(_,v,7),T=Xt(_,v,1)^Xt(_,v,8)^Uo(_,v,7),A=Ct[y-2]|0,E=Rt[y-2]|0,S=Yt(A,E,19)^$r(A,E,61)^No(A,E,6),U=Xt(A,E,19)^Vr(A,E,61)^Uo(A,E,6),C=oi(T,U,Rt[y-7],Rt[y-16]),x=si(C,I,S,Ct[y-7],Ct[y-16]);Ct[y]=x|0,Rt[y]=C|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:c,Cl:a,Dh:u,Dl:h,Eh:d,El:f,Fh:l,Fl:p,Gh:b,Gl:g,Hh:m,Hl:w}=this;for(let y=0;y<80;y++){let _=Yt(d,f,14)^Yt(d,f,18)^$r(d,f,41),v=Xt(d,f,14)^Xt(d,f,18)^Vr(d,f,41),I=d&l^~d&b,T=f&p^~f&g,A=ii(w,v,T,ha[y],Rt[y]),E=ci(A,m,_,I,la[y],Ct[y]),S=A|0,U=Yt(n,o,28)^$r(n,o,34)^$r(n,o,39),C=Xt(n,o,28)^Vr(n,o,34)^Vr(n,o,39),x=n&s^n&c^s&c,B=o&i^o&a^i&a;m=b|0,w=g|0,b=l|0,g=p|0,l=d|0,p=f|0,{h:d,l:f}=nt(u|0,h|0,E|0,S|0),u=c|0,h=a|0,c=s|0,a=i|0,s=n|0,i=o|0;let R=ri(S,C,B);n=ni(R,E,U,x),o=R|0}({h:n,l:o}=nt(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=nt(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:a}=nt(this.Ch|0,this.Cl|0,c|0,a|0),{h:u,l:h}=nt(this.Dh|0,this.Dl|0,u|0,h|0),{h:d,l:f}=nt(this.Eh|0,this.El|0,d|0,f|0),{h:l,l:p}=nt(this.Fh|0,this.Fl|0,l|0,p|0),{h:b,l:g}=nt(this.Gh|0,this.Gl|0,b|0,g|0),{h:m,l:w}=nt(this.Hh|0,this.Hl|0,m|0,w|0),this.set(n,o,s,i,c,a,u,h,d,f,l,p,b,g,m,w)}roundClean(){Zt(Ct,Rt)}destroy(){Zt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var xe=Sn(()=>new On),fi=Sn(()=>new qo),ui=Sn(()=>new Po);var Cn="__principal__",pa=2,di=4,ma="aaaaa-aa",H=class t{static anonymous(){return new this(new Uint8Array([di]))}static managementCanister(){return this.fromText(ma)}static selfAuthenticating(e){let r=fi(e);return new this(new Uint8Array([...r,pa]))}static from(e){if(typeof e=="string")return t.fromText(e);if(Object.getPrototypeOf(e)===Uint8Array.prototype)return new t(e);if(t.isPrincipal(e))return new t(e._arr);throw new Error(`Impossible to convert ${JSON.stringify(e)} to Principal.`)}static fromHex(e){return new this(He(e))}static fromText(e){let r=e;if(e.includes(Cn)){let i=JSON.parse(e);Cn in i&&(r=i[Cn])}let n=r.toLowerCase().replace(/-/g,""),o=Zs(n);o=o.slice(4,o.length);let s=new this(o);if(s.toText()!==r)throw new Error(`Principal "${s.toText()}" does not have a valid checksum (original value "${r}" may not be a valid Principal ID).`);return s}static fromUint8Array(e){return new this(e)}static isPrincipal(e){return e instanceof t||typeof e=="object"&&e!==null&&"_isPrincipal"in e&&e._isPrincipal===!0&&"_arr"in e&&e._arr instanceof Uint8Array}constructor(e){this._arr=e,this._isPrincipal=!0}isAnonymous(){return this._arr.byteLength===1&&this._arr[0]===di}toUint8Array(){return this._arr}toHex(){return K(this._arr).toUpperCase()}toText(){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,Ys(this._arr));let n=new Uint8Array(e),o=new Uint8Array([...n,...this._arr]),i=Gs(o).match(/.{1,5}/g);if(!i)throw new Error;return i.join("-")}toString(){return this.toText()}toJSON(){return{[Cn]:this.toText()}}compareTo(e){for(let r=0;r<Math.min(this._arr.length,e._arr.length);r++){if(this._arr[r]<e._arr[r])return"lt";if(this._arr[r]>e._arr[r])return"gt"}return this._arr.length<e._arr.length?"lt":this._arr.length>e._arr.length?"gt":"eq"}ltEq(e){let r=this.compareTo(e);return r=="lt"||r=="eq"}gtEq(e){let r=this.compareTo(e);return r=="gt"||r=="eq"}};var dt;(function(t){t.Trust="Trust",t.Protocol="Protocol",t.Reject="Reject",t.Transport="Transport",t.External="External",t.Limit="Limit",t.Input="Input",t.Unknown="Unknown"})(dt||(dt={}));var V=class{constructor(e=!1){this.isCertified=e}toString(){let e=this.toErrorMessage();return this.requestContext&&(e+=`
Request context:
  Request ID (hex): ${this.requestContext.requestId?K(this.requestContext.requestId):"undefined"}
  Sender pubkey (hex): ${K(this.requestContext.senderPubKey)}
  Sender signature (hex): ${K(this.requestContext.senderSignature)}
  Ingress expiry: ${this.requestContext.ingressExpiry.toString()}`),this.callContext&&(e+=`
Call context:
  Canister ID: ${this.callContext.canisterId.toText()}
  Method name: ${this.callContext.methodName}
  HTTP details: ${JSON.stringify(this.callContext.httpDetails,null,2)}`),e}},Ke=class t extends Error{get code(){return this.cause.code}set code(e){this.cause.code=e}get kind(){return this.cause.kind}set kind(e){this.cause.kind=e}get isCertified(){return this.code.isCertified}constructor(e,r){super(e.toString()),this.name="AgentError",this.cause={code:e,kind:r},Object.setPrototypeOf(this,t.prototype)}hasCode(e){return this.code instanceof e}toString(){return`${this.name} (${this.kind}): ${this.message}`}},lt=class extends Ke{static fromCode(e){return new this(e)}},Be=class t extends lt{constructor(e){super(e,dt.Trust),this.name="TrustError",Object.setPrototypeOf(this,t.prototype)}},Q=class t extends lt{constructor(e){super(e,dt.Protocol),this.name="ProtocolError",Object.setPrototypeOf(this,t.prototype)}},Nt=class t extends lt{constructor(e){super(e,dt.Reject),this.name="RejectError",Object.setPrototypeOf(this,t.prototype)}},jr=class t extends lt{constructor(e){super(e,dt.Transport),this.name="TransportError",Object.setPrototypeOf(this,t.prototype)}},ae=class t extends lt{constructor(e){super(e,dt.External),this.name="ExternalError",Object.setPrototypeOf(this,t.prototype)}};var G=class t extends lt{constructor(e){super(e,dt.Input),this.name="InputError",Object.setPrototypeOf(this,t.prototype)}},le=class t extends lt{constructor(e){super(e,dt.Unknown),this.name="UnknownError",Object.setPrototypeOf(this,t.prototype)}},zt=class t extends V{constructor(e){super(),this.reason=e,this.name="CertificateVerificationErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Certificate verification error: "${this.reason}"`}},Hr=class t extends V{constructor(e,r,n,o){super(),this.maxAgeInMinutes=e,this.certificateTime=r,this.currentTime=n,this.ageType=o,this.name="CertificateTimeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Certificate is signed more than ${this.maxAgeInMinutes} minutes in the ${this.ageType}. Certificate time: ${this.certificateTime.toISOString()} Current time: ${this.currentTime.toISOString()}`}},Rn=class t extends V{constructor(){super(),this.name="CertificateHasTooManyDelegationsErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Certificate has too many delegations"}},gr=class t extends V{constructor(e,r){super(),this.canisterId=e,this.subnetId=r,this.name="CertificateNotAuthorizedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The certificate contains a delegation that does not include the canister ${this.canisterId.toText()} in the canister_ranges field. Subnet ID: 0x${K(this.subnetId)}`}},ht=class t extends V{constructor(e,r){super(),this.message=e,this.lookupStatus=r,this.name="LookupErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`${this.message}. Lookup status: ${this.lookupStatus}`}},xr=class t extends V{constructor(e){super(),this.message=e,this.name="MalformedLookupFoundValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.message}},Nn=class t extends V{constructor(e){super(),this.message=e,this.name="MissingLookupValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.message}},wr=class t extends V{constructor(e,r){super(),this.expectedLength=e,this.actualLength=r,this.name="DerKeyLengthMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`BLS DER-encoded public key must be ${this.expectedLength} bytes long, but is ${this.actualLength} bytes long`}},Un=class t extends V{constructor(e,r){super(),this.expectedPrefix=e,this.actualPrefix=r,this.name="DerPrefixMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`BLS DER-encoded public key is invalid. Expected the following prefix: ${K(this.expectedPrefix)}, but got ${K(this.actualPrefix)}`}},qn=class t extends V{constructor(e,r){super(),this.expectedLength=e,this.actualLength=r,this.name="DerDecodeLengthMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`DER payload mismatch: Expected length ${this.expectedLength}, actual length: ${this.actualLength}`}},Ge=class t extends V{constructor(e){super(),this.error=e,this.name="DerDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode DER: ${this.error}`}},Kr=class t extends V{constructor(e){super(),this.error=e,this.name="DerEncodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to encode DER: ${this.error}`}},Pn=class t extends V{constructor(e,r){super(),this.error=e,this.input=r,this.name="CborDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode CBOR: ${this.error}, input: ${K(this.input)}`}},Ln=class t extends V{constructor(e,r){super(),this.error=e,this.value=r,this.name="CborEncodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to encode CBOR: ${this.error}, input: ${this.value}`}};var Wt=class t extends V{constructor(e,r,n){super(),this.message=e,this.requestId=r,this.status=n,this.name="TimeoutWaitingForResponseErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`${this.message}
`;return this.requestId&&(e+=`  Request ID: ${K(this.requestId)}
`),this.status&&(e+=`  Request status: ${this.status}
`),e}},Mn=class t extends V{constructor(e,r,n){super(),this.maxIngressExpiryInMinutes=e,this.requestId=r,this.retryTimes=n,this.name="CertificateOutdatedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`Certificate is stale (over ${this.maxIngressExpiryInMinutes} minutes). Is the computer's clock synchronized?
  Request ID: ${K(this.requestId)}
`;return this.retryTimes!==void 0&&(e+=`  Retried ${this.retryTimes} times.`),e}},Qt=class t extends V{constructor(e,r,n,o){super(!0),this.requestId=e,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=o,this.name="CertifiedRejectErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${K(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},Dn=class t extends V{constructor(e,r,n,o,s){super(),this.requestId=e,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=o,this.signatures=s,this.name="UncertifiedRejectErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${K(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},kn=class t extends V{constructor(e){super(),this.requestId=e,this.name="RequestStatusDoneNoReplyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Call was marked as done but we never saw the reply:
  Request ID: ${K(this.requestId)}
`}},Ze=class t extends V{constructor(e){super(),this.shouldFetchRootKey=e,this.name="MissingRootKeyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.shouldFetchRootKey===void 0?"Agent is missing root key":`Agent is missing root key and the shouldFetchRootKey value is set to ${this.shouldFetchRootKey}. The root key should only be unknown if you are in local development. Otherwise you should avoid fetching and use the default IC Root Key or the known root key of your environment.`}},Fn=class t extends V{constructor(e){super(),this.value=e,this.name="HashValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Attempt to hash a value of unsupported type: ${this.value}`}},Er=class t extends V{constructor(e){super(),this.error=e,this.name="HttpDefaultFetchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.error}},Ut=class t extends V{constructor(){super(),this.name="IdentityInvalidErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"This identity has expired due this application's security policy. Please refresh your authentication."}},Jt=class t extends V{constructor(e,r){super(),this.message=e,this.providedIngressExpiryInMinutes=r,this.name="IngressExpiryInvalidErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`${this.message}. Provided ingress expiry time is ${this.providedIngressExpiryInMinutes} minutes.`}},$n=class t extends V{constructor(){super(),this.name="CreateHttpAgentErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Failed to create agent from provided agent"}},Vn=class t extends V{constructor(e){super(),this.error=e,this.name="MalformedSignatureErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Query response contained a malformed signature: ${this.error}`}},Gr=class t extends V{constructor(){super(),this.name="MissingSignatureErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Query response did not contain any node signatures"}},jn=class t extends V{constructor(){super(),this.name="MalformedPublicKeyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Read state response contained a malformed public key"}},Hn=class t extends V{constructor(e){super(),this.nodeId=e,this.name="QuerySignatureVerificationFailedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Query signature verification failed. Node ID: ${this.nodeId}`}},Ne=class t extends V{constructor(e){super(),this.error=e,this.name="UnexpectedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Unexpected error: ${this.error}`}},qt=class t extends V{constructor(e){super(),this.error=e,this.name="HashTreeDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode certificate: ${this.error}`}},Zr=class t extends V{constructor(e,r,n,o){super(),this.status=e,this.statusText=r,this.headers=n,this.bodyText=o,this.name="HttpErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`HTTP request failed:
  Status: ${this.status} (${this.statusText})
  Headers: ${JSON.stringify(this.headers)}
`;return this.bodyText&&(e+=`  Body: ${this.bodyText}
`),e}},Yr=class t extends V{constructor(){super(),this.name="HttpV3ApiNotSupportedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"HTTP request failed: v3 API is not supported"}},Xr=class t extends V{constructor(e){super(),this.error=e,this.name="HttpFetchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to fetch HTTP request: ${this.error}`}},zr=class t extends V{constructor(e){super(),this.receivedCanisterId=e,this.name="MissingCanisterIdErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Canister ID is required, but received ${typeof this.receivedCanisterId} instead. If you are using automatically generated declarations, this may be because your application is not setting the canister ID in process.env correctly.`}},Kn=class t extends V{constructor(e){super(),this.request=e,this.name="InvalidReadStateRequestErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Invalid read state request: ${this.request}`}},Wr=class t extends V{constructor(e){super(),this.error=e,this.name="ExpiryJsonDeserializeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to deserialize expiry: ${this.error}`}},Pt=new Error("unreachable");var nr={};sa(nr,{Bool:()=>Ei,BoolClass:()=>zn,ConstructType:()=>st,Empty:()=>xi,EmptyClass:()=>Jr,FixedIntClass:()=>yt,FixedNatClass:()=>ot,Float32:()=>Ti,Float64:()=>Si,FloatClass:()=>rn,Func:()=>ji,FuncClass:()=>rr,Int:()=>vi,Int16:()=>Oi,Int32:()=>Ci,Int64:()=>Ri,Int8:()=>Ai,IntClass:()=>en,Nat:()=>Ii,Nat16:()=>Ui,Nat32:()=>qi,Nat64:()=>Pi,Nat8:()=>Ni,NatClass:()=>tn,Null:()=>_i,NullClass:()=>er,Opt:()=>ki,OptClass:()=>Dt,PrimitiveType:()=>Oe,Principal:()=>Li,PrincipalClass:()=>Jn,Rec:()=>Vi,RecClass:()=>Pe,Record:()=>Fi,RecordClass:()=>tr,Reserved:()=>wi,ReservedClass:()=>it,Service:()=>Hi,ServiceClass:()=>Ir,Text:()=>Bi,TextClass:()=>Wn,Tuple:()=>Mi,TupleClass:()=>Qn,Type:()=>_r,Unknown:()=>xa,UnknownClass:()=>Xn,Variant:()=>$i,VariantClass:()=>vr,Vec:()=>Di,VecClass:()=>Br,Visitor:()=>$o,decode:()=>ga,encode:()=>ba,resetSubtypeCache:()=>Vo,subtype:()=>Ho});function Z(...t){let e=new Uint8Array(t.reduce((n,o)=>n+o.byteLength,0)),r=0;for(let n of t)e.set(n,r),r+=n.byteLength;return e}var Ye=class{save(){return this._view}restore(e){if(!(e instanceof Uint8Array))throw new Error("Checkpoint must be a Uint8Array");this._view=e}constructor(e,r=e?.byteLength||0){if(e&&!(e instanceof Uint8Array))try{e=li(e)}catch{throw new Error("Buffer must be a Uint8Array")}if(r<0||!Number.isInteger(r))throw new Error("Length must be a non-negative integer");if(e&&r>e.byteLength)throw new Error("Length cannot exceed buffer length");this._buffer=e||new Uint8Array(0),this._view=new Uint8Array(this._buffer.buffer,0,r)}get buffer(){return this._view.slice()}get byteLength(){return this._view.byteLength}read(e){let r=this._view.subarray(0,e);return this._view=this._view.subarray(e),r.slice()}readUint8(){if(this._view.byteLength===0)return;let e=this._view[0];return this._view=this._view.subarray(1),e}write(e){if(!(e instanceof Uint8Array))throw new Error("Buffer must be a Uint8Array");let r=this._view.byteLength;this._view.byteOffset+this._view.byteLength+e.byteLength>=this._buffer.byteLength?this.alloc(e.byteLength):this._view=new Uint8Array(this._buffer.buffer,this._view.byteOffset,this._view.byteLength+e.byteLength),this._view.set(e,r)}get end(){return this._view.byteLength===0}alloc(e){if(e<=0||!Number.isInteger(e))throw new Error("Amount must be a positive integer");let r=new Uint8Array((this._buffer.byteLength+e)*1.2|0),n=new Uint8Array(r.buffer,0,this._view.byteLength+e);n.set(this._view),this._buffer=r,this._view=n}};function li(t){if(!t)throw new Error("Input cannot be null or undefined");return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):Array.isArray(t)?new Uint8Array(t):"buffer"in t?li(t.buffer):new Uint8Array(t)}function hi(t,e){if(t.byteLength!==e.byteLength)return t.byteLength-e.byteLength;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return t[r]-e[r];return 0}function pi(t){if(!(t instanceof Uint8Array))throw new Error("Input must be a Uint8Array");return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ya(t){let r=new TextEncoder().encode(t),n=0;for(let o of r)n=(n*223+o)%2**32;return n}function ve(t){if(/^_\d+_$/.test(t)||/^_0x[0-9a-fA-F]+_$/.test(t)){let e=+t.slice(1,-1);if(Number.isSafeInteger(e)&&e>=0&&e<2**32)return e}return ya(t)}function Lo(t){let e=BigInt(t);if(t<=0)throw new RangeError("Input must be positive");return e.toString(2).length-1}function Gn(t){let e=BigInt(t);if(t<0)throw new RangeError("Input must be non-negative");return BigInt(1)<<e}function mi(){throw new Error("unexpected end of buffer")}function Mt(t,e){return t.byteLength<e&&mi(),t.read(e)}function Lt(t){let e=t.readUint8();return e===void 0&&mi(),e}function J(t){if(typeof t=="number"&&(t=BigInt(t)),t<BigInt(0))throw new Error("Cannot leb encode negative values.");let e=(t===BigInt(0)?0:Lo(t))+1,r=new Ye(new Uint8Array(e),0);for(;;){let n=Number(t&BigInt(127));if(t/=BigInt(128),t===BigInt(0)){r.write(new Uint8Array([n]));break}else r.write(new Uint8Array([n|128]))}return r.buffer}function se(t){let e=BigInt(1),r=BigInt(0),n;do n=Lt(t),r+=BigInt(n&127).valueOf()*e,e*=BigInt(128);while(n>=128);return r}function ie(t){typeof t=="number"&&(t=BigInt(t));let e=t<BigInt(0);e&&(t=-t-BigInt(1));let r=(t===BigInt(0)?0:Lo(t))+1,n=new Ye(new Uint8Array(r),0);for(;;){let s=o(t);if(t/=BigInt(128),e&&t===BigInt(0)&&(s&64)!==0||!e&&t===BigInt(0)&&(s&64)===0){n.write(new Uint8Array([s]));break}else n.write(new Uint8Array([s|128]))}function o(s){let i=s%BigInt(128);return Number(e?BigInt(128)-i-BigInt(1):i)}return n.buffer}function pt(t){let e=new Uint8Array(t.buffer),r=0;for(;r<e.byteLength;r++)if(e[r]<128){if((e[r]&64)===0)return se(t);break}let n=new Uint8Array(Mt(t,r+1)),o=BigInt(0);for(let s=n.byteLength-1;s>=0;s--)o=o*BigInt(128)+BigInt(128-(n[s]&127)-1);return-o-BigInt(1)}function yi(t,e){if(BigInt(t)<BigInt(0))throw new Error("Cannot write negative values.");return Mo(t,e)}function Mo(t,e){t=BigInt(t);let r=new Ye(new Uint8Array(Math.min(1,e)),0),n=0,o=BigInt(256),s=BigInt(0),i=Number(t%o);for(r.write(new Uint8Array([i]));++n<e;)t<0&&s===BigInt(0)&&i!==0&&(s=BigInt(1)),i=Number((t/o-s)%BigInt(256)),r.write(new Uint8Array([i])),o*=BigInt(256);return r.buffer}function Do(t,e){if(e<=0||!Number.isInteger(e))throw new Error("Byte length must be a positive integer");let r=BigInt(Lt(t)),n=BigInt(1),o=0;for(;++o<e;){n*=BigInt(256);let s=BigInt(Lt(t));r=r+n*s}return r}function bi(t,e){if(e<=0||!Number.isInteger(e))throw new Error("Byte length must be a positive integer");let r=Do(t,e),n=BigInt(2)**(BigInt(8)*BigInt(e-1)+BigInt(7));return r>=n&&(r-=n*BigInt(2)),r}var X;(function(t){t[t.Null=-1]="Null",t[t.Bool=-2]="Bool",t[t.Nat=-3]="Nat",t[t.Int=-4]="Int",t[t.Float32=-13]="Float32",t[t.Float64=-14]="Float64",t[t.Text=-15]="Text",t[t.Reserved=-16]="Reserved",t[t.Empty=-17]="Empty",t[t.Opt=-18]="Opt",t[t.Vector=-19]="Vector",t[t.Record=-20]="Record",t[t.Variant=-21]="Variant",t[t.Func=-22]="Func",t[t.Service=-23]="Service",t[t.Principal=-24]="Principal"})(X||(X={}));var Zn="DIDL",gi=400;function Qr(t,e,r){return t.map((n,o)=>r(n,e[o]))}var Fo=class{constructor(){this._typs=[],this._idx=new Map}has(e){return this._idx.has(e.name)}add(e,r){let n=this._typs.length;this._idx.set(e.name,n),this._typs.push(r)}merge(e,r){let n=this._idx.get(e.name),o=this._idx.get(r);if(n===void 0)throw new Error("Missing type index for "+e);if(o===void 0)throw new Error("Missing type index for "+r);this._typs[n]=this._typs[o],this._typs.splice(o,1),this._idx.delete(r)}encode(){let e=J(this._typs.length),r=Z(...this._typs);return Z(e,r)}indexOf(e){if(!this._idx.has(e))throw new Error("Missing type index for "+e);return ie(this._idx.get(e)||0)}},$o=class{visitType(e,r){throw new Error("Not implemented")}visitPrimitive(e,r){return this.visitType(e,r)}visitEmpty(e,r){return this.visitPrimitive(e,r)}visitBool(e,r){return this.visitPrimitive(e,r)}visitNull(e,r){return this.visitPrimitive(e,r)}visitReserved(e,r){return this.visitPrimitive(e,r)}visitText(e,r){return this.visitPrimitive(e,r)}visitNumber(e,r){return this.visitPrimitive(e,r)}visitInt(e,r){return this.visitNumber(e,r)}visitNat(e,r){return this.visitNumber(e,r)}visitFloat(e,r){return this.visitPrimitive(e,r)}visitFixedInt(e,r){return this.visitNumber(e,r)}visitFixedNat(e,r){return this.visitNumber(e,r)}visitPrincipal(e,r){return this.visitPrimitive(e,r)}visitConstruct(e,r){return this.visitType(e,r)}visitVec(e,r,n){return this.visitConstruct(e,n)}visitOpt(e,r,n){return this.visitConstruct(e,n)}visitRecord(e,r,n){return this.visitConstruct(e,n)}visitTuple(e,r,n){let o=r.map((s,i)=>[`_${i}_`,s]);return this.visitRecord(e,o,n)}visitVariant(e,r,n){return this.visitConstruct(e,n)}visitRec(e,r,n){return this.visitConstruct(r,n)}visitFunc(e,r){return this.visitConstruct(e,r)}visitService(e,r){return this.visitConstruct(e,r)}},k;(function(t){t.EmptyClass="__IDL_EmptyClass__",t.UnknownClass="__IDL_UnknownClass__",t.BoolClass="__IDL_BoolClass__",t.NullClass="__IDL_NullClass__",t.ReservedClass="__IDL_ReservedClass__",t.TextClass="__IDL_TextClass__",t.IntClass="__IDL_IntClass__",t.NatClass="__IDL_NatClass__",t.FloatClass="__IDL_FloatClass__",t.FixedIntClass="__IDL_FixedIntClass__",t.FixedNatClass="__IDL_FixedNatClass__",t.VecClass="__IDL_VecClass__",t.OptClass="__IDL_OptClass__",t.RecordClass="__IDL_RecordClass__",t.TupleClass="__IDL_TupleClass__",t.VariantClass="__IDL_VariantClass__",t.RecClass="__IDL_RecClass__",t.PrincipalClass="__IDL_PrincipalClass__",t.FuncClass="__IDL_FuncClass__",t.ServiceClass="__IDL_ServiceClass__"})(k||(k={}));var _r=class{display(){return this.name}valueToString(e){return oe(e)}buildTypeTable(e){e.has(this)||this._buildTypeTableImpl(e)}},Oe=class extends _r{checkType(e){if(this.name!==e.name)throw new Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`);return e}_buildTypeTableImpl(e){}},st=class extends _r{checkType(e){if(e instanceof Pe){let r=e.getType();if(typeof r>"u")throw new Error("type mismatch with uninitialized type");return r}throw new Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`)}encodeType(e){return e.indexOf(this.name)}},Jr=class extends Oe{get typeName(){return k.EmptyClass}static[Symbol.hasInstance](e){return e.typeName===k.EmptyClass}accept(e,r){return e.visitEmpty(this,r)}covariant(e){throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(){throw new Error("Empty cannot appear as a function argument")}valueToString(){throw new Error("Empty cannot appear as a value")}encodeType(){return ie(X.Empty)}decodeValue(){throw new Error("Empty cannot appear as an output")}get name(){return"empty"}},Xn=class extends _r{get typeName(){return k.UnknownClass}static[Symbol.hasInstance](e){return e.typeName===k.UnknownClass}checkType(e){throw new Error("Method not implemented for unknown.")}accept(e,r){throw e.visitType(this,r)}covariant(e){throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(){throw new Error("Unknown cannot appear as a function argument")}valueToString(){throw new Error("Unknown cannot appear as a value")}encodeType(){throw new Error("Unknown cannot be serialized")}decodeValue(e,r){let n=r.decodeValue(e,r);Object(n)!==n&&(n=Object(n));let o;return r instanceof Pe?o=()=>r.getType():o=()=>r,Object.defineProperty(n,"type",{value:o,writable:!0,enumerable:!1,configurable:!0}),n}_buildTypeTableImpl(){throw new Error("Unknown cannot be serialized")}get name(){return"Unknown"}},zn=class extends Oe{get typeName(){return k.BoolClass}static[Symbol.hasInstance](e){return e.typeName===k.BoolClass}accept(e,r){return e.visitBool(this,r)}covariant(e){if(typeof e=="boolean")return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){return new Uint8Array([e?1:0])}encodeType(){return ie(X.Bool)}decodeValue(e,r){switch(this.checkType(r),Lt(e)){case 0:return!1;case 1:return!0;default:throw new Error("Boolean value out of range")}}get name(){return"bool"}},er=class extends Oe{get typeName(){return k.NullClass}static[Symbol.hasInstance](e){return e.typeName===k.NullClass}accept(e,r){return e.visitNull(this,r)}covariant(e){if(e===null)return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(){return new Uint8Array(0)}encodeType(){return ie(X.Null)}decodeValue(e,r){return this.checkType(r),null}get name(){return"null"}},it=class extends Oe{get typeName(){return k.ReservedClass}static[Symbol.hasInstance](e){return e.typeName===k.ReservedClass}accept(e,r){return e.visitReserved(this,r)}covariant(e){return!0}encodeValue(){return new Uint8Array(0)}encodeType(){return ie(X.Reserved)}decodeValue(e,r){return r.name!==this.name&&r.decodeValue(e,r),null}get name(){return"reserved"}},Wn=class extends Oe{get typeName(){return k.TextClass}static[Symbol.hasInstance](e){return e.typeName===k.TextClass}accept(e,r){return e.visitText(this,r)}covariant(e){if(typeof e=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){let r=new TextEncoder().encode(e),n=J(r.byteLength);return Z(n,r)}encodeType(){return ie(X.Text)}decodeValue(e,r){this.checkType(r);let n=se(e),o=Mt(e,Number(n));return new TextDecoder("utf8",{fatal:!0}).decode(o)}get name(){return"text"}valueToString(e){return'"'+e+'"'}},en=class extends Oe{get typeName(){return k.IntClass}static[Symbol.hasInstance](e){return e.typeName===k.IntClass}accept(e,r){return e.visitInt(this,r)}covariant(e){if(typeof e=="bigint"||Number.isInteger(e))return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){return ie(e)}encodeType(){return ie(X.Int)}decodeValue(e,r){return this.checkType(r),pt(e)}get name(){return"int"}valueToString(e){return e.toString()}},tn=class extends Oe{get typeName(){return k.NatClass}static[Symbol.hasInstance](e){return e.typeName===k.NatClass}accept(e,r){return e.visitNat(this,r)}covariant(e){if(typeof e=="bigint"&&e>=BigInt(0)||Number.isInteger(e)&&e>=0)return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){return J(e)}encodeType(){return ie(X.Nat)}decodeValue(e,r){return this.checkType(r),se(e)}get name(){return"nat"}valueToString(e){return e.toString()}},rn=class extends Oe{get typeName(){return k.FloatClass}static[Symbol.hasInstance](e){return e.typeName===k.FloatClass}constructor(e){if(super(),this._bits=e,e!==32&&e!==64)throw new Error("not a valid float type")}accept(e,r){return e.visitFloat(this,r)}covariant(e){if(typeof e=="number"||e instanceof Number)return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){let r=new ArrayBuffer(this._bits/8),n=new DataView(r);return this._bits===32?n.setFloat32(0,e,!0):n.setFloat64(0,e,!0),new Uint8Array(r)}encodeType(){let e=this._bits===32?X.Float32:X.Float64;return ie(e)}decodeValue(e,r){this.checkType(r);let n=Mt(e,this._bits/8),o=pi(n);return this._bits===32?o.getFloat32(0,!0):o.getFloat64(0,!0)}get name(){return"float"+this._bits}valueToString(e){return e.toString()}},yt=class extends Oe{get typeName(){return k.FixedIntClass}static[Symbol.hasInstance](e){return e.typeName===k.FixedIntClass}constructor(e){super(),this._bits=e}accept(e,r){return e.visitFixedInt(this,r)}covariant(e){let r=Gn(this._bits-1)*BigInt(-1),n=Gn(this._bits-1)-BigInt(1),o=!1;if(typeof e=="bigint")o=e>=r&&e<=n;else if(Number.isInteger(e)){let s=BigInt(e);o=s>=r&&s<=n}else o=!1;if(o)return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){return Mo(e,this._bits/8)}encodeType(){let e=Math.log2(this._bits)-3;return ie(-9-e)}decodeValue(e,r){this.checkType(r);let n=bi(e,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`int${this._bits}`}valueToString(e){return e.toString()}},ot=class extends Oe{get typeName(){return k.FixedNatClass}static[Symbol.hasInstance](e){return e.typeName===k.FixedNatClass}constructor(e){super(),this._bits=e}accept(e,r){return e.visitFixedNat(this,r)}covariant(e){let r=Gn(this._bits),n=!1;if(typeof e=="bigint"&&e>=BigInt(0)?n=e<r:Number.isInteger(e)&&e>=0?n=BigInt(e)<r:n=!1,n)return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){return yi(e,this._bits/8)}encodeType(){let e=Math.log2(this._bits)-3;return ie(-5-e)}decodeValue(e,r){this.checkType(r);let n=Do(e,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`nat${this._bits}`}valueToString(e){return e.toString()}},Br=class t extends st{get typeName(){return k.VecClass}static[Symbol.hasInstance](e){return e.typeName===k.VecClass}constructor(e){super(),this._type=e,this._blobOptimization=!1,e instanceof ot&&e._bits===8&&(this._blobOptimization=!0)}accept(e,r){return e.visitVec(this,this._type,r)}covariant(e){let r=this._type instanceof ot?this._type._bits:this._type instanceof yt?this._type._bits:0;if(ArrayBuffer.isView(e)&&r==e.BYTES_PER_ELEMENT*8||Array.isArray(e)&&e.every((n,o)=>{try{return this._type.covariant(n)}catch(s){throw new Error(`Invalid ${this.display()} argument: 

index ${o} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){let r=J(e.length);if(this._blobOptimization)return Z(r,new Uint8Array(e));if(ArrayBuffer.isView(e))if(e instanceof Int16Array||e instanceof Uint16Array){let o=new DataView(new ArrayBuffer(e.length*2));for(let s=0;s<e.length;s++)e instanceof Int16Array?o.setInt16(s*2,e[s],!0):o.setUint16(s*2,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else if(e instanceof Int32Array||e instanceof Uint32Array){let o=new DataView(new ArrayBuffer(e.length*4));for(let s=0;s<e.length;s++)e instanceof Int32Array?o.setInt32(s*4,e[s],!0):o.setUint32(s*4,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else if(e instanceof BigInt64Array||e instanceof BigUint64Array){let o=new DataView(new ArrayBuffer(e.length*8));for(let s=0;s<e.length;s++)e instanceof BigInt64Array?o.setBigInt64(s*8,e[s],!0):o.setBigUint64(s*8,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else return Z(r,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));let n=new Ye(new Uint8Array(r.byteLength+e.length),0);n.write(r);for(let o of e){let s=this._type.encodeValue(o);n.write(new Uint8Array(s))}return n.buffer}_buildTypeTableImpl(e){this._type.buildTypeTable(e);let r=ie(X.Vector),n=this._type.encodeType(e);e.add(this,Z(r,n))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a vector type");let o=Number(se(e));if(this._type instanceof ot){if(this._type._bits==8)return new Uint8Array(e.read(o));if(this._type._bits==16){let i=e.read(o*2);return new Uint16Array(i.buffer,i.byteOffset,o)}if(this._type._bits==32){let i=e.read(o*4);return new Uint32Array(i.buffer,i.byteOffset,o)}if(this._type._bits==64)return new BigUint64Array(e.read(o*8).buffer)}if(this._type instanceof yt){if(this._type._bits==8)return new Int8Array(e.read(o));if(this._type._bits==16){let i=e.read(o*2),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new Int16Array(o);for(let u=0;u<o;u++)a[u]=c.getInt16(u*2,!0);return a}if(this._type._bits==32){let i=e.read(o*4),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new Int32Array(o);for(let u=0;u<o;u++)a[u]=c.getInt32(u*4,!0);return a}if(this._type._bits==64){let i=e.read(o*8),c=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new BigInt64Array(o);for(let u=0;u<o;u++)a[u]=c.getBigInt64(u*8,!0);return a}}let s=[];for(let i=0;i<o;i++)s.push(this._type.decodeValue(e,n._type));return s}get name(){return`vec ${this._type.name}`}display(){return`vec ${this._type.display()}`}valueToString(e){return"vec {"+e.map(n=>this._type.valueToString(n)).join("; ")+"}"}},Dt=class t extends st{get typeName(){return k.OptClass}static[Symbol.hasInstance](e){return e.typeName===k.OptClass}constructor(e){super(),this._type=e}accept(e,r){return e.visitOpt(this,this._type,r)}covariant(e){try{if(Array.isArray(e)&&(e.length===0||e.length===1&&this._type.covariant(e[0])))return!0}catch(r){throw new Error(`Invalid ${this.display()} argument: ${oe(e)} 

-> ${r.message}`)}throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){return e.length===0?new Uint8Array([0]):Z(new Uint8Array([1]),this._type.encodeValue(e[0]))}_buildTypeTableImpl(e){this._type.buildTypeTable(e);let r=ie(X.Opt),n=this._type.encodeType(e);e.add(this,Z(r,n))}decodeValue(e,r){if(r instanceof er)return[];if(r instanceof it)return[];let n=r;if(r instanceof Pe){let o=r.getType();if(typeof o>"u")throw new Error("type mismatch with uninitialized type");n=o}if(n instanceof t)switch(Lt(e)){case 0:return[];case 1:{let o=e.save();try{return[this._type.decodeValue(e,n._type)]}catch{return e.restore(o),n._type.decodeValue(e,n._type),[]}}default:throw new Error("Not an option value")}else{if(this._type instanceof er||this._type instanceof t||this._type instanceof it)return n.decodeValue(e,n),[];{let o=e.save();try{return[this._type.decodeValue(e,r)]}catch{return e.restore(o),n.decodeValue(e,r),[]}}}}get name(){return`opt ${this._type.name}`}display(){return`opt ${this._type.display()}`}valueToString(e){return e.length===0?"null":`opt ${this._type.valueToString(e[0])}`}},tr=class t extends st{get typeName(){return k.RecordClass}static[Symbol.hasInstance](e){return e.typeName===k.RecordClass||e.typeName===k.TupleClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((r,n)=>ve(r[0])-ve(n[0]))}accept(e,r){return e.visitRecord(this,this._fields,r)}tryAsTuple(){let e=[];for(let r=0;r<this._fields.length;r++){let[n,o]=this._fields[r];if(n!==`_${r}_`)return null;e.push(o)}return e}covariant(e){if(typeof e=="object"&&this._fields.every(([r,n])=>{if(!e.hasOwnProperty(r))throw new Error(`Record is missing key "${r}".`);try{return n.covariant(e[r])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

field ${r} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){let r=this._fields.map(([o])=>e[o]),n=Qr(this._fields,r,([,o],s)=>o.encodeValue(s));return Z(...n)}_buildTypeTableImpl(e){this._fields.forEach(([s,i])=>i.buildTypeTable(e));let r=ie(X.Record),n=J(this._fields.length),o=this._fields.map(([s,i])=>Z(J(ve(s)),i.encodeType(e)));e.add(this,Z(r,n,Z(...o)))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a record type");let o={},s=0,i=0;for(;i<n._fields.length;){let[c,a]=n._fields[i];if(s>=this._fields.length){a.decodeValue(e,a),i++;continue}let[u,h]=this._fields[s],d=ve(this._fields[s][0]),f=ve(c);if(d===f)o[u]=h.decodeValue(e,a),s++,i++;else if(f>d)if(h instanceof Dt||h instanceof it)o[u]=[],s++;else throw new Error("Cannot find required field "+u);else a.decodeValue(e,a),i++}for(let[c,a]of this._fields.slice(s))if(a instanceof Dt||a instanceof it)o[c]=[];else throw new Error("Cannot find required field "+c);return o}get fieldsAsObject(){let e={};for(let[r,n]of this._fields)e[ve(r)]=n;return e}get name(){return`record {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`record {${this._fields.map(([r,n])=>r+":"+n.display()).join("; ")}}`}valueToString(e){let r=this._fields.map(([o])=>e[o]);return`record {${Qr(this._fields,r,([o,s],i)=>o+"="+s.valueToString(i)).join("; ")}}`}},Qn=class t extends tr{get typeName(){return k.TupleClass}static[Symbol.hasInstance](e){return e.typeName===k.TupleClass}constructor(e){let r={};e.forEach((n,o)=>r["_"+o+"_"]=n),super(r),this._components=e}accept(e,r){return e.visitTuple(this,this._components,r)}covariant(e){if(Array.isArray(e)&&e.length>=this._fields.length&&this._components.every((r,n)=>{try{return r.covariant(e[n])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

index ${n} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){let r=Qr(this._components,e,(n,o)=>n.encodeValue(o));return Z(...r)}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("not a tuple type");if(n._components.length<this._components.length)throw new Error("tuple mismatch");let o=[];for(let[s,i]of n._components.entries())s>=this._components.length?i.decodeValue(e,i):o.push(this._components[s].decodeValue(e,i));return o}display(){return`record {${this._components.map(r=>r.display()).join("; ")}}`}valueToString(e){return`record {${Qr(this._components,e,(n,o)=>n.valueToString(o)).join("; ")}}`}},vr=class t extends st{get typeName(){return k.VariantClass}static[Symbol.hasInstance](e){return e.typeName===k.VariantClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((r,n)=>ve(r[0])-ve(n[0]))}accept(e,r){return e.visitVariant(this,this._fields,r)}covariant(e){if(typeof e=="object"&&Object.entries(e).length===1&&this._fields.every(([r,n])=>{try{return!e.hasOwnProperty(r)||n.covariant(e[r])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

variant ${r} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){for(let r=0;r<this._fields.length;r++){let[n,o]=this._fields[r];if(e.hasOwnProperty(n)){let s=J(r),i=o.encodeValue(e[n]);return Z(s,i)}}throw Error("Variant has no data: "+e)}_buildTypeTableImpl(e){this._fields.forEach(([,s])=>{s.buildTypeTable(e)});let r=ie(X.Variant),n=J(this._fields.length),o=this._fields.map(([s,i])=>Z(J(ve(s)),i.encodeType(e)));e.add(this,Z(r,n,...o))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a variant type");let o=Number(se(e));if(o>=n._fields.length)throw Error("Invalid variant index: "+o);let[s,i]=n._fields[o];for(let[c,a]of this._fields)if(ve(s)===ve(c)){let u=a.decodeValue(e,i);return{[c]:u}}throw new Error("Cannot find field hash "+s)}get name(){return`variant {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`variant {${this._fields.map(([r,n])=>r+(n.name==="null"?"":`:${n.display()}`)).join("; ")}}`}valueToString(e){for(let[r,n]of this._fields)if(e.hasOwnProperty(r)){let o=n.valueToString(e[r]);return o==="null"?`variant {${r}}`:`variant {${r}=${o}}`}throw new Error("Variant has no data: "+e)}get alternativesAsObject(){let e={};for(let[r,n]of this._fields)e[ve(r)]=n;return e}},Pe=class t extends st{constructor(){super(...arguments),this._id=t._counter++}get typeName(){return k.RecClass}static{this._counter=0}static[Symbol.hasInstance](e){return e.typeName===k.RecClass}accept(e,r){if(!this._type)throw Error("Recursive type uninitialized.");return e.visitRec(this,this._type,r)}fill(e){this._type=e}getType(){return this._type}covariant(e){if(this._type&&this._type.covariant(e))return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.encodeValue(e)}_buildTypeTableImpl(e){if(!this._type)throw Error("Recursive type uninitialized.");e.add(this,new Uint8Array([])),this._type.buildTypeTable(e),e.merge(this,this._type.name)}decodeValue(e,r){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.decodeValue(e,r)}get name(){return`rec_${this._id}`}display(){if(!this._type)throw Error("Recursive type uninitialized.");return`\u03BC${this.name}.${this._type.name}`}valueToString(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.valueToString(e)}};function jo(t){if(Lt(t)!==1)throw new Error("Cannot decode principal");let r=Number(se(t));return H.fromUint8Array(new Uint8Array(Mt(t,r)))}var Jn=class extends Oe{get typeName(){return k.PrincipalClass}static[Symbol.hasInstance](e){return e.typeName===k.PrincipalClass}accept(e,r){return e.visitPrincipal(this,r)}covariant(e){if(e&&e._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){let r=e.toUint8Array(),n=J(r.byteLength);return Z(new Uint8Array([1]),n,r)}encodeType(){return ie(X.Principal)}decodeValue(e,r){return this.checkType(r),jo(e)}get name(){return"principal"}valueToString(e){return`${this.name} "${e.toText()}"`}},rr=class extends st{get typeName(){return k.FuncClass}static[Symbol.hasInstance](e){return e.typeName===k.FuncClass}static argsToString(e,r){if(e.length!==r.length)throw new Error("arity mismatch");return"("+e.map((n,o)=>n.valueToString(r[o])).join(", ")+")"}constructor(e,r,n=[]){super(),this.argTypes=e,this.retTypes=r,this.annotations=n}accept(e,r){return e.visitFunc(this,r)}covariant(e){if(Array.isArray(e)&&e.length===2&&e[0]&&e[0]._isPrincipal&&typeof e[1]=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue([e,r]){let n=e.toUint8Array(),o=J(n.byteLength),s=Z(new Uint8Array([1]),o,n),i=new TextEncoder().encode(r),c=J(i.byteLength);return Z(new Uint8Array([1]),s,c,i)}_buildTypeTableImpl(e){this.argTypes.forEach(u=>u.buildTypeTable(e)),this.retTypes.forEach(u=>u.buildTypeTable(e));let r=ie(X.Func),n=J(this.argTypes.length),o=Z(...this.argTypes.map(u=>u.encodeType(e))),s=J(this.retTypes.length),i=Z(...this.retTypes.map(u=>u.encodeType(e))),c=J(this.annotations.length),a=Z(...this.annotations.map(u=>this.encodeAnnotation(u)));e.add(this,Z(r,n,o,s,i,c,a))}decodeValue(e,r){let n=r instanceof Pe?r.getType()??r:r;if(!Ho(n,this))throw new Error(`Cannot decode function reference at type ${this.display()} from wire type ${n.display()}`);if(Lt(e)!==1)throw new Error("Cannot decode function reference");let s=jo(e),i=Number(se(e)),c=Mt(e,i),u=new TextDecoder("utf8",{fatal:!0}).decode(c);return[s,u]}get name(){let e=this.argTypes.map(o=>o.name).join(", "),r=this.retTypes.map(o=>o.name).join(", "),n=" "+this.annotations.join(" ");return`(${e}) -> (${r})${n}`}valueToString([e,r]){return`func "${e.toText()}".${r}`}display(){let e=this.argTypes.map(o=>o.display()).join(", "),r=this.retTypes.map(o=>o.display()).join(", "),n=" "+this.annotations.join(" ");return`(${e}) \u2192 (${r})${n}`}encodeAnnotation(e){if(e==="query")return new Uint8Array([1]);if(e==="oneway")return new Uint8Array([2]);if(e==="composite_query")return new Uint8Array([3]);throw new Error("Illegal function annotation")}},Ir=class extends st{get typeName(){return k.ServiceClass}static[Symbol.hasInstance](e){return e.typeName===k.ServiceClass}constructor(e){super(),this._fields=Object.entries(e).sort((r,n)=>r[0]<n[0]?-1:r[0]>n[0]?1:0)}accept(e,r){return e.visitService(this,r)}covariant(e){if(e&&e._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${oe(e)}`)}encodeValue(e){let r=e.toUint8Array(),n=J(r.length);return Z(new Uint8Array([1]),n,r)}_buildTypeTableImpl(e){this._fields.forEach(([s,i])=>i.buildTypeTable(e));let r=ie(X.Service),n=J(this._fields.length),o=this._fields.map(([s,i])=>{let c=new TextEncoder().encode(s),a=J(c.length);return Z(a,c,i.encodeType(e))});e.add(this,Z(r,n,...o))}decodeValue(e,r){let n=r instanceof Pe?r.getType()??r:r;if(!Ho(n,this))throw new Error(`Cannot decode service reference at type ${this.display()} from wire type ${n.display()}`);return jo(e)}get name(){return`service {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}valueToString(e){return`service "${e.toText()}"`}fieldsAsObject(){let e={};for(let[r,n]of this._fields)e[r]=n;return e}};function oe(t){let e=JSON.stringify(t,(r,n)=>typeof n=="bigint"?`BigInt(${n})`:n);return e&&e.length>gi?e.substring(0,gi-3)+"...":e}function ba(t,e){if(e.length<t.length)throw Error("Wrong number of message arguments");let r=new Fo;t.forEach(a=>a.buildTypeTable(r));let n=new TextEncoder().encode(Zn),o=r.encode(),s=J(e.length),i=Z(...t.map(a=>a.encodeType(r))),c=Z(...Qr(t,e,(a,u)=>{try{a.covariant(u)}catch(h){throw new Error(h.message+`

`)}return a.encodeValue(u)}));return Z(n,o,s,i,c)}function ga(t,e){let r=new Ye(e);if(e.byteLength<Zn.length)throw new Error("Message length smaller than magic number");let n=Mt(r,Zn.length),o=new TextDecoder().decode(n);if(o!==Zn)throw new Error("Wrong magic number: "+JSON.stringify(o));function s(f){let l=[],p=Number(se(f));for(let m=0;m<p;m++){let w=Number(pt(f));switch(w){case X.Opt:case X.Vector:{let y=Number(pt(f));l.push([w,y]);break}case X.Record:case X.Variant:{let y=[],_=Number(se(f)),v;for(;_--;){let I=Number(se(f));if(I>=Math.pow(2,32))throw new Error("field id out of 32-bit range");if(typeof v=="number"&&v>=I)throw new Error("field id collision or not sorted");v=I;let T=Number(pt(f));y.push([I,T])}l.push([w,y]);break}case X.Func:{let y=[],_=Number(se(f));for(;_--;)y.push(Number(pt(f)));let v=[],I=Number(se(f));for(;I--;)v.push(Number(pt(f)));let T=[],A=Number(se(f));for(;A--;)switch(Number(se(f))){case 1:{T.push("query");break}case 2:{T.push("oneway");break}case 3:{T.push("composite_query");break}default:throw new Error("unknown annotation")}l.push([w,[y,v,T]]);break}case X.Service:{let y=Number(se(f)),_=[];for(;y--;){let v=Number(se(f)),I=new TextDecoder().decode(Mt(f,v)),T=pt(f);_.push([I,T])}l.push([w,_]);break}default:throw new Error("Illegal op_code: "+w)}}let b=[],g=Number(se(f));for(let m=0;m<g;m++)b.push(Number(pt(f)));return[l,b]}let[i,c]=s(r);if(c.length<t.length)throw new Error("Wrong number of return values");let a=i.map(f=>Vi());function u(f){if(f<-24)throw new Error("future value not supported");if(f<0)switch(f){case-1:return _i;case-2:return Ei;case-3:return Ii;case-4:return vi;case-5:return Ni;case-6:return Ui;case-7:return qi;case-8:return Pi;case-9:return Ai;case-10:return Oi;case-11:return Ci;case-12:return Ri;case-13:return Ti;case-14:return Si;case-15:return Bi;case-16:return wi;case-17:return xi;case-24:return Li;default:throw new Error("Illegal op_code: "+f)}if(f>=i.length)throw new Error("type index out of range");return a[f]}function h(f){switch(f[0]){case X.Vector:{let l=u(f[1]);return Di(l)}case X.Opt:{let l=u(f[1]);return ki(l)}case X.Record:{let l={};for(let[g,m]of f[1]){let w=`_${g}_`;l[w]=u(m)}let p=Fi(l),b=p.tryAsTuple();return Array.isArray(b)?Mi(...b):p}case X.Variant:{let l={};for(let[p,b]of f[1]){let g=`_${p}_`;l[g]=u(b)}return $i(l)}case X.Func:{let[l,p,b]=f[1];return ji(l.map(g=>u(g)),p.map(g=>u(g)),b)}case X.Service:{let l={},p=f[1];for(let[b,g]of p){let m=u(g);if(m instanceof Pe&&(m=m.getType()),!(m instanceof rr))throw new Error("Illegal service definition: services can only contain functions");l[b]=m}return Hi(l)}default:throw new Error("Illegal op_code: "+f[0])}}i.forEach((f,l)=>{if(f[0]===X.Func){let p=h(f);a[l].fill(p)}}),i.forEach((f,l)=>{if(f[0]!==X.Func){let p=h(f);a[l].fill(p)}}),Vo();let d=c.map(f=>u(f));try{let f=t.map((l,p)=>l.decodeValue(r,d[p]));for(let l=t.length;l<d.length;l++)d[l].decodeValue(r,d[l]);if(r.byteLength>0)throw new Error("decode: Left-over bytes");return f}finally{Vo()}}var xi=new Jr,wi=new it,xa=new Xn,Ei=new zn,_i=new er,Bi=new Wn,vi=new en,Ii=new tn,Ti=new rn(32),Si=new rn(64),Ai=new yt(8),Oi=new yt(16),Ci=new yt(32),Ri=new yt(64),Ni=new ot(8),Ui=new ot(16),qi=new ot(32),Pi=new ot(64),Li=new Jn;function Mi(...t){return new Qn(t)}function Di(t){return new Br(t)}function ki(t){return new Dt(t)}function Fi(t){return new tr(t)}function $i(t){return new vr(t)}function Vi(){return new Pe}function ji(t,e,r=[]){return new rr(t,e,r)}function Hi(t){return new Ir(t)}var eo=class t{constructor(e=new Map){this.rels=e}copy(){let e=new Map;for(let[r,n]of this.rels.entries()){let o=new Map(n);e.set(r,o)}return new t(e)}known(e,r){return this.rels.get(e.name)?.get(r.name)}addNegative(e,r){this.addNames(e.name,r.name,!1)}add(e,r){this.addNames(e.name,r.name,!0)}display(){let e="";for(let[r,n]of this.rels)for(let[o,s]of n)e+=`${r} ${s?":<":"!<:"} ${o}
`;return e}addNames(e,r,n){let o=this.rels.get(e);if(o==null){let s=new Map;s.set(r,n),this.rels.set(e,s)}else o.set(r,n)}},Yn=new eo;function Vo(){Yn=new eo}function wa(t,e){let r=new Set(t.annotations),n=new Set(e.annotations);if(r.size!==n.size)return!1;for(let o of r)if(!n.has(o))return!1;return!0}function ko(t){return t instanceof Dt||t instanceof er||t instanceof it}function Ho(t,e){let r=Yn.copy(),n=mt(r,t,e);return n?Yn.add(t,e):Yn.addNegative(t,e),n}function mt(t,e,r){if(e.name===r.name)return!0;let n=t.known(e,r);if(n!==void 0)return n;if(t.add(e,r),r instanceof it||e instanceof Jr||e instanceof tn&&r instanceof en)return!0;if(e instanceof Br&&r instanceof Br)return mt(t,e._type,r._type);if(r instanceof Dt)return!0;if(e instanceof tr&&r instanceof tr){let o=e.fieldsAsObject;for(let[s,i]of r._fields){let c=o[ve(s)];if(c){if(!mt(t,c,i))return!1}else if(!ko(i))return!1}return!0}if(e instanceof rr&&r instanceof rr){if(!wa(e,r))return!1;for(let o=0;o<e.argTypes.length;o++){let s=e.argTypes[o];if(o<r.argTypes.length){if(!mt(t,r.argTypes[o],s))return!1}else if(!ko(s))return!1}for(let o=0;o<r.retTypes.length;o++){let s=r.retTypes[o];if(o<e.retTypes.length){if(!mt(t,e.retTypes[o],s))return!1}else if(!ko(s))return!1}return!0}if(e instanceof vr&&r instanceof vr){let o=r.alternativesAsObject;for(let[s,i]of e._fields){let c=o[ve(s)];if(!c||!mt(t,i,c))return!1}return!0}if(e instanceof Ir&&r instanceof Ir){let o=e.fieldsAsObject();for(let[s,i]of r._fields){let c=o[s];if(!c||!mt(t,c,i))return!1}return!0}return e instanceof Pe?mt(t,e.getType(),r):r instanceof Pe?mt(t,e,r.getType()):!1}function Tr(t){if(!t)throw new Error("Input cannot be null or undefined");return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):Array.isArray(t)?new Uint8Array(t):"buffer"in t?Tr(t.buffer):new Uint8Array(t)}function or(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Ko(t){if(typeof t=="string")return Ki(t);if(typeof t=="number")return xe(J(t));if(t instanceof Uint8Array||ArrayBuffer.isView(t))return xe(Tr(t));if(Array.isArray(t)){let e=t.map(Ko);return xe(F(...e))}else{if(t&&typeof t=="object"&&t._isPrincipal)return xe(t.toUint8Array());if(typeof t=="object"&&t!==null&&typeof t.toHash=="function")return Ko(t.toHash());if(typeof t=="object")return nn(t);if(typeof t=="bigint")return xe(J(t))}throw G.fromCode(new Fn(t))}var Ki=t=>{let e=new TextEncoder().encode(t);return xe(e)};function to(t){return nn(t)}function nn(t){let n=Object.entries(t).filter(([,i])=>i!==void 0).map(([i,c])=>{let a=Ki(i),u=Ko(c);return[a,u]}).sort(([i],[c])=>hi(i,c)),o=F(...n.map(i=>F(...i)));return xe(o)}var Ad=new TextEncoder().encode(`
ic-request`),Gi=new TextEncoder().encode("\vic-response"),Od=new TextEncoder().encode("ic-request-auth-delegation");var on=class{getPrincipal(){return H.anonymous()}async transformRequest(e){return{...e,body:{content:e.body}}}};var bt=class extends Error{constructor(e){super(e),this.name="DecodingError"}},Yi=55799,Xi=Symbol("CBOR_STOP_CODE"),We=(t=>(t[t.False=20]="False",t[t.True=21]="True",t[t.Null=22]="Null",t[t.Undefined=23]="Undefined",t[t.Break=31]="Break",t))(We||{}),ue=(t=>(t[t.UnsignedInteger=0]="UnsignedInteger",t[t.NegativeInteger=1]="NegativeInteger",t[t.ByteString=2]="ByteString",t[t.TextString=3]="TextString",t[t.Array=4]="Array",t[t.Map=5]="Map",t[t.Tag=6]="Tag",t[t.Simple=7]="Simple",t))(ue||{}),Ea=23,_a=255,Ba=65535,va=4294967295,Ia=BigInt("0xffffffffffffffff"),ze=(t=>(t[t.Value=23]="Value",t[t.OneByte=24]="OneByte",t[t.TwoBytes=25]="TwoBytes",t[t.FourBytes=26]="FourBytes",t[t.EightBytes=27]="EightBytes",t[t.Indefinite=31]="Indefinite",t))(ze||{}),Sr=!1;function Ta(t){return t==null}function zi(t,e){let r=new Uint8Array(e);return r.set(t),r}var Sa=new TextDecoder;function Aa(t){return(t&224)>>5}function Oa(t){return t&31}var an=new Uint8Array,sn,Qe=0;function Wi(t,e){an=t,Qe=0;let r=sr(e);return e?.(r)??r}function sr(t){let[e,r]=ro();switch(e){case ue.UnsignedInteger:return Ar(r);case ue.NegativeInteger:return Ua(r);case ue.ByteString:return Qi(r);case ue.TextString:return Zo(r);case ue.Array:return Ca(r,t);case ue.Map:return Na(r,t);case ue.Tag:return qa(r,t);case ue.Simple:return Ra(r)}throw new bt(`Unsupported major type: ${e}`)}function ro(){let t=an.at(Qe);if(Ta(t))throw new bt("Provided CBOR data is empty");let e=Aa(t),r=Oa(t);return Qe++,[e,r]}function Ca(t,e){let r=Ar(t);if(r===1/0){let o=[],s=sr(e);for(;s!==Xi;)o.push(e?.(s)??s),s=sr(e);return o}let n=new Array(r);for(let o=0;o<r;o++){let s=sr(e);n[o]=e?.(s)??s}return n}function Ra(t){switch(t){case We.False:return!1;case We.True:return!0;case We.Null:return null;case We.Undefined:return;case We.Break:return Xi}throw new bt(`Unrecognized simple type: ${t.toString(2)}`)}function Na(t,e){let r=Ar(t),n={};if(r===1/0){let[o,s]=ro();for(;o!==ue.Simple&&s!==We.Break;){let i=Zo(s),c=sr(e);n[i]=e?.(c,i)??c,[o,s]=ro()}return n}for(let o=0;o<r;o++){let[s,i]=ro();if(s!==ue.TextString)throw new bt("Map keys must be text strings");let c=Zo(i),a=sr(e);n[c]=e?.(a,c)??a}return n}function Ar(t){if(t<=ze.Value)return t;switch(sn=new DataView(an.buffer,an.byteOffset+Qe),t){case ze.OneByte:return Qe++,sn.getUint8(0);case ze.TwoBytes:return Qe+=2,sn.getUint16(0,Sr);case ze.FourBytes:return Qe+=4,sn.getUint32(0,Sr);case ze.EightBytes:return Qe+=8,sn.getBigUint64(0,Sr);case ze.Indefinite:return 1/0;default:throw new bt(`Unsupported integer info: ${t.toString(2)}`)}}function Ua(t){let e=Ar(t);return typeof e=="number"?-1-e:-1n-e}function Qi(t){let e=Ar(t);if(e>Number.MAX_SAFE_INTEGER)throw new bt("Byte length is too large");let r=Number(e);return Qe+=r,an.slice(Qe-r,Qe)}function Zo(t){let e=Qi(t);return Sa.decode(e)}function qa(t,e){let r=Ar(t);if(r===Yi)return sr(e);throw new bt(`Unsupported tag: ${r}.`)}var fn=class extends Error{constructor(e){super(e),this.name="SerializationError"}},Pa=2*1024,La=100,Ma=new TextEncoder;function cn(t){return t<<5}var Ue=new Uint8Array(Pa),Xe=new DataView(Ue.buffer),fe=0,Go=[];function Ji(t,e){fe=0;let r=e?.(t)??t;return Ka(Yi,r,e),Ue.slice(0,fe)}function Yo(t,e){if(fe>Ue.length-La&&(Ue=zi(Ue,Ue.length*2),Xe=new DataView(Ue.buffer)),t===!1||t===!0||t===null||t===void 0){Fa(t);return}if(typeof t=="number"||typeof t=="bigint"){Ha(t);return}if(typeof t=="string"){rc(t);return}if(t instanceof Uint8Array){Zi(t);return}if(t instanceof ArrayBuffer){Zi(new Uint8Array(t));return}if(Array.isArray(t)){Da(t,e);return}if(typeof t=="object"){ka(t,e);return}throw new fn(`Unsupported type: ${typeof t}`)}function Da(t,e){Or(ue.Array,t.length),t.forEach((r,n)=>{Yo(e?.(r,n.toString())??r,e)})}function ka(t,e){Go=Object.entries(t),Or(ue.Map,Go.length),Go.forEach(([r,n])=>{rc(r),Yo(e?.(n,r)??n,e)})}function Or(t,e){if(e<=Ea){Xe.setUint8(fe++,cn(t)|Number(e));return}if(e<=_a){Xe.setUint8(fe++,cn(t)|ze.OneByte),Xe.setUint8(fe,Number(e)),fe+=1;return}if(e<=Ba){Xe.setUint8(fe++,cn(t)|ze.TwoBytes),Xe.setUint16(fe,Number(e),Sr),fe+=2;return}if(e<=va){Xe.setUint8(fe++,cn(t)|ze.FourBytes),Xe.setUint32(fe,Number(e),Sr),fe+=4;return}if(e<=Ia){Xe.setUint8(fe++,cn(t)|ze.EightBytes),Xe.setBigUint64(fe,BigInt(e),Sr),fe+=8;return}throw new fn(`Value too large to encode: ${e}`)}function Fa(t){Or(ue.Simple,$a(t))}function $a(t){if(t===!1)return We.False;if(t===!0)return We.True;if(t===null)return We.Null;if(t===void 0)return We.Undefined;throw new fn(`Unrecognized simple value: ${t.toString()}`)}function ec(t,e){Or(t,e.length),fe>Ue.length-e.length&&(Ue=zi(Ue,Ue.length+e.length),Xe=new DataView(Ue.buffer)),Ue.set(e,fe),fe+=e.length}function tc(t,e){Or(t,e)}function Va(t){tc(ue.UnsignedInteger,t)}function ja(t){tc(ue.NegativeInteger,typeof t=="bigint"?-1n-t:-1-t)}function Ha(t){t>=0?Va(t):ja(t)}function rc(t){ec(ue.TextString,Ma.encode(t))}function Zi(t){ec(ue.ByteString,t)}function Ka(t,e,r){Or(ue.Tag,t),Yo(e,r)}function Za(t){return typeof t=="object"&&t!==null&&"toCborValue"in t}function no(t){try{return Ji(t,e=>H.isPrincipal(e)?e.toUint8Array():Cr.isExpiry(e)?e.toBigInt():Za(e)?e.toCborValue():e)}catch(e){throw G.fromCode(new Ln(e,t))}}function qe(t){try{return Wi(t)}catch(e){throw G.fromCode(new Pn(e,t))}}var un=()=>{if(typeof window<"u"&&window.crypto&&window.crypto.getRandomValues){let t=new Uint32Array(1);return window.crypto.getRandomValues(t),t[0]}if(typeof crypto<"u"&&crypto.getRandomValues){let t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]}return typeof crypto<"u"&&crypto.randomInt?crypto.randomInt(0,4294967295):Math.floor(Math.random()*4294967295)};var gt;(function(t){t.Query="read",t.ReadState="read_state",t.Call="call"})(gt||(gt={}));var oo;(function(t){t.Call="call"})(oo||(oo={}));var ir;(function(t){t.Query="query",t.ReadState="read_state"})(ir||(ir={}));function dn(){let t=new ArrayBuffer(16),e=new DataView(t),r=un(),n=un(),o=un(),s=un();return e.setUint32(0,r),e.setUint32(4,n),e.setUint32(8,o),e.setUint32(12,s),Object.assign(new Uint8Array(t),{__nonce__:void 0})}var so="__expiry__",zo=BigInt(1e6),io=zo*BigInt(1e3),nc=BigInt(60),Ya=60*1e3,Cr=class t{constructor(e){this.__expiry__=e,this._isExpiry=!0}static fromDeltaInMilliseconds(e){if(e<90*1e3){let c=BigInt(Date.now()+e)*zo/io;return new t(c*io)}let s=BigInt(Math.floor(Date.now()+e-Ya))*zo/io/nc*nc*io;return new t(s)}toBigInt(){return this.__expiry__}toHash(){return J(this.__expiry__)}toString(){return this.__expiry__.toString()}toJSON(){return{[so]:this.toString()}}static fromJSON(e){let r=JSON.parse(e);if(r[so])try{let n=BigInt(r[so]);return new t(n)}catch(n){throw new G(new Wr(`Not a valid BigInt: ${n}`))}throw new G(new Wr(`The input does not contain the key ${so}`))}static isExpiry(e){return e instanceof t||typeof e=="object"&&e!==null&&"_isExpiry"in e&&e._isExpiry===!0&&"__expiry__"in e&&typeof e.__expiry__=="bigint"}};function Wo(t=dn){return async e=>{let r=e.request.headers;e.request.headers=r,e.endpoint===gt.Call&&(e.body.nonce=t())}}function co(t){let e=[];return t.forEach((r,n)=>{e.push([n,r])}),e}var Jo=BigInt(0),ao=BigInt(1);function cr(t,e=""){if(typeof t!="boolean"){let r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function kt(t,e,r=""){let n=rt(t),o=t?.length,s=e!==void 0;if(!n||s&&o!==e){let i=r&&`"${r}" `,c=s?` of length ${e}`:"",a=n?`length=${o}`:`type=${typeof t}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return t}function oc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Jo:BigInt("0x"+t)}function Ce(t){return oc(K(t))}function xt(t){return ne(t),oc(K(Uint8Array.from(t).reverse()))}function de(t,e){return He(t.toString(16).padStart(e*2,"0"))}function es(t,e){return de(t,e).reverse()}function re(t,e,r){let n;if(typeof e=="string")try{n=He(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(rt(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(t+" of length "+r+" expected, got "+o);return n}function sc(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}function ts(t){return Uint8Array.from(t)}var Qo=t=>typeof t=="bigint"&&Jo<=t;function rs(t,e,r){return Qo(t)&&Qo(e)&&Qo(r)&&e<=t&&t<r}function fo(t,e,r,n){if(!rs(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function wt(t){let e;for(e=0;t>Jo;t>>=ao,e+=1);return e}function ic(t,e){return t>>BigInt(e)&ao}var Je=t=>(ao<<BigInt(t))-ao;function cc(t){return typeof t=="function"&&Number.isSafeInteger(t.outputLen)}function Et(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(o,s,i){let c=t[o];if(i&&c===void 0)return;let a=typeof c;if(a!==s||c===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${a}`)}Object.entries(e).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}var Rr=()=>{throw new Error("not implemented")};function Ft(t){let e=new WeakMap;return(r,...n)=>{let o=e.get(r);if(o!==void 0)return o;let s=t(r,...n);return e.set(r,s),s}}var Ie=BigInt(0),he=BigInt(1),ar=BigInt(2),fc=BigInt(3),uc=BigInt(4),dc=BigInt(5),Xa=BigInt(7),lc=BigInt(8),za=BigInt(9),hc=BigInt(16);function ee(t,e){let r=t%e;return r>=Ie?r:e+r}function et(t,e,r){let n=t;for(;e-- >Ie;)n*=n,n%=r;return n}function ac(t,e){if(t===Ie)throw new Error("invert: expected non-zero number");if(e<=Ie)throw new Error("invert: expected positive modulus, got "+e);let r=ee(t,e),n=e,o=Ie,s=he,i=he,c=Ie;for(;r!==Ie;){let u=n/r,h=n%r,d=o-i*u,f=s-c*u;n=r,r=h,o=i,s=c,i=d,c=f}if(n!==he)throw new Error("invert: does not exist");return ee(o,e)}function ns(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function pc(t,e){let r=(t.ORDER+he)/uc,n=t.pow(e,r);return ns(t,n,e),n}function Wa(t,e){let r=(t.ORDER-dc)/lc,n=t.mul(e,ar),o=t.pow(n,r),s=t.mul(e,o),i=t.mul(t.mul(s,ar),o),c=t.mul(s,t.sub(i,t.ONE));return ns(t,c,e),c}function Qa(t){let e=Te(t),r=mc(t),n=r(e,e.neg(e.ONE)),o=r(e,n),s=r(e,e.neg(n)),i=(t+Xa)/hc;return(c,a)=>{let u=c.pow(a,i),h=c.mul(u,n),d=c.mul(u,o),f=c.mul(u,s),l=c.eql(c.sqr(h),a),p=c.eql(c.sqr(d),a);u=c.cmov(u,h,l),h=c.cmov(f,d,p);let b=c.eql(c.sqr(h),a),g=c.cmov(u,h,b);return ns(c,g,a),g}}function mc(t){if(t<fc)throw new Error("sqrt is not defined for small field");let e=t-he,r=0;for(;e%ar===Ie;)e/=ar,r++;let n=ar,o=Te(t);for(;ln(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return pc;let s=o.pow(n,e),i=(e+he)/ar;return function(a,u){if(a.is0(u))return u;if(ln(a,u)!==1)throw new Error("Cannot find square root");let h=r,d=a.mul(a.ONE,s),f=a.pow(u,e),l=a.pow(u,i);for(;!a.eql(f,a.ONE);){if(a.is0(f))return a.ZERO;let p=1,b=a.sqr(f);for(;!a.eql(b,a.ONE);)if(p++,b=a.sqr(b),p===h)throw new Error("Cannot find square root");let g=he<<BigInt(h-p-1),m=a.pow(d,g);h=p,d=a.sqr(m),f=a.mul(f,d),l=a.mul(l,m)}return l}}function Ja(t){return t%uc===fc?pc:t%lc===dc?Wa:t%hc===za?Qa(t):mc(t)}var _t=(t,e)=>(ee(t,e)&he)===he,ef=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function uo(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=ef.reduce((n,o)=>(n[o]="function",n),e);return Et(t,r),t}function hn(t,e,r){if(r<Ie)throw new Error("invalid exponent, negatives unsupported");if(r===Ie)return t.ONE;if(r===he)return e;let n=t.ONE,o=e;for(;r>Ie;)r&he&&(n=t.mul(n,o)),o=t.sqr(o),r>>=he;return n}function Le(t,e,r=!1){let n=new Array(e.length).fill(r?t.ZERO:void 0),o=e.reduce((i,c,a)=>t.is0(c)?i:(n[a]=i,t.mul(i,c)),t.ONE),s=t.inv(o);return e.reduceRight((i,c,a)=>t.is0(c)?i:(n[a]=t.mul(i,n[a]),t.mul(i,c)),s),n}function ln(t,e){let r=(t.ORDER-he)/ar,n=t.pow(e,r),o=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),i=t.eql(n,t.neg(t.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function os(t,e){e!==void 0&&Oo(e);let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Te(t,e,r=!1,n={}){if(t<=Ie)throw new Error("invalid field: expected ORDER > 0, got "+t);let o,s,i=!1,c;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=e;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(i=f.modFromBytes),c=f.allowedLengths}else typeof e=="number"&&(o=e),n.sqrt&&(s=n.sqrt);let{nBitLength:a,nByteLength:u}=os(t,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h,d=Object.freeze({ORDER:t,isLE:r,BITS:a,BYTES:u,MASK:Je(a),ZERO:Ie,ONE:he,allowedLengths:c,create:f=>ee(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ie<=f&&f<t},is0:f=>f===Ie,isValidNot0:f=>!d.is0(f)&&d.isValid(f),isOdd:f=>(f&he)===he,neg:f=>ee(-f,t),eql:(f,l)=>f===l,sqr:f=>ee(f*f,t),add:(f,l)=>ee(f+l,t),sub:(f,l)=>ee(f-l,t),mul:(f,l)=>ee(f*l,t),pow:(f,l)=>hn(d,f,l),div:(f,l)=>ee(f*ac(l,t),t),sqrN:f=>f*f,addN:(f,l)=>f+l,subN:(f,l)=>f-l,mulN:(f,l)=>f*l,inv:f=>ac(f,t),sqrt:s||(f=>(h||(h=Ja(t)),h(d,f))),toBytes:f=>r?es(f,u):de(f,u),fromBytes:(f,l=!0)=>{if(c){if(!c.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);let b=new Uint8Array(u);b.set(f,r?0:b.length-f.length),f=b}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let p=r?xt(f):Ce(f);if(i&&(p=ee(p,t)),!l&&!d.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>Le(d,f),cmov:(f,l,p)=>p?l:f});return Object.freeze(d)}function yc(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function lo(t){let e=yc(t);return e+Math.ceil(e/2)}function ss(t,e,r=!1){let n=t.length,o=yc(e),s=lo(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?xt(t):Ce(t),c=ee(i,e-he)+he;return r?es(c,o):de(c,o)}var Nr=BigInt(0),fr=BigInt(1);function pn(t,e){let r=e.negate();return t?r:e}function Me(t,e){let r=Le(t.Fp,e.map(n=>n.Z));return e.map((n,o)=>t.fromAffine(n.toAffine(r[o])))}function wc(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function is(t,e){wc(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1),o=2**t,s=Je(t),i=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function bc(t,e,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,c=Number(t&o),a=t>>i;c>n&&(c-=s,a+=fr);let u=e*n,h=u+Math.abs(c)-1,d=c===0,f=c<0,l=e%2!==0;return{nextN:a,offset:h,isZero:d,isNeg:f,isNegF:l,offsetF:u}}function rf(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function nf(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}var cs=new WeakMap,Ec=new WeakMap;function as(t){return Ec.get(t)||1}function gc(t){if(t!==Nr)throw new Error("invalid wNAF")}var Ur=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let o=e;for(;r>Nr;)r&fr&&(n=n.add(o)),o=o.double(),r>>=fr;return n}precomputeWindow(e,r){let{windows:n,windowSize:o}=is(r,this.bits),s=[],i=e,c=i;for(let a=0;a<n;a++){c=i,s.push(c);for(let u=1;u<o;u++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=is(e,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:u,isZero:h,isNeg:d,isNegF:f,offsetF:l}=bc(n,c,i);n=a,h?s=s.add(pn(f,r[l])):o=o.add(pn(d,r[u]))}return gc(n),{p:o,f:s}}wNAFUnsafe(e,r,n,o=this.ZERO){let s=is(e,this.bits);for(let i=0;i<s.windows&&n!==Nr;i++){let{nextN:c,offset:a,isZero:u,isNeg:h}=bc(n,i,s);if(n=c,!u){let d=r[a];o=o.add(h?d.negate():d)}}return gc(n),o}getPrecomputes(e,r,n){let o=cs.get(r);return o||(o=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(o=n(o)),cs.set(r,o))),o}cached(e,r,n){let o=as(e);return this.wNAF(o,this.getPrecomputes(o,e,n),r)}unsafe(e,r,n,o){let s=as(e);return s===1?this._unsafeLadder(e,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,o)}createCache(e,r){wc(r,this.bits),Ec.set(e,r),cs.delete(e)}hasCache(e){return as(e)!==1}};function _c(t,e,r,n){let o=e,s=t.ZERO,i=t.ZERO;for(;r>Nr||n>Nr;)r&fr&&(s=s.add(o)),n&fr&&(i=i.add(o)),o=o.double(),r>>=fr,n>>=fr;return{p1:s,p2:i}}function qr(t,e,r,n){rf(r,t),nf(n,e);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=t.ZERO,c=wt(BigInt(o)),a=1;c>12?a=c-3:c>4?a=c-2:c>0&&(a=2);let u=Je(a),h=new Array(Number(u)+1).fill(i),d=Math.floor((e.BITS-1)/a)*a,f=i;for(let l=d;l>=0;l-=a){h.fill(i);for(let b=0;b<s;b++){let g=n[b],m=Number(g>>BigInt(l)&u);h[m]=h[m].add(r[b])}let p=i;for(let b=h.length-1,g=i;b>0;b--)g=g.add(h[b]),p=p.add(g);if(f=f.add(p),l!==0)for(let b=0;b<a;b++)f=f.double()}return f}function xc(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return uo(e),e}else return Te(t,{isLE:r})}function ho(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let a of["p","n","h"]){let u=e[a];if(!(typeof u=="bigint"&&u>Nr))throw new Error(`CURVE.${a} must be positive bigint`)}let o=xc(e.p,r.Fp,n),s=xc(e.n,r.Fn,n),c=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let a of c)if(!o.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:s}}var of=Ce;function $t(t,e){if(mn(t),mn(e),t<0||t>=1<<8*e)throw new Error("invalid I2OSP input: "+t);let r=Array.from({length:e}).fill(0);for(let n=e-1;n>=0;n--)r[n]=t&255,t>>>=8;return new Uint8Array(r)}function sf(t,e){let r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t[n]^e[n];return r}function mn(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function Bc(t){if(!rt(t)&&typeof t!="string")throw new Error("DST must be Uint8Array or string");return typeof t=="string"?z(t):t}function cf(t,e,r,n){ne(t),mn(r),e=Bc(e),e.length>255&&(e=n(F(z("H2C-OVERSIZE-DST-"),e)));let{outputLen:o,blockLen:s}=n,i=Math.ceil(r/o);if(r>65535||i>255)throw new Error("expand_message_xmd: invalid lenInBytes");let c=F(e,$t(e.length,1)),a=$t(0,s),u=$t(r,2),h=new Array(i),d=n(F(a,t,u,$t(0,1),c));h[0]=n(F(d,$t(1,1),c));for(let l=1;l<=i;l++){let p=[sf(d,h[l-1]),$t(l+1,1),c];h[l]=n(F(...p))}return F(...h).slice(0,r)}function af(t,e,r,n,o){if(ne(t),mn(r),e=Bc(e),e.length>255){let s=Math.ceil(2*n/8);e=o.create({dkLen:s}).update(z("H2C-OVERSIZE-DST-")).update(e).digest()}if(r>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return o.create({dkLen:r}).update(t).update($t(r,2)).update(e).update($t(e.length,1)).digest()}function fs(t,e,r){Et(r,{p:"bigint",m:"number",k:"number",hash:"function"});let{p:n,k:o,m:s,hash:i,expand:c,DST:a}=r;if(!cc(r.hash))throw new Error("expected valid hash");ne(t),mn(e);let u=n.toString(2).length,h=Math.ceil((u+o)/8),d=e*s*h,f;if(c==="xmd")f=cf(t,a,d,i);else if(c==="xof")f=af(t,a,d,o,i);else if(c==="_internal_pass")f=t;else throw new Error('expand must be "xmd" or "xof"');let l=new Array(e);for(let p=0;p<e;p++){let b=new Array(s);for(let g=0;g<s;g++){let m=h*(g+p*s),w=f.subarray(m,m+h);b[g]=ee(of(w),n)}l[p]=b}return l}function us(t,e){let r=e.map(n=>Array.from(n).reverse());return(n,o)=>{let[s,i,c,a]=r.map(d=>d.reduce((f,l)=>t.add(t.mul(f,n),l))),[u,h]=Le(t,[i,a],!0);return n=t.mul(s,u),o=t.mul(o,t.mul(c,h)),{x:n,y:o}}}var ff=z("HashToScalar-");function ds(t,e,r){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function n(s){return t.fromAffine(e(s))}function o(s){let i=s.clearCofactor();return i.equals(t.ZERO)?t.ZERO:(i.assertValidity(),i)}return{defaults:r,hashToCurve(s,i){let c=Object.assign({},r,i),a=fs(s,2,c),u=n(a[0]),h=n(a[1]);return o(u.add(h))},encodeToCurve(s,i){let c=r.encodeDST?{DST:r.encodeDST}:{},a=Object.assign({},r,c,i),u=fs(s,1,a),h=n(u[0]);return o(h)},mapToCurve(s){if(!Array.isArray(s))throw new Error("expected array of bigints");for(let i of s)if(typeof i!="bigint")throw new Error("expected array of bigints");return o(n(s))},hashToScalar(s,i){let c=t.Fn.ORDER,a=Object.assign({},r,{p:c,m:1,DST:ff},i);return fs(s,1,a)[0][0]}}}var vc=(t,e)=>(t+(t>=0?e:-e)/Bt)/e;function uf(t,e,r){let[[n,o],[s,i]]=e,c=vc(i*t,r),a=vc(-o*t,r),u=t-c*n-a*s,h=-c*o-a*i,d=u<ur,f=h<ur;d&&(u=-u),f&&(h=-h);let l=Je(Math.ceil(wt(r)/2))+Se;if(u<ur||u>=l||h<ur||h>=l)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:d,k1:u,k2neg:f,k2:h}}var ur=BigInt(0),Se=BigInt(1),Bt=BigInt(2),Pr=BigInt(3),ls=BigInt(4);function yn(t,e){let{BYTES:r}=t,n;if(typeof e=="bigint")n=e;else{let o=re("private key",e);try{n=t.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function df(t,e={}){let r=ho("weierstrass",t,e),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:c}=s;Et(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:a}=e;if(a&&(!n.is0(s.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=pf(n,o);function h(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(C,x,B){let{x:R,y:L}=x.toAffine(),$=n.toBytes(R);if(cr(B,"isCompressed"),B){h();let O=!n.isOdd(L);return F(lf(O),$)}else return F(Uint8Array.of(4),$,n.toBytes(L))}function f(C){kt(C,void 0,"Point");let{publicKey:x,publicKeyUncompressed:B}=u,R=C.length,L=C[0],$=C.subarray(1);if(R===x&&(L===2||L===3)){let O=n.fromBytes($);if(!n.isValid(O))throw new Error("bad point: is not on curve, wrong x");let N=b(O),q;try{q=n.sqrt(N)}catch(ye){let ce=ye instanceof Error?": "+ye.message:"";throw new Error("bad point: is not on curve, sqrt error"+ce)}h();let M=n.isOdd(q);return(L&1)===1!==M&&(q=n.neg(q)),{x:O,y:q}}else if(R===B&&L===4){let O=n.BYTES,N=n.fromBytes($.subarray(0,O)),q=n.fromBytes($.subarray(O,O*2));if(!g(N,q))throw new Error("bad point: is not on curve");return{x:N,y:q}}else throw new Error(`bad point: got length ${R}, expected compressed=${x} or uncompressed=${B}`)}let l=e.toBytes||d,p=e.fromBytes||f;function b(C){let x=n.sqr(C),B=n.mul(x,C);return n.add(n.add(B,n.mul(C,s.a)),s.b)}function g(C,x){let B=n.sqr(x),R=b(C);return n.eql(B,R)}if(!g(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let m=n.mul(n.pow(s.a,Pr),ls),w=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(m,w)))throw new Error("bad curve params: a or b");function y(C,x,B=!1){if(!n.isValid(x)||B&&n.is0(x))throw new Error(`bad point coordinate ${C}`);return x}function _(C){if(!(C instanceof E))throw new Error("ProjectivePoint expected")}function v(C){if(!a||!a.basises)throw new Error("no endo");return uf(C,a.basises,o.ORDER)}let I=Ft((C,x)=>{let{X:B,Y:R,Z:L}=C;if(n.eql(L,n.ONE))return{x:B,y:R};let $=C.is0();x==null&&(x=$?n.ONE:n.inv(L));let O=n.mul(B,x),N=n.mul(R,x),q=n.mul(L,x);if($)return{x:n.ZERO,y:n.ZERO};if(!n.eql(q,n.ONE))throw new Error("invZ was invalid");return{x:O,y:N}}),T=Ft(C=>{if(C.is0()){if(e.allowInfinityPoint&&!n.is0(C.Y))return;throw new Error("bad point: ZERO")}let{x,y:B}=C.toAffine();if(!n.isValid(x)||!n.isValid(B))throw new Error("bad point: x or y not field elements");if(!g(x,B))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function A(C,x,B,R,L){return B=new E(n.mul(B.X,C),B.Y,B.Z),x=pn(R,x),B=pn(L,B),x.add(B)}class E{constructor(x,B,R){this.X=y("x",x),this.Y=y("y",B,!0),this.Z=y("z",R),Object.freeze(this)}static CURVE(){return s}static fromAffine(x){let{x:B,y:R}=x||{};if(!x||!n.isValid(B)||!n.isValid(R))throw new Error("invalid affine point");if(x instanceof E)throw new Error("projective point not allowed");return n.is0(B)&&n.is0(R)?E.ZERO:new E(B,R,n.ONE)}static fromBytes(x){let B=E.fromAffine(p(kt(x,void 0,"point")));return B.assertValidity(),B}static fromHex(x){return E.fromBytes(re("pointHex",x))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,B=!0){return U.createCache(this,x),B||this.multiply(Pr),this}assertValidity(){T(this)}hasEvenY(){let{y:x}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(x)}equals(x){_(x);let{X:B,Y:R,Z:L}=this,{X:$,Y:O,Z:N}=x,q=n.eql(n.mul(B,N),n.mul($,L)),M=n.eql(n.mul(R,N),n.mul(O,L));return q&&M}negate(){return new E(this.X,n.neg(this.Y),this.Z)}double(){let{a:x,b:B}=s,R=n.mul(B,Pr),{X:L,Y:$,Z:O}=this,N=n.ZERO,q=n.ZERO,M=n.ZERO,D=n.mul(L,L),ye=n.mul($,$),ce=n.mul(O,O),W=n.mul(L,$);return W=n.add(W,W),M=n.mul(L,O),M=n.add(M,M),N=n.mul(x,M),q=n.mul(R,ce),q=n.add(N,q),N=n.sub(ye,q),q=n.add(ye,q),q=n.mul(N,q),N=n.mul(W,N),M=n.mul(R,M),ce=n.mul(x,ce),W=n.sub(D,ce),W=n.mul(x,W),W=n.add(W,M),M=n.add(D,D),D=n.add(M,D),D=n.add(D,ce),D=n.mul(D,W),q=n.add(q,D),ce=n.mul($,O),ce=n.add(ce,ce),D=n.mul(ce,W),N=n.sub(N,D),M=n.mul(ce,ye),M=n.add(M,M),M=n.add(M,M),new E(N,q,M)}add(x){_(x);let{X:B,Y:R,Z:L}=this,{X:$,Y:O,Z:N}=x,q=n.ZERO,M=n.ZERO,D=n.ZERO,ye=s.a,ce=n.mul(s.b,Pr),W=n.mul(B,$),$e=n.mul(R,O),Ve=n.mul(L,N),mr=n.add(B,R),_e=n.add($,O);mr=n.mul(mr,_e),_e=n.add(W,$e),mr=n.sub(mr,_e),_e=n.add(B,L);let tt=n.add($,N);return _e=n.mul(_e,tt),tt=n.add(W,Ve),_e=n.sub(_e,tt),tt=n.add(R,L),q=n.add(O,N),tt=n.mul(tt,q),q=n.add($e,Ve),tt=n.sub(tt,q),D=n.mul(ye,_e),q=n.mul(ce,Ve),D=n.add(q,D),q=n.sub($e,D),D=n.add($e,D),M=n.mul(q,D),$e=n.add(W,W),$e=n.add($e,W),Ve=n.mul(ye,Ve),_e=n.mul(ce,_e),$e=n.add($e,Ve),Ve=n.sub(W,Ve),Ve=n.mul(ye,Ve),_e=n.add(_e,Ve),W=n.mul($e,_e),M=n.add(M,W),W=n.mul(tt,_e),q=n.mul(mr,q),q=n.sub(q,W),W=n.mul(mr,$e),D=n.mul(tt,D),D=n.add(D,W),new E(q,M,D)}subtract(x){return this.add(x.negate())}is0(){return this.equals(E.ZERO)}multiply(x){let{endo:B}=e;if(!o.isValidNot0(x))throw new Error("invalid scalar: out of range");let R,L,$=O=>U.cached(this,O,N=>Me(E,N));if(B){let{k1neg:O,k1:N,k2neg:q,k2:M}=v(x),{p:D,f:ye}=$(N),{p:ce,f:W}=$(M);L=ye.add(W),R=A(B.beta,D,ce,O,q)}else{let{p:O,f:N}=$(x);R=O,L=N}return Me(E,[R,L])[0]}multiplyUnsafe(x){let{endo:B}=e,R=this;if(!o.isValid(x))throw new Error("invalid scalar: out of range");if(x===ur||R.is0())return E.ZERO;if(x===Se)return R;if(U.hasCache(this))return this.multiply(x);if(B){let{k1neg:L,k1:$,k2neg:O,k2:N}=v(x),{p1:q,p2:M}=_c(E,R,$,N);return A(B.beta,q,M,L,O)}else return U.unsafe(R,x)}multiplyAndAddUnsafe(x,B,R){let L=this.multiplyUnsafe(B).add(x.multiplyUnsafe(R));return L.is0()?void 0:L}toAffine(x){return I(this,x)}isTorsionFree(){let{isTorsionFree:x}=e;return i===Se?!0:x?x(E,this):U.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:x}=e;return i===Se?this:x?x(E,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(x=!0){return cr(x,"isCompressed"),this.assertValidity(),l(E,this,x)}toHex(x=!0){return K(this.toBytes(x))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(x=!0){return this.toBytes(x)}_setWindowSize(x){this.precompute(x)}static normalizeZ(x){return Me(E,x)}static msm(x,B){return qr(E,o,x,B)}static fromPrivateKey(x){return E.BASE.multiply(yn(o,x))}}E.BASE=new E(s.Gx,s.Gy,n.ONE),E.ZERO=new E(n.ZERO,n.ONE,n.ZERO),E.Fp=n,E.Fn=o;let S=o.BITS,U=new Ur(E,e.endo?Math.ceil(S/2):S);return E.BASE.precompute(8),E}function lf(t){return Uint8Array.of(t?2:3)}function hf(t,e){let r=t.ORDER,n=ur;for(let p=r-Se;p%Bt===ur;p/=Bt)n+=Se;let o=n,s=Bt<<o-Se-Se,i=s*Bt,c=(r-Se)/i,a=(c-Se)/Bt,u=i-Se,h=s,d=t.pow(e,c),f=t.pow(e,(c+Se)/Bt),l=(p,b)=>{let g=d,m=t.pow(b,u),w=t.sqr(m);w=t.mul(w,b);let y=t.mul(p,w);y=t.pow(y,a),y=t.mul(y,m),m=t.mul(y,b),w=t.mul(y,p);let _=t.mul(w,m);y=t.pow(_,h);let v=t.eql(y,t.ONE);m=t.mul(w,f),y=t.mul(_,g),w=t.cmov(m,w,v),_=t.cmov(y,_,v);for(let I=o;I>Se;I--){let T=I-Bt;T=Bt<<T-Se;let A=t.pow(_,T),E=t.eql(A,t.ONE);m=t.mul(w,g),g=t.mul(g,g),A=t.mul(_,g),w=t.cmov(m,w,E),_=t.cmov(A,_,E)}return{isValid:v,value:w}};if(t.ORDER%ls===Pr){let p=(t.ORDER-Pr)/ls,b=t.sqrt(t.neg(e));l=(g,m)=>{let w=t.sqr(m),y=t.mul(g,m);w=t.mul(w,y);let _=t.pow(w,p);_=t.mul(_,y);let v=t.mul(_,b),I=t.mul(t.sqr(_),m),T=t.eql(I,g),A=t.cmov(v,_,T);return{isValid:T,value:A}}}return l}function hs(t,e){uo(t);let{A:r,B:n,Z:o}=e;if(!t.isValid(r)||!t.isValid(n)||!t.isValid(o))throw new Error("mapToCurveSimpleSWU: invalid opts");let s=hf(t,o);if(!t.isOdd)throw new Error("Field does not have .isOdd()");return i=>{let c,a,u,h,d,f,l,p;c=t.sqr(i),c=t.mul(c,o),a=t.sqr(c),a=t.add(a,c),u=t.add(a,t.ONE),u=t.mul(u,n),h=t.cmov(o,t.neg(a),!t.eql(a,t.ZERO)),h=t.mul(h,r),a=t.sqr(u),f=t.sqr(h),d=t.mul(f,r),a=t.add(a,d),a=t.mul(a,u),f=t.mul(f,h),d=t.mul(f,n),a=t.add(a,d),l=t.mul(c,u);let{isValid:b,value:g}=s(a,f);p=t.mul(c,i),p=t.mul(p,g),l=t.cmov(l,u,b),p=t.cmov(p,g,b);let m=t.isOdd(i)===t.isOdd(p);p=t.cmov(t.neg(p),p,m);let w=Le(t,[h],!0)[0];return l=t.mul(l,w),{x:l,y:p}}}function pf(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function ps(t){let{CURVE:e,curveOpts:r}=mf(t),n=df(e,r);return bf(t,n)}function mf(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(i=>Math.ceil(i/2)))):void 0,o=Te(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:o,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function yf(t,e,r){function n(o){let s=t.sqr(o),i=t.mul(s,o);return t.add(t.add(i,t.mul(o,e)),r)}return n}function bf(t,e){let{Fp:r,Fn:n}=e;function o(i){return rs(i,Se,n.ORDER)}let s=yf(r,t.a,t.b);return Object.assign({},{CURVE:t,Point:e,ProjectivePoint:e,normPrivateKeyToScalar:i=>yn(n,i),weierstrassEquation:s,isWithinCurveOrder:o})}var gf=BigInt(0),po=BigInt(1),Ic=BigInt(2),Lr=BigInt(3);function xf(t){let e=[];for(;t>po;t>>=po)(t&po)===gf?e.unshift(0):(t&Lr)===Lr?(e.unshift(-1),t+=po):e.unshift(1);return e}function ms(t){if(!Array.isArray(t)||t.length===0)throw new Error("expected non-empty array")}function wf(t,e,r,n){let{Fp2:o,Fp12:s}=t,{twistType:i,ateLoopSize:c,xNegative:a,postPrecompute:u}=n,h;if(i==="multiplicative")h=(y,_,v,I,T,A)=>s.mul014(I,y,o.mul(_,T),o.mul(v,A));else if(i==="divisive")h=(y,_,v,I,T,A)=>s.mul034(I,o.mul(v,A),o.mul(_,T),y);else throw new Error("bls: unknown twist type");let d=o.div(o.ONE,o.mul(o.ONE,Ic));function f(y,_,v,I){let T=o.sqr(v),A=o.sqr(I),E=o.mulByB(o.mul(A,Lr)),S=o.mul(E,Lr),U=o.sub(o.sub(o.sqr(o.add(v,I)),A),T),C=o.sub(E,T),x=o.mul(o.sqr(_),Lr),B=o.neg(U);return y.push([C,x,B]),_=o.mul(o.mul(o.mul(o.sub(T,S),_),v),d),v=o.sub(o.sqr(o.mul(o.add(T,S),d)),o.mul(o.sqr(E),Lr)),I=o.mul(T,U),{Rx:_,Ry:v,Rz:I}}function l(y,_,v,I,T,A){let E=o.sub(v,o.mul(A,I)),S=o.sub(_,o.mul(T,I)),U=o.sub(o.mul(E,T),o.mul(S,A)),C=o.neg(E),x=S;y.push([U,C,x]);let B=o.sqr(S),R=o.mul(B,S),L=o.mul(B,_),$=o.add(o.sub(R,o.mul(L,Ic)),o.mul(o.sqr(E),I));return _=o.mul(S,$),v=o.sub(o.mul(o.sub(L,$),E),o.mul(R,v)),I=o.mul(I,R),{Rx:_,Ry:v,Rz:I}}let p=xf(c),b=Ft(y=>{let _=y,{x:v,y:I}=_.toAffine(),T=v,A=I,E=o.neg(I),S=T,U=A,C=o.ONE,x=[];for(let B of p){let R=[];({Rx:S,Ry:U,Rz:C}=f(R,S,U,C)),B&&({Rx:S,Ry:U,Rz:C}=l(R,S,U,C,T,B===-1?E:A)),x.push(R)}if(u){let B=x[x.length-1];u(S,U,C,T,A,l.bind(null,B))}return x});function g(y,_=!1){let v=s.ONE;if(y.length){let I=y[0][0].length;for(let T=0;T<I;T++){v=s.sqr(v);for(let[A,E,S]of y)for(let[U,C,x]of A[T])v=h(U,C,x,v,E,S)}}return a&&(v=s.conjugate(v)),_?s.finalExponentiate(v):v}function m(y,_=!0){let v=[];Me(e,y.map(({g1:I})=>I)),Me(r,y.map(({g2:I})=>I));for(let{g1:I,g2:T}of y){if(I.is0()||T.is0())throw new Error("pairing is not available for ZERO point");I.assertValidity(),T.assertValidity();let A=I.toAffine();v.push([b(T),A.x,A.y])}return g(v,_)}function w(y,_,v=!0){return m([{g1:y,g2:_}],v)}return{Fp12:s,millerLoopBatch:g,pairing:w,pairingBatch:m,calcPairingPrecomputes:b}}function Tc(t,e,r,n,o){let{Fp12:s,pairingBatch:i}=t;function c(d){return d instanceof e.Point?d:e.Point.fromHex(d)}function a(d){return d instanceof r.Point?d:r.Point.fromHex(d)}function u(d){if(!(d instanceof r.Point))throw new Error(`expected valid message hashed to ${o?"G1":"G2"} curve`);return d}let h=o?(d,f)=>({g1:f,g2:d}):(d,f)=>({g1:d,g2:f});return{getPublicKey(d){let f=yn(e.Point.Fn,d);return e.Point.BASE.multiply(f)},sign(d,f,l){if(l!=null)throw new Error("sign() expects 2 arguments");let p=yn(e.Point.Fn,f);return u(d).assertValidity(),d.multiply(p)},verify(d,f,l,p){if(p!=null)throw new Error("verify() expects 3 arguments");d=a(d),l=c(l);let b=l.negate(),g=e.Point.BASE,m=u(f),w=d,y=i([h(b,m),h(g,w)]);return s.eql(y,s.ONE)},verifyBatch(d,f,l){if(ms(f),l.length!==f.length)throw new Error("amount of public keys and messages should be equal");let p=a(d),b=f,g=l.map(c),m=new Map;for(let _=0;_<g.length;_++){let v=g[_],I=b[_],T=m.get(I);T===void 0&&(T=[],m.set(I,T)),T.push(v)}let w=[],y=e.Point.BASE;try{for(let[_,v]of m){let I=v.reduce((T,A)=>T.add(A));w.push(h(I,_))}return w.push(h(y.negate(),p)),s.eql(i(w),s.ONE)}catch{return!1}},aggregatePublicKeys(d){ms(d),d=d.map(l=>c(l));let f=d.reduce((l,p)=>l.add(p),e.Point.ZERO);return f.assertValidity(),f},aggregateSignatures(d){ms(d),d=d.map(l=>a(l));let f=d.reduce((l,p)=>l.add(p),r.Point.ZERO);return f.assertValidity(),f},hash(d,f){ne(d);let l=f?{DST:f}:void 0;return r.hashToCurve(d,l)},Signature:n}}function Sc(t){let{Fp:e,Fr:r,Fp2:n,Fp6:o,Fp12:s}=t.fields,i=ps(t.G1),c=Object.assign(i,ds(i.Point,t.G1.mapToCurve,{...t.htfDefaults,...t.G1.htfDefaults})),a=ps(t.G2),u=Object.assign(a,ds(a.Point,t.G2.mapToCurve,{...t.htfDefaults,...t.G2.htfDefaults})),h=wf(t.fields,c.Point,u.Point,{...t.params,postPrecompute:t.postPrecompute}),{millerLoopBatch:d,pairing:f,pairingBatch:l,calcPairingPrecomputes:p}=h,b=Tc(h,c,u,t.G2.Signature,!1),g=Tc(h,u,c,t.G1.ShortSignature,!0),m=t.randomBytes||br,w=()=>{let O=lo(r.ORDER);return ss(m(O),r.ORDER)},y={randomSecretKey:w,randomPrivateKey:w,calcPairingPrecomputes:p},{ShortSignature:_}=t.G1,{Signature:v}=t.G2;function I(O,N){return O instanceof c.Point?O:g.hash(re("point",O),N?.DST)}function T(O,N){return O instanceof u.Point?O:b.hash(re("point",O),N?.DST)}function A(O){return b.getPublicKey(O).toBytes(!0)}function E(O){return g.getPublicKey(O).toBytes(!0)}function S(O,N,q){let M=T(O,q),D=b.sign(M,N);return O instanceof u.Point?D:v.toBytes(D)}function U(O,N,q){let M=I(O,q),D=g.sign(M,N);return O instanceof c.Point?D:_.toBytes(D)}function C(O,N,q,M){let D=T(N,M);return b.verify(O,D,q)}function x(O,N,q,M){let D=I(N,M);return g.verify(O,D,q)}function B(O){let N=b.aggregatePublicKeys(O);return O[0]instanceof c.Point?N:N.toBytes(!0)}function R(O){let N=b.aggregateSignatures(O);return O[0]instanceof u.Point?N:v.toBytes(N)}function L(O){let N=g.aggregateSignatures(O);return O[0]instanceof c.Point?N:_.toBytes(N)}function $(O,N,q,M){let D=N.map(ye=>T(ye,M));return b.verifyBatch(O,D,q)}return c.Point.BASE.precompute(4),{longSignatures:b,shortSignatures:g,millerLoopBatch:d,pairing:f,pairingBatch:l,verifyBatch:$,fields:{Fr:r,Fp:e,Fp2:n,Fp6:o,Fp12:s},params:{ateLoopSize:t.params.ateLoopSize,twistType:t.params.twistType,r:t.params.r,G1b:t.G1.b,G2b:t.G2.b},utils:y,getPublicKey:A,getPublicKeyForShortSignatures:E,sign:S,signShortSignature:U,verify:C,verifyShortSignature:x,aggregatePublicKeys:B,aggregateSignatures:R,aggregateShortSignatures:L,G1:c,G2:u,Signature:v,ShortSignature:_}}var Ac=BigInt(0),vt=BigInt(1),Ae=BigInt(2),Oc=BigInt(3);function xs(t,e,r,n,o=1,s){let i=BigInt(s===void 0?n:s),c=r**BigInt(n),a=[];for(let u=0;u<o;u++){let h=BigInt(u+1),d=[];for(let f=0,l=vt;f<n;f++){let p=(h*l-h)/i%c;d.push(t.pow(e,p)),l*=r}a.push(d)}return a}function Rc(t,e,r){let n=e.pow(r,(t.ORDER-vt)/Oc),o=e.pow(r,(t.ORDER-vt)/Ae);function s(f,l){let p=e.mul(e.frobeniusMap(f,1),n),b=e.mul(e.frobeniusMap(l,1),o);return[p,b]}let i=e.pow(r,(t.ORDER**Ae-vt)/Oc),c=e.pow(r,(t.ORDER**Ae-vt)/Ae);if(!e.eql(c,e.neg(e.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function a(f,l){return[e.mul(f,i),e.neg(l)]}let u=f=>(l,p)=>{let b=p.toAffine(),g=f(b.x,b.y);return l.fromAffine({x:g[0],y:g[1]})},h=u(s),d=u(a);return{psi:s,psi2:a,G2psi:h,G2psi2:d,PSI_X:n,PSI_Y:o,PSI2_X:i,PSI2_Y:c}}var Cc=(t,e)=>{if(e.length!==2)throw new Error("invalid tuple");let r=e.map(n=>t.create(n));return{c0:r[0],c1:r[1]}},ys=class{constructor(e,r={}){this.MASK=vt;let n=e.ORDER,o=n*n;this.Fp=e,this.ORDER=o,this.BITS=wt(o),this.BYTES=Math.ceil(wt(o)/8),this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.Fp_NONRESIDUE=e.create(r.NONRESIDUE||BigInt(-1)),this.Fp_div2=e.div(e.ONE,Ae),this.NONRESIDUE=Cc(e,r.FP2_NONRESIDUE),this.FROBENIUS_COEFFICIENTS=xs(e,this.Fp_NONRESIDUE,e.ORDER,2)[0],this.mulByB=r.Fp2mulByB,Object.seal(this)}fromBigTuple(e){return Cc(this.Fp,e)}create(e){return e}isValid({c0:e,c1:r}){function n(o,s){return typeof o=="bigint"&&Ac<=o&&o<s}return n(e,this.ORDER)&&n(r,this.ORDER)}is0({c0:e,c1:r}){return this.Fp.is0(e)&&this.Fp.is0(r)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}eql({c0:e,c1:r},{c0:n,c1:o}){return this.Fp.eql(e,n)&&this.Fp.eql(r,o)}neg({c0:e,c1:r}){return{c0:this.Fp.neg(e),c1:this.Fp.neg(r)}}pow(e,r){return hn(this,e,r)}invertBatch(e){return Le(this,e)}add(e,r){let{c0:n,c1:o}=e,{c0:s,c1:i}=r;return{c0:this.Fp.add(n,s),c1:this.Fp.add(o,i)}}sub({c0:e,c1:r},{c0:n,c1:o}){return{c0:this.Fp.sub(e,n),c1:this.Fp.sub(r,o)}}mul({c0:e,c1:r},n){let{Fp:o}=this;if(typeof n=="bigint")return{c0:o.mul(e,n),c1:o.mul(r,n)};let{c0:s,c1:i}=n,c=o.mul(e,s),a=o.mul(r,i),u=o.sub(c,a),h=o.sub(o.mul(o.add(e,r),o.add(s,i)),o.add(c,a));return{c0:u,c1:h}}sqr({c0:e,c1:r}){let{Fp:n}=this,o=n.add(e,r),s=n.sub(e,r),i=n.add(e,e);return{c0:n.mul(o,s),c1:n.mul(i,r)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}div(e,r){let{Fp:n}=this;return this.mul(e,typeof r=="bigint"?n.inv(n.create(r)):this.inv(r))}inv({c0:e,c1:r}){let{Fp:n}=this,o=n.inv(n.create(e*e+r*r));return{c0:n.mul(o,n.create(e)),c1:n.mul(o,n.create(-r))}}sqrt(e){let{Fp:r}=this,n=this,{c0:o,c1:s}=e;if(r.is0(s))return ln(r,o)===1?n.create({c0:r.sqrt(o),c1:r.ZERO}):n.create({c0:r.ZERO,c1:r.sqrt(r.div(o,this.Fp_NONRESIDUE))});let i=r.sqrt(r.sub(r.sqr(o),r.mul(r.sqr(s),this.Fp_NONRESIDUE))),c=r.mul(r.add(i,o),this.Fp_div2);ln(r,c)===-1&&(c=r.sub(c,i));let u=r.sqrt(c),h=n.create({c0:u,c1:r.div(r.mul(s,this.Fp_div2),u)});if(!n.eql(n.sqr(h),e))throw new Error("Cannot find square root");let d=h,f=n.neg(d),{re:l,im:p}=n.reim(d),{re:b,im:g}=n.reim(f);return p>g||p===g&&l>b?d:f}isOdd(e){let{re:r,im:n}=this.reim(e),o=r%Ae,s=r===Ac,i=n%Ae;return BigInt(o||s&&i)==vt}fromBytes(e){let{Fp:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);return{c0:r.fromBytes(e.subarray(0,r.BYTES)),c1:r.fromBytes(e.subarray(r.BYTES))}}toBytes({c0:e,c1:r}){return F(this.Fp.toBytes(e),this.Fp.toBytes(r))}cmov({c0:e,c1:r},{c0:n,c1:o},s){return{c0:this.Fp.cmov(e,n,s),c1:this.Fp.cmov(r,o,s)}}reim({c0:e,c1:r}){return{re:e,im:r}}Fp4Square(e,r){let n=this,o=n.sqr(e),s=n.sqr(r);return{first:n.add(n.mulByNonresidue(s),o),second:n.sub(n.sub(n.sqr(n.add(e,r)),o),s)}}mulByNonresidue({c0:e,c1:r}){return this.mul({c0:e,c1:r},this.NONRESIDUE)}frobeniusMap({c0:e,c1:r},n){return{c0:e,c1:this.Fp.mul(r,this.FROBENIUS_COEFFICIENTS[n%2])}}},bs=class{constructor(e){this.MASK=vt,this.Fp2=e,this.ORDER=e.ORDER,this.BITS=3*e.BITS,this.BYTES=3*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO,c2:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO,c2:e.ZERO};let{Fp:r}=e,n=xs(e,e.NONRESIDUE,r.ORDER,6,2,3);this.FROBENIUS_COEFFICIENTS_1=n[0],this.FROBENIUS_COEFFICIENTS_2=n[1],Object.seal(this)}add({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:c}=this;return{c0:c.add(e,o),c1:c.add(r,s),c2:c.add(n,i)}}sub({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:c}=this;return{c0:c.sub(e,o),c1:c.sub(r,s),c2:c.sub(n,i)}}mul({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;if(typeof o=="bigint")return{c0:s.mul(e,o),c1:s.mul(r,o),c2:s.mul(n,o)};let{c0:i,c1:c,c2:a}=o,u=s.mul(e,i),h=s.mul(r,c),d=s.mul(n,a);return{c0:s.add(u,s.mulByNonresidue(s.sub(s.mul(s.add(r,n),s.add(c,a)),s.add(h,d)))),c1:s.add(s.sub(s.mul(s.add(e,r),s.add(i,c)),s.add(u,h)),s.mulByNonresidue(d)),c2:s.sub(s.add(h,s.mul(s.add(e,n),s.add(i,a))),s.add(u,d))}}sqr({c0:e,c1:r,c2:n}){let{Fp2:o}=this,s=o.sqr(e),i=o.mul(o.mul(e,r),Ae),c=o.mul(o.mul(r,n),Ae),a=o.sqr(n);return{c0:o.add(o.mulByNonresidue(c),s),c1:o.add(o.mulByNonresidue(a),i),c2:o.sub(o.sub(o.add(o.add(i,o.sqr(o.add(o.sub(e,r),n))),c),s),a)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}create(e){return e}isValid({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return o.isValid(e)&&o.isValid(r)&&o.isValid(n)}is0({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return o.is0(e)&&o.is0(r)&&o.is0(n)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return{c0:o.neg(e),c1:o.neg(r),c2:o.neg(n)}}eql({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:c}=this;return c.eql(e,o)&&c.eql(r,s)&&c.eql(n,i)}sqrt(e){return Rr()}div(e,r){let{Fp2:n}=this,{Fp:o}=n;return this.mul(e,typeof r=="bigint"?o.inv(o.create(r)):this.inv(r))}pow(e,r){return hn(this,e,r)}invertBatch(e){return Le(this,e)}inv({c0:e,c1:r,c2:n}){let{Fp2:o}=this,s=o.sub(o.sqr(e),o.mulByNonresidue(o.mul(n,r))),i=o.sub(o.mulByNonresidue(o.sqr(n)),o.mul(e,r)),c=o.sub(o.sqr(r),o.mul(e,n)),a=o.inv(o.add(o.mulByNonresidue(o.add(o.mul(n,i),o.mul(r,c))),o.mul(e,s)));return{c0:o.mul(a,s),c1:o.mul(a,i),c2:o.mul(a,c)}}fromBytes(e){let{Fp2:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);let n=r.BYTES;return{c0:r.fromBytes(e.subarray(0,n)),c1:r.fromBytes(e.subarray(n,n*2)),c2:r.fromBytes(e.subarray(2*n))}}toBytes({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return F(o.toBytes(e),o.toBytes(r),o.toBytes(n))}cmov({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i},c){let{Fp2:a}=this;return{c0:a.cmov(e,o,c),c1:a.cmov(r,s,c),c2:a.cmov(n,i,c)}}fromBigSix(e){let{Fp2:r}=this;if(!Array.isArray(e)||e.length!==6)throw new Error("invalid Fp6 usage");return{c0:r.fromBigTuple(e.slice(0,2)),c1:r.fromBigTuple(e.slice(2,4)),c2:r.fromBigTuple(e.slice(4,6))}}frobeniusMap({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.frobeniusMap(e,o),c1:s.mul(s.frobeniusMap(r,o),this.FROBENIUS_COEFFICIENTS_1[o%6]),c2:s.mul(s.frobeniusMap(n,o),this.FROBENIUS_COEFFICIENTS_2[o%6])}}mulByFp2({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.mul(e,o),c1:s.mul(r,o),c2:s.mul(n,o)}}mulByNonresidue({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return{c0:o.mulByNonresidue(n),c1:e,c2:r}}mul1({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.mulByNonresidue(s.mul(n,o)),c1:s.mul(e,o),c2:s.mul(r,o)}}mul01({c0:e,c1:r,c2:n},o,s){let{Fp2:i}=this,c=i.mul(e,o),a=i.mul(r,s);return{c0:i.add(i.mulByNonresidue(i.sub(i.mul(i.add(r,n),s),a)),c),c1:i.sub(i.sub(i.mul(i.add(o,s),i.add(e,r)),c),a),c2:i.add(i.sub(i.mul(i.add(e,n),o),c),a)}}},gs=class{constructor(e,r){this.MASK=vt;let{Fp2:n}=e,{Fp:o}=n;this.Fp6=e,this.ORDER=n.ORDER,this.BITS=2*e.BITS,this.BYTES=2*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.FROBENIUS_COEFFICIENTS=xs(n,n.NONRESIDUE,o.ORDER,12,1,6)[0],this.X_LEN=r.X_LEN,this.finalExponentiate=r.Fp12finalExponentiate}create(e){return e}isValid({c0:e,c1:r}){let{Fp6:n}=this;return n.isValid(e)&&n.isValid(r)}is0({c0:e,c1:r}){let{Fp6:n}=this;return n.is0(e)&&n.is0(r)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:r}){let{Fp6:n}=this;return{c0:n.neg(e),c1:n.neg(r)}}eql({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return s.eql(e,n)&&s.eql(r,o)}sqrt(e){Rr()}inv({c0:e,c1:r}){let{Fp6:n}=this,o=n.inv(n.sub(n.sqr(e),n.mulByNonresidue(n.sqr(r))));return{c0:n.mul(e,o),c1:n.neg(n.mul(r,o))}}div(e,r){let{Fp6:n}=this,{Fp2:o}=n,{Fp:s}=o;return this.mul(e,typeof r=="bigint"?s.inv(s.create(r)):this.inv(r))}pow(e,r){return hn(this,e,r)}invertBatch(e){return Le(this,e)}add({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return{c0:s.add(e,n),c1:s.add(r,o)}}sub({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return{c0:s.sub(e,n),c1:s.sub(r,o)}}mul({c0:e,c1:r},n){let{Fp6:o}=this;if(typeof n=="bigint")return{c0:o.mul(e,n),c1:o.mul(r,n)};let{c0:s,c1:i}=n,c=o.mul(e,s),a=o.mul(r,i);return{c0:o.add(c,o.mulByNonresidue(a)),c1:o.sub(o.mul(o.add(e,r),o.add(s,i)),o.add(c,a))}}sqr({c0:e,c1:r}){let{Fp6:n}=this,o=n.mul(e,r);return{c0:n.sub(n.sub(n.mul(n.add(n.mulByNonresidue(r),e),n.add(e,r)),o),n.mulByNonresidue(o)),c1:n.add(o,o)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}fromBytes(e){let{Fp6:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);return{c0:r.fromBytes(e.subarray(0,r.BYTES)),c1:r.fromBytes(e.subarray(r.BYTES))}}toBytes({c0:e,c1:r}){let{Fp6:n}=this;return F(n.toBytes(e),n.toBytes(r))}cmov({c0:e,c1:r},{c0:n,c1:o},s){let{Fp6:i}=this;return{c0:i.cmov(e,n,s),c1:i.cmov(r,o,s)}}fromBigTwelve(e){let{Fp6:r}=this;return{c0:r.fromBigSix(e.slice(0,6)),c1:r.fromBigSix(e.slice(6,12))}}frobeniusMap(e,r){let{Fp6:n}=this,{Fp2:o}=n,{c0:s,c1:i,c2:c}=n.frobeniusMap(e.c1,r),a=this.FROBENIUS_COEFFICIENTS[r%12];return{c0:n.frobeniusMap(e.c0,r),c1:n.create({c0:o.mul(s,a),c1:o.mul(i,a),c2:o.mul(c,a)})}}mulByFp2({c0:e,c1:r},n){let{Fp6:o}=this;return{c0:o.mulByFp2(e,n),c1:o.mulByFp2(r,n)}}conjugate({c0:e,c1:r}){return{c0:e,c1:this.Fp6.neg(r)}}mul014({c0:e,c1:r},n,o,s){let{Fp6:i}=this,{Fp2:c}=i,a=i.mul01(e,n,o),u=i.mul1(r,s);return{c0:i.add(i.mulByNonresidue(u),a),c1:i.sub(i.sub(i.mul01(i.add(r,e),n,c.add(o,s)),a),u)}}mul034({c0:e,c1:r},n,o,s){let{Fp6:i}=this,{Fp2:c}=i,a=i.create({c0:c.mul(e.c0,n),c1:c.mul(e.c1,n),c2:c.mul(e.c2,n)}),u=i.mul01(r,o,s),h=i.mul01(i.add(e,r),c.add(n,o),s);return{c0:i.add(i.mulByNonresidue(u),a),c1:i.sub(h,i.add(a,u))}}_cyclotomicSquare({c0:e,c1:r}){let{Fp6:n}=this,{Fp2:o}=n,{c0:s,c1:i,c2:c}=e,{c0:a,c1:u,c2:h}=r,{first:d,second:f}=o.Fp4Square(s,u),{first:l,second:p}=o.Fp4Square(a,c),{first:b,second:g}=o.Fp4Square(i,h),m=o.mulByNonresidue(g);return{c0:n.create({c0:o.add(o.mul(o.sub(d,s),Ae),d),c1:o.add(o.mul(o.sub(l,i),Ae),l),c2:o.add(o.mul(o.sub(b,c),Ae),b)}),c1:n.create({c0:o.add(o.mul(o.add(m,a),Ae),m),c1:o.add(o.mul(o.add(f,u),Ae),f),c2:o.add(o.mul(o.add(p,h),Ae),p)})}}_cyclotomicExp(e,r){let n=this.ONE;for(let o=this.X_LEN-1;o>=0;o--)n=this._cyclotomicSquare(n),ic(r,o)&&(n=this.mul(n,e));return n}};function Nc(t){let e=Te(t.ORDER),r=new ys(e,t),n=new bs(r),o=new gs(n,t);return{Fp:e,Fp2:r,Fp6:n,Fp12:o}}var we=BigInt(0),mo=BigInt(1),De=BigInt(2),yo=BigInt(3),bn=BigInt(4),Vt=BigInt("0xd201000000010000"),Ef=wt(Vt),dr={p:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),n:BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001"),h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),a:we,b:bn,Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1")},_f=Te(dr.n,{modFromBytes:!0,isLE:!0}),{Fp:P,Fp2:j,Fp6:Bf,Fp12:Y}=Nc({ORDER:dr.p,X_LEN:Ef,FP2_NONRESIDUE:[mo,mo],Fp2mulByB:({c0:t,c1:e})=>{let r=P.mul(t,bn),n=P.mul(e,bn);return{c0:P.sub(r,n),c1:P.add(r,n)}},Fp12finalExponentiate:t=>{let e=Vt,r=Y.div(Y.frobeniusMap(t,6),t),n=Y.mul(Y.frobeniusMap(r,2),r),o=Y.conjugate(Y._cyclotomicExp(n,e)),s=Y.mul(Y.conjugate(Y._cyclotomicSquare(n)),o),i=Y.conjugate(Y._cyclotomicExp(s,e)),c=Y.conjugate(Y._cyclotomicExp(i,e)),a=Y.mul(Y.conjugate(Y._cyclotomicExp(c,e)),Y._cyclotomicSquare(o)),u=Y.conjugate(Y._cyclotomicExp(a,e)),h=Y.frobeniusMap(Y.mul(o,c),2),d=Y.frobeniusMap(Y.mul(i,n),3),f=Y.frobeniusMap(Y.mul(a,Y.conjugate(n)),1),l=Y.mul(Y.mul(u,Y.conjugate(s)),n);return Y.mul(Y.mul(Y.mul(h,d),f),l)}}),{G2psi:Uc,G2psi2:vf}=Rc(P,j,j.div(j.ONE,j.NONRESIDUE)),ws=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:P.ORDER,m:2,k:128,expand:"xmd",hash:xe}),Bs={p:j.ORDER,n:dr.n,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),a:j.ZERO,b:j.fromBigTuple([bn,bn]),Gx:j.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:j.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")])},bo=gn(P.toBytes(we),{infinity:!0,compressed:!0});function go(t){t=t.slice();let e=t[0]&224,r=!!(e>>7&1),n=!!(e>>6&1),o=!!(e>>5&1);return t[0]&=31,{compressed:r,infinity:n,sort:o,value:t}}function gn(t,e){if(t[0]&224)throw new Error("setMask: non-empty mask");return e.compressed&&(t[0]|=128),e.infinity&&(t[0]|=64),e.sort&&(t[0]|=32),t}function If(t,e,r){let{BYTES:n,ORDER:o}=P,s=e.is0(),{x:i,y:c}=e.toAffine();if(r){if(s)return bo.slice();let a=!!(c*De/o);return gn(de(i,n),{compressed:!0,sort:a})}else return s?F(Uint8Array.of(64),new Uint8Array(2*n-1)):F(de(i,n),de(c,n))}function Es(t){t.assertValidity();let{BYTES:e,ORDER:r}=P,{x:n,y:o}=t.toAffine();if(t.is0())return bo.slice();let s=!!(o*De/r);return gn(de(n,e),{compressed:!0,sort:s})}function Tf(t){let{compressed:e,infinity:r,sort:n,value:o}=go(t),{BYTES:s,ORDER:i}=P;if(o.length===48&&e){let c=Ce(o),a=P.create(c&Je(P.BITS));if(r){if(a!==we)throw new Error("invalid G1 point: non-empty, at infinity, with compression");return{x:we,y:we}}let u=P.add(P.pow(a,yo),P.create(dr.b)),h=P.sqrt(u);if(!h)throw new Error("invalid G1 point: compressed point");return h*De/i!==BigInt(n)&&(h=P.neg(h)),{x:P.create(a),y:P.create(h)}}else if(o.length===96&&!e){let c=Ce(o.subarray(0,s)),a=Ce(o.subarray(s));if(r){if(c!==we||a!==we)throw new Error("G1: non-empty point at infinity");return xn.G1.Point.ZERO.toAffine()}return{x:P.create(c),y:P.create(a)}}else throw new Error("invalid G1 point: expected 48/96 bytes")}function qc(t){let{infinity:e,sort:r,value:n}=go(re("signatureHex",t,48)),o=P.ORDER,s=xn.G1.Point,i=Ce(n);if(e)return s.ZERO;let c=P.create(i&Je(P.BITS)),a=P.add(P.pow(c,yo),P.create(dr.b)),u=P.sqrt(a);if(!u)throw new Error("invalid G1 point: compressed");let h=BigInt(r);u*De/o!==h&&(u=P.neg(u));let d=s.fromAffine({x:c,y:u});return d.assertValidity(),d}function Sf(t,e,r){let{BYTES:n,ORDER:o}=P,s=e.is0(),{x:i,y:c}=e.toAffine();if(r){if(s)return F(bo,de(we,n));let a=!!(c.c1===we?c.c0*De/o:c.c1*De/o);return F(gn(de(i.c1,n),{compressed:!0,sort:a}),de(i.c0,n))}else{if(s)return F(Uint8Array.of(64),new Uint8Array(4*n-1));let{re:a,im:u}=j.reim(i),{re:h,im:d}=j.reim(c);return F(de(u,n),de(a,n),de(d,n),de(h,n))}}function _s(t){t.assertValidity();let{BYTES:e}=P;if(t.is0())return F(bo,de(we,e));let{x:r,y:n}=t.toAffine(),{re:o,im:s}=j.reim(r),{re:i,im:c}=j.reim(n),u=!!((c>we?c*De:i*De)/P.ORDER&mo),h=o;return F(gn(de(s,e),{sort:u,compressed:!0}),de(h,e))}function Af(t){let{BYTES:e,ORDER:r}=P,{compressed:n,infinity:o,sort:s,value:i}=go(t);if(!n&&!o&&s||!n&&o&&s||s&&o&&n)throw new Error("invalid encoding flag: "+(t[0]&224));let c=(a,u,h)=>Ce(a.slice(u,h));if(i.length===96&&n){if(o){if(i.reduce((p,b)=>p!==0?b+1:b,0)>0)throw new Error("invalid G2 point: compressed");return{x:j.ZERO,y:j.ZERO}}let a=c(i,0,e),u=c(i,e,2*e),h=j.create({c0:P.create(u),c1:P.create(a)}),d=j.add(j.pow(h,yo),Bs.b),f=j.sqrt(d),l=f.c1===we?f.c0*De/r:f.c1*De/r?mo:we;return f=s&&l>0?f:j.neg(f),{x:h,y:f}}else if(i.length===192&&!n){if(o){if(i.reduce((f,l)=>f!==0?l+1:l,0)>0)throw new Error("invalid G2 point: uncompressed");return{x:j.ZERO,y:j.ZERO}}let a=c(i,0*e,1*e),u=c(i,1*e,2*e),h=c(i,2*e,3*e),d=c(i,3*e,4*e);return{x:j.fromBigTuple([u,a]),y:j.fromBigTuple([d,h])}}else throw new Error("invalid G2 point: expected 96/192 bytes")}function Pc(t){let{ORDER:e}=P,{infinity:r,sort:n,value:o}=go(re("signatureHex",t)),s=xn.G2.Point,i=o.length/2;if(i!==48&&i!==96)throw new Error("invalid compressed signature length, expected 96/192 bytes");let c=Ce(o.slice(0,i)),a=Ce(o.slice(i));if(r)return s.ZERO;let u=P.create(c&Je(P.BITS)),h=P.create(a),d=j.create({c0:h,c1:u}),f=j.add(j.pow(d,yo),Bs.b),l=j.sqrt(f);if(!l)throw new Error("Failed to find a square root");let{re:p,im:b}=j.reim(l),g=BigInt(n),m=b>we&&b*De/e!==g,w=b===we&&p*De/e!==g;(m||w)&&(l=j.neg(l));let y=s.fromAffine({x:d,y:l});return y.assertValidity(),y}var xn=Sc({fields:{Fp:P,Fp2:j,Fp6:Bf,Fp12:Y,Fr:_f},G1:{...dr,Fp:P,htfDefaults:{...ws,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(t,e)=>{let r=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),n=new t(P.mul(e.X,r),e.Y,e.Z);return e.multiplyUnsafe(Vt).negate().multiplyUnsafe(Vt).equals(n)},clearCofactor:(t,e)=>e.multiplyUnsafe(Vt).add(e),mapToCurve:Uf,fromBytes:Tf,toBytes:If,ShortSignature:{fromBytes(t){return ne(t),qc(t)},fromHex(t){return qc(t)},toBytes(t){return Es(t)},toRawBytes(t){return Es(t)},toHex(t){return K(Es(t))}}},G2:{...Bs,Fp:j,hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...ws},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:qf,isTorsionFree:(t,e)=>e.multiplyUnsafe(Vt).negate().equals(Uc(t,e)),clearCofactor:(t,e)=>{let r=Vt,n=e.multiplyUnsafe(r).negate(),o=Uc(t,e),s=e.double();return s=vf(t,s),s=s.subtract(o),o=n.add(o),o=o.multiplyUnsafe(r).negate(),s=s.add(o),s=s.subtract(n),s.subtract(e)},fromBytes:Af,toBytes:Sf,Signature:{fromBytes(t){return ne(t),Pc(t)},fromHex(t){return Pc(t)},toBytes(t){return _s(t)},toRawBytes(t){return _s(t)},toHex(t){return K(_s(t))}}},params:{ateLoopSize:Vt,r:dr.n,xNegative:!0,twistType:"multiplicative"},htfDefaults:ws,hash:xe}),Of=us(j,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(t=>t.map(e=>j.fromBigTuple(e.map(BigInt))))),Cf=us(P,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(e=>BigInt(e)))),Rf=hs(P,{A:P.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:P.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:P.create(BigInt(11))}),Nf=hs(j,{A:j.create({c0:P.create(we),c1:P.create(BigInt(240))}),B:j.create({c0:P.create(BigInt(1012)),c1:P.create(BigInt(1012))}),Z:j.create({c0:P.create(BigInt(-2)),c1:P.create(BigInt(-1))})});function Uf(t){let{x:e,y:r}=Rf(P.create(t[0]));return Cf(e,r)}function qf(t){let{x:e,y:r}=Nf(j.fromBigTuple(t));return Of(e,r)}function Lc(t,e,r){let n=typeof t=="string"?t:K(t),o=typeof e=="string"?e:K(e),s=typeof r=="string"?r:K(r);return xn.verifyShortSignature(o,s,n)}var vs=t=>se(new Ye(t)),Mr=t=>{let e=vs(t);return new Date(Number(e)/1e6)};var ge;(function(t){t[t.Empty=0]="Empty",t[t.Fork=1]="Fork",t[t.Labeled=2]="Labeled",t[t.Leaf=3]="Leaf",t[t.Pruned=4]="Pruned"})(ge||(ge={}));function Lf(t,e){for(let r=0;r<t.length;r++)if(t[r]>e[r])return!0;return!1}var jt=class t{#e=!1;static async create(e){let r=t.createUnverified(e);return await r.verify(),r}static createUnverified(e){return new t(e.certificate,e.rootKey,e.canisterId,e.blsVerify??Lc,e.maxAgeInMinutes,e.disableTimeVerification)}constructor(e,r,n,o,s=5,i=!1){this._rootKey=r,this._canisterId=n,this._blsVerify=o,this._maxAgeInMinutes=s,this.#e=i,this.cert=qe(e)}lookup_path(e){return hr(e,this.cert.tree)}lookup_subtree(e){return Eo(e,this.cert.tree)}async verify(){let e=await xo(this.cert.tree),r=await this._checkDelegationAndGetKey(this.cert.delegation),n=this.cert.signature,o=Df(r),s=F(En("ic-state-root"),e),i=!1,c=Ee(this.lookup_path(["time"]));if(!c)throw Q.fromCode(new zt("Certificate does not contain a time"));if(!this.#e){let u=this._maxAgeInMinutes*60*1e3,h=Date.now(),d=h-u,f=h+3e5,l=Mr(c);if(l.getTime()<d)throw Be.fromCode(new Hr(this._maxAgeInMinutes,l,new Date(h),"past"));if(l.getTime()>f)throw Be.fromCode(new Hr(5,l,new Date(h),"future"))}try{i=await this._blsVerify(new Uint8Array(o),new Uint8Array(n),new Uint8Array(s))}catch{i=!1}if(!i)throw Be.fromCode(new zt("Signature verification failed"))}async _checkDelegationAndGetKey(e){if(!e)return this._rootKey;let r=t.createUnverified({certificate:e.certificate,rootKey:this._rootKey,canisterId:this._canisterId,blsVerify:this._blsVerify,disableTimeVerification:!0});if(r.cert.delegation)throw Q.fromCode(new Rn);if(await r.verify(),this._canisterId.toString()!==Dc&&!Is({canisterId:this._canisterId,subnetId:H.fromUint8Array(new Uint8Array(e.subnet_id)),tree:r.cert.tree}))throw Be.fromCode(new gr(this._canisterId,e.subnet_id));let n=Ee(r.lookup_path(["subnet",e.subnet_id,"public_key"]));if(!n)throw Be.fromCode(new Nn(`Could not find subnet key for subnet 0x${K(e.subnet_id)}`));return n}},wn=He("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100"),Mf=96;function Df(t){let e=wn.byteLength+Mf;if(t.byteLength!==e)throw Q.fromCode(new wr(e,t.byteLength));let r=t.slice(0,wn.byteLength);if(!or(r,wn))throw Q.fromCode(new Un(wn,r));return t.slice(wn.byteLength)}function Ee(t){if(t.status===Re.Found&&t.value instanceof Uint8Array)return t.value}async function xo(t){switch(t[0]){case ge.Empty:return xe(En("ic-hashtree-empty"));case ge.Pruned:return t[1];case ge.Leaf:return xe(F(En("ic-hashtree-leaf"),t[1]));case ge.Labeled:return xe(F(En("ic-hashtree-labeled"),t[1],await xo(t[2])));case ge.Fork:return xe(F(En("ic-hashtree-fork"),await xo(t[1]),await xo(t[2])));default:throw Pt}}function En(t){let e=new Uint8Array([t.length]),r=new TextEncoder().encode(t);return F(e,r)}function Mc(t){return typeof t[0]=="string"?z(t[0]):t[0]}var Re;(function(t){t.Unknown="Unknown",t.Absent="Absent",t.Found="Found",t.Error="Error"})(Re||(Re={}));var lr;(function(t){t.Absent="Absent",t.Unknown="Unknown",t.Found="Found"})(lr||(lr={}));var te;(function(t){t.Absent="Absent",t.Unknown="Unknown",t.Found="Found",t.Less="Less",t.Greater="Greater"})(te||(te={}));function hr(t,e){if(t.length===0)switch(e[0]){case ge.Empty:return{status:Re.Absent};case ge.Leaf:{if(!e[1])throw le.fromCode(new qt("Invalid tree structure for leaf"));if(e[1]instanceof Uint8Array)return{status:Re.Found,value:e[1].slice(e[1].byteOffset,e[1].byteLength+e[1].byteOffset)};throw Pt}case ge.Pruned:return{status:Re.Unknown};case ge.Labeled:case ge.Fork:return{status:Re.Error};default:throw Pt}let r=Mc(t),n=_n(r,e);switch(n.status){case te.Found:return hr(t.slice(1),n.value);case te.Absent:case te.Greater:case te.Less:return{status:Re.Absent};case te.Unknown:return{status:Re.Unknown};default:throw Pt}}function Eo(t,e){if(t.length===0)return{status:lr.Found,value:e};let r=Mc(t),n=_n(r,e);switch(n.status){case te.Found:return Eo(t.slice(1),n.value);case te.Unknown:return{status:lr.Unknown};case te.Absent:case te.Greater:case te.Less:return{status:lr.Absent};default:throw Pt}}function wo(t){switch(t[0]){case ge.Empty:return[];case ge.Fork:return wo(t[1]).concat(wo(t[2]));default:return[t]}}function _n(t,e){switch(e[0]){case ge.Labeled:return Lf(t,e[1])?{status:te.Greater}:or(t,e[1])?{status:te.Found,value:e[2]}:{status:te.Less};case ge.Fork:{let r=_n(t,e[1]);switch(r.status){case te.Greater:{let n=_n(t,e[2]);return n.status===te.Less?{status:te.Absent}:n}case te.Unknown:{let n=_n(t,e[2]);return n.status===te.Less?{status:te.Unknown}:n}default:return r}}case ge.Pruned:return{status:te.Unknown};default:return{status:te.Absent}}}function Is(t){let{canisterId:e,subnetId:r,tree:n}=t,o=hr(["subnet",r.toUint8Array(),"canister_ranges"],n);if(o.status!==Re.Found)throw Q.fromCode(new ht(`Could not find canister ranges for subnet ${r.toText()}`,o.status));if(!(o.value instanceof Uint8Array))throw Q.fromCode(new xr(`Could not find canister ranges for subnet ${r.toText()}`));return qe(o.value).map(a=>[H.fromUint8Array(a[0]),H.fromUint8Array(a[1])]).some(a=>a[0].ltEq(e)&&a[1].gtEq(e))}var Ts=async t=>{let{agent:e,paths:r}=t,n=H.from(t.canisterId),o=[...new Set(r)],s=new Map,i=o.map((c,a)=>{let u=Ff(c,n);return(async()=>{try{let h=await e.readState(n,{paths:[u]});if(e.rootKey==null)throw ae.fromCode(new Ze);let d=await jt.create({certificate:h.certificate,rootKey:e.rootKey,canisterId:n,disableTimeVerification:!0}),f=(b,g)=>{if(g==="subnet"){if(e.rootKey==null)throw ae.fromCode(new Ze);let m=kf(h.certificate,n,e.rootKey);return{path:g,data:m}}else return{path:g,data:Ee(b.lookup_path(u))}},{path:l,data:p}=f(d,o[a]);if(!p)console.warn(`Expected to find result for path ${l}, but instead found nothing.`),typeof l=="string"?s.set(l,null):s.set(l.key,null);else switch(l){case"time":{s.set(l,Mr(p));break}case"controllers":{s.set(l,$f(p));break}case"module_hash":{s.set(l,K(p));break}case"subnet":{s.set(l,p);break}case"candid":{s.set(l,new TextDecoder().decode(p));break}default:if(typeof l!="string"&&"key"in l&&"path"in l)switch(l.decodeStrategy){case"raw":s.set(l.key,p);break;case"leb128":{s.set(l.key,vs(p));break}case"cbor":{s.set(l.key,qe(p));break}case"hex":{s.set(l.key,K(p));break}case"utf-8":s.set(l.key,new TextDecoder().decode(p))}}}catch(h){if(h instanceof Ke&&h.hasCode(zt))throw h;typeof c!="string"&&"key"in c&&"path"in c?s.set(c.key,null):s.set(c,null),console.group(),console.warn(`Expected to find result for path ${c}, but instead found nothing.`),console.warn(h),console.groupEnd()}})()});return await Promise.all(i),s},kf=(t,e,r)=>{if(!e._isPrincipal)throw G.fromCode(new Ne("Invalid canisterId"));let n=qe(t),o=n.tree,s=n.delegation,i;if(s&&s.subnet_id?i=H.fromUint8Array(new Uint8Array(s.subnet_id)):!s&&typeof r<"u"?(i=H.selfAuthenticating(new Uint8Array(r)),s={subnet_id:i.toUint8Array(),certificate:new Uint8Array(0)}):(i=H.selfAuthenticating(H.fromText("tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe").toUint8Array()),s={subnet_id:i.toUint8Array(),certificate:new Uint8Array(0)}),!Is({canisterId:e,subnetId:i,tree:o}))throw Be.fromCode(new gr(e,s.subnet_id));let a=Eo(["subnet",s.subnet_id,"node"],o);if(a.status!==lr.Found)throw Q.fromCode(new ht("Node not found",a.status));if(a.value instanceof Uint8Array)throw le.fromCode(new qt("Invalid node tree"));let u=wo(a.value),h=new Map;return u.forEach(d=>{let f=H.from(d[1]).toText(),l=hr(["public_key"],d[2]);if(l.status!==Re.Found)throw Q.fromCode(new ht("Public key not found",l.status));let p=l.value;if(p.byteLength!==44)throw Q.fromCode(new wr(44,p.byteLength));h.set(f,p)}),{subnetId:H.fromUint8Array(new Uint8Array(s.subnet_id)).toText(),nodeKeys:h}},Ff=(t,e)=>{let r=e.toUint8Array();switch(t){case"time":return[z("time")];case"controllers":return[z("canister"),r,z("controllers")];case"module_hash":return[z("canister"),r,z("module_hash")];case"subnet":return[z("subnet")];case"candid":return[z("canister"),r,z("metadata"),z("candid:service")];default:if("key"in t&&"path"in t)if(typeof t.path=="string"||t.path instanceof Uint8Array){let n=t.path,o=typeof n=="string"?z(n):n;return[z("canister"),r,z("metadata"),o]}else return t.path}throw le.fromCode(new Ne(`Error while encoding your path for canister status. Please ensure that your path ${t} was formatted correctly.`))},$f=t=>qe(t).map(r=>H.fromUint8Array(r));var Ht=BigInt(0),pe=BigInt(1),Ss=BigInt(2),Vf=BigInt(8);function jf(t,e,r,n){let o=t.sqr(r),s=t.sqr(n),i=t.add(t.mul(e.a,o),s),c=t.add(t.ONE,t.mul(e.d,t.mul(o,s)));return t.eql(i,c)}function Hf(t,e={}){let r=ho("edwards",t,e,e.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;Et(e,{},{uvRatio:"function"});let c=Ss<<BigInt(o.BYTES*8)-pe,a=g=>n.create(g),u=e.uvRatio||((g,m)=>{try{return{isValid:!0,value:n.sqrt(n.div(g,m))}}catch{return{isValid:!1,value:Ht}}});if(!jf(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function h(g,m,w=!1){let y=w?pe:Ht;return fo("coordinate "+g,m,y,c),m}function d(g){if(!(g instanceof p))throw new Error("ExtendedPoint expected")}let f=Ft((g,m)=>{let{X:w,Y:y,Z:_}=g,v=g.is0();m==null&&(m=v?Vf:n.inv(_));let I=a(w*m),T=a(y*m),A=n.mul(_,m);if(v)return{x:Ht,y:pe};if(A!==pe)throw new Error("invZ was invalid");return{x:I,y:T}}),l=Ft(g=>{let{a:m,d:w}=s;if(g.is0())throw new Error("bad point: ZERO");let{X:y,Y:_,Z:v,T:I}=g,T=a(y*y),A=a(_*_),E=a(v*v),S=a(E*E),U=a(T*m),C=a(E*a(U+A)),x=a(S+a(w*a(T*A)));if(C!==x)throw new Error("bad point: equation left != right (1)");let B=a(y*_),R=a(v*I);if(B!==R)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(m,w,y,_){this.X=h("x",m),this.Y=h("y",w),this.Z=h("z",y,!0),this.T=h("t",_),Object.freeze(this)}static CURVE(){return s}static fromAffine(m){if(m instanceof p)throw new Error("extended point not allowed");let{x:w,y}=m||{};return h("x",w),h("y",y),new p(w,y,pe,a(w*y))}static fromBytes(m,w=!1){let y=n.BYTES,{a:_,d:v}=s;m=ts(kt(m,y,"point")),cr(w,"zip215");let I=ts(m),T=m[y-1];I[y-1]=T&-129;let A=xt(I),E=w?c:n.ORDER;fo("point.y",A,Ht,E);let S=a(A*A),U=a(S-pe),C=a(v*S-_),{isValid:x,value:B}=u(U,C);if(!x)throw new Error("bad point: invalid y coordinate");let R=(B&pe)===pe,L=(T&128)!==0;if(!w&&B===Ht&&L)throw new Error("bad point: x=0 and x_0=1");return L!==R&&(B=a(-B)),p.fromAffine({x:B,y:A})}static fromHex(m,w=!1){return p.fromBytes(re("point",m),w)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,w=!0){return b.createCache(this,m),w||this.multiply(Ss),this}assertValidity(){l(this)}equals(m){d(m);let{X:w,Y:y,Z:_}=this,{X:v,Y:I,Z:T}=m,A=a(w*T),E=a(v*_),S=a(y*T),U=a(I*_);return A===E&&S===U}is0(){return this.equals(p.ZERO)}negate(){return new p(a(-this.X),this.Y,this.Z,a(-this.T))}double(){let{a:m}=s,{X:w,Y:y,Z:_}=this,v=a(w*w),I=a(y*y),T=a(Ss*a(_*_)),A=a(m*v),E=w+y,S=a(a(E*E)-v-I),U=A+I,C=U-T,x=A-I,B=a(S*C),R=a(U*x),L=a(S*x),$=a(C*U);return new p(B,R,$,L)}add(m){d(m);let{a:w,d:y}=s,{X:_,Y:v,Z:I,T}=this,{X:A,Y:E,Z:S,T:U}=m,C=a(_*A),x=a(v*E),B=a(T*y*U),R=a(I*S),L=a((_+v)*(A+E)-C-x),$=R-B,O=R+B,N=a(x-w*C),q=a(L*$),M=a(O*N),D=a(L*N),ye=a($*O);return new p(q,M,ye,D)}subtract(m){return this.add(m.negate())}multiply(m){if(!o.isValidNot0(m))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:w,f:y}=b.cached(this,m,_=>Me(p,_));return Me(p,[w,y])[0]}multiplyUnsafe(m,w=p.ZERO){if(!o.isValid(m))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return m===Ht?p.ZERO:this.is0()||m===pe?this:b.unsafe(this,m,y=>Me(p,y),w)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return b.unsafe(this,s.n).is0()}toAffine(m){return f(this,m)}clearCofactor(){return i===pe?this:this.multiplyUnsafe(i)}toBytes(){let{x:m,y:w}=this.toAffine(),y=n.toBytes(w);return y[y.length-1]|=m&pe?128:0,y}toHex(){return K(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(m){return Me(p,m)}static msm(m,w){return qr(p,o,m,w)}_setWindowSize(m){this.precompute(m)}toRawBytes(){return this.toBytes()}}p.BASE=new p(s.Gx,s.Gy,pe,a(s.Gx*s.Gy)),p.ZERO=new p(Ht,pe,pe,Ht),p.Fp=n,p.Fn=o;let b=new Ur(p,o.BITS);return p.BASE.precompute(8),p}var _o=class{constructor(e){this.ep=e}static fromBytes(e){Rr()}static fromHex(e){Rr()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(e){return this.ep.toAffine(e)}toHex(){return K(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(e){return this.assertSame(e),this.init(this.ep.add(e.ep))}subtract(e){return this.assertSame(e),this.init(this.ep.subtract(e.ep))}multiply(e){return this.init(this.ep.multiply(e))}multiplyUnsafe(e){return this.init(this.ep.multiplyUnsafe(e))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(e,r){return this.init(this.ep.precompute(e,r))}toRawBytes(){return this.toBytes()}};function Kf(t,e,r={}){if(typeof e!="function")throw new Error('"hash" function param is required');Et(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=t,c=r.randomBytes||br,a=r.adjustScalarBytes||(E=>E),u=r.domain||((E,S,U)=>{if(cr(U,"phflag"),S.length||U)throw new Error("Contexts/pre-hash are not supported");return E});function h(E){return i.create(xt(E))}function d(E){let S=y.secretKey;E=re("private key",E,S);let U=re("hashed private key",e(E),2*S),C=a(U.slice(0,S)),x=U.slice(S,2*S),B=h(C);return{head:C,prefix:x,scalar:B}}function f(E){let{head:S,prefix:U,scalar:C}=d(E),x=o.multiply(C),B=x.toBytes();return{head:S,prefix:U,scalar:C,point:x,pointBytes:B}}function l(E){return f(E).pointBytes}function p(E=Uint8Array.of(),...S){let U=F(...S);return h(e(u(U,re("context",E),!!n)))}function b(E,S,U={}){E=re("message",E),n&&(E=n(E));let{prefix:C,scalar:x,pointBytes:B}=f(S),R=p(U.context,C,E),L=o.multiply(R).toBytes(),$=p(U.context,L,B,E),O=i.create(R+$*x);if(!i.isValid(O))throw new Error("sign failed: invalid s");let N=F(L,i.toBytes(O));return kt(N,y.signature,"result")}let g={zip215:!0};function m(E,S,U,C=g){let{context:x,zip215:B}=C,R=y.signature;E=re("signature",E,R),S=re("message",S),U=re("publicKey",U,y.publicKey),B!==void 0&&cr(B,"zip215"),n&&(S=n(S));let L=R/2,$=E.subarray(0,L),O=xt(E.subarray(L,R)),N,q,M;try{N=t.fromBytes(U,B),q=t.fromBytes($,B),M=o.multiplyUnsafe(O)}catch{return!1}if(!B&&N.isSmallOrder())return!1;let D=p(x,q.toBytes(),N.toBytes(),S);return q.add(N.multiplyUnsafe(D)).subtract(M).clearCofactor().is0()}let w=s.BYTES,y={secretKey:w,publicKey:w,signature:2*w,seed:w};function _(E=c(y.seed)){return kt(E,y.seed,"seed")}function v(E){let S=A.randomSecretKey(E);return{secretKey:S,publicKey:l(S)}}function I(E){return rt(E)&&E.length===i.BYTES}function T(E,S){try{return!!t.fromBytes(E,S)}catch{return!1}}let A={getExtendedPublicKey:f,randomSecretKey:_,isValidSecretKey:I,isValidPublicKey:T,toMontgomery(E){let{y:S}=t.fromBytes(E),U=y.publicKey,C=U===32;if(!C&&U!==57)throw new Error("only defined for 25519 and 448");let x=C?s.div(pe+S,pe-S):s.div(S-pe,S+pe);return s.toBytes(x)},toMontgomeryPriv(E){let S=y.secretKey;kt(E,S);let U=e(E.subarray(0,S));return a(U).subarray(0,S)},randomPrivateKey:_,precompute(E=8,S=t.BASE){return S.precompute(E,!1)}};return Object.freeze({keygen:v,getPublicKey:l,sign:b,verify:m,utils:A,Point:t,lengths:y})}function Gf(t){let e={a:t.a,d:t.d,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=Te(e.n,t.nBitLength,!0),o={Fp:r,Fn:n,uvRatio:t.uvRatio},s={randomBytes:t.randomBytes,adjustScalarBytes:t.adjustScalarBytes,domain:t.domain,prehash:t.prehash,mapToCurve:t.mapToCurve};return{CURVE:e,curveOpts:o,hash:t.hash,eddsaOpts:s}}function Zf(t,e){let r=e.Point;return Object.assign({},e,{ExtendedPoint:r,CURVE:t,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}function kc(t){let{CURVE:e,curveOpts:r,hash:n,eddsaOpts:o}=Gf(t),s=Hf(e,r),i=Kf(s,n,o);return Zf(t,i)}var Yf=BigInt(0),It=BigInt(1),Fc=BigInt(2),Ql=BigInt(3),Xf=BigInt(5),zf=BigInt(8),Dr=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Bn={p:Dr,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:zf,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Wf(t){let e=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=Dr,c=t*t%s*t%s,a=et(c,Fc,s)*c%s,u=et(a,It,s)*t%s,h=et(u,Xf,s)*u%s,d=et(h,e,s)*h%s,f=et(d,r,s)*d%s,l=et(f,n,s)*f%s,p=et(l,o,s)*l%s,b=et(p,o,s)*l%s,g=et(b,e,s)*h%s;return{pow_p_5_8:et(g,Fc,s)*t%s,b2:c}}function Qf(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}var As=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Rs(t,e){let r=Dr,n=ee(e*e*e,r),o=ee(n*n*e,r),s=Wf(t*o).pow_p_5_8,i=ee(t*n*s,r),c=ee(e*i*i,r),a=i,u=ee(i*As,r),h=c===t,d=c===ee(-t,r),f=c===ee(-t*As,r);return h&&(i=a),(d||f)&&(i=u),_t(i,r)&&(i=ee(-i,r)),{isValid:h||d,value:i}}var Kt=Te(Bn.p,{isLE:!0}),Jf=Te(Bn.n,{isLE:!0}),eu={...Bn,Fp:Kt,hash:ui,adjustScalarBytes:Qf,uvRatio:Rs},Tt=kc(eu);var Os=As,tu=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),ru=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),nu=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),ou=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),$c=t=>Rs(It,t),su=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Cs=t=>Tt.Point.Fp.create(xt(t)&su);function Vc(t){let{d:e}=Bn,r=Dr,n=m=>Kt.create(m),o=n(Os*t*t),s=n((o+It)*nu),i=BigInt(-1),c=n((i-e*o)*n(o+e)),{isValid:a,value:u}=Rs(s,c),h=n(u*t);_t(h,r)||(h=n(-h)),a||(u=h),a||(i=o);let d=n(i*(o-It)*ou-c),f=u*u,l=n((u+u)*c),p=n(d*tu),b=n(It-f),g=n(It+f);return new Tt.Point(n(l*g),n(b*p),n(p*g),n(l*b))}function iu(t){ne(t,64);let e=Cs(t.subarray(0,32)),r=Vc(e),n=Cs(t.subarray(32,64)),o=Vc(n);return new St(r.add(o))}var St=class t extends _o{constructor(e){super(e)}static fromAffine(e){return new t(Tt.Point.fromAffine(e))}assertSame(e){if(!(e instanceof t))throw new Error("RistrettoPoint expected")}init(e){return new t(e)}static hashToCurve(e){return iu(re("ristrettoHash",e,64))}static fromBytes(e){ne(e,32);let{a:r,d:n}=Bn,o=Dr,s=_=>Kt.create(_),i=Cs(e);if(!sc(Kt.toBytes(i),e)||_t(i,o))throw new Error("invalid ristretto255 encoding 1");let c=s(i*i),a=s(It+r*c),u=s(It-r*c),h=s(a*a),d=s(u*u),f=s(r*n*h-d),{isValid:l,value:p}=$c(s(f*d)),b=s(p*u),g=s(p*b*f),m=s((i+i)*b);_t(m,o)&&(m=s(-m));let w=s(a*g),y=s(m*w);if(!l||_t(y,o)||w===Yf)throw new Error("invalid ristretto255 encoding 2");return new t(new Tt.Point(m,w,It,y))}static fromHex(e){return t.fromBytes(re("ristrettoHex",e,32))}static msm(e,r){return qr(t,Tt.Point.Fn,e,r)}toBytes(){let{X:e,Y:r,Z:n,T:o}=this.ep,s=Dr,i=g=>Kt.create(g),c=i(i(n+r)*i(n-r)),a=i(e*r),u=i(a*a),{value:h}=$c(i(c*u)),d=i(h*c),f=i(h*a),l=i(d*f*o),p;if(_t(o*l,s)){let g=i(r*Os),m=i(e*Os);e=g,r=m,p=i(d*ru)}else p=f;_t(e*l,s)&&(r=i(-r));let b=i((n-r)*p);return _t(b,s)&&(b=i(-b)),Kt.toBytes(b)}equals(e){this.assertSame(e);let{X:r,Y:n}=this.ep,{X:o,Y:s}=e.ep,i=u=>Kt.create(u),c=i(r*s)===i(n*o),a=i(n*s)===i(r*o);return c||a}is0(){return this.equals(t.ZERO)}};St.BASE=new St(Tt.Point.BASE);St.ZERO=new St(Tt.Point.ZERO);St.Fp=Kt;St.Fn=Jf;var jc,Hc,Bo=class{static{jc=Symbol.iterator,Hc=Symbol.toStringTag}#e;#t;constructor(e={}){this[jc]=this.entries.bind(this),this[Hc]="ExpirableMap";let{source:r=[],expirationTime:n=600*1e3}=e,o=Date.now();this.#e=new Map([...r].map(([s,i])=>[s,{value:i,timestamp:o}])),this.#t=n}prune(){let e=Date.now();for(let[r,n]of this.#e.entries())e-n.timestamp>this.#t&&this.#e.delete(r);return this}set(e,r){this.prune();let n={value:r,timestamp:Date.now()};return this.#e.set(e,n),this}get(e){let r=this.#e.get(e);if(r!==void 0){if(Date.now()-r.timestamp>this.#t){this.#e.delete(e);return}return r.value}}clear(){this.#e.clear()}entries(){let e=this.#e.entries();return function*(){for(let[n,o]of e)yield[n,o.value]}()}values(){let e=this.#e.values();return function*(){for(let n of e)yield n.value}()}keys(){return this.#e.keys()}forEach(e,r){for(let[n,o]of this.#e.entries())e.call(r,o.value,n,this)}has(e){return this.#e.has(e)}delete(e){return this.#e.delete(e)}get size(){return this.#e.size}};var Kc=t=>{if(t<=127)return 1;if(t<=255)return 2;if(t<=65535)return 3;if(t<=16777215)return 4;throw G.fromCode(new Kr("Length too long (> 4 bytes)"))},Gc=(t,e,r)=>{if(r<=127)return t[e]=r,1;if(r<=255)return t[e]=129,t[e+1]=r,2;if(r<=65535)return t[e]=130,t[e+1]=r>>8,t[e+2]=r,3;if(r<=16777215)return t[e]=131,t[e+1]=r>>16,t[e+2]=r>>8,t[e+3]=r,4;throw G.fromCode(new Kr("Length too long (> 4 bytes)"))},Ns=(t,e)=>{if(t[e]<128)return 1;if(t[e]===128)throw G.fromCode(new Ge("Invalid length 0"));if(t[e]===129)return 2;if(t[e]===130)return 3;if(t[e]===131)return 4;throw G.fromCode(new Ge("Length too long (> 4 bytes)"))},cu=(t,e)=>{let r=Ns(t,e);if(r===1)return t[e];if(r===2)return t[e+1];if(r===3)return(t[e+1]<<8)+t[e+2];if(r===4)return(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];throw G.fromCode(new Ge("Length too long (> 4 bytes)"))},n0=Uint8Array.from([48,12,6,10,43,6,1,4,1,131,184,67,1,1]),Us=Uint8Array.from([48,5,6,3,43,101,112]),o0=Uint8Array.from([48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10]),s0=Uint8Array.from([48,29,6,13,43,6,1,4,1,130,220,124,5,3,1,2,1,6,12,43,6,1,4,1,130,220,124,5,3,2,1]);function Zc(t,e){let r=2+Kc(t.byteLength+1),n=e.byteLength+r+t.byteLength,o=0,s=new Uint8Array(1+Kc(n)+n);return s[o++]=48,o+=Gc(s,o,n),s.set(e,o),o+=e.byteLength,s[o++]=3,o+=Gc(s,o,t.byteLength+1),s[o++]=0,s.set(new Uint8Array(t),o),s}var Yc=(t,e)=>{let r=0,n=(c,a)=>{if(o[r++]!==c)throw G.fromCode(new Ge(`Expected ${a} at offset ${r}`))},o=new Uint8Array(t);if(n(48,"sequence"),r+=Ns(o,r),!or(o.slice(r,r+e.byteLength),e))throw G.fromCode(new Ge("Not the expected OID."));r+=e.byteLength,n(3,"bit string");let s=cu(o,r)-1;r+=Ns(o,r),n(0,"0 padding");let i=o.slice(r);if(s!==i.length)throw G.fromCode(new qn(s,i.length));return i};var vo=class t{static from(e){return this.fromDer(e.toDer())}static fromRaw(e){return new t(e)}static fromDer(e){return new t(this.derDecode(e))}static{this.RAW_KEY_LENGTH=32}static derEncode(e){return Zc(e,Us)}static derDecode(e){let r=Yc(e,Us);if(r.length!==this.RAW_KEY_LENGTH)throw G.fromCode(new Ge("An Ed25519 public key must be exactly 32 bytes long"));return r}#e;get rawKey(){return this.#e}#t;get derKey(){return this.#t}constructor(e){if(e.byteLength!==t.RAW_KEY_LENGTH)throw G.fromCode(new Ge("An Ed25519 public key must be exactly 32 bytes long"));this.#e=e,this.#t=t.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}};var qs=class{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}unsubscribe(e){this.observers=this.observers.filter(r=>r!==e)}notify(e,...r){this.observers.forEach(n=>n(e,...r))}},Io=class extends qs{constructor(){super()}print(e,...r){this.notify({message:e,level:"info"},...r)}warn(e,...r){this.notify({message:e,level:"warn"},...r)}error(e,r,...n){this.notify({message:e,level:"error",error:r},...n)}};var To=class t{#e;#t;#n;#i;#u;#r;#o;#c;#a=0;static{this.default={initialInterval:500,randomizationFactor:.5,multiplier:1.5,maxInterval:6e4,maxElapsedTime:9e5,maxIterations:10,date:Date}}constructor(e=t.default){let{initialInterval:r=500,randomizationFactor:n=.5,multiplier:o=1.5,maxInterval:s=6e4,maxElapsedTime:i=9e5,maxIterations:c=10,date:a=Date}=e;this.#e=r,this.#t=n,this.#n=o,this.#i=s,this.#c=a,this.#u=a.now(),this.#r=i,this.#o=c}get ellapsedTimeInMsec(){return this.#c.now()-this.#u}get currentInterval(){return this.#e}get count(){return this.#a}get randomValueFromInterval(){let e=this.#t*this.#e,r=this.#e-e,n=this.#e+e;return Math.random()*(n-r)+r}incrementCurrentInterval(){return this.#e=Math.min(this.#e*this.#n,this.#i),this.#a++,this.#e}next(){return this.ellapsedTimeInMsec>=this.#r||this.#a>=this.#o?null:(this.incrementCurrentInterval(),this.randomValueFromInterval)}};var ct;(function(t){t.Received="received",t.Processing="processing",t.Replied="replied",t.Rejected="rejected",t.Unknown="unknown",t.Done="done"})(ct||(ct={}));var Xc=60*1e3,au=1e6,fu="308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d9685f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484b01291091c5f87b98883463f98091a0baaae",Dc="aaaaa-aa",uu="ic0.app",du=".ic0.app",lu="icp0.io",hu=".icp0.io",pu="icp-api.io",mu=".icp-api.io",Ps=200,yu=202,bu=404;function gu(){let t;if(typeof window<"u")if(window.fetch)t=window.fetch.bind(window);else throw ae.fromCode(new Er("Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present."));else if(typeof global<"u")if(global.fetch)t=global.fetch.bind(global);else throw ae.fromCode(new Er("Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available."));else typeof self<"u"&&self.fetch&&(t=self.fetch.bind(self));if(t)return t;throw ae.fromCode(new Er("Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context."))}function xu(t){let e;if(t!==void 0)!t.match(/^[a-z]+:/)&&typeof window<"u"?e=new URL(window.location.protocol+"//"+t):e=new URL(t);else{let r=["ic0.app","icp0.io","127.0.0.1","localhost"],n=[".github.dev",".gitpod.io"],o=typeof window<"u"?window.location:void 0,s=o?.hostname,i;s&&typeof s=="string"&&(n.some(c=>s.endsWith(c))?i=s:i=r.find(c=>s.endsWith(c))),o&&i?e=new URL(`${o.protocol}//${i}${o.port?":"+o.port:""}`):e=new URL("https://icp-api.io")}return e.toString()}var pr=class t{#e;#t;#n;#i;#u;#r;#o;#c;#a;#s;#d;#p;#f;get#_(){return this.#f*Xc}#m;#y;#l;#h;constructor(e={}){this.#e=null,this.#t=!1,this.#n=0,this.#i=null,this.#u=!1,this._isAgent=!0,this.config={},this.log=new Io,this.#m=[],this.#y=[],this.#l=new Bo({expirationTime:300*1e3}),this.#h=!0,this.#w=(o,s)=>{if(this.#h===!1)return o;if(!s)throw Be.fromCode(new Gr);let{status:i,signatures:c=[],requestId:a}=o;for(let u of c){let{timestamp:h,identity:d}=u,f=H.fromUint8Array(d).toText(),l;if(i===At.Replied){let{reply:w}=o;l=nn({status:i,reply:w,timestamp:BigInt(h),request_id:a})}else if(i===At.Rejected){let{reject_code:w,reject_message:y,error_code:_}=o;l=nn({status:i,reject_code:w,reject_message:y,error_code:_,timestamp:BigInt(h),request_id:a})}else throw le.fromCode(new Ne(`Unknown status: ${i}`));let p=F(Gi,l),b=s.nodeKeys.get(f);if(!b)throw Q.fromCode(new jn);let g=vo.fromDer(b).rawKey;if(Tt.verify(u.signature,p,g))return o;throw Be.fromCode(new Hn(f))}return o},this.config=e,this.#o=e.fetch||gu()||fetch.bind(global),this.#c=e.fetchOptions,this.#a=e.callOptions,this.#t=e.shouldFetchRootKey??!1,this.#u=e.shouldSyncTime??!1,e.rootKey?this.rootKey=e.rootKey:this.#t?this.rootKey=null:this.rootKey=He(fu);let r=xu(e.host);this.host=new URL(r),e.verifyQuerySignatures!==void 0&&(this.#h=e.verifyQuerySignatures),this.#d=e.retryTimes??3;let n=()=>new To({maxIterations:this.#d});if(this.#p=e.backoffStrategy||n,this.host.hostname.endsWith(du)?this.host.hostname=uu:this.host.hostname.endsWith(hu)?this.host.hostname=lu:this.host.hostname.endsWith(mu)&&(this.host.hostname=pu),e.credentials){let{name:o,password:s}=e.credentials;this.#s=`${o}${s?":"+s:""}`}if(this.#r=Promise.resolve(e.identity||new on),e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes>5)throw G.fromCode(new Jt("The maximum ingress expiry time is 5 minutes.",e.ingressExpiryInMinutes));if(e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes<=0)throw G.fromCode(new Jt("Ingress expiry time must be greater than 0.",e.ingressExpiryInMinutes));this.#f=e.ingressExpiryInMinutes||5,this.addTransform("update",Wo(dn)),e.useQueryNonces&&this.addTransform("query",Wo(dn)),e.logToConsole&&this.log.subscribe(o=>{o.level==="error"?console.error(o.message):o.level==="warn"?console.warn(o.message):console.log(o.message)})}static createSync(e={}){return new this({...e})}static async create(e={}){let r=t.createSync(e);return await r.#g(),r}static async from(e){try{return"config"in e?await t.create(e.config):await t.create({fetch:e._fetch,fetchOptions:e._fetchOptions,callOptions:e._callOptions,host:e._host.toString(),identity:e._identity??void 0})}catch{throw G.fromCode(new $n)}}isLocal(){let e=this.host.hostname;return e==="127.0.0.1"||e.endsWith("127.0.0.1")}addTransform(e,r,n=r.priority||0){if(e==="update"){let o=this.#y.findIndex(s=>(s.priority||0)<n);this.#y.splice(o>=0?o:this.#y.length,0,Object.assign(r,{priority:n}))}else if(e==="query"){let o=this.#m.findIndex(s=>(s.priority||0)<n);this.#m.splice(o>=0?o:this.#m.length,0,Object.assign(r,{priority:n}))}}async getPrincipal(){if(!this.#r)throw ae.fromCode(new Ut);return(await this.#r).getPrincipal()}async call(e,r,n){let o=r.callSync??!0,s=await(n??this.#r);if(!s)throw ae.fromCode(new Ut);let i=H.from(e),c=r.effectiveCanisterId?H.from(r.effectiveCanisterId):i;await this.#g(c);let a=s.getPrincipal(),u=Ls(this.#f,this.#n),h={request_type:oo.Call,canister_id:i,method_name:r.methodName,arg:r.arg,sender:a,ingress_expiry:u},d=await this._transform({request:{body:null,method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:gt.Call,body:h}),f;r?.nonce?f=l(r.nonce):d.body.nonce?f=l(d.body.nonce):f=void 0,h.nonce=f;function l(m){return Object.assign(m,{__nonce__:void 0})}d=await s.transformRequest(d);let p=no(d.body),b=this.#p(),g=to(h);try{let y=o?()=>(this.log.print(`fetching "/api/v3/canister/${c.toText()}/call" with request:`,d),this.#o(""+new URL(`/api/v3/canister/${c.toText()}/call`,this.host),{...this.#a,...d.request,body:p})):()=>(this.log.print(`fetching "/api/v2/canister/${c.toText()}/call" with request:`,d),this.#o(""+new URL(`/api/v2/canister/${c.toText()}/call`,this.host),{...this.#a,...d.request,body:p})),{responseBodyBytes:_,...v}=await this.#b({requestFn:y,backoff:b,tries:0}),I=_.byteLength>0?qe(_):null;return{requestId:g,response:{...v,body:I},requestDetails:h}}catch(m){let w;if(m instanceof Ke){if(m.hasCode(Yr))return this.log.warn("v3 api not supported. Fall back to v2"),this.call(e,{...r,callSync:!1},n);if(m.hasCode(Jt))return await this.syncTime(i),this.call(i,r,n);m.code.requestContext={requestId:g,senderPubKey:d.body.sender_pubkey,senderSignature:d.body.sender_sig,ingressExpiry:d.body.content.ingress_expiry},w=m}else w=le.fromCode(new Ne(m));throw this.log.error(`Error while making call: ${w.message}`,w),w}}async#x(e){let{ecid:r,transformedRequest:n,body:o,requestId:s,backoff:i,tries:c}=e,a=c===0?0:i.next();if(this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with tries:`,{tries:c,backoff:i,delay:a}),a===null)throw le.fromCode(new Wt(`Backoff strategy exhausted after ${c} attempts.`,s));a>0&&await new Promise(l=>setTimeout(l,a));let u;try{this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with request:`,n);let l=await this.#o(""+new URL(`/api/v2/canister/${r.toString()}/query`,this.host),{...this.#c,...n.request,body:o});if(l.status===Ps)u={...qe(Tr(await l.arrayBuffer())),httpDetails:{ok:l.ok,status:l.status,statusText:l.statusText,headers:co(l.headers)},requestId:s};else throw Q.fromCode(new Zr(l.status,l.statusText,co(l.headers),await l.text()))}catch(l){if(c<this.#d)return this.log.warn(`Caught exception while attempting to make query:
  ${l}
  Retrying query.`),await this.#x({...e,tries:c+1});throw l instanceof Ke?l:jr.fromCode(new Xr(l))}if(!this.#h)return u;let h=u.signatures?.[0]?.timestamp;if(!h)throw Q.fromCode(new Vn("Timestamp not found in query response. This suggests a malformed or malicious response."));let d=Number(BigInt(h)/BigInt(au));if(Date.now()+this.#n-d>this.#_){if(c<this.#d)return this.log.warn("Timestamp is older than the max ingress expiry. Retrying query.",{requestId:s,signatureTimestampMs:d}),await this.#x({...e,tries:c+1});throw Be.fromCode(new Mn(this.#f,s,c))}return u}async#b(e){let{requestFn:r,backoff:n,tries:o}=e,s=o===0?0:n.next();if(s===null)throw Q.fromCode(new Wt(`Retry strategy exhausted after ${o} attempts.`));s>0&&await new Promise(h=>setTimeout(h,s));let i,c=new Uint8Array;try{i=await r(),i.status===Ps&&(c=Tr(await i.clone().arrayBuffer()))}catch(h){if(o<this.#d)return this.log.warn(`Caught exception while attempting to make request:
  ${h}
  Retrying request.`),await this.#b({requestFn:r,backoff:n,tries:o+1});throw jr.fromCode(new Xr(h))}let a=co(i.headers);if(i.status===Ps||i.status===yu)return{ok:i.ok,status:i.status,statusText:i.statusText,responseBodyBytes:c,headers:a};let u=await i.text();if(i.status===bu&&i.url.includes("api/v3"))throw Q.fromCode(new Yr);if(u.startsWith("Invalid request expiry: "))throw G.fromCode(new Jt(u,this.#f));if(o<this.#d)return await this.#b({requestFn:r,backoff:n,tries:o+1});throw Q.fromCode(new Zr(i.status,i.statusText,a,u))}async query(e,r,n){let o=this.#p(),s=r.effectiveCanisterId?H.from(r.effectiveCanisterId):H.from(e);await this.#g(s),this.log.print(`ecid ${s.toString()}`),this.log.print(`canisterId ${e.toString()}`);let i,c=await(n??this.#r);if(!c)throw ae.fromCode(new Ut);let a=H.from(e),u=c.getPrincipal(),h=Ls(this.#f,this.#n),d={request_type:ir.Query,canister_id:a,method_name:r.methodName,arg:r.arg,sender:u,ingress_expiry:h},f=to(d);i=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:gt.Query,body:d}),i=await c.transformRequest(i);let l=no(i.body),p={canister:a.toText(),ecid:s,transformedRequest:i,body:l,requestId:f,backoff:o,tries:0},b=async()=>({requestDetails:d,query:await this.#x(p)}),g=async()=>{if(!this.#h)return;let m=this.#l.get(s.toString());return m||(await this.fetchSubnetKeys(s.toString()),this.#l.get(s.toString()))};try{let[m,w]=await Promise.all([b(),g()]),{requestDetails:y,query:_}=m,v={..._,requestDetails:y};if(this.log.print("Query response:",v),!this.#h)return v;try{return this.#w(v,w)}catch{this.log.warn("Query response verification failed. Retrying with fresh subnet keys."),this.#l.delete(e.toString()),await this.fetchSubnetKeys(s.toString());let I=this.#l.get(e.toString());if(!I)throw Be.fromCode(new Gr);return this.#w(v,I)}}catch(m){let w;throw m instanceof Ke?(m.code.requestContext={requestId:f,senderPubKey:i.body.sender_pubkey,senderSignature:i.body.sender_sig,ingressExpiry:i.body.content.ingress_expiry},w=m):w=le.fromCode(new Ne(m)),this.log.error(`Error while making query: ${w.message}`,w),w}}#w;async createReadStateRequest(e,r){await this.#g();let n=await(r??this.#r);if(!n)throw ae.fromCode(new Ut);let o=n.getPrincipal(),s=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:gt.ReadState,body:{request_type:ir.ReadState,paths:e.paths,sender:o,ingress_expiry:Ls(this.#f,this.#n)}});return n.transformRequest(s)}async readState(e,r,n,o){await this.#E();let s=H.from(e);function i(h){for(let d of h.paths){let[f,l]=d,p=new TextEncoder().encode("request_status");if(or(f,p))return l}}let c,a;if(o)c=o,a=to(c);else{a=i(r);let h=await this.#r;if(!h)throw ae.fromCode(new Ut);c=await this.createReadStateRequest(r,h)}this.log.print(`fetching "/api/v2/canister/${s}/read_state" with request:`,c);let u=this.#p();try{let{responseBodyBytes:h}=await this.#b({requestFn:()=>this.#o(""+new URL(`/api/v2/canister/${s.toString()}/read_state`,this.host),{...this.#c,...c.request,body:no(c.body)}),backoff:u,tries:0}),d=qe(h);return this.log.print("Read state response:",d),d}catch(h){let d;throw h instanceof Ke?(h.code.requestContext={requestId:a,senderPubKey:c.body.sender_pubkey,senderSignature:c.body.sender_sig,ingressExpiry:c.body.content.ingress_expiry},d=h):d=le.fromCode(new Ne(h)),this.log.error(`Error while making read state: ${d.message}`,d),d}}parseTimeFromResponse(e){let r;if(e.certificate){let n=qe(e.certificate);if(n&&"tree"in n)r=n.tree;else throw Q.fromCode(new qt("Could not decode time from response"));let o=hr(["time"],r);if(o.status!==Re.Found)throw Q.fromCode(new ht("Time was not found in the response or was not in its expected format.",o.status));if(!(o.value instanceof Uint8Array)&&!ArrayBuffer.isView(o))throw Q.fromCode(new xr("Time was not in its expected format."));let s=Mr(o.value);return this.log.print("Time from response:",s),this.log.print("Time from response in milliseconds:",Number(s)),Number(s)}else this.log.warn("No certificate found in response");return 0}async syncTime(e){this.#i=this.#i??(async()=>{await this.#E();let r=Date.now();try{e||this.log.print("Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai");let n=e??H.from("ryjl3-tyaaa-aaaaa-aaaba-cai"),o=t.createSync({identity:new on,host:this.host.toString(),fetch:this.#o,retryTimes:0,rootKey:this.rootKey??void 0}),i=(await Promise.all(Array(3).fill(null).map(async()=>{let a=(await Ts({canisterId:n,agent:o,paths:["time"]})).get("time");if(a instanceof Date)return a.getTime()},[]))).reduce((c,a)=>typeof a=="number"&&a>c?a:c,0);i>BigInt(0)&&(this.#n=Number(i)-Number(r),this.log.notify({message:`Syncing time: offset of ${this.#n}`,level:"info"}))}catch(n){let o=n instanceof Ke?n:le.fromCode(new Ne(n));throw this.log.error("Caught exception while attempting to sync time",o),o}})(),await this.#i.finally(()=>{this.#i=null})}async status(){let e=this.#s?{Authorization:"Basic "+btoa(this.#s)}:{};this.log.print('fetching "/api/v2/status"');let r=this.#p(),{responseBodyBytes:n}=await this.#b({backoff:r,requestFn:()=>this.#o(""+new URL("/api/v2/status",this.host),{headers:e,...this.#c}),tries:0});return qe(n)}async fetchRootKey(){return this.#e=this.#e??(async()=>{let e=await this.status();return this.rootKey=e.root_key,this.rootKey})(),await this.#e.finally(()=>{this.#e=null})}async#g(e){await Promise.all([this.#E(),this.#B(e)])}async#E(){if(!this.rootKey)if(this.rootKey===null&&this.host.toString()!=="https://icp-api.io"&&this.#t)await this.fetchRootKey();else throw ae.fromCode(new Ze(this.#t))}async#B(e){this.#u&&this.#n===0&&await this.syncTime(e)}invalidateIdentity(){this.#r=null}replaceIdentity(e){this.#r=Promise.resolve(e)}async fetchSubnetKeys(e){let r=H.from(e);await this.#g(r);let o=(await Ts({canisterId:r,paths:["subnet"],agent:this})).get("subnet");if(o&&typeof o=="object"&&"nodeKeys"in o)return this.#l.set(r.toText(),o),o}_transform(e){let r=Promise.resolve(e);if(e.endpoint===gt.Call)for(let n of this.#y)r=r.then(o=>n(o).then(s=>s||o));else for(let n of this.#m)r=r.then(o=>n(o).then(s=>s||o));return r}};function Ls(t,e){return Cr.fromDeltaInMilliseconds(t*Xc+e)}var wu=300*1e3;function Ms(){return Iu(_u(Eu(),1e3),vu(1e3,1.2),Bu(wu))}function Eu(){let t=!0;return async()=>t?(t=!1,!0):!1}function _u(t,e){return async(r,n,o)=>{if(await t(r,n,o))return new Promise(s=>setTimeout(s,e))}}function Bu(t){let e=Date.now()+t;return async(r,n,o)=>{if(Date.now()>e)throw Q.fromCode(new Wt(`Request timed out after ${t} msec`,n,o))}}function vu(t,e){let r=t;return()=>new Promise(n=>setTimeout(()=>{r*=e,n()},r))}function Iu(...t){return async(e,r,n)=>{for(let o of t)await o(e,r,n)}}var Wc={strategy:Ms(),preSignReadStateRequest:!1};function Qc(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ds(t,e){return t!==null&&typeof t=="object"&&Qc(t,e)}function Su(t,e){return Qc(t,e)&&typeof t[e]=="function"}function zc(t){return Ds(t,"body")&&Ds(t.body,"content")&&t.body.content.request_type===ir.ReadState&&Ds(t.body.content,"ingress_expiry")&&typeof t.body.content.ingress_expiry=="object"&&t.body.content.ingress_expiry!==null&&Su(t.body.content.ingress_expiry,"toHash")}async function ks(t,e,r,n={}){let o=[z("request_status"),r],s,i;if(n.preSignReadStateRequest??!1?(i=await Au({paths:[o],agent:t,pollingOptions:n}),s=await t.readState(e,{paths:[o]},void 0,i)):s=await t.readState(e,{paths:[o]}),t.rootKey==null)throw ae.fromCode(new Ze);let a=await jt.create({certificate:s.certificate,rootKey:t.rootKey,canisterId:e,blsVerify:n.blsVerify}),u=Ee(a.lookup_path([...o,z("status")])),h;switch(typeof u>"u"?h=ct.Unknown:h=new TextDecoder().decode(u),h){case ct.Replied:return{reply:Ee(a.lookup_path([...o,"reply"])),certificate:a};case ct.Received:case ct.Unknown:case ct.Processing:return await(n.strategy??Ms())(e,r,h),ks(t,e,r,{...n,request:i});case ct.Rejected:{let d=new Uint8Array(Ee(a.lookup_path([...o,"reject_code"])))[0],f=new TextDecoder().decode(Ee(a.lookup_path([...o,"reject_message"]))),l=Ee(a.lookup_path([...o,"error_code"])),p=l?new TextDecoder().decode(l):void 0;throw Nt.fromCode(new Qt(r,d,f,p))}case ct.Done:throw le.fromCode(new kn(r))}throw Pt}async function Au(t){let{paths:e,agent:r,pollingOptions:n}=t;if(n.request&&zc(n.request))return n.request;let o=await r.createReadStateRequest?.({paths:e},void 0);if(!zc(o))throw G.fromCode(new Kn(o));return o}var ke=Symbol.for("ic-agent-metadata"),So=class t{static agentOf(e){return e[ke].config.agent}static interfaceOf(e){return e[ke].service}static canisterIdOf(e){return H.from(e[ke].config.canisterId)}static createActorClass(e,r){let n=e({IDL:nr});class o extends t{constructor(i){if(!i.canisterId)throw G.fromCode(new zr(i.canisterId));let c=typeof i.canisterId=="string"?H.fromText(i.canisterId):i.canisterId;super({config:{...Jc,...i,canisterId:c},service:n});for(let[a,u]of n._fields)r?.httpDetails&&u.annotations.push(Fs),r?.certificate&&u.annotations.push(ea),this[a]=Ou(this,a,u,i.blsVerify)}}return o}static createActor(e,r){if(!r.canisterId)throw G.fromCode(new zr(r.canisterId));return new(this.createActorClass(e))(r)}static createActorWithHttpDetails(e,r){return new(this.createActorClass(e,{httpDetails:!0}))(r)}static createActorWithExtendedDetails(e,r,n={httpDetails:!0,certificate:!0}){return new(this.createActorClass(e,n))(r)}constructor(e){this[ke]=Object.freeze(e)}};function kr(t,e){let r=nr.decode(t,e);switch(r.length){case 0:return;case 1:return r[0];default:return r}}var Jc={pollingOptions:Wc},Fs="http-details",ea="certificate";function Ou(t,e,r,n){let o;r.annotations.includes("query")||r.annotations.includes("composite_query")?o=async(i,...c)=>{i={...i,...t[ke].config.queryTransform?.(e,c,{...t[ke].config,...i})};let a=i.agent||t[ke].config.agent||new pr,u=H.from(i.canisterId||t[ke].config.canisterId),h=nr.encode(r.argTypes,c),d=await a.query(u,{methodName:e,arg:h,effectiveCanisterId:i.effectiveCanisterId}),f={...d.httpDetails,requestDetails:d.requestDetails};switch(d.status){case At.Rejected:{let l=new Dn(d.requestId,d.reject_code,d.reject_message,d.error_code,d.signatures);throw l.callContext={canisterId:u,methodName:e,httpDetails:f},Nt.fromCode(l)}case At.Replied:return r.annotations.includes(Fs)?{httpDetails:f,result:kr(r.retTypes,d.reply.arg)}:kr(r.retTypes,d.reply.arg)}}:o=async(i,...c)=>{i={...i,...t[ke].config.callTransform?.(e,c,{...t[ke].config,...i})};let a=i.agent||t[ke].config.agent||pr.createSync(),{canisterId:u,effectiveCanisterId:h,pollingOptions:d}={...Jc,...t[ke].config,...i},f=H.from(u),l=h!==void 0?H.from(h):f,p=nr.encode(r.argTypes,c),{requestId:b,response:g,requestDetails:m}=await a.call(f,{methodName:e,arg:p,effectiveCanisterId:l,nonce:i.nonce}),w,y;if(Ks(g.body)){if(a.rootKey==null)throw ae.fromCode(new Ze);let T=g.body.certificate;y=await jt.create({certificate:T,rootKey:a.rootKey,canisterId:H.from(u),blsVerify:n});let A=[z("request_status"),b];switch(new TextDecoder().decode(Ee(y.lookup_path([...A,"status"])))){case"replied":w=Ee(y.lookup_path([...A,"reply"]));break;case"rejected":{let S=new Uint8Array(Ee(y.lookup_path([...A,"reject_code"])))[0],U=new TextDecoder().decode(Ee(y.lookup_path([...A,"reject_message"]))),C=Ee(y.lookup_path([...A,"error_code"])),x=C?new TextDecoder().decode(C):void 0,B=new Qt(b,S,U,x);throw B.callContext={canisterId:f,methodName:e,httpDetails:g},Nt.fromCode(B)}}}else if(Hs(g.body)){let{reject_code:T,reject_message:A,error_code:E}=g.body,S=new Qt(b,T,A,E);throw S.callContext={canisterId:f,methodName:e,httpDetails:g},Nt.fromCode(S)}if(g.status===202){let T={...d,blsVerify:n},A=await ks(a,l,b,T);y=A.certificate,w=A.reply}let _=r.annotations.includes(Fs),v=r.annotations.includes(ea),I={...g,requestDetails:m};if(w!==void 0)return _&&v?{httpDetails:I,certificate:y,result:kr(r.retTypes,w)}:v?{certificate:y,result:kr(r.retTypes,w)}:_?{httpDetails:I,result:kr(r.retTypes,w)}:kr(r.retTypes,w);if(r.retTypes.length===0)return _?{httpDetails:g,result:void 0}:void 0;throw le.fromCode(new Ne(`Call was returned undefined, but type [${r.retTypes.map(T=>T.display()).join(",")}].`))};let s=(...i)=>o({},...i);return s.withOptions=i=>(...c)=>o(i,...c),s}var Cu=({IDL:t})=>t.Service({get_deposit_address:t.Func([t.Text],[t.Text],["query"]),get_nonce:t.Func([t.Text],[t.Nat64],["query"]),get_pid:t.Func([t.Text],[t.Text],["query"]),get_balance:t.Func([t.Text],[t.Nat64],[]),transfer:t.Func([t.Text,t.Nat64,t.Text,t.Vec(t.Nat8),t.Nat64],[t.Text],[]),get_sol_deposit_address:t.Func([t.Text],[t.Text],[]),get_sol_balance:t.Func([t.Text],[t.Nat64],[]),transfer_sol:t.Func([t.Text,t.Nat64,t.Text,t.Vec(t.Nat8),t.Nat64],[t.Text],[])}),ta=Cu;var Ru="https://ic0.app",Nu="f4kcz-fqaaa-aaaap-an3hq-cai",Uu=new pr({host:Ru}),Fe=So.createActor(ta,{agent:Uu,canisterId:Nu});function qu(){if("phantom"in window){let t=window.phantom?.solana;if(t?.isPhantom)return t}window.open("https://phantom.app/","_blank")}var Ao=qu(),me=null,$s=1e-4,Vs=2e-4,ra=2e-4,na=5e-6,Pu=BigInt(Math.round($s*1e8)),Lu=BigInt(Math.round(Vs*1e8));document.getElementById("connect").onclick=async()=>{try{me=(await Ao.connect()).publicKey.toString(),document.getElementById("pubkey").innerText=`Sol Pubkey: ${me}`;let e=await Fe.get_deposit_address(me);document.getElementById("deposit").innerText=`ICP Deposit to: ${e} (Send ICP here manually)`;let r=await Fe.get_sol_deposit_address(me);document.getElementById("sol_deposit").innerText=`SOL Deposit to: ${r} (Send SOL here manually)`;let n=await Fe.get_pid(me);document.getElementById("pid").innerText=`ICP PID: ${n}`;let o=await Fe.get_balance(me),s=(Number(o)/1e8).toFixed(8);document.getElementById("balance").innerText=`ICP Balance: ${s} ICP`;let i=await Fe.get_sol_balance(me),c=(Number(i)/1e9).toFixed(9);document.getElementById("sol_balance").innerText=`SOL Balance: ${c} SOL`}catch(t){document.getElementById("status").innerText=`Error: ${t.message}`}};document.getElementById("get_sol").onclick=async()=>{if(!me)return alert("Connect first");try{let t=await Fe.get_sol_balance(me),e=(Number(t)/1e9).toFixed(9);document.getElementById("sol_balance").innerText=`SOL Balance: ${e} SOL`}catch(t){document.getElementById("status").innerText=`Error: ${t.message}`}};document.getElementById("send").onclick=async()=>{if(!me)return alert("Connect first");let t=document.getElementById("to").value,e=document.getElementById("amount").value;if(isNaN(parseFloat(e))||parseFloat(e)<0)return alert("Invalid amount");let r=BigInt(Math.round(parseFloat(e)*1e8)),n=await Fe.get_nonce(me),s=parseFloat(e)+$s+ra,i=`Confirm transaction:
To: ${t}
Amount: ${e} ICP
Network fee: ${ra} ICP (includes ledger fees for transaction processing)
Service fee: ${$s} ICP
Total deduction from your balance: ${s.toFixed(8)} ICP`;if(!window.confirm(i))return;let c=`transfer to ${t} amount ${r} nonce ${n} service_fee ${Pu}`,a=new TextEncoder().encode(c),u=document.getElementById("send");u.disabled=!0,u.innerText="Sending...";try{let d=(await Ao.signMessage(a,"utf8")).signature,f=await Fe.transfer(t,r,me,Array.from(d),n);document.getElementById("status").innerText=f;let l=await Fe.get_balance(me),p=(Number(l)/1e8).toFixed(8);document.getElementById("balance").innerText=`ICP Balance: ${p} ICP`,f.startsWith("Transfer successful")&&(document.getElementById("to").value="",document.getElementById("amount").value="")}catch(h){document.getElementById("status").innerText=`Error: ${h.message}`}finally{u.disabled=!1,u.innerText="Send ICP"}};document.getElementById("send_sol").onclick=async()=>{if(!me)return alert("Connect first");let t=document.getElementById("to_sol").value,e=document.getElementById("amount_sol").value;if(isNaN(parseFloat(e))||parseFloat(e)<0)return alert("Invalid amount");let r=BigInt(Math.round(parseFloat(e)*1e9)),n=await Fe.get_nonce(me),s=parseFloat(e)+na,i=`Confirm SOL transaction:
To: ${t}
Amount: ${e} SOL
Solana fee: ~${na} SOL
Service fee: ${Vs} ICP
Total SOL deduction: ${s.toFixed(9)} SOL
Total ICP deduction: ${Vs} ICP`;if(!window.confirm(i))return;let c=`transfer_sol to ${t} amount ${r} nonce ${n} service_fee ${Lu}`,a=new TextEncoder().encode(c),u=document.getElementById("send_sol");u.disabled=!0,u.innerText="Sending...";try{let d=(await Ao.signMessage(a,"utf8")).signature,f=await Fe.transfer_sol(t,r,me,Array.from(d),n);document.getElementById("status").innerText=f;let l=await Fe.get_sol_balance(me),p=(Number(l)/1e9).toFixed(9);document.getElementById("sol_balance").innerText=`SOL Balance: ${p} SOL`,f.startsWith("Transfer successful")&&(document.getElementById("to_sol").value="",document.getElementById("amount_sol").value="")}catch(h){document.getElementById("status").innerText=`Error: ${h.message}`}finally{u.disabled=!1,u.innerText="Send SOL"}};document.getElementById("logout").onclick=async()=>{try{await Ao.disconnect(),me=null,document.getElementById("pubkey").innerText="",document.getElementById("pid").innerText="",document.getElementById("deposit").innerText="",document.getElementById("balance").innerText="",document.getElementById("sol_deposit").innerText="",document.getElementById("sol_balance").innerText="",document.getElementById("status").innerText="Disconnected. To prevent auto-reconnect, revoke access in Phantom settings (Settings > Connected Apps > Revoke this app) or lock your wallet."}catch(t){document.getElementById("status").innerText=`Error: ${t.message}`}};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/abstract/bls.js:
@noble/curves/esm/abstract/tower.js:
@noble/curves/esm/bls12-381.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
