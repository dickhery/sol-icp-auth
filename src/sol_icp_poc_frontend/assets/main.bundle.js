var If=Object.defineProperty;var Bf=(t,e)=>{for(var r in e)If(t,r,{get:e[r],enumerable:!0})};var Xi;(function(t){t[t.SysFatal=1]="SysFatal",t[t.SysTransient=2]="SysTransient",t[t.DestinationInvalid=3]="DestinationInvalid",t[t.CanisterReject=4]="CanisterReject",t[t.CanisterError=5]="CanisterError"})(Xi||(Xi={}));var Ft;(function(t){t.Replied="replied",t.Rejected="rejected"})(Ft||(Ft={}));function Ji(t){return t!=null&&"reject_code"in t}function Qi(t){return t!=null&&"certificate"in t}var so="abcdefghijklmnopqrstuvwxyz234567",Pr=Object.create(null);for(let t=0;t<so.length;t++)Pr[so[t]]=t;Pr[0]=Pr.o;Pr[1]=Pr.i;function ea(t){let e=0,r=0,n="";function o(s){return e<0?r|=s>>-e:r=s<<e&248,e>3?(e-=8,1):(e<4&&(n+=so[r>>3],e+=5),0)}for(let s=0;s<t.length;)s+=o(t[s]);return n+(e<0?so[r>>3]:"")}function ta(t){let e=0,r=0,n=new Uint8Array(t.length*4/3|0),o=0;function s(i){let a=Pr[i.toLowerCase()];if(a===void 0)throw new Error(`Invalid character: ${JSON.stringify(i)}`);a<<=3,r|=a>>>e,e+=5,e>=8&&(n[o++]=r,e-=8,e>0?r=a<<5-e&255:r=0)}for(let i of t)s(i);return n.slice(0,o)}var Sf=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function ra(t){let e=-1;for(let r=0;r<t.length;r++){let o=(t[r]^e)&255;e=Sf[o]^e>>>8}return(e^-1)>>>0}var cr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ct(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function _s(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function se(t,...e){if(!ct(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Es(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function oa(t,e){se(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function fr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function ao(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ze(t,e){return t<<32-e|t>>>e}var sa=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Tf=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function F(t){if(se(t),sa)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Tf[t[r]];return e}var bt={_0:48,_9:57,A:65,F:70,a:97,f:102};function na(t){if(t>=bt._0&&t<=bt._9)return t-bt._0;if(t>=bt.A&&t<=bt.F)return t-(bt.A-10);if(t>=bt.a&&t<=bt.f)return t-(bt.a-10)}function pe(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(sa)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=na(t.charCodeAt(s)),a=na(t.charCodeAt(s+1));if(i===void 0||a===void 0){let c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function W(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function vs(t){return typeof t=="string"&&(t=W(t)),se(t),t}function $(...t){let e=0;for(let n=0;n<t.length;n++){let o=t[n];se(o),e+=o.length}let r=new Uint8Array(e);for(let n=0,o=0;n<t.length;n++){let s=t[n];r.set(s,o),o+=s.length}return r}var io=class{};function co(t){let e=n=>t().update(vs(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Ur(t=32){if(cr&&typeof cr.getRandomValues=="function")return cr.getRandomValues(new Uint8Array(t));if(cr&&typeof cr.randomBytes=="function")return Uint8Array.from(cr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function Af(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,i,n),t.setUint32(e+u,a,n)}function ia(t,e,r){return t&e^~t&r}function aa(t,e,r){return t&e^t&r^e&r}var dn=class extends io{constructor(e,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=ao(this.buffer)}update(e){Es(this),e=vs(e),se(e);let{view:r,buffer:n,blockLen:o}=this,s=e.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=ao(e);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Es(this),oa(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,fr(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let d=i;d<o;d++)r[d]=0;Af(n,o-8,BigInt(this.length*8),s),this.process(n,0);let a=ao(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,l[d],s)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return e.destroyed=i,e.finished=s,e.length=o,e.pos=a,o%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}},gt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wt=Uint32Array.from([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]);var _e=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var fo=BigInt(4294967295),ca=BigInt(32);function Of(t,e=!1){return e?{h:Number(t&fo),l:Number(t>>ca&fo)}:{h:Number(t>>ca&fo)|0,l:Number(t&fo)|0}}function fa(t,e=!1){let r=t.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=Of(t[s],e);[n[s],o[s]]=[i,a]}return[n,o]}var Is=(t,e,r)=>t>>>r,Bs=(t,e,r)=>t<<32-r|e>>>r,ur=(t,e,r)=>t>>>r|e<<32-r,dr=(t,e,r)=>t<<32-r|e>>>r,ln=(t,e,r)=>t<<64-r|e>>>r-32,hn=(t,e,r)=>t>>>r-32|e<<64-r;function ft(t,e,r,n){let o=(e>>>0)+(n>>>0);return{h:t+r+(o/2**32|0)|0,l:o|0}}var ua=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),da=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,la=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),ha=(t,e,r,n,o)=>e+r+n+o+(t/2**32|0)|0,pa=(t,e,r,n,o)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(o>>>0),ma=(t,e,r,n,o,s)=>e+r+n+o+s+(t/2**32|0)|0;var Rf=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$t=new Uint32Array(64),uo=class extends dn{constructor(e=32){super(64,e,8,!1),this.A=gt[0]|0,this.B=gt[1]|0,this.C=gt[2]|0,this.D=gt[3]|0,this.E=gt[4]|0,this.F=gt[5]|0,this.G=gt[6]|0,this.H=gt[7]|0}get(){let{A:e,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[e,r,n,o,s,i,a,c]}set(e,r,n,o,s,i,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(e,r){for(let d=0;d<16;d++,r+=4)$t[d]=e.getUint32(r,!1);for(let d=16;d<64;d++){let f=$t[d-15],h=$t[d-2],p=ze(f,7)^ze(f,18)^f>>>3,m=ze(h,17)^ze(h,19)^h>>>10;$t[d]=m+$t[d-7]+p+$t[d-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:u,H:l}=this;for(let d=0;d<64;d++){let f=ze(a,6)^ze(a,11)^ze(a,25),h=l+f+ia(a,c,u)+Rf[d]+$t[d]|0,m=(ze(n,2)^ze(n,13)^ze(n,22))+aa(n,o,s)|0;l=u,u=c,c=a,a=i+h|0,i=s,s=o,o=n,n=h+m|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,a,c,u,l)}roundClean(){fr($t)}destroy(){this.set(0,0,0,0,0,0,0,0),fr(this.buffer)}},Ss=class extends uo{constructor(){super(28),this.A=wt[0]|0,this.B=wt[1]|0,this.C=wt[2]|0,this.D=wt[3]|0,this.E=wt[4]|0,this.F=wt[5]|0,this.G=wt[6]|0,this.H=wt[7]|0}},ya=fa(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Nf=ya[0],Pf=ya[1],Vt=new Uint32Array(80),jt=new Uint32Array(80),Ts=class extends dn{constructor(e=64){super(128,e,16,!1),this.Ah=_e[0]|0,this.Al=_e[1]|0,this.Bh=_e[2]|0,this.Bl=_e[3]|0,this.Ch=_e[4]|0,this.Cl=_e[5]|0,this.Dh=_e[6]|0,this.Dl=_e[7]|0,this.Eh=_e[8]|0,this.El=_e[9]|0,this.Fh=_e[10]|0,this.Fl=_e[11]|0,this.Gh=_e[12]|0,this.Gl=_e[13]|0,this.Hh=_e[14]|0,this.Hl=_e[15]|0}get(){let{Ah:e,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:u,El:l,Fh:d,Fl:f,Gh:h,Gl:p,Hh:m,Hl:g}=this;return[e,r,n,o,s,i,a,c,u,l,d,f,h,p,m,g]}set(e,r,n,o,s,i,a,c,u,l,d,f,h,p,m,g){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=d|0,this.Fl=f|0,this.Gh=h|0,this.Gl=p|0,this.Hh=m|0,this.Hl=g|0}process(e,r){for(let b=0;b<16;b++,r+=4)Vt[b]=e.getUint32(r),jt[b]=e.getUint32(r+=4);for(let b=16;b<80;b++){let E=Vt[b-15]|0,I=jt[b-15]|0,S=ur(E,I,1)^ur(E,I,8)^Is(E,I,7),B=dr(E,I,1)^dr(E,I,8)^Bs(E,I,7),A=Vt[b-2]|0,_=jt[b-2]|0,T=ur(A,_,19)^ln(A,_,61)^Is(A,_,6),P=dr(A,_,19)^hn(A,_,61)^Bs(A,_,6),C=la(B,P,jt[b-7],jt[b-16]),x=ha(C,S,T,Vt[b-7],Vt[b-16]);Vt[b]=x|0,jt[b]=C|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:u,Dl:l,Eh:d,El:f,Fh:h,Fl:p,Gh:m,Gl:g,Hh:y,Hl:w}=this;for(let b=0;b<80;b++){let E=ur(d,f,14)^ur(d,f,18)^ln(d,f,41),I=dr(d,f,14)^dr(d,f,18)^hn(d,f,41),S=d&h^~d&m,B=f&p^~f&g,A=pa(w,I,B,Pf[b],jt[b]),_=ma(A,y,E,S,Nf[b],Vt[b]),T=A|0,P=ur(n,o,28)^ln(n,o,34)^ln(n,o,39),C=dr(n,o,28)^hn(n,o,34)^hn(n,o,39),x=n&s^n&a^s&a,v=o&i^o&c^i&c;y=m|0,w=g|0,m=h|0,g=p|0,h=d|0,p=f|0,{h:d,l:f}=ft(u|0,l|0,_|0,T|0),u=a|0,l=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let R=ua(T,C,v);n=da(R,_,P,x),o=R|0}({h:n,l:o}=ft(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=ft(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=ft(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=ft(this.Dh|0,this.Dl|0,u|0,l|0),{h:d,l:f}=ft(this.Eh|0,this.El|0,d|0,f|0),{h,l:p}=ft(this.Fh|0,this.Fl|0,h|0,p|0),{h:m,l:g}=ft(this.Gh|0,this.Gl|0,m|0,g|0),{h:y,l:w}=ft(this.Hh|0,this.Hl|0,y|0,w|0),this.set(n,o,s,i,a,c,u,l,d,f,h,p,m,g,y,w)}roundClean(){fr(Vt,jt)}destroy(){fr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var ve=co(()=>new uo),ba=co(()=>new Ss),ga=co(()=>new Ts);var lo="__principal__",Uf=2,wa=4,Df="aaaaa-aa",L=class t{static anonymous(){return new this(new Uint8Array([wa]))}static managementCanister(){return this.fromText(Df)}static selfAuthenticating(e){let r=ba(e);return new this(new Uint8Array([...r,Uf]))}static from(e){if(typeof e=="string")return t.fromText(e);if(Object.getPrototypeOf(e)===Uint8Array.prototype)return new t(e);if(t.isPrincipal(e))return new t(e._arr);throw new Error(`Impossible to convert ${JSON.stringify(e)} to Principal.`)}static fromHex(e){return new this(pe(e))}static fromText(e){let r=e;if(e.includes(lo)){let i=JSON.parse(e);lo in i&&(r=i[lo])}let n=r.toLowerCase().replace(/-/g,""),o=ta(n);o=o.slice(4,o.length);let s=new this(o);if(s.toText()!==r)throw new Error(`Principal "${s.toText()}" does not have a valid checksum (original value "${r}" may not be a valid Principal ID).`);return s}static fromUint8Array(e){return new this(e)}static isPrincipal(e){return e instanceof t||typeof e=="object"&&e!==null&&"_isPrincipal"in e&&e._isPrincipal===!0&&"_arr"in e&&e._arr instanceof Uint8Array}constructor(e){this._arr=e,this._isPrincipal=!0}isAnonymous(){return this._arr.byteLength===1&&this._arr[0]===wa}toUint8Array(){return this._arr}toHex(){return F(this._arr).toUpperCase()}toText(){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,ra(this._arr));let n=new Uint8Array(e),o=new Uint8Array([...n,...this._arr]),i=ea(o).match(/.{1,5}/g);if(!i)throw new Error;return i.join("-")}toString(){return this.toText()}toJSON(){return{[lo]:this.toText()}}compareTo(e){for(let r=0;r<Math.min(this._arr.length,e._arr.length);r++){if(this._arr[r]<e._arr[r])return"lt";if(this._arr[r]>e._arr[r])return"gt"}return this._arr.length<e._arr.length?"lt":this._arr.length>e._arr.length?"gt":"eq"}ltEq(e){let r=this.compareTo(e);return r=="lt"||r=="eq"}gtEq(e){let r=this.compareTo(e);return r=="gt"||r=="eq"}};var xt;(function(t){t.Trust="Trust",t.Protocol="Protocol",t.Reject="Reject",t.Transport="Transport",t.External="External",t.Limit="Limit",t.Input="Input",t.Unknown="Unknown"})(xt||(xt={}));var K=class{constructor(e=!1){this.isCertified=e}toString(){let e=this.toErrorMessage();return this.requestContext&&(e+=`
Request context:
  Request ID (hex): ${this.requestContext.requestId?F(this.requestContext.requestId):"undefined"}
  Sender pubkey (hex): ${F(this.requestContext.senderPubKey)}
  Sender signature (hex): ${F(this.requestContext.senderSignature)}
  Ingress expiry: ${this.requestContext.ingressExpiry.toString()}`),this.callContext&&(e+=`
Call context:
  Canister ID: ${this.callContext.canisterId.toText()}
  Method name: ${this.callContext.methodName}
  HTTP details: ${JSON.stringify(this.callContext.httpDetails,null,2)}`),e}},We=class t extends Error{get code(){return this.cause.code}set code(e){this.cause.code=e}get kind(){return this.cause.kind}set kind(e){this.cause.kind=e}get isCertified(){return this.code.isCertified}constructor(e,r){super(e.toString()),this.name="AgentError",this.cause={code:e,kind:r},Object.setPrototypeOf(this,t.prototype)}hasCode(e){return this.code instanceof e}toString(){return`${this.name} (${this.kind}): ${this.message}`}},_t=class extends We{static fromCode(e){return new this(e)}},Te=class t extends _t{constructor(e){super(e,xt.Trust),this.name="TrustError",Object.setPrototypeOf(this,t.prototype)}},J=class t extends _t{constructor(e){super(e,xt.Protocol),this.name="ProtocolError",Object.setPrototypeOf(this,t.prototype)}},Kt=class t extends _t{constructor(e){super(e,xt.Reject),this.name="RejectError",Object.setPrototypeOf(this,t.prototype)}},pn=class t extends _t{constructor(e){super(e,xt.Transport),this.name="TransportError",Object.setPrototypeOf(this,t.prototype)}},me=class t extends _t{constructor(e){super(e,xt.External),this.name="ExternalError",Object.setPrototypeOf(this,t.prototype)}};var G=class t extends _t{constructor(e){super(e,xt.Input),this.name="InputError",Object.setPrototypeOf(this,t.prototype)}},ue=class t extends _t{constructor(e){super(e,xt.Unknown),this.name="UnknownError",Object.setPrototypeOf(this,t.prototype)}},Ht=class t extends K{constructor(e,r){super(),this.reason=e,this.error=r,this.name="CertificateVerificationErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=this.reason;return this.error&&(e+=`: ${_n(this.error)}`),`Certificate verification error: "${e}"`}},lr=class t extends K{constructor(e,r,n,o,s){super(),this.maxAgeInMinutes=e,this.certificateTime=r,this.currentTime=n,this.timeDiffMsecs=o,this.ageType=s,this.name="CertificateTimeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Certificate is signed more than ${this.maxAgeInMinutes} minutes in the ${this.ageType}. Certificate time: ${this.certificateTime.toISOString()} Current time: ${this.currentTime.toISOString()} Clock drift: ${this.timeDiffMsecs}ms`}},ho=class t extends K{constructor(){super(),this.name="CertificateHasTooManyDelegationsErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Certificate has too many delegations"}},Dr=class t extends K{constructor(e,r){super(),this.canisterId=e,this.subnetId=r,this.name="CertificateNotAuthorizedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The certificate contains a delegation that does not include the canister ${this.canisterId.toText()} in the canister_ranges field. Subnet ID: ${this.subnetId.toText()}`}},Et=class t extends K{constructor(e,r){super(),this.message=e,this.lookupStatus=r,this.name="LookupErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`${this.message}. Lookup status: ${this.lookupStatus}`}},kr=class t extends K{constructor(e){super(),this.message=e,this.name="MalformedLookupFoundValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.message}},po=class t extends K{constructor(e){super(),this.message=e,this.name="MissingLookupValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.message}},Mr=class t extends K{constructor(e,r){super(),this.expectedLength=e,this.actualLength=r,this.name="DerKeyLengthMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`BLS DER-encoded public key must be ${this.expectedLength} bytes long, but is ${this.actualLength} bytes long`}},mo=class t extends K{constructor(e,r){super(),this.expectedPrefix=e,this.actualPrefix=r,this.name="DerPrefixMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`BLS DER-encoded public key is invalid. Expected the following prefix: ${F(this.expectedPrefix)}, but got ${F(this.actualPrefix)}`}},yo=class t extends K{constructor(e,r){super(),this.expectedLength=e,this.actualLength=r,this.name="DerDecodeLengthMismatchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`DER payload mismatch: Expected length ${this.expectedLength}, actual length: ${this.actualLength}`}},Xe=class t extends K{constructor(e){super(),this.error=e,this.name="DerDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode DER: ${this.error}`}},mn=class t extends K{constructor(e){super(),this.error=e,this.name="DerEncodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to encode DER: ${this.error}`}},bo=class t extends K{constructor(e,r){super(),this.error=e,this.input=r,this.name="CborDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode CBOR: ${_n(this.error)}, input: ${F(this.input)}`}},go=class t extends K{constructor(e,r){super(),this.error=e,this.value=r,this.name="CborEncodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to encode CBOR: ${_n(this.error)}, input: ${this.value}`}};var hr=class t extends K{constructor(e,r,n){super(),this.message=e,this.requestId=r,this.status=n,this.name="TimeoutWaitingForResponseErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`${this.message}
`;return this.requestId&&(e+=`  Request ID: ${F(this.requestId)}
`),this.status&&(e+=`  Request status: ${this.status}
`),e}},wo=class t extends K{constructor(e,r,n){super(),this.maxIngressExpiryInMinutes=e,this.requestId=r,this.retryTimes=n,this.name="CertificateOutdatedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`Certificate is stale (over ${this.maxIngressExpiryInMinutes} minutes). Is the computer's clock synchronized?
  Request ID: ${F(this.requestId)}
`;return this.retryTimes!==void 0&&(e+=`  Retried ${this.retryTimes} times.`),e}},Lr=class t extends K{constructor(e,r,n,o){super(!0),this.requestId=e,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=o,this.name="CertifiedRejectErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${F(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},xo=class t extends K{constructor(e,r,n,o,s){super(),this.requestId=e,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=o,this.signatures=s,this.name="UncertifiedRejectErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${F(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},_o=class t extends K{constructor(e,r,n,o){super(),this.requestId=e,this.rejectCode=r,this.rejectMessage=n,this.rejectErrorCode=o,this.name="UncertifiedRejectUpdateErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`The replica returned a rejection error:
  Request ID: ${F(this.requestId)}
  Reject code: ${this.rejectCode}
  Reject text: ${this.rejectMessage}
  Error code: ${this.rejectErrorCode}
`}},Eo=class t extends K{constructor(e){super(),this.requestId=e,this.name="RequestStatusDoneNoReplyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Call was marked as done but we never saw the reply:
  Request ID: ${F(this.requestId)}
`}},ut=class t extends K{constructor(e){super(),this.shouldFetchRootKey=e,this.name="MissingRootKeyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.shouldFetchRootKey===void 0?"Agent is missing root key":`Agent is missing root key and the shouldFetchRootKey value is set to ${this.shouldFetchRootKey}. The root key should only be unknown if you are in local development. Otherwise you should avoid fetching and use the default IC Root Key or the known root key of your environment.`}},vo=class t extends K{constructor(e){super(),this.value=e,this.name="HashValueErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Attempt to hash a value of unsupported type: ${this.value}`}},qr=class t extends K{constructor(e){super(),this.error=e,this.name="HttpDefaultFetchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return this.error}},Gt=class t extends K{constructor(){super(),this.name="IdentityInvalidErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"This identity has expired due this application's security policy. Please refresh your authentication."}},pr=class t extends K{constructor(e,r){super(),this.message=e,this.providedIngressExpiryInMinutes=r,this.name="IngressExpiryInvalidErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`${this.message}. Provided ingress expiry time is ${this.providedIngressExpiryInMinutes} minutes.`}},Io=class t extends K{constructor(){super(),this.name="CreateHttpAgentErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Failed to create agent from provided agent"}},Bo=class t extends K{constructor(e){super(),this.error=e,this.name="MalformedSignatureErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Query response contained a malformed signature: ${this.error}`}},So=class t extends K{constructor(){super(),this.name="MissingSignatureErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Query response did not contain any node signatures"}},To=class t extends K{constructor(){super(),this.name="MalformedPublicKeyErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"Read state response contained a malformed public key"}},Ao=class t extends K{constructor(e){super(),this.nodeId=e,this.name="QuerySignatureVerificationFailedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Query signature verification failed. Node ID: ${this.nodeId}`}},Ae=class t extends K{constructor(e){super(),this.error=e,this.name="UnexpectedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Unexpected error: ${_n(this.error)}`}},Zt=class t extends K{constructor(e){super(),this.error=e,this.name="HashTreeDecodeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to decode certificate: ${this.error}`}},yn=class t extends K{constructor(e,r,n,o){super(),this.status=e,this.statusText=r,this.headers=n,this.bodyText=o,this.name="HttpErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){let e=`HTTP request failed:
  Status: ${this.status} (${this.statusText})
  Headers: ${JSON.stringify(this.headers)}
`;return this.bodyText&&(e+=`  Body: ${this.bodyText}
`),e}},bn=class t extends K{constructor(){super(),this.name="HttpV3ApiNotSupportedErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return"HTTP request failed: v3 API is not supported"}},gn=class t extends K{constructor(e){super(),this.error=e,this.name="HttpFetchErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to fetch HTTP request: ${_n(this.error)}`}},wn=class t extends K{constructor(e){super(),this.receivedCanisterId=e,this.name="MissingCanisterIdErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Canister ID is required, but received ${typeof this.receivedCanisterId} instead. If you are using automatically generated declarations, this may be because your application is not setting the canister ID in process.env correctly.`}},Oo=class t extends K{constructor(e){super(),this.request=e,this.name="InvalidReadStateRequestErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Invalid read state request: ${this.request}`}},xn=class t extends K{constructor(e){super(),this.error=e,this.name="ExpiryJsonDeserializeErrorCode",Object.setPrototypeOf(this,t.prototype)}toErrorMessage(){return`Failed to deserialize expiry: ${this.error}`}};function _n(t){if(t instanceof Error)return t.stack??t.message;try{return JSON.stringify(t)}catch{return String(t)}}var Yt=new Error("unreachable");var gr={};Bf(gr,{Bool:()=>Aa,BoolClass:()=>Uo,ConstructType:()=>ht,Empty:()=>Sa,EmptyClass:()=>vn,FixedIntClass:()=>Bt,FixedNatClass:()=>lt,Float32:()=>Pa,Float64:()=>Ua,FloatClass:()=>Sn,Func:()=>Wa,FuncClass:()=>br,Int:()=>Ra,Int16:()=>ka,Int32:()=>Ma,Int64:()=>La,Int8:()=>Da,IntClass:()=>In,Nat:()=>Na,Nat16:()=>Fa,Nat32:()=>$a,Nat64:()=>Va,Nat8:()=>qa,NatClass:()=>Bn,Null:()=>Oa,NullClass:()=>mr,Opt:()=>Ga,OptClass:()=>Xt,PrimitiveType:()=>De,Principal:()=>ja,PrincipalClass:()=>Mo,Rec:()=>za,RecClass:()=>Ve,Record:()=>Za,RecordClass:()=>yr,Reserved:()=>Ta,ReservedClass:()=>pt,Service:()=>Xa,ServiceClass:()=>jr,Text:()=>Ca,TextClass:()=>Do,Tuple:()=>Ka,TupleClass:()=>ko,Type:()=>Fr,Unknown:()=>qf,UnknownClass:()=>Po,Variant:()=>Ya,VariantClass:()=>Vr,Vec:()=>Ha,VecClass:()=>$r,Visitor:()=>Us,decode:()=>Lf,encode:()=>Mf,resetSubtypeCache:()=>Ds,subtype:()=>Ms});function Z(...t){let e=new Uint8Array(t.reduce((n,o)=>n+o.byteLength,0)),r=0;for(let n of t)e.set(n,r),r+=n.byteLength;return e}var Je=class{save(){return this._view}restore(e){if(!(e instanceof Uint8Array))throw new Error("Checkpoint must be a Uint8Array");this._view=e}constructor(e,r=e?.byteLength||0){if(e&&!(e instanceof Uint8Array))try{e=dt(e)}catch{throw new Error("Buffer must be a Uint8Array")}if(r<0||!Number.isInteger(r))throw new Error("Length must be a non-negative integer");if(e&&r>e.byteLength)throw new Error("Length cannot exceed buffer length");this._buffer=e||new Uint8Array(0),this._view=new Uint8Array(this._buffer.buffer,0,r)}get buffer(){return this._view.slice()}get byteLength(){return this._view.byteLength}read(e){let r=this._view.subarray(0,e);return this._view=this._view.subarray(e),r.slice()}readUint8(){if(this._view.byteLength===0)return;let e=this._view[0];return this._view=this._view.subarray(1),e}write(e){if(!(e instanceof Uint8Array))throw new Error("Buffer must be a Uint8Array");let r=this._view.byteLength;this._view.byteOffset+this._view.byteLength+e.byteLength>=this._buffer.byteLength?this.alloc(e.byteLength):this._view=new Uint8Array(this._buffer.buffer,this._view.byteOffset,this._view.byteLength+e.byteLength),this._view.set(e,r)}get end(){return this._view.byteLength===0}alloc(e){if(e<=0||!Number.isInteger(e))throw new Error("Amount must be a positive integer");let r=new Uint8Array((this._buffer.byteLength+e)*1.2|0),n=new Uint8Array(r.buffer,0,this._view.byteLength+e);n.set(this._view),this._buffer=r,this._view=n}};function dt(t){if(!t)throw new Error("Input cannot be null or undefined");return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):Array.isArray(t)?new Uint8Array(t):"buffer"in t?dt(t.buffer):new Uint8Array(t)}function As(t,e){if(t.byteLength!==e.byteLength)return t.byteLength-e.byteLength;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return t[r]-e[r];return 0}function xa(t,e){return As(t,e)===0}function _a(t){if(!(t instanceof Uint8Array))throw new Error("Input must be a Uint8Array");return new DataView(t.buffer,t.byteOffset,t.byteLength)}function kf(t){let r=new TextEncoder().encode(t),n=0;for(let o of r)n=(n*223+o)%2**32;return n}function Oe(t){if(/^_\d+_$/.test(t)||/^_0x[0-9a-fA-F]+_$/.test(t)){let e=+t.slice(1,-1);if(Number.isSafeInteger(e)&&e>=0&&e<2**32)return e}return kf(t)}function Os(t){let e=BigInt(t);if(t<=0)throw new RangeError("Input must be positive");return e.toString(2).length-1}function Co(t){let e=BigInt(t);if(t<0)throw new RangeError("Input must be non-negative");return BigInt(1)<<e}function Ea(){throw new Error("unexpected end of buffer")}function Wt(t,e){return t.byteLength<e&&Ea(),t.read(e)}function zt(t){let e=t.readUint8();return e===void 0&&Ea(),e}function Q(t){if(typeof t=="number"&&(t=BigInt(t)),t<BigInt(0))throw new Error("Cannot leb encode negative values.");let e=(t===BigInt(0)?0:Os(t))+1,r=new Je(new Uint8Array(e),0);for(;;){let n=Number(t&BigInt(127));if(t/=BigInt(128),t===BigInt(0)){r.write(new Uint8Array([n]));break}else r.write(new Uint8Array([n|128]))}return r.buffer}function ae(t){let e=BigInt(1),r=BigInt(0),n;do n=zt(t),r+=BigInt(n&127).valueOf()*e,e*=BigInt(128);while(n>=128);return r}function ce(t){typeof t=="number"&&(t=BigInt(t));let e=t<BigInt(0);e&&(t=-t-BigInt(1));let r=(t===BigInt(0)?0:Os(t))+1,n=new Je(new Uint8Array(r),0);for(;;){let s=o(t);if(t/=BigInt(128),e&&t===BigInt(0)&&(s&64)!==0||!e&&t===BigInt(0)&&(s&64)===0){n.write(new Uint8Array([s]));break}else n.write(new Uint8Array([s|128]))}function o(s){let i=s%BigInt(128);return Number(e?BigInt(128)-i-BigInt(1):i)}return n.buffer}function vt(t){let e=new Uint8Array(t.buffer),r=0;for(;r<e.byteLength;r++)if(e[r]<128){if((e[r]&64)===0)return ae(t);break}let n=new Uint8Array(Wt(t,r+1)),o=BigInt(0);for(let s=n.byteLength-1;s>=0;s--)o=o*BigInt(128)+BigInt(128-(n[s]&127)-1);return-o-BigInt(1)}function va(t,e){if(BigInt(t)<BigInt(0))throw new Error("Cannot write negative values.");return Cs(t,e)}function Cs(t,e){t=BigInt(t);let r=new Je(new Uint8Array(Math.min(1,e)),0),n=0,o=BigInt(256),s=BigInt(0),i=Number(t%o);for(r.write(new Uint8Array([i]));++n<e;)t<0&&s===BigInt(0)&&i!==0&&(s=BigInt(1)),i=Number((t/o-s)%BigInt(256)),r.write(new Uint8Array([i])),o*=BigInt(256);return r.buffer}function Rs(t,e){if(e<=0||!Number.isInteger(e))throw new Error("Byte length must be a positive integer");let r=BigInt(zt(t)),n=BigInt(1),o=0;for(;++o<e;){n*=BigInt(256);let s=BigInt(zt(t));r=r+n*s}return r}function Ia(t,e){if(e<=0||!Number.isInteger(e))throw new Error("Byte length must be a positive integer");let r=Rs(t,e),n=BigInt(2)**(BigInt(8)*BigInt(e-1)+BigInt(7));return r>=n&&(r-=n*BigInt(2)),r}var z;(function(t){t[t.Null=-1]="Null",t[t.Bool=-2]="Bool",t[t.Nat=-3]="Nat",t[t.Int=-4]="Int",t[t.Float32=-13]="Float32",t[t.Float64=-14]="Float64",t[t.Text=-15]="Text",t[t.Reserved=-16]="Reserved",t[t.Empty=-17]="Empty",t[t.Opt=-18]="Opt",t[t.Vector=-19]="Vector",t[t.Record=-20]="Record",t[t.Variant=-21]="Variant",t[t.Func=-22]="Func",t[t.Service=-23]="Service",t[t.Principal=-24]="Principal"})(z||(z={}));var Ro="DIDL",Ba=400;function En(t,e,r){return t.map((n,o)=>r(n,e[o]))}var Ps=class{constructor(){this._typs=[],this._idx=new Map}has(e){return this._idx.has(e.name)}add(e,r){let n=this._typs.length;this._idx.set(e.name,n),this._typs.push(r)}merge(e,r){let n=this._idx.get(e.name),o=this._idx.get(r);if(n===void 0)throw new Error("Missing type index for "+e);if(o===void 0)throw new Error("Missing type index for "+r);this._typs[n]=this._typs[o],this._typs.splice(o,1),this._idx.delete(r)}encode(){let e=Q(this._typs.length),r=Z(...this._typs);return Z(e,r)}indexOf(e){if(!this._idx.has(e))throw new Error("Missing type index for "+e);return ce(this._idx.get(e)||0)}},Us=class{visitType(e,r){throw new Error("Not implemented")}visitPrimitive(e,r){return this.visitType(e,r)}visitEmpty(e,r){return this.visitPrimitive(e,r)}visitBool(e,r){return this.visitPrimitive(e,r)}visitNull(e,r){return this.visitPrimitive(e,r)}visitReserved(e,r){return this.visitPrimitive(e,r)}visitText(e,r){return this.visitPrimitive(e,r)}visitNumber(e,r){return this.visitPrimitive(e,r)}visitInt(e,r){return this.visitNumber(e,r)}visitNat(e,r){return this.visitNumber(e,r)}visitFloat(e,r){return this.visitPrimitive(e,r)}visitFixedInt(e,r){return this.visitNumber(e,r)}visitFixedNat(e,r){return this.visitNumber(e,r)}visitPrincipal(e,r){return this.visitPrimitive(e,r)}visitConstruct(e,r){return this.visitType(e,r)}visitVec(e,r,n){return this.visitConstruct(e,n)}visitOpt(e,r,n){return this.visitConstruct(e,n)}visitRecord(e,r,n){return this.visitConstruct(e,n)}visitTuple(e,r,n){let o=r.map((s,i)=>[`_${i}_`,s]);return this.visitRecord(e,o,n)}visitVariant(e,r,n){return this.visitConstruct(e,n)}visitRec(e,r,n){return this.visitConstruct(r,n)}visitFunc(e,r){return this.visitConstruct(e,r)}visitService(e,r){return this.visitConstruct(e,r)}},V;(function(t){t.EmptyClass="__IDL_EmptyClass__",t.UnknownClass="__IDL_UnknownClass__",t.BoolClass="__IDL_BoolClass__",t.NullClass="__IDL_NullClass__",t.ReservedClass="__IDL_ReservedClass__",t.TextClass="__IDL_TextClass__",t.IntClass="__IDL_IntClass__",t.NatClass="__IDL_NatClass__",t.FloatClass="__IDL_FloatClass__",t.FixedIntClass="__IDL_FixedIntClass__",t.FixedNatClass="__IDL_FixedNatClass__",t.VecClass="__IDL_VecClass__",t.OptClass="__IDL_OptClass__",t.RecordClass="__IDL_RecordClass__",t.TupleClass="__IDL_TupleClass__",t.VariantClass="__IDL_VariantClass__",t.RecClass="__IDL_RecClass__",t.PrincipalClass="__IDL_PrincipalClass__",t.FuncClass="__IDL_FuncClass__",t.ServiceClass="__IDL_ServiceClass__"})(V||(V={}));var Fr=class{display(){return this.name}valueToString(e){return ie(e)}buildTypeTable(e){e.has(this)||this._buildTypeTableImpl(e)}},De=class extends Fr{checkType(e){if(this.name!==e.name)throw new Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`);return e}_buildTypeTableImpl(e){}},ht=class extends Fr{checkType(e){if(e instanceof Ve){let r=e.getType();if(typeof r>"u")throw new Error("type mismatch with uninitialized type");return r}throw new Error(`type mismatch: type on the wire ${e.name}, expect type ${this.name}`)}encodeType(e){return e.indexOf(this.name)}},vn=class extends De{get typeName(){return V.EmptyClass}static[Symbol.hasInstance](e){return e.typeName===V.EmptyClass}accept(e,r){return e.visitEmpty(this,r)}covariant(e){throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(){throw new Error("Empty cannot appear as a function argument")}valueToString(){throw new Error("Empty cannot appear as a value")}encodeType(){return ce(z.Empty)}decodeValue(){throw new Error("Empty cannot appear as an output")}get name(){return"empty"}},Po=class extends Fr{get typeName(){return V.UnknownClass}static[Symbol.hasInstance](e){return e.typeName===V.UnknownClass}checkType(e){throw new Error("Method not implemented for unknown.")}accept(e,r){throw e.visitType(this,r)}covariant(e){throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(){throw new Error("Unknown cannot appear as a function argument")}valueToString(){throw new Error("Unknown cannot appear as a value")}encodeType(){throw new Error("Unknown cannot be serialized")}decodeValue(e,r){let n=r.decodeValue(e,r);Object(n)!==n&&(n=Object(n));let o;return r instanceof Ve?o=()=>r.getType():o=()=>r,Object.defineProperty(n,"type",{value:o,writable:!0,enumerable:!1,configurable:!0}),n}_buildTypeTableImpl(){throw new Error("Unknown cannot be serialized")}get name(){return"Unknown"}},Uo=class extends De{get typeName(){return V.BoolClass}static[Symbol.hasInstance](e){return e.typeName===V.BoolClass}accept(e,r){return e.visitBool(this,r)}covariant(e){if(typeof e=="boolean")return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return new Uint8Array([e?1:0])}encodeType(){return ce(z.Bool)}decodeValue(e,r){switch(this.checkType(r),zt(e)){case 0:return!1;case 1:return!0;default:throw new Error("Boolean value out of range")}}get name(){return"bool"}},mr=class extends De{get typeName(){return V.NullClass}static[Symbol.hasInstance](e){return e.typeName===V.NullClass}accept(e,r){return e.visitNull(this,r)}covariant(e){if(e===null)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(){return new Uint8Array(0)}encodeType(){return ce(z.Null)}decodeValue(e,r){return this.checkType(r),null}get name(){return"null"}},pt=class extends De{get typeName(){return V.ReservedClass}static[Symbol.hasInstance](e){return e.typeName===V.ReservedClass}accept(e,r){return e.visitReserved(this,r)}covariant(e){return!0}encodeValue(){return new Uint8Array(0)}encodeType(){return ce(z.Reserved)}decodeValue(e,r){return r.name!==this.name&&r.decodeValue(e,r),null}get name(){return"reserved"}},Do=class extends De{get typeName(){return V.TextClass}static[Symbol.hasInstance](e){return e.typeName===V.TextClass}accept(e,r){return e.visitText(this,r)}covariant(e){if(typeof e=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=new TextEncoder().encode(e),n=Q(r.byteLength);return Z(n,r)}encodeType(){return ce(z.Text)}decodeValue(e,r){this.checkType(r);let n=ae(e),o=Wt(e,Number(n));return new TextDecoder("utf8",{fatal:!0}).decode(o)}get name(){return"text"}valueToString(e){return'"'+e+'"'}},In=class extends De{get typeName(){return V.IntClass}static[Symbol.hasInstance](e){return e.typeName===V.IntClass}accept(e,r){return e.visitInt(this,r)}covariant(e){if(typeof e=="bigint"||Number.isInteger(e))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return ce(e)}encodeType(){return ce(z.Int)}decodeValue(e,r){return this.checkType(r),vt(e)}get name(){return"int"}valueToString(e){return e.toString()}},Bn=class extends De{get typeName(){return V.NatClass}static[Symbol.hasInstance](e){return e.typeName===V.NatClass}accept(e,r){return e.visitNat(this,r)}covariant(e){if(typeof e=="bigint"&&e>=BigInt(0)||Number.isInteger(e)&&e>=0)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return Q(e)}encodeType(){return ce(z.Nat)}decodeValue(e,r){return this.checkType(r),ae(e)}get name(){return"nat"}valueToString(e){return e.toString()}},Sn=class extends De{get typeName(){return V.FloatClass}static[Symbol.hasInstance](e){return e.typeName===V.FloatClass}constructor(e){if(super(),this._bits=e,e!==32&&e!==64)throw new Error("not a valid float type")}accept(e,r){return e.visitFloat(this,r)}covariant(e){if(typeof e=="number"||e instanceof Number)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=new ArrayBuffer(this._bits/8),n=new DataView(r);return this._bits===32?n.setFloat32(0,e,!0):n.setFloat64(0,e,!0),new Uint8Array(r)}encodeType(){let e=this._bits===32?z.Float32:z.Float64;return ce(e)}decodeValue(e,r){this.checkType(r);let n=Wt(e,this._bits/8),o=_a(n);return this._bits===32?o.getFloat32(0,!0):o.getFloat64(0,!0)}get name(){return"float"+this._bits}valueToString(e){return e.toString()}},Bt=class extends De{get typeName(){return V.FixedIntClass}static[Symbol.hasInstance](e){return e.typeName===V.FixedIntClass}constructor(e){super(),this._bits=e}accept(e,r){return e.visitFixedInt(this,r)}covariant(e){let r=Co(this._bits-1)*BigInt(-1),n=Co(this._bits-1)-BigInt(1),o=!1;if(typeof e=="bigint")o=e>=r&&e<=n;else if(Number.isInteger(e)){let s=BigInt(e);o=s>=r&&s<=n}else o=!1;if(o)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return Cs(e,this._bits/8)}encodeType(){let e=Math.log2(this._bits)-3;return ce(-9-e)}decodeValue(e,r){this.checkType(r);let n=Ia(e,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`int${this._bits}`}valueToString(e){return e.toString()}},lt=class extends De{get typeName(){return V.FixedNatClass}static[Symbol.hasInstance](e){return e.typeName===V.FixedNatClass}constructor(e){super(),this._bits=e}accept(e,r){return e.visitFixedNat(this,r)}covariant(e){let r=Co(this._bits),n=!1;if(typeof e=="bigint"&&e>=BigInt(0)?n=e<r:Number.isInteger(e)&&e>=0?n=BigInt(e)<r:n=!1,n)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return va(e,this._bits/8)}encodeType(){let e=Math.log2(this._bits)-3;return ce(-5-e)}decodeValue(e,r){this.checkType(r);let n=Rs(e,this._bits/8);return this._bits<=32?Number(n):n}get name(){return`nat${this._bits}`}valueToString(e){return e.toString()}},$r=class t extends ht{get typeName(){return V.VecClass}static[Symbol.hasInstance](e){return e.typeName===V.VecClass}constructor(e){super(),this._type=e,this._blobOptimization=!1,e instanceof lt&&e._bits===8&&(this._blobOptimization=!0)}accept(e,r){return e.visitVec(this,this._type,r)}covariant(e){let r=this._type instanceof lt?this._type._bits:this._type instanceof Bt?this._type._bits:0;if(ArrayBuffer.isView(e)&&r==e.BYTES_PER_ELEMENT*8||Array.isArray(e)&&e.every((n,o)=>{try{return this._type.covariant(n)}catch(s){throw new Error(`Invalid ${this.display()} argument: 

index ${o} -> ${s.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=Q(e.length);if(this._blobOptimization)return Z(r,new Uint8Array(e));if(ArrayBuffer.isView(e))if(e instanceof Int16Array||e instanceof Uint16Array){let o=new DataView(new ArrayBuffer(e.length*2));for(let s=0;s<e.length;s++)e instanceof Int16Array?o.setInt16(s*2,e[s],!0):o.setUint16(s*2,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else if(e instanceof Int32Array||e instanceof Uint32Array){let o=new DataView(new ArrayBuffer(e.length*4));for(let s=0;s<e.length;s++)e instanceof Int32Array?o.setInt32(s*4,e[s],!0):o.setUint32(s*4,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else if(e instanceof BigInt64Array||e instanceof BigUint64Array){let o=new DataView(new ArrayBuffer(e.length*8));for(let s=0;s<e.length;s++)e instanceof BigInt64Array?o.setBigInt64(s*8,e[s],!0):o.setBigUint64(s*8,e[s],!0);return Z(r,new Uint8Array(o.buffer))}else return Z(r,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));let n=new Je(new Uint8Array(r.byteLength+e.length),0);n.write(r);for(let o of e){let s=this._type.encodeValue(o);n.write(new Uint8Array(s))}return n.buffer}_buildTypeTableImpl(e){this._type.buildTypeTable(e);let r=ce(z.Vector),n=this._type.encodeType(e);e.add(this,Z(r,n))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a vector type");let o=Number(ae(e));if(this._type instanceof lt){if(this._type._bits==8)return new Uint8Array(e.read(o));if(this._type._bits==16){let i=e.read(o*2);return new Uint16Array(i.buffer,i.byteOffset,o)}if(this._type._bits==32){let i=e.read(o*4);return new Uint32Array(i.buffer,i.byteOffset,o)}if(this._type._bits==64)return new BigUint64Array(e.read(o*8).buffer)}if(this._type instanceof Bt){if(this._type._bits==8)return new Int8Array(e.read(o));if(this._type._bits==16){let i=e.read(o*2),a=new DataView(i.buffer,i.byteOffset,i.byteLength),c=new Int16Array(o);for(let u=0;u<o;u++)c[u]=a.getInt16(u*2,!0);return c}if(this._type._bits==32){let i=e.read(o*4),a=new DataView(i.buffer,i.byteOffset,i.byteLength),c=new Int32Array(o);for(let u=0;u<o;u++)c[u]=a.getInt32(u*4,!0);return c}if(this._type._bits==64){let i=e.read(o*8),a=new DataView(i.buffer,i.byteOffset,i.byteLength),c=new BigInt64Array(o);for(let u=0;u<o;u++)c[u]=a.getBigInt64(u*8,!0);return c}}let s=[];for(let i=0;i<o;i++)s.push(this._type.decodeValue(e,n._type));return s}get name(){return`vec ${this._type.name}`}display(){return`vec ${this._type.display()}`}valueToString(e){return"vec {"+e.map(n=>this._type.valueToString(n)).join("; ")+"}"}},Xt=class t extends ht{get typeName(){return V.OptClass}static[Symbol.hasInstance](e){return e.typeName===V.OptClass}constructor(e){super(),this._type=e}accept(e,r){return e.visitOpt(this,this._type,r)}covariant(e){try{if(Array.isArray(e)&&(e.length===0||e.length===1&&this._type.covariant(e[0])))return!0}catch(r){throw new Error(`Invalid ${this.display()} argument: ${ie(e)} 

-> ${r.message}`)}throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){return e.length===0?new Uint8Array([0]):Z(new Uint8Array([1]),this._type.encodeValue(e[0]))}_buildTypeTableImpl(e){this._type.buildTypeTable(e);let r=ce(z.Opt),n=this._type.encodeType(e);e.add(this,Z(r,n))}decodeValue(e,r){if(r instanceof mr)return[];if(r instanceof pt)return[];let n=r;if(r instanceof Ve){let o=r.getType();if(typeof o>"u")throw new Error("type mismatch with uninitialized type");n=o}if(n instanceof t)switch(zt(e)){case 0:return[];case 1:{let o=e.save();try{return[this._type.decodeValue(e,n._type)]}catch{return e.restore(o),n._type.decodeValue(e,n._type),[]}}default:throw new Error("Not an option value")}else{if(this._type instanceof mr||this._type instanceof t||this._type instanceof pt)return n.decodeValue(e,n),[];{let o=e.save();try{return[this._type.decodeValue(e,r)]}catch{return e.restore(o),n.decodeValue(e,r),[]}}}}get name(){return`opt ${this._type.name}`}display(){return`opt ${this._type.display()}`}valueToString(e){return e.length===0?"null":`opt ${this._type.valueToString(e[0])}`}},yr=class t extends ht{get typeName(){return V.RecordClass}static[Symbol.hasInstance](e){return e.typeName===V.RecordClass||e.typeName===V.TupleClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((r,n)=>Oe(r[0])-Oe(n[0]))}accept(e,r){return e.visitRecord(this,this._fields,r)}tryAsTuple(){let e=[];for(let r=0;r<this._fields.length;r++){let[n,o]=this._fields[r];if(n!==`_${r}_`)return null;e.push(o)}return e}covariant(e){if(typeof e=="object"&&this._fields.every(([r,n])=>{if(!e.hasOwnProperty(r))throw new Error(`Record is missing key "${r}".`);try{return n.covariant(e[r])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

field ${r} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=this._fields.map(([o])=>e[o]),n=En(this._fields,r,([,o],s)=>o.encodeValue(s));return Z(...n)}_buildTypeTableImpl(e){this._fields.forEach(([s,i])=>i.buildTypeTable(e));let r=ce(z.Record),n=Q(this._fields.length),o=this._fields.map(([s,i])=>Z(Q(Oe(s)),i.encodeType(e)));e.add(this,Z(r,n,Z(...o)))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a record type");let o={},s=0,i=0;for(;i<n._fields.length;){let[a,c]=n._fields[i];if(s>=this._fields.length){c.decodeValue(e,c),i++;continue}let[u,l]=this._fields[s],d=Oe(this._fields[s][0]),f=Oe(a);if(d===f)o[u]=l.decodeValue(e,c),s++,i++;else if(f>d)if(l instanceof Xt||l instanceof pt)o[u]=[],s++;else throw new Error("Cannot find required field "+u);else c.decodeValue(e,c),i++}for(let[a,c]of this._fields.slice(s))if(c instanceof Xt||c instanceof pt)o[a]=[];else throw new Error("Cannot find required field "+a);return o}get fieldsAsObject(){let e={};for(let[r,n]of this._fields)e[Oe(r)]=n;return e}get name(){return`record {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`record {${this._fields.map(([r,n])=>r+":"+n.display()).join("; ")}}`}valueToString(e){let r=this._fields.map(([o])=>e[o]);return`record {${En(this._fields,r,([o,s],i)=>o+"="+s.valueToString(i)).join("; ")}}`}},ko=class t extends yr{get typeName(){return V.TupleClass}static[Symbol.hasInstance](e){return e.typeName===V.TupleClass}constructor(e){let r={};e.forEach((n,o)=>r["_"+o+"_"]=n),super(r),this._components=e}accept(e,r){return e.visitTuple(this,this._components,r)}covariant(e){if(Array.isArray(e)&&e.length>=this._fields.length&&this._components.every((r,n)=>{try{return r.covariant(e[n])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

index ${n} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=En(this._components,e,(n,o)=>n.encodeValue(o));return Z(...r)}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("not a tuple type");if(n._components.length<this._components.length)throw new Error("tuple mismatch");let o=[];for(let[s,i]of n._components.entries())s>=this._components.length?i.decodeValue(e,i):o.push(this._components[s].decodeValue(e,i));return o}display(){return`record {${this._components.map(r=>r.display()).join("; ")}}`}valueToString(e){return`record {${En(this._components,e,(n,o)=>n.valueToString(o)).join("; ")}}`}},Vr=class t extends ht{get typeName(){return V.VariantClass}static[Symbol.hasInstance](e){return e.typeName===V.VariantClass}constructor(e={}){super(),this._fields=Object.entries(e).sort((r,n)=>Oe(r[0])-Oe(n[0]))}accept(e,r){return e.visitVariant(this,this._fields,r)}covariant(e){if(typeof e=="object"&&Object.entries(e).length===1&&this._fields.every(([r,n])=>{try{return!e.hasOwnProperty(r)||n.covariant(e[r])}catch(o){throw new Error(`Invalid ${this.display()} argument: 

variant ${r} -> ${o.message}`)}}))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){for(let r=0;r<this._fields.length;r++){let[n,o]=this._fields[r];if(e.hasOwnProperty(n)){let s=Q(r),i=o.encodeValue(e[n]);return Z(s,i)}}throw Error("Variant has no data: "+e)}_buildTypeTableImpl(e){this._fields.forEach(([,s])=>{s.buildTypeTable(e)});let r=ce(z.Variant),n=Q(this._fields.length),o=this._fields.map(([s,i])=>Z(Q(Oe(s)),i.encodeType(e)));e.add(this,Z(r,n,...o))}decodeValue(e,r){let n=this.checkType(r);if(!(n instanceof t))throw new Error("Not a variant type");let o=Number(ae(e));if(o>=n._fields.length)throw Error("Invalid variant index: "+o);let[s,i]=n._fields[o];for(let[a,c]of this._fields)if(Oe(s)===Oe(a)){let u=c.decodeValue(e,i);return{[a]:u}}throw new Error("Cannot find field hash "+s)}get name(){return`variant {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}display(){return`variant {${this._fields.map(([r,n])=>r+(n.name==="null"?"":`:${n.display()}`)).join("; ")}}`}valueToString(e){for(let[r,n]of this._fields)if(e.hasOwnProperty(r)){let o=n.valueToString(e[r]);return o==="null"?`variant {${r}}`:`variant {${r}=${o}}`}throw new Error("Variant has no data: "+e)}get alternativesAsObject(){let e={};for(let[r,n]of this._fields)e[Oe(r)]=n;return e}},Ve=class t extends ht{constructor(){super(...arguments),this._id=t._counter++}get typeName(){return V.RecClass}static{this._counter=0}static[Symbol.hasInstance](e){return e.typeName===V.RecClass}accept(e,r){if(!this._type)throw Error("Recursive type uninitialized.");return e.visitRec(this,this._type,r)}fill(e){this._type=e}getType(){return this._type}covariant(e){if(this._type&&this._type.covariant(e))return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.encodeValue(e)}_buildTypeTableImpl(e){if(!this._type)throw Error("Recursive type uninitialized.");e.add(this,new Uint8Array([])),this._type.buildTypeTable(e),e.merge(this,this._type.name)}decodeValue(e,r){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.decodeValue(e,r)}get name(){return`rec_${this._id}`}display(){if(!this._type)throw Error("Recursive type uninitialized.");return`\u03BC${this.name}.${this._type.name}`}valueToString(e){if(!this._type)throw Error("Recursive type uninitialized.");return this._type.valueToString(e)}};function ks(t){if(zt(t)!==1)throw new Error("Cannot decode principal");let r=Number(ae(t));return L.fromUint8Array(new Uint8Array(Wt(t,r)))}var Mo=class extends De{get typeName(){return V.PrincipalClass}static[Symbol.hasInstance](e){return e.typeName===V.PrincipalClass}accept(e,r){return e.visitPrincipal(this,r)}covariant(e){if(e&&e._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=e.toUint8Array(),n=Q(r.byteLength);return Z(new Uint8Array([1]),n,r)}encodeType(){return ce(z.Principal)}decodeValue(e,r){return this.checkType(r),ks(e)}get name(){return"principal"}valueToString(e){return`${this.name} "${e.toText()}"`}},br=class extends ht{get typeName(){return V.FuncClass}static[Symbol.hasInstance](e){return e.typeName===V.FuncClass}static argsToString(e,r){if(e.length!==r.length)throw new Error("arity mismatch");return"("+e.map((n,o)=>n.valueToString(r[o])).join(", ")+")"}constructor(e,r,n=[]){super(),this.argTypes=e,this.retTypes=r,this.annotations=n}accept(e,r){return e.visitFunc(this,r)}covariant(e){if(Array.isArray(e)&&e.length===2&&e[0]&&e[0]._isPrincipal&&typeof e[1]=="string")return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue([e,r]){let n=e.toUint8Array(),o=Q(n.byteLength),s=Z(new Uint8Array([1]),o,n),i=new TextEncoder().encode(r),a=Q(i.byteLength);return Z(new Uint8Array([1]),s,a,i)}_buildTypeTableImpl(e){this.argTypes.forEach(u=>u.buildTypeTable(e)),this.retTypes.forEach(u=>u.buildTypeTable(e));let r=ce(z.Func),n=Q(this.argTypes.length),o=Z(...this.argTypes.map(u=>u.encodeType(e))),s=Q(this.retTypes.length),i=Z(...this.retTypes.map(u=>u.encodeType(e))),a=Q(this.annotations.length),c=Z(...this.annotations.map(u=>this.encodeAnnotation(u)));e.add(this,Z(r,n,o,s,i,a,c))}decodeValue(e,r){let n=r instanceof Ve?r.getType()??r:r;if(!Ms(n,this))throw new Error(`Cannot decode function reference at type ${this.display()} from wire type ${n.display()}`);if(zt(e)!==1)throw new Error("Cannot decode function reference");let s=ks(e),i=Number(ae(e)),a=Wt(e,i),u=new TextDecoder("utf8",{fatal:!0}).decode(a);return[s,u]}get name(){let e=this.argTypes.map(o=>o.name).join(", "),r=this.retTypes.map(o=>o.name).join(", "),n=" "+this.annotations.join(" ");return`(${e}) -> (${r})${n}`}valueToString([e,r]){return`func "${e.toText()}".${r}`}display(){let e=this.argTypes.map(o=>o.display()).join(", "),r=this.retTypes.map(o=>o.display()).join(", "),n=" "+this.annotations.join(" ");return`(${e}) \u2192 (${r})${n}`}encodeAnnotation(e){if(e==="query")return new Uint8Array([1]);if(e==="oneway")return new Uint8Array([2]);if(e==="composite_query")return new Uint8Array([3]);throw new Error("Illegal function annotation")}},jr=class extends ht{get typeName(){return V.ServiceClass}static[Symbol.hasInstance](e){return e.typeName===V.ServiceClass}constructor(e){super(),this._fields=Object.entries(e).sort((r,n)=>r[0]<n[0]?-1:r[0]>n[0]?1:0)}accept(e,r){return e.visitService(this,r)}covariant(e){if(e&&e._isPrincipal)return!0;throw new Error(`Invalid ${this.display()} argument: ${ie(e)}`)}encodeValue(e){let r=e.toUint8Array(),n=Q(r.length);return Z(new Uint8Array([1]),n,r)}_buildTypeTableImpl(e){this._fields.forEach(([s,i])=>i.buildTypeTable(e));let r=ce(z.Service),n=Q(this._fields.length),o=this._fields.map(([s,i])=>{let a=new TextEncoder().encode(s),c=Q(a.length);return Z(c,a,i.encodeType(e))});e.add(this,Z(r,n,...o))}decodeValue(e,r){let n=r instanceof Ve?r.getType()??r:r;if(!Ms(n,this))throw new Error(`Cannot decode service reference at type ${this.display()} from wire type ${n.display()}`);return ks(e)}get name(){return`service {${this._fields.map(([r,n])=>r+":"+n.name).join("; ")}}`}valueToString(e){return`service "${e.toText()}"`}fieldsAsObject(){let e={};for(let[r,n]of this._fields)e[r]=n;return e}};function ie(t){let e=JSON.stringify(t,(r,n)=>typeof n=="bigint"?`BigInt(${n})`:n);return e&&e.length>Ba?e.substring(0,Ba-3)+"...":e}function Mf(t,e){if(e.length<t.length)throw Error("Wrong number of message arguments");let r=new Ps;t.forEach(c=>c.buildTypeTable(r));let n=new TextEncoder().encode(Ro),o=r.encode(),s=Q(e.length),i=Z(...t.map(c=>c.encodeType(r))),a=Z(...En(t,e,(c,u)=>{try{c.covariant(u)}catch(l){throw new Error(l.message+`

`)}return c.encodeValue(u)}));return Z(n,o,s,i,a)}function Lf(t,e){let r=new Je(e);if(e.byteLength<Ro.length)throw new Error("Message length smaller than magic number");let n=Wt(r,Ro.length),o=new TextDecoder().decode(n);if(o!==Ro)throw new Error("Wrong magic number: "+JSON.stringify(o));function s(f){let h=[],p=Number(ae(f));for(let y=0;y<p;y++){let w=Number(vt(f));switch(w){case z.Opt:case z.Vector:{let b=Number(vt(f));h.push([w,b]);break}case z.Record:case z.Variant:{let b=[],E=Number(ae(f)),I;for(;E--;){let S=Number(ae(f));if(S>=Math.pow(2,32))throw new Error("field id out of 32-bit range");if(typeof I=="number"&&I>=S)throw new Error("field id collision or not sorted");I=S;let B=Number(vt(f));b.push([S,B])}h.push([w,b]);break}case z.Func:{let b=[],E=Number(ae(f));for(;E--;)b.push(Number(vt(f)));let I=[],S=Number(ae(f));for(;S--;)I.push(Number(vt(f)));let B=[],A=Number(ae(f));for(;A--;)switch(Number(ae(f))){case 1:{B.push("query");break}case 2:{B.push("oneway");break}case 3:{B.push("composite_query");break}default:throw new Error("unknown annotation")}h.push([w,[b,I,B]]);break}case z.Service:{let b=Number(ae(f)),E=[];for(;b--;){let I=Number(ae(f)),S=new TextDecoder().decode(Wt(f,I)),B=vt(f);E.push([S,B])}h.push([w,E]);break}default:throw new Error("Illegal op_code: "+w)}}let m=[],g=Number(ae(f));for(let y=0;y<g;y++)m.push(Number(vt(f)));return[h,m]}let[i,a]=s(r);if(a.length<t.length)throw new Error("Wrong number of return values");let c=i.map(f=>za());function u(f){if(f<-24)throw new Error("future value not supported");if(f<0)switch(f){case-1:return Oa;case-2:return Aa;case-3:return Na;case-4:return Ra;case-5:return qa;case-6:return Fa;case-7:return $a;case-8:return Va;case-9:return Da;case-10:return ka;case-11:return Ma;case-12:return La;case-13:return Pa;case-14:return Ua;case-15:return Ca;case-16:return Ta;case-17:return Sa;case-24:return ja;default:throw new Error("Illegal op_code: "+f)}if(f>=i.length)throw new Error("type index out of range");return c[f]}function l(f){switch(f[0]){case z.Vector:{let h=u(f[1]);return Ha(h)}case z.Opt:{let h=u(f[1]);return Ga(h)}case z.Record:{let h={};for(let[g,y]of f[1]){let w=`_${g}_`;h[w]=u(y)}let p=Za(h),m=p.tryAsTuple();return Array.isArray(m)?Ka(...m):p}case z.Variant:{let h={};for(let[p,m]of f[1]){let g=`_${p}_`;h[g]=u(m)}return Ya(h)}case z.Func:{let[h,p,m]=f[1];return Wa(h.map(g=>u(g)),p.map(g=>u(g)),m)}case z.Service:{let h={},p=f[1];for(let[m,g]of p){let y=u(g);if(y instanceof Ve&&(y=y.getType()),!(y instanceof br))throw new Error("Illegal service definition: services can only contain functions");h[m]=y}return Xa(h)}default:throw new Error("Illegal op_code: "+f[0])}}i.forEach((f,h)=>{if(f[0]===z.Func){let p=l(f);c[h].fill(p)}}),i.forEach((f,h)=>{if(f[0]!==z.Func){let p=l(f);c[h].fill(p)}}),Ds();let d=a.map(f=>u(f));try{let f=t.map((h,p)=>h.decodeValue(r,d[p]));for(let h=t.length;h<d.length;h++)d[h].decodeValue(r,d[h]);if(r.byteLength>0)throw new Error("decode: Left-over bytes");return f}finally{Ds()}}var Sa=new vn,Ta=new pt,qf=new Po,Aa=new Uo,Oa=new mr,Ca=new Do,Ra=new In,Na=new Bn,Pa=new Sn(32),Ua=new Sn(64),Da=new Bt(8),ka=new Bt(16),Ma=new Bt(32),La=new Bt(64),qa=new lt(8),Fa=new lt(16),$a=new lt(32),Va=new lt(64),ja=new Mo;function Ka(...t){return new ko(t)}function Ha(t){return new $r(t)}function Ga(t){return new Xt(t)}function Za(t){return new yr(t)}function Ya(t){return new Vr(t)}function za(){return new Ve}function Wa(t,e,r=[]){return new br(t,e,r)}function Xa(t){return new jr(t)}var Lo=class t{constructor(e=new Map){this.rels=e}copy(){let e=new Map;for(let[r,n]of this.rels.entries()){let o=new Map(n);e.set(r,o)}return new t(e)}known(e,r){return this.rels.get(e.name)?.get(r.name)}addNegative(e,r){this.addNames(e.name,r.name,!1)}add(e,r){this.addNames(e.name,r.name,!0)}display(){let e="";for(let[r,n]of this.rels)for(let[o,s]of n)e+=`${r} ${s?":<":"!<:"} ${o}
`;return e}addNames(e,r,n){let o=this.rels.get(e);if(o==null){let s=new Map;s.set(r,n),this.rels.set(e,s)}else o.set(r,n)}},No=new Lo;function Ds(){No=new Lo}function Ff(t,e){let r=new Set(t.annotations),n=new Set(e.annotations);if(r.size!==n.size)return!1;for(let o of r)if(!n.has(o))return!1;return!0}function Ns(t){return t instanceof Xt||t instanceof mr||t instanceof pt}function Ms(t,e){let r=No.copy(),n=It(r,t,e);return n?No.add(t,e):No.addNegative(t,e),n}function It(t,e,r){if(e.name===r.name)return!0;let n=t.known(e,r);if(n!==void 0)return n;if(t.add(e,r),r instanceof pt||e instanceof vn||e instanceof Bn&&r instanceof In)return!0;if(e instanceof $r&&r instanceof $r)return It(t,e._type,r._type);if(r instanceof Xt)return!0;if(e instanceof yr&&r instanceof yr){let o=e.fieldsAsObject;for(let[s,i]of r._fields){let a=o[Oe(s)];if(a){if(!It(t,a,i))return!1}else if(!Ns(i))return!1}return!0}if(e instanceof br&&r instanceof br){if(!Ff(e,r))return!1;for(let o=0;o<e.argTypes.length;o++){let s=e.argTypes[o];if(o<r.argTypes.length){if(!It(t,r.argTypes[o],s))return!1}else if(!Ns(s))return!1}for(let o=0;o<r.retTypes.length;o++){let s=r.retTypes[o];if(o<e.retTypes.length){if(!It(t,e.retTypes[o],s))return!1}else if(!Ns(s))return!1}return!0}if(e instanceof Vr&&r instanceof Vr){let o=r.alternativesAsObject;for(let[s,i]of e._fields){let a=o[Oe(s)];if(!a||!It(t,i,a))return!1}return!0}if(e instanceof jr&&r instanceof jr){let o=e.fieldsAsObject();for(let[s,i]of r._fields){let a=o[s];if(!a||!It(t,a,i))return!1}return!0}return e instanceof Ve?It(t,e.getType(),r):r instanceof Ve?It(t,e,r.getType()):!1}function Kr(t){if(!t)throw new Error("Input cannot be null or undefined");return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):Array.isArray(t)?new Uint8Array(t):"buffer"in t?Kr(t.buffer):new Uint8Array(t)}function wr(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Ls(t){if(typeof t=="string")return Ja(t);if(typeof t=="number")return ve(Q(t));if(t instanceof Uint8Array||ArrayBuffer.isView(t))return ve(Kr(t));if(Array.isArray(t)){let e=t.map(Ls);return ve($(...e))}else{if(t&&typeof t=="object"&&t._isPrincipal)return ve(t.toUint8Array());if(typeof t=="object"&&t!==null&&typeof t.toHash=="function")return Ls(t.toHash());if(typeof t=="object")return Tn(t);if(typeof t=="bigint")return ve(Q(t))}throw G.fromCode(new vo(t))}var Ja=t=>{let e=new TextEncoder().encode(t);return ve(e)};function St(t){return Tn(t)}function Tn(t){let n=Object.entries(t).filter(([,i])=>i!==void 0).map(([i,a])=>{let c=Ja(i),u=Ls(a);return[c,u]}).sort(([i],[a])=>As(i,a)),o=$(...n.map(i=>$(...i)));return ve(o)}var An=new TextEncoder().encode(`
ic-request`),qs=new TextEncoder().encode("\vic-response"),Fs=new TextEncoder().encode("ic-request-auth-delegation");var Jt=class{getPrincipal(){return this._principal||(this._principal=L.selfAuthenticating(new Uint8Array(this.getPublicKey().toDer()))),this._principal}async transformRequest(e){let{body:r,...n}=e,o=St(r);return{...n,body:{content:r,sender_pubkey:this.getPublicKey().toDer(),sender_sig:await this.sign($(An,o))}}}},Qt=class{getPrincipal(){return L.anonymous()}async transformRequest(e){return{...e,body:{content:e.body}}}};var Tt=class extends Error{constructor(e){super(e),this.name="DecodingError"}},ec=55799,tc=Symbol("CBOR_STOP_CODE"),tt=(t=>(t[t.False=20]="False",t[t.True=21]="True",t[t.Null=22]="Null",t[t.Undefined=23]="Undefined",t[t.Break=31]="Break",t))(tt||{}),le=(t=>(t[t.UnsignedInteger=0]="UnsignedInteger",t[t.NegativeInteger=1]="NegativeInteger",t[t.ByteString=2]="ByteString",t[t.TextString=3]="TextString",t[t.Array=4]="Array",t[t.Map=5]="Map",t[t.Tag=6]="Tag",t[t.Simple=7]="Simple",t))(le||{}),$f=23,Vf=255,jf=65535,Kf=4294967295,Hf=BigInt("0xffffffffffffffff"),et=(t=>(t[t.Value=23]="Value",t[t.OneByte=24]="OneByte",t[t.TwoBytes=25]="TwoBytes",t[t.FourBytes=26]="FourBytes",t[t.EightBytes=27]="EightBytes",t[t.Indefinite=31]="Indefinite",t))(et||{}),Hr=!1;function Gf(t){return t==null}function rc(t,e){let r=new Uint8Array(e);return r.set(t),r}var Zf=new TextDecoder;function Yf(t){return(t&224)>>5}function zf(t){return t&31}var Rn=new Uint8Array,On,rt=0;function nc(t,e){Rn=t,rt=0;let r=xr(e);return e?.(r)??r}function xr(t){let[e,r]=qo();switch(e){case le.UnsignedInteger:return Gr(r);case le.NegativeInteger:return Qf(r);case le.ByteString:return oc(r);case le.TextString:return Vs(r);case le.Array:return Wf(r,t);case le.Map:return Jf(r,t);case le.Tag:return eu(r,t);case le.Simple:return Xf(r)}throw new Tt(`Unsupported major type: ${e}`)}function qo(){let t=Rn.at(rt);if(Gf(t))throw new Tt("Provided CBOR data is empty");let e=Yf(t),r=zf(t);return rt++,[e,r]}function Wf(t,e){let r=Gr(t);if(r===1/0){let o=[],s=xr(e);for(;s!==tc;)o.push(e?.(s)??s),s=xr(e);return o}let n=new Array(r);for(let o=0;o<r;o++){let s=xr(e);n[o]=e?.(s)??s}return n}function Xf(t){switch(t){case tt.False:return!1;case tt.True:return!0;case tt.Null:return null;case tt.Undefined:return;case tt.Break:return tc}throw new Tt(`Unrecognized simple type: ${t.toString(2)}`)}function Jf(t,e){let r=Gr(t),n={};if(r===1/0){let[o,s]=qo();for(;o!==le.Simple&&s!==tt.Break;){let i=Vs(s),a=xr(e);n[i]=e?.(a,i)??a,[o,s]=qo()}return n}for(let o=0;o<r;o++){let[s,i]=qo();if(s!==le.TextString)throw new Tt("Map keys must be text strings");let a=Vs(i),c=xr(e);n[a]=e?.(c,a)??c}return n}function Gr(t){if(t<=et.Value)return t;switch(On=new DataView(Rn.buffer,Rn.byteOffset+rt),t){case et.OneByte:return rt++,On.getUint8(0);case et.TwoBytes:return rt+=2,On.getUint16(0,Hr);case et.FourBytes:return rt+=4,On.getUint32(0,Hr);case et.EightBytes:return rt+=8,On.getBigUint64(0,Hr);case et.Indefinite:return 1/0;default:throw new Tt(`Unsupported integer info: ${t.toString(2)}`)}}function Qf(t){let e=Gr(t);return typeof e=="number"?-1-e:-1n-e}function oc(t){let e=Gr(t);if(e>Number.MAX_SAFE_INTEGER)throw new Tt("Byte length is too large");let r=Number(e);return rt+=r,Rn.slice(rt-r,rt)}function Vs(t){let e=oc(t);return Zf.decode(e)}function eu(t,e){let r=Gr(t);if(r===ec)return xr(e);throw new Tt(`Unsupported tag: ${r}.`)}var Nn=class extends Error{constructor(e){super(e),this.name="SerializationError"}},tu=2*1024,ru=100,nu=new TextEncoder;function Cn(t){return t<<5}var qe=new Uint8Array(tu),Qe=new DataView(qe.buffer),de=0,$s=[];function sc(t,e){de=0;let r=e?.(t)??t;return du(ec,r,e),qe.slice(0,de)}function js(t,e){if(de>qe.length-ru&&(qe=rc(qe,qe.length*2),Qe=new DataView(qe.buffer)),t===!1||t===!0||t===null||t===void 0){iu(t);return}if(typeof t=="number"||typeof t=="bigint"){uu(t);return}if(typeof t=="string"){cc(t);return}if(t instanceof Uint8Array){Qa(t);return}if(t instanceof ArrayBuffer){Qa(new Uint8Array(t));return}if(Array.isArray(t)){ou(t,e);return}if(typeof t=="object"){su(t,e);return}throw new Nn(`Unsupported type: ${typeof t}`)}function ou(t,e){Zr(le.Array,t.length),t.forEach((r,n)=>{js(e?.(r,n.toString())??r,e)})}function su(t,e){$s=Object.entries(t),Zr(le.Map,$s.length),$s.forEach(([r,n])=>{cc(r),js(e?.(n,r)??n,e)})}function Zr(t,e){if(e<=$f){Qe.setUint8(de++,Cn(t)|Number(e));return}if(e<=Vf){Qe.setUint8(de++,Cn(t)|et.OneByte),Qe.setUint8(de,Number(e)),de+=1;return}if(e<=jf){Qe.setUint8(de++,Cn(t)|et.TwoBytes),Qe.setUint16(de,Number(e),Hr),de+=2;return}if(e<=Kf){Qe.setUint8(de++,Cn(t)|et.FourBytes),Qe.setUint32(de,Number(e),Hr),de+=4;return}if(e<=Hf){Qe.setUint8(de++,Cn(t)|et.EightBytes),Qe.setBigUint64(de,BigInt(e),Hr),de+=8;return}throw new Nn(`Value too large to encode: ${e}`)}function iu(t){Zr(le.Simple,au(t))}function au(t){if(t===!1)return tt.False;if(t===!0)return tt.True;if(t===null)return tt.Null;if(t===void 0)return tt.Undefined;throw new Nn(`Unrecognized simple value: ${t.toString()}`)}function ic(t,e){Zr(t,e.length),de>qe.length-e.length&&(qe=rc(qe,qe.length+e.length),Qe=new DataView(qe.buffer)),qe.set(e,de),de+=e.length}function ac(t,e){Zr(t,e)}function cu(t){ac(le.UnsignedInteger,t)}function fu(t){ac(le.NegativeInteger,typeof t=="bigint"?-1n-t:-1-t)}function uu(t){t>=0?cu(t):fu(t)}function cc(t){ic(le.TextString,nu.encode(t))}function Qa(t){ic(le.ByteString,t)}function du(t,e,r){Zr(le.Tag,t),js(e,r)}function hu(t){return typeof t=="object"&&t!==null&&"toCborValue"in t}function Fo(t){try{return sc(t,e=>L.isPrincipal(e)?e.toUint8Array():Yr.isExpiry(e)?e.toBigInt():hu(e)?e.toCborValue():e)}catch(e){throw G.fromCode(new go(e,t))}}function Fe(t){try{return nc(t)}catch(e){throw G.fromCode(new bo(e,t))}}var Pn=()=>{if(typeof window<"u"&&window.crypto&&window.crypto.getRandomValues){let t=new Uint32Array(1);return window.crypto.getRandomValues(t),t[0]}if(typeof crypto<"u"&&crypto.getRandomValues){let t=new Uint32Array(1);return crypto.getRandomValues(t),t[0]}return typeof crypto<"u"&&crypto.randomInt?crypto.randomInt(0,4294967295):Math.floor(Math.random()*4294967295)};var At;(function(t){t.Query="read",t.ReadState="read_state",t.Call="call"})(At||(At={}));var $o;(function(t){t.Call="call"})($o||($o={}));var _r;(function(t){t.Query="query",t.ReadState="read_state"})(_r||(_r={}));function Un(){let t=new ArrayBuffer(16),e=new DataView(t),r=Pn(),n=Pn(),o=Pn(),s=Pn();return e.setUint32(0,r),e.setUint32(4,n),e.setUint32(8,o),e.setUint32(12,s),Object.assign(new Uint8Array(t),{__nonce__:void 0})}var Vo="__expiry__",Hs=BigInt(1e3),pu=BigInt(1e6),fc=BigInt(60),mu=BigInt(90)*Hs;function uc(t){return t/Hs}function yu(t){return uc(t)/fc}var Yr=class t{constructor(e){this.__expiry__=e,this._isExpiry=!0}static fromDeltaInMilliseconds(e,r=0){let n=BigInt(e),o=BigInt(Date.now())+n+BigInt(r),s;return n<mu?s=uc(o):s=yu(o)*fc,new t(s*Hs*pu)}toBigInt(){return this.__expiry__}toHash(){return Q(this.__expiry__)}toString(){return this.__expiry__.toString()}toJSON(){return{[Vo]:this.toString()}}static fromJSON(e){let r=JSON.parse(e);if(r[Vo])try{let n=BigInt(r[Vo]);return new t(n)}catch(n){throw new G(new xn(`Not a valid BigInt: ${n}`))}throw new G(new xn(`The input does not contain the key ${Vo}`))}static isExpiry(e){return e instanceof t||typeof e=="object"&&e!==null&&"_isExpiry"in e&&e._isExpiry===!0&&"__expiry__"in e&&typeof e.__expiry__=="bigint"}};function Gs(t=Un){return async e=>{let r=e.request.headers;e.request.headers=r,e.endpoint===At.Call&&(e.body.nonce=t())}}function jo(t){let e=[];return t.forEach((r,n)=>{e.push([n,r])}),e}var Ys=BigInt(0),Ko=BigInt(1);function Er(t,e=""){if(typeof t!="boolean"){let r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function er(t,e,r=""){let n=ct(t),o=t?.length,s=e!==void 0;if(!n||s&&o!==e){let i=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${o}`:`type=${typeof t}`;throw new Error(i+"expected Uint8Array"+a+", got "+c)}return t}function dc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ys:BigInt("0x"+t)}function ke(t){return dc(F(t))}function Ot(t){return se(t),dc(F(Uint8Array.from(t).reverse()))}function he(t,e){return pe(t.toString(16).padStart(e*2,"0"))}function zs(t,e){return he(t,e).reverse()}function oe(t,e,r){let n;if(typeof e=="string")try{n=pe(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ct(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(t+" of length "+r+" expected, got "+o);return n}function lc(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}function Ws(t){return Uint8Array.from(t)}var Zs=t=>typeof t=="bigint"&&Ys<=t;function Xs(t,e,r){return Zs(t)&&Zs(e)&&Zs(r)&&e<=t&&t<r}function Ho(t,e,r,n){if(!Xs(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Ct(t){let e;for(e=0;t>Ys;t>>=Ko,e+=1);return e}function hc(t,e){return t>>BigInt(e)&Ko}var nt=t=>(Ko<<BigInt(t))-Ko;function pc(t){return typeof t=="function"&&Number.isSafeInteger(t.outputLen)}function Rt(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(o,s,i){let a=t[o];if(i&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}var zr=()=>{throw new Error("not implemented")};function tr(t){let e=new WeakMap;return(r,...n)=>{let o=e.get(r);if(o!==void 0)return o;let s=t(r,...n);return e.set(r,s),s}}var Ce=BigInt(0),ye=BigInt(1),vr=BigInt(2),yc=BigInt(3),bc=BigInt(4),gc=BigInt(5),bu=BigInt(7),wc=BigInt(8),gu=BigInt(9),xc=BigInt(16);function ee(t,e){let r=t%e;return r>=Ce?r:e+r}function ot(t,e,r){let n=t;for(;e-- >Ce;)n*=n,n%=r;return n}function mc(t,e){if(t===Ce)throw new Error("invert: expected non-zero number");if(e<=Ce)throw new Error("invert: expected positive modulus, got "+e);let r=ee(t,e),n=e,o=Ce,s=ye,i=ye,a=Ce;for(;r!==Ce;){let u=n/r,l=n%r,d=o-i*u,f=s-a*u;n=r,r=l,o=i,s=a,i=d,a=f}if(n!==ye)throw new Error("invert: does not exist");return ee(o,e)}function Js(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function _c(t,e){let r=(t.ORDER+ye)/bc,n=t.pow(e,r);return Js(t,n,e),n}function wu(t,e){let r=(t.ORDER-gc)/wc,n=t.mul(e,vr),o=t.pow(n,r),s=t.mul(e,o),i=t.mul(t.mul(s,vr),o),a=t.mul(s,t.sub(i,t.ONE));return Js(t,a,e),a}function xu(t){let e=Re(t),r=Ec(t),n=r(e,e.neg(e.ONE)),o=r(e,n),s=r(e,e.neg(n)),i=(t+bu)/xc;return(a,c)=>{let u=a.pow(c,i),l=a.mul(u,n),d=a.mul(u,o),f=a.mul(u,s),h=a.eql(a.sqr(l),c),p=a.eql(a.sqr(d),c);u=a.cmov(u,l,h),l=a.cmov(f,d,p);let m=a.eql(a.sqr(l),c),g=a.cmov(u,l,m);return Js(a,g,c),g}}function Ec(t){if(t<yc)throw new Error("sqrt is not defined for small field");let e=t-ye,r=0;for(;e%vr===Ce;)e/=vr,r++;let n=vr,o=Re(t);for(;Dn(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return _c;let s=o.pow(n,e),i=(e+ye)/vr;return function(c,u){if(c.is0(u))return u;if(Dn(c,u)!==1)throw new Error("Cannot find square root");let l=r,d=c.mul(c.ONE,s),f=c.pow(u,e),h=c.pow(u,i);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let p=1,m=c.sqr(f);for(;!c.eql(m,c.ONE);)if(p++,m=c.sqr(m),p===l)throw new Error("Cannot find square root");let g=ye<<BigInt(l-p-1),y=c.pow(d,g);l=p,d=c.sqr(y),f=c.mul(f,d),h=c.mul(h,y)}return h}}function _u(t){return t%bc===yc?_c:t%wc===gc?wu:t%xc===gu?xu(t):Ec(t)}var Nt=(t,e)=>(ee(t,e)&ye)===ye,Eu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Go(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Eu.reduce((n,o)=>(n[o]="function",n),e);return Rt(t,r),t}function kn(t,e,r){if(r<Ce)throw new Error("invalid exponent, negatives unsupported");if(r===Ce)return t.ONE;if(r===ye)return e;let n=t.ONE,o=e;for(;r>Ce;)r&ye&&(n=t.mul(n,o)),o=t.sqr(o),r>>=ye;return n}function je(t,e,r=!1){let n=new Array(e.length).fill(r?t.ZERO:void 0),o=e.reduce((i,a,c)=>t.is0(a)?i:(n[c]=i,t.mul(i,a)),t.ONE),s=t.inv(o);return e.reduceRight((i,a,c)=>t.is0(a)?i:(n[c]=t.mul(i,n[c]),t.mul(i,a)),s),n}function Dn(t,e){let r=(t.ORDER-ye)/vr,n=t.pow(e,r),o=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),i=t.eql(n,t.neg(t.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Qs(t,e){e!==void 0&&_s(e);let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Re(t,e,r=!1,n={}){if(t<=Ce)throw new Error("invalid field: expected ORDER > 0, got "+t);let o,s,i=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=e;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(i=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(o=e),n.sqrt&&(s=n.sqrt);let{nBitLength:c,nByteLength:u}=Qs(t,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l,d=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:u,MASK:nt(c),ZERO:Ce,ONE:ye,allowedLengths:a,create:f=>ee(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ce<=f&&f<t},is0:f=>f===Ce,isValidNot0:f=>!d.is0(f)&&d.isValid(f),isOdd:f=>(f&ye)===ye,neg:f=>ee(-f,t),eql:(f,h)=>f===h,sqr:f=>ee(f*f,t),add:(f,h)=>ee(f+h,t),sub:(f,h)=>ee(f-h,t),mul:(f,h)=>ee(f*h,t),pow:(f,h)=>kn(d,f,h),div:(f,h)=>ee(f*mc(h,t),t),sqrN:f=>f*f,addN:(f,h)=>f+h,subN:(f,h)=>f-h,mulN:(f,h)=>f*h,inv:f=>mc(f,t),sqrt:s||(f=>(l||(l=_u(t)),l(d,f))),toBytes:f=>r?zs(f,u):he(f,u),fromBytes:(f,h=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);let m=new Uint8Array(u);m.set(f,r?0:m.length-f.length),f=m}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let p=r?Ot(f):ke(f);if(i&&(p=ee(p,t)),!h&&!d.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>je(d,f),cmov:(f,h,p)=>p?h:f});return Object.freeze(d)}function vc(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function Zo(t){let e=vc(t);return e+Math.ceil(e/2)}function ei(t,e,r=!1){let n=t.length,o=vc(e),s=Zo(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?Ot(t):ke(t),a=ee(i,e-ye)+ye;return r?zs(a,o):he(a,o)}var Wr=BigInt(0),Ir=BigInt(1);function Mn(t,e){let r=e.negate();return t?r:e}function Ke(t,e){let r=je(t.Fp,e.map(n=>n.Z));return e.map((n,o)=>t.fromAffine(n.toAffine(r[o])))}function Tc(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ti(t,e){Tc(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1),o=2**t,s=nt(t),i=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function Ic(t,e,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,a=Number(t&o),c=t>>i;a>n&&(a-=s,c+=Ir);let u=e*n,l=u+Math.abs(a)-1,d=a===0,f=a<0,h=e%2!==0;return{nextN:c,offset:l,isZero:d,isNeg:f,isNegF:h,offsetF:u}}function Iu(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Bu(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}var ri=new WeakMap,Ac=new WeakMap;function ni(t){return Ac.get(t)||1}function Bc(t){if(t!==Wr)throw new Error("invalid wNAF")}var Xr=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let o=e;for(;r>Wr;)r&Ir&&(n=n.add(o)),o=o.double(),r>>=Ir;return n}precomputeWindow(e,r){let{windows:n,windowSize:o}=ti(r,this.bits),s=[],i=e,a=i;for(let c=0;c<n;c++){a=i,s.push(a);for(let u=1;u<o;u++)a=a.add(i),s.push(a);i=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=ti(e,this.bits);for(let a=0;a<i.windows;a++){let{nextN:c,offset:u,isZero:l,isNeg:d,isNegF:f,offsetF:h}=Ic(n,a,i);n=c,l?s=s.add(Mn(f,r[h])):o=o.add(Mn(d,r[u]))}return Bc(n),{p:o,f:s}}wNAFUnsafe(e,r,n,o=this.ZERO){let s=ti(e,this.bits);for(let i=0;i<s.windows&&n!==Wr;i++){let{nextN:a,offset:c,isZero:u,isNeg:l}=Ic(n,i,s);if(n=a,!u){let d=r[c];o=o.add(l?d.negate():d)}}return Bc(n),o}getPrecomputes(e,r,n){let o=ri.get(r);return o||(o=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(o=n(o)),ri.set(r,o))),o}cached(e,r,n){let o=ni(e);return this.wNAF(o,this.getPrecomputes(o,e,n),r)}unsafe(e,r,n,o){let s=ni(e);return s===1?this._unsafeLadder(e,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,o)}createCache(e,r){Tc(r,this.bits),Ac.set(e,r),ri.delete(e)}hasCache(e){return ni(e)!==1}};function Oc(t,e,r,n){let o=e,s=t.ZERO,i=t.ZERO;for(;r>Wr||n>Wr;)r&Ir&&(s=s.add(o)),n&Ir&&(i=i.add(o)),o=o.double(),r>>=Ir,n>>=Ir;return{p1:s,p2:i}}function Jr(t,e,r,n){Iu(r,t),Bu(n,e);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=t.ZERO,a=Ct(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let u=nt(c),l=new Array(Number(u)+1).fill(i),d=Math.floor((e.BITS-1)/c)*c,f=i;for(let h=d;h>=0;h-=c){l.fill(i);for(let m=0;m<s;m++){let g=n[m],y=Number(g>>BigInt(h)&u);l[y]=l[y].add(r[m])}let p=i;for(let m=l.length-1,g=i;m>0;m--)g=g.add(l[m]),p=p.add(g);if(f=f.add(p),h!==0)for(let m=0;m<c;m++)f=f.double()}return f}function Sc(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Go(e),e}else return Re(t,{isLE:r})}function Yo(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let c of["p","n","h"]){let u=e[c];if(!(typeof u=="bigint"&&u>Wr))throw new Error(`CURVE.${c} must be positive bigint`)}let o=Sc(e.p,r.Fp,n),s=Sc(e.n,r.Fn,n),a=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let c of a)if(!o.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:s}}var Su=ke;function rr(t,e){if(Ln(t),Ln(e),t<0||t>=1<<8*e)throw new Error("invalid I2OSP input: "+t);let r=Array.from({length:e}).fill(0);for(let n=e-1;n>=0;n--)r[n]=t&255,t>>>=8;return new Uint8Array(r)}function Tu(t,e){let r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t[n]^e[n];return r}function Ln(t){if(!Number.isSafeInteger(t))throw new Error("number expected")}function Cc(t){if(!ct(t)&&typeof t!="string")throw new Error("DST must be Uint8Array or string");return typeof t=="string"?W(t):t}function Au(t,e,r,n){se(t),Ln(r),e=Cc(e),e.length>255&&(e=n($(W("H2C-OVERSIZE-DST-"),e)));let{outputLen:o,blockLen:s}=n,i=Math.ceil(r/o);if(r>65535||i>255)throw new Error("expand_message_xmd: invalid lenInBytes");let a=$(e,rr(e.length,1)),c=rr(0,s),u=rr(r,2),l=new Array(i),d=n($(c,t,u,rr(0,1),a));l[0]=n($(d,rr(1,1),a));for(let h=1;h<=i;h++){let p=[Tu(d,l[h-1]),rr(h+1,1),a];l[h]=n($(...p))}return $(...l).slice(0,r)}function Ou(t,e,r,n,o){if(se(t),Ln(r),e=Cc(e),e.length>255){let s=Math.ceil(2*n/8);e=o.create({dkLen:s}).update(W("H2C-OVERSIZE-DST-")).update(e).digest()}if(r>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return o.create({dkLen:r}).update(t).update(rr(r,2)).update(e).update(rr(e.length,1)).digest()}function oi(t,e,r){Rt(r,{p:"bigint",m:"number",k:"number",hash:"function"});let{p:n,k:o,m:s,hash:i,expand:a,DST:c}=r;if(!pc(r.hash))throw new Error("expected valid hash");se(t),Ln(e);let u=n.toString(2).length,l=Math.ceil((u+o)/8),d=e*s*l,f;if(a==="xmd")f=Au(t,c,d,i);else if(a==="xof")f=Ou(t,c,d,o,i);else if(a==="_internal_pass")f=t;else throw new Error('expand must be "xmd" or "xof"');let h=new Array(e);for(let p=0;p<e;p++){let m=new Array(s);for(let g=0;g<s;g++){let y=l*(g+p*s),w=f.subarray(y,y+l);m[g]=ee(Su(w),n)}h[p]=m}return h}function si(t,e){let r=e.map(n=>Array.from(n).reverse());return(n,o)=>{let[s,i,a,c]=r.map(d=>d.reduce((f,h)=>t.add(t.mul(f,n),h))),[u,l]=je(t,[i,c],!0);return n=t.mul(s,u),o=t.mul(o,t.mul(a,l)),{x:n,y:o}}}var Cu=W("HashToScalar-");function ii(t,e,r){if(typeof e!="function")throw new Error("mapToCurve() must be defined");function n(s){return t.fromAffine(e(s))}function o(s){let i=s.clearCofactor();return i.equals(t.ZERO)?t.ZERO:(i.assertValidity(),i)}return{defaults:r,hashToCurve(s,i){let a=Object.assign({},r,i),c=oi(s,2,a),u=n(c[0]),l=n(c[1]);return o(u.add(l))},encodeToCurve(s,i){let a=r.encodeDST?{DST:r.encodeDST}:{},c=Object.assign({},r,a,i),u=oi(s,1,c),l=n(u[0]);return o(l)},mapToCurve(s){if(!Array.isArray(s))throw new Error("expected array of bigints");for(let i of s)if(typeof i!="bigint")throw new Error("expected array of bigints");return o(n(s))},hashToScalar(s,i){let a=t.Fn.ORDER,c=Object.assign({},r,{p:a,m:1,DST:Cu},i);return oi(s,1,c)[0][0]}}}var Rc=(t,e)=>(t+(t>=0?e:-e)/Pt)/e;function Ru(t,e,r){let[[n,o],[s,i]]=e,a=Rc(i*t,r),c=Rc(-o*t,r),u=t-a*n-c*s,l=-a*o-c*i,d=u<Br,f=l<Br;d&&(u=-u),f&&(l=-l);let h=nt(Math.ceil(Ct(r)/2))+Ne;if(u<Br||u>=h||l<Br||l>=h)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:d,k1:u,k2neg:f,k2:l}}var Br=BigInt(0),Ne=BigInt(1),Pt=BigInt(2),Qr=BigInt(3),ai=BigInt(4);function qn(t,e){let{BYTES:r}=t,n;if(typeof e=="bigint")n=e;else{let o=oe("private key",e);try{n=t.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function Nu(t,e={}){let r=Yo("weierstrass",t,e),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:a}=s;Rt(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=Du(n,o);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(C,x,v){let{x:R,y:k}=x.toAffine(),j=n.toBytes(R);if(Er(v,"isCompressed"),v){l();let O=!n.isOdd(k);return $(Pu(O),j)}else return $(Uint8Array.of(4),j,n.toBytes(k))}function f(C){er(C,void 0,"Point");let{publicKey:x,publicKeyUncompressed:v}=u,R=C.length,k=C[0],j=C.subarray(1);if(R===x&&(k===2||k===3)){let O=n.fromBytes(j);if(!n.isValid(O))throw new Error("bad point: is not on curve, wrong x");let N=m(O),U;try{U=n.sqrt(N)}catch(xe){let fe=xe instanceof Error?": "+xe.message:"";throw new Error("bad point: is not on curve, sqrt error"+fe)}l();let M=n.isOdd(U);return(k&1)===1!==M&&(U=n.neg(U)),{x:O,y:U}}else if(R===v&&k===4){let O=n.BYTES,N=n.fromBytes(j.subarray(0,O)),U=n.fromBytes(j.subarray(O,O*2));if(!g(N,U))throw new Error("bad point: is not on curve");return{x:N,y:U}}else throw new Error(`bad point: got length ${R}, expected compressed=${x} or uncompressed=${v}`)}let h=e.toBytes||d,p=e.fromBytes||f;function m(C){let x=n.sqr(C),v=n.mul(x,C);return n.add(n.add(v,n.mul(C,s.a)),s.b)}function g(C,x){let v=n.sqr(x),R=m(C);return n.eql(v,R)}if(!g(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let y=n.mul(n.pow(s.a,Qr),ai),w=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(y,w)))throw new Error("bad curve params: a or b");function b(C,x,v=!1){if(!n.isValid(x)||v&&n.is0(x))throw new Error(`bad point coordinate ${C}`);return x}function E(C){if(!(C instanceof _))throw new Error("ProjectivePoint expected")}function I(C){if(!c||!c.basises)throw new Error("no endo");return Ru(C,c.basises,o.ORDER)}let S=tr((C,x)=>{let{X:v,Y:R,Z:k}=C;if(n.eql(k,n.ONE))return{x:v,y:R};let j=C.is0();x==null&&(x=j?n.ONE:n.inv(k));let O=n.mul(v,x),N=n.mul(R,x),U=n.mul(k,x);if(j)return{x:n.ZERO,y:n.ZERO};if(!n.eql(U,n.ONE))throw new Error("invZ was invalid");return{x:O,y:N}}),B=tr(C=>{if(C.is0()){if(e.allowInfinityPoint&&!n.is0(C.Y))return;throw new Error("bad point: ZERO")}let{x,y:v}=C.toAffine();if(!n.isValid(x)||!n.isValid(v))throw new Error("bad point: x or y not field elements");if(!g(x,v))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function A(C,x,v,R,k){return v=new _(n.mul(v.X,C),v.Y,v.Z),x=Mn(R,x),v=Mn(k,v),x.add(v)}class _{constructor(x,v,R){this.X=b("x",x),this.Y=b("y",v,!0),this.Z=b("z",R),Object.freeze(this)}static CURVE(){return s}static fromAffine(x){let{x:v,y:R}=x||{};if(!x||!n.isValid(v)||!n.isValid(R))throw new Error("invalid affine point");if(x instanceof _)throw new Error("projective point not allowed");return n.is0(v)&&n.is0(R)?_.ZERO:new _(v,R,n.ONE)}static fromBytes(x){let v=_.fromAffine(p(er(x,void 0,"point")));return v.assertValidity(),v}static fromHex(x){return _.fromBytes(oe("pointHex",x))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(x=8,v=!0){return P.createCache(this,x),v||this.multiply(Qr),this}assertValidity(){B(this)}hasEvenY(){let{y:x}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(x)}equals(x){E(x);let{X:v,Y:R,Z:k}=this,{X:j,Y:O,Z:N}=x,U=n.eql(n.mul(v,N),n.mul(j,k)),M=n.eql(n.mul(R,N),n.mul(O,k));return U&&M}negate(){return new _(this.X,n.neg(this.Y),this.Z)}double(){let{a:x,b:v}=s,R=n.mul(v,Qr),{X:k,Y:j,Z:O}=this,N=n.ZERO,U=n.ZERO,M=n.ZERO,q=n.mul(k,k),xe=n.mul(j,j),fe=n.mul(O,O),X=n.mul(k,j);return X=n.add(X,X),M=n.mul(k,O),M=n.add(M,M),N=n.mul(x,M),U=n.mul(R,fe),U=n.add(N,U),N=n.sub(xe,U),U=n.add(xe,U),U=n.mul(N,U),N=n.mul(X,N),M=n.mul(R,M),fe=n.mul(x,fe),X=n.sub(q,fe),X=n.mul(x,X),X=n.add(X,M),M=n.add(q,q),q=n.add(M,q),q=n.add(q,fe),q=n.mul(q,X),U=n.add(U,q),fe=n.mul(j,O),fe=n.add(fe,fe),q=n.mul(fe,X),N=n.sub(N,q),M=n.mul(fe,xe),M=n.add(M,M),M=n.add(M,M),new _(N,U,M)}add(x){E(x);let{X:v,Y:R,Z:k}=this,{X:j,Y:O,Z:N}=x,U=n.ZERO,M=n.ZERO,q=n.ZERO,xe=s.a,fe=n.mul(s.b,Qr),X=n.mul(v,j),Ze=n.mul(R,O),Ye=n.mul(k,N),Nr=n.add(v,R),Se=n.add(j,O);Nr=n.mul(Nr,Se),Se=n.add(X,Ze),Nr=n.sub(Nr,Se),Se=n.add(v,k);let at=n.add(j,N);return Se=n.mul(Se,at),at=n.add(X,Ye),Se=n.sub(Se,at),at=n.add(R,k),U=n.add(O,N),at=n.mul(at,U),U=n.add(Ze,Ye),at=n.sub(at,U),q=n.mul(xe,Se),U=n.mul(fe,Ye),q=n.add(U,q),U=n.sub(Ze,q),q=n.add(Ze,q),M=n.mul(U,q),Ze=n.add(X,X),Ze=n.add(Ze,X),Ye=n.mul(xe,Ye),Se=n.mul(fe,Se),Ze=n.add(Ze,Ye),Ye=n.sub(X,Ye),Ye=n.mul(xe,Ye),Se=n.add(Se,Ye),X=n.mul(Ze,Se),M=n.add(M,X),X=n.mul(at,Se),U=n.mul(Nr,U),U=n.sub(U,X),X=n.mul(Nr,Ze),q=n.mul(at,q),q=n.add(q,X),new _(U,M,q)}subtract(x){return this.add(x.negate())}is0(){return this.equals(_.ZERO)}multiply(x){let{endo:v}=e;if(!o.isValidNot0(x))throw new Error("invalid scalar: out of range");let R,k,j=O=>P.cached(this,O,N=>Ke(_,N));if(v){let{k1neg:O,k1:N,k2neg:U,k2:M}=I(x),{p:q,f:xe}=j(N),{p:fe,f:X}=j(M);k=xe.add(X),R=A(v.beta,q,fe,O,U)}else{let{p:O,f:N}=j(x);R=O,k=N}return Ke(_,[R,k])[0]}multiplyUnsafe(x){let{endo:v}=e,R=this;if(!o.isValid(x))throw new Error("invalid scalar: out of range");if(x===Br||R.is0())return _.ZERO;if(x===Ne)return R;if(P.hasCache(this))return this.multiply(x);if(v){let{k1neg:k,k1:j,k2neg:O,k2:N}=I(x),{p1:U,p2:M}=Oc(_,R,j,N);return A(v.beta,U,M,k,O)}else return P.unsafe(R,x)}multiplyAndAddUnsafe(x,v,R){let k=this.multiplyUnsafe(v).add(x.multiplyUnsafe(R));return k.is0()?void 0:k}toAffine(x){return S(this,x)}isTorsionFree(){let{isTorsionFree:x}=e;return i===Ne?!0:x?x(_,this):P.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:x}=e;return i===Ne?this:x?x(_,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(x=!0){return Er(x,"isCompressed"),this.assertValidity(),h(_,this,x)}toHex(x=!0){return F(this.toBytes(x))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(x=!0){return this.toBytes(x)}_setWindowSize(x){this.precompute(x)}static normalizeZ(x){return Ke(_,x)}static msm(x,v){return Jr(_,o,x,v)}static fromPrivateKey(x){return _.BASE.multiply(qn(o,x))}}_.BASE=new _(s.Gx,s.Gy,n.ONE),_.ZERO=new _(n.ZERO,n.ONE,n.ZERO),_.Fp=n,_.Fn=o;let T=o.BITS,P=new Xr(_,e.endo?Math.ceil(T/2):T);return _.BASE.precompute(8),_}function Pu(t){return Uint8Array.of(t?2:3)}function Uu(t,e){let r=t.ORDER,n=Br;for(let p=r-Ne;p%Pt===Br;p/=Pt)n+=Ne;let o=n,s=Pt<<o-Ne-Ne,i=s*Pt,a=(r-Ne)/i,c=(a-Ne)/Pt,u=i-Ne,l=s,d=t.pow(e,a),f=t.pow(e,(a+Ne)/Pt),h=(p,m)=>{let g=d,y=t.pow(m,u),w=t.sqr(y);w=t.mul(w,m);let b=t.mul(p,w);b=t.pow(b,c),b=t.mul(b,y),y=t.mul(b,m),w=t.mul(b,p);let E=t.mul(w,y);b=t.pow(E,l);let I=t.eql(b,t.ONE);y=t.mul(w,f),b=t.mul(E,g),w=t.cmov(y,w,I),E=t.cmov(b,E,I);for(let S=o;S>Ne;S--){let B=S-Pt;B=Pt<<B-Ne;let A=t.pow(E,B),_=t.eql(A,t.ONE);y=t.mul(w,g),g=t.mul(g,g),A=t.mul(E,g),w=t.cmov(y,w,_),E=t.cmov(A,E,_)}return{isValid:I,value:w}};if(t.ORDER%ai===Qr){let p=(t.ORDER-Qr)/ai,m=t.sqrt(t.neg(e));h=(g,y)=>{let w=t.sqr(y),b=t.mul(g,y);w=t.mul(w,b);let E=t.pow(w,p);E=t.mul(E,b);let I=t.mul(E,m),S=t.mul(t.sqr(E),y),B=t.eql(S,g),A=t.cmov(I,E,B);return{isValid:B,value:A}}}return h}function ci(t,e){Go(t);let{A:r,B:n,Z:o}=e;if(!t.isValid(r)||!t.isValid(n)||!t.isValid(o))throw new Error("mapToCurveSimpleSWU: invalid opts");let s=Uu(t,o);if(!t.isOdd)throw new Error("Field does not have .isOdd()");return i=>{let a,c,u,l,d,f,h,p;a=t.sqr(i),a=t.mul(a,o),c=t.sqr(a),c=t.add(c,a),u=t.add(c,t.ONE),u=t.mul(u,n),l=t.cmov(o,t.neg(c),!t.eql(c,t.ZERO)),l=t.mul(l,r),c=t.sqr(u),f=t.sqr(l),d=t.mul(f,r),c=t.add(c,d),c=t.mul(c,u),f=t.mul(f,l),d=t.mul(f,n),c=t.add(c,d),h=t.mul(a,u);let{isValid:m,value:g}=s(c,f);p=t.mul(a,i),p=t.mul(p,g),h=t.cmov(h,u,m),p=t.cmov(p,g,m);let y=t.isOdd(i)===t.isOdd(p);p=t.cmov(t.neg(p),p,y);let w=je(t,[l],!0)[0];return h=t.mul(h,w),{x:h,y:p}}}function Du(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function fi(t){let{CURVE:e,curveOpts:r}=ku(t),n=Nu(e,r);return Lu(t,n)}function ku(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(i=>Math.ceil(i/2)))):void 0,o=Re(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:o,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function Mu(t,e,r){function n(o){let s=t.sqr(o),i=t.mul(s,o);return t.add(t.add(i,t.mul(o,e)),r)}return n}function Lu(t,e){let{Fp:r,Fn:n}=e;function o(i){return Xs(i,Ne,n.ORDER)}let s=Mu(r,t.a,t.b);return Object.assign({},{CURVE:t,Point:e,ProjectivePoint:e,normPrivateKeyToScalar:i=>qn(n,i),weierstrassEquation:s,isWithinCurveOrder:o})}var qu=BigInt(0),zo=BigInt(1),Nc=BigInt(2),en=BigInt(3);function Fu(t){let e=[];for(;t>zo;t>>=zo)(t&zo)===qu?e.unshift(0):(t&en)===en?(e.unshift(-1),t+=zo):e.unshift(1);return e}function ui(t){if(!Array.isArray(t)||t.length===0)throw new Error("expected non-empty array")}function $u(t,e,r,n){let{Fp2:o,Fp12:s}=t,{twistType:i,ateLoopSize:a,xNegative:c,postPrecompute:u}=n,l;if(i==="multiplicative")l=(b,E,I,S,B,A)=>s.mul014(S,b,o.mul(E,B),o.mul(I,A));else if(i==="divisive")l=(b,E,I,S,B,A)=>s.mul034(S,o.mul(I,A),o.mul(E,B),b);else throw new Error("bls: unknown twist type");let d=o.div(o.ONE,o.mul(o.ONE,Nc));function f(b,E,I,S){let B=o.sqr(I),A=o.sqr(S),_=o.mulByB(o.mul(A,en)),T=o.mul(_,en),P=o.sub(o.sub(o.sqr(o.add(I,S)),A),B),C=o.sub(_,B),x=o.mul(o.sqr(E),en),v=o.neg(P);return b.push([C,x,v]),E=o.mul(o.mul(o.mul(o.sub(B,T),E),I),d),I=o.sub(o.sqr(o.mul(o.add(B,T),d)),o.mul(o.sqr(_),en)),S=o.mul(B,P),{Rx:E,Ry:I,Rz:S}}function h(b,E,I,S,B,A){let _=o.sub(I,o.mul(A,S)),T=o.sub(E,o.mul(B,S)),P=o.sub(o.mul(_,B),o.mul(T,A)),C=o.neg(_),x=T;b.push([P,C,x]);let v=o.sqr(T),R=o.mul(v,T),k=o.mul(v,E),j=o.add(o.sub(R,o.mul(k,Nc)),o.mul(o.sqr(_),S));return E=o.mul(T,j),I=o.sub(o.mul(o.sub(k,j),_),o.mul(R,I)),S=o.mul(S,R),{Rx:E,Ry:I,Rz:S}}let p=Fu(a),m=tr(b=>{let E=b,{x:I,y:S}=E.toAffine(),B=I,A=S,_=o.neg(S),T=B,P=A,C=o.ONE,x=[];for(let v of p){let R=[];({Rx:T,Ry:P,Rz:C}=f(R,T,P,C)),v&&({Rx:T,Ry:P,Rz:C}=h(R,T,P,C,B,v===-1?_:A)),x.push(R)}if(u){let v=x[x.length-1];u(T,P,C,B,A,h.bind(null,v))}return x});function g(b,E=!1){let I=s.ONE;if(b.length){let S=b[0][0].length;for(let B=0;B<S;B++){I=s.sqr(I);for(let[A,_,T]of b)for(let[P,C,x]of A[B])I=l(P,C,x,I,_,T)}}return c&&(I=s.conjugate(I)),E?s.finalExponentiate(I):I}function y(b,E=!0){let I=[];Ke(e,b.map(({g1:S})=>S)),Ke(r,b.map(({g2:S})=>S));for(let{g1:S,g2:B}of b){if(S.is0()||B.is0())throw new Error("pairing is not available for ZERO point");S.assertValidity(),B.assertValidity();let A=S.toAffine();I.push([m(B),A.x,A.y])}return g(I,E)}function w(b,E,I=!0){return y([{g1:b,g2:E}],I)}return{Fp12:s,millerLoopBatch:g,pairing:w,pairingBatch:y,calcPairingPrecomputes:m}}function Pc(t,e,r,n,o){let{Fp12:s,pairingBatch:i}=t;function a(d){return d instanceof e.Point?d:e.Point.fromHex(d)}function c(d){return d instanceof r.Point?d:r.Point.fromHex(d)}function u(d){if(!(d instanceof r.Point))throw new Error(`expected valid message hashed to ${o?"G1":"G2"} curve`);return d}let l=o?(d,f)=>({g1:f,g2:d}):(d,f)=>({g1:d,g2:f});return{getPublicKey(d){let f=qn(e.Point.Fn,d);return e.Point.BASE.multiply(f)},sign(d,f,h){if(h!=null)throw new Error("sign() expects 2 arguments");let p=qn(e.Point.Fn,f);return u(d).assertValidity(),d.multiply(p)},verify(d,f,h,p){if(p!=null)throw new Error("verify() expects 3 arguments");d=c(d),h=a(h);let m=h.negate(),g=e.Point.BASE,y=u(f),w=d,b=i([l(m,y),l(g,w)]);return s.eql(b,s.ONE)},verifyBatch(d,f,h){if(ui(f),h.length!==f.length)throw new Error("amount of public keys and messages should be equal");let p=c(d),m=f,g=h.map(a),y=new Map;for(let E=0;E<g.length;E++){let I=g[E],S=m[E],B=y.get(S);B===void 0&&(B=[],y.set(S,B)),B.push(I)}let w=[],b=e.Point.BASE;try{for(let[E,I]of y){let S=I.reduce((B,A)=>B.add(A));w.push(l(S,E))}return w.push(l(b.negate(),p)),s.eql(i(w),s.ONE)}catch{return!1}},aggregatePublicKeys(d){ui(d),d=d.map(h=>a(h));let f=d.reduce((h,p)=>h.add(p),e.Point.ZERO);return f.assertValidity(),f},aggregateSignatures(d){ui(d),d=d.map(h=>c(h));let f=d.reduce((h,p)=>h.add(p),r.Point.ZERO);return f.assertValidity(),f},hash(d,f){se(d);let h=f?{DST:f}:void 0;return r.hashToCurve(d,h)},Signature:n}}function Uc(t){let{Fp:e,Fr:r,Fp2:n,Fp6:o,Fp12:s}=t.fields,i=fi(t.G1),a=Object.assign(i,ii(i.Point,t.G1.mapToCurve,{...t.htfDefaults,...t.G1.htfDefaults})),c=fi(t.G2),u=Object.assign(c,ii(c.Point,t.G2.mapToCurve,{...t.htfDefaults,...t.G2.htfDefaults})),l=$u(t.fields,a.Point,u.Point,{...t.params,postPrecompute:t.postPrecompute}),{millerLoopBatch:d,pairing:f,pairingBatch:h,calcPairingPrecomputes:p}=l,m=Pc(l,a,u,t.G2.Signature,!1),g=Pc(l,u,a,t.G1.ShortSignature,!0),y=t.randomBytes||Ur,w=()=>{let O=Zo(r.ORDER);return ei(y(O),r.ORDER)},b={randomSecretKey:w,randomPrivateKey:w,calcPairingPrecomputes:p},{ShortSignature:E}=t.G1,{Signature:I}=t.G2;function S(O,N){return O instanceof a.Point?O:g.hash(oe("point",O),N?.DST)}function B(O,N){return O instanceof u.Point?O:m.hash(oe("point",O),N?.DST)}function A(O){return m.getPublicKey(O).toBytes(!0)}function _(O){return g.getPublicKey(O).toBytes(!0)}function T(O,N,U){let M=B(O,U),q=m.sign(M,N);return O instanceof u.Point?q:I.toBytes(q)}function P(O,N,U){let M=S(O,U),q=g.sign(M,N);return O instanceof a.Point?q:E.toBytes(q)}function C(O,N,U,M){let q=B(N,M);return m.verify(O,q,U)}function x(O,N,U,M){let q=S(N,M);return g.verify(O,q,U)}function v(O){let N=m.aggregatePublicKeys(O);return O[0]instanceof a.Point?N:N.toBytes(!0)}function R(O){let N=m.aggregateSignatures(O);return O[0]instanceof u.Point?N:I.toBytes(N)}function k(O){let N=g.aggregateSignatures(O);return O[0]instanceof a.Point?N:E.toBytes(N)}function j(O,N,U,M){let q=N.map(xe=>B(xe,M));return m.verifyBatch(O,q,U)}return a.Point.BASE.precompute(4),{longSignatures:m,shortSignatures:g,millerLoopBatch:d,pairing:f,pairingBatch:h,verifyBatch:j,fields:{Fr:r,Fp:e,Fp2:n,Fp6:o,Fp12:s},params:{ateLoopSize:t.params.ateLoopSize,twistType:t.params.twistType,r:t.params.r,G1b:t.G1.b,G2b:t.G2.b},utils:b,getPublicKey:A,getPublicKeyForShortSignatures:_,sign:T,signShortSignature:P,verify:C,verifyShortSignature:x,aggregatePublicKeys:v,aggregateSignatures:R,aggregateShortSignatures:k,G1:a,G2:u,Signature:I,ShortSignature:E}}var Dc=BigInt(0),Ut=BigInt(1),Pe=BigInt(2),kc=BigInt(3);function pi(t,e,r,n,o=1,s){let i=BigInt(s===void 0?n:s),a=r**BigInt(n),c=[];for(let u=0;u<o;u++){let l=BigInt(u+1),d=[];for(let f=0,h=Ut;f<n;f++){let p=(l*h-l)/i%a;d.push(t.pow(e,p)),h*=r}c.push(d)}return c}function Lc(t,e,r){let n=e.pow(r,(t.ORDER-Ut)/kc),o=e.pow(r,(t.ORDER-Ut)/Pe);function s(f,h){let p=e.mul(e.frobeniusMap(f,1),n),m=e.mul(e.frobeniusMap(h,1),o);return[p,m]}let i=e.pow(r,(t.ORDER**Pe-Ut)/kc),a=e.pow(r,(t.ORDER**Pe-Ut)/Pe);if(!e.eql(a,e.neg(e.ONE)))throw new Error("psiFrobenius: PSI2_Y!==-1");function c(f,h){return[e.mul(f,i),e.neg(h)]}let u=f=>(h,p)=>{let m=p.toAffine(),g=f(m.x,m.y);return h.fromAffine({x:g[0],y:g[1]})},l=u(s),d=u(c);return{psi:s,psi2:c,G2psi:l,G2psi2:d,PSI_X:n,PSI_Y:o,PSI2_X:i,PSI2_Y:a}}var Mc=(t,e)=>{if(e.length!==2)throw new Error("invalid tuple");let r=e.map(n=>t.create(n));return{c0:r[0],c1:r[1]}},di=class{constructor(e,r={}){this.MASK=Ut;let n=e.ORDER,o=n*n;this.Fp=e,this.ORDER=o,this.BITS=Ct(o),this.BYTES=Math.ceil(Ct(o)/8),this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.Fp_NONRESIDUE=e.create(r.NONRESIDUE||BigInt(-1)),this.Fp_div2=e.div(e.ONE,Pe),this.NONRESIDUE=Mc(e,r.FP2_NONRESIDUE),this.FROBENIUS_COEFFICIENTS=pi(e,this.Fp_NONRESIDUE,e.ORDER,2)[0],this.mulByB=r.Fp2mulByB,Object.seal(this)}fromBigTuple(e){return Mc(this.Fp,e)}create(e){return e}isValid({c0:e,c1:r}){function n(o,s){return typeof o=="bigint"&&Dc<=o&&o<s}return n(e,this.ORDER)&&n(r,this.ORDER)}is0({c0:e,c1:r}){return this.Fp.is0(e)&&this.Fp.is0(r)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}eql({c0:e,c1:r},{c0:n,c1:o}){return this.Fp.eql(e,n)&&this.Fp.eql(r,o)}neg({c0:e,c1:r}){return{c0:this.Fp.neg(e),c1:this.Fp.neg(r)}}pow(e,r){return kn(this,e,r)}invertBatch(e){return je(this,e)}add(e,r){let{c0:n,c1:o}=e,{c0:s,c1:i}=r;return{c0:this.Fp.add(n,s),c1:this.Fp.add(o,i)}}sub({c0:e,c1:r},{c0:n,c1:o}){return{c0:this.Fp.sub(e,n),c1:this.Fp.sub(r,o)}}mul({c0:e,c1:r},n){let{Fp:o}=this;if(typeof n=="bigint")return{c0:o.mul(e,n),c1:o.mul(r,n)};let{c0:s,c1:i}=n,a=o.mul(e,s),c=o.mul(r,i),u=o.sub(a,c),l=o.sub(o.mul(o.add(e,r),o.add(s,i)),o.add(a,c));return{c0:u,c1:l}}sqr({c0:e,c1:r}){let{Fp:n}=this,o=n.add(e,r),s=n.sub(e,r),i=n.add(e,e);return{c0:n.mul(o,s),c1:n.mul(i,r)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}div(e,r){let{Fp:n}=this;return this.mul(e,typeof r=="bigint"?n.inv(n.create(r)):this.inv(r))}inv({c0:e,c1:r}){let{Fp:n}=this,o=n.inv(n.create(e*e+r*r));return{c0:n.mul(o,n.create(e)),c1:n.mul(o,n.create(-r))}}sqrt(e){let{Fp:r}=this,n=this,{c0:o,c1:s}=e;if(r.is0(s))return Dn(r,o)===1?n.create({c0:r.sqrt(o),c1:r.ZERO}):n.create({c0:r.ZERO,c1:r.sqrt(r.div(o,this.Fp_NONRESIDUE))});let i=r.sqrt(r.sub(r.sqr(o),r.mul(r.sqr(s),this.Fp_NONRESIDUE))),a=r.mul(r.add(i,o),this.Fp_div2);Dn(r,a)===-1&&(a=r.sub(a,i));let u=r.sqrt(a),l=n.create({c0:u,c1:r.div(r.mul(s,this.Fp_div2),u)});if(!n.eql(n.sqr(l),e))throw new Error("Cannot find square root");let d=l,f=n.neg(d),{re:h,im:p}=n.reim(d),{re:m,im:g}=n.reim(f);return p>g||p===g&&h>m?d:f}isOdd(e){let{re:r,im:n}=this.reim(e),o=r%Pe,s=r===Dc,i=n%Pe;return BigInt(o||s&&i)==Ut}fromBytes(e){let{Fp:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);return{c0:r.fromBytes(e.subarray(0,r.BYTES)),c1:r.fromBytes(e.subarray(r.BYTES))}}toBytes({c0:e,c1:r}){return $(this.Fp.toBytes(e),this.Fp.toBytes(r))}cmov({c0:e,c1:r},{c0:n,c1:o},s){return{c0:this.Fp.cmov(e,n,s),c1:this.Fp.cmov(r,o,s)}}reim({c0:e,c1:r}){return{re:e,im:r}}Fp4Square(e,r){let n=this,o=n.sqr(e),s=n.sqr(r);return{first:n.add(n.mulByNonresidue(s),o),second:n.sub(n.sub(n.sqr(n.add(e,r)),o),s)}}mulByNonresidue({c0:e,c1:r}){return this.mul({c0:e,c1:r},this.NONRESIDUE)}frobeniusMap({c0:e,c1:r},n){return{c0:e,c1:this.Fp.mul(r,this.FROBENIUS_COEFFICIENTS[n%2])}}},li=class{constructor(e){this.MASK=Ut,this.Fp2=e,this.ORDER=e.ORDER,this.BITS=3*e.BITS,this.BYTES=3*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO,c2:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO,c2:e.ZERO};let{Fp:r}=e,n=pi(e,e.NONRESIDUE,r.ORDER,6,2,3);this.FROBENIUS_COEFFICIENTS_1=n[0],this.FROBENIUS_COEFFICIENTS_2=n[1],Object.seal(this)}add({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:a}=this;return{c0:a.add(e,o),c1:a.add(r,s),c2:a.add(n,i)}}sub({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:a}=this;return{c0:a.sub(e,o),c1:a.sub(r,s),c2:a.sub(n,i)}}mul({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;if(typeof o=="bigint")return{c0:s.mul(e,o),c1:s.mul(r,o),c2:s.mul(n,o)};let{c0:i,c1:a,c2:c}=o,u=s.mul(e,i),l=s.mul(r,a),d=s.mul(n,c);return{c0:s.add(u,s.mulByNonresidue(s.sub(s.mul(s.add(r,n),s.add(a,c)),s.add(l,d)))),c1:s.add(s.sub(s.mul(s.add(e,r),s.add(i,a)),s.add(u,l)),s.mulByNonresidue(d)),c2:s.sub(s.add(l,s.mul(s.add(e,n),s.add(i,c))),s.add(u,d))}}sqr({c0:e,c1:r,c2:n}){let{Fp2:o}=this,s=o.sqr(e),i=o.mul(o.mul(e,r),Pe),a=o.mul(o.mul(r,n),Pe),c=o.sqr(n);return{c0:o.add(o.mulByNonresidue(a),s),c1:o.add(o.mulByNonresidue(c),i),c2:o.sub(o.sub(o.add(o.add(i,o.sqr(o.add(o.sub(e,r),n))),a),s),c)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}create(e){return e}isValid({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return o.isValid(e)&&o.isValid(r)&&o.isValid(n)}is0({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return o.is0(e)&&o.is0(r)&&o.is0(n)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return{c0:o.neg(e),c1:o.neg(r),c2:o.neg(n)}}eql({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i}){let{Fp2:a}=this;return a.eql(e,o)&&a.eql(r,s)&&a.eql(n,i)}sqrt(e){return zr()}div(e,r){let{Fp2:n}=this,{Fp:o}=n;return this.mul(e,typeof r=="bigint"?o.inv(o.create(r)):this.inv(r))}pow(e,r){return kn(this,e,r)}invertBatch(e){return je(this,e)}inv({c0:e,c1:r,c2:n}){let{Fp2:o}=this,s=o.sub(o.sqr(e),o.mulByNonresidue(o.mul(n,r))),i=o.sub(o.mulByNonresidue(o.sqr(n)),o.mul(e,r)),a=o.sub(o.sqr(r),o.mul(e,n)),c=o.inv(o.add(o.mulByNonresidue(o.add(o.mul(n,i),o.mul(r,a))),o.mul(e,s)));return{c0:o.mul(c,s),c1:o.mul(c,i),c2:o.mul(c,a)}}fromBytes(e){let{Fp2:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);let n=r.BYTES;return{c0:r.fromBytes(e.subarray(0,n)),c1:r.fromBytes(e.subarray(n,n*2)),c2:r.fromBytes(e.subarray(2*n))}}toBytes({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return $(o.toBytes(e),o.toBytes(r),o.toBytes(n))}cmov({c0:e,c1:r,c2:n},{c0:o,c1:s,c2:i},a){let{Fp2:c}=this;return{c0:c.cmov(e,o,a),c1:c.cmov(r,s,a),c2:c.cmov(n,i,a)}}fromBigSix(e){let{Fp2:r}=this;if(!Array.isArray(e)||e.length!==6)throw new Error("invalid Fp6 usage");return{c0:r.fromBigTuple(e.slice(0,2)),c1:r.fromBigTuple(e.slice(2,4)),c2:r.fromBigTuple(e.slice(4,6))}}frobeniusMap({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.frobeniusMap(e,o),c1:s.mul(s.frobeniusMap(r,o),this.FROBENIUS_COEFFICIENTS_1[o%6]),c2:s.mul(s.frobeniusMap(n,o),this.FROBENIUS_COEFFICIENTS_2[o%6])}}mulByFp2({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.mul(e,o),c1:s.mul(r,o),c2:s.mul(n,o)}}mulByNonresidue({c0:e,c1:r,c2:n}){let{Fp2:o}=this;return{c0:o.mulByNonresidue(n),c1:e,c2:r}}mul1({c0:e,c1:r,c2:n},o){let{Fp2:s}=this;return{c0:s.mulByNonresidue(s.mul(n,o)),c1:s.mul(e,o),c2:s.mul(r,o)}}mul01({c0:e,c1:r,c2:n},o,s){let{Fp2:i}=this,a=i.mul(e,o),c=i.mul(r,s);return{c0:i.add(i.mulByNonresidue(i.sub(i.mul(i.add(r,n),s),c)),a),c1:i.sub(i.sub(i.mul(i.add(o,s),i.add(e,r)),a),c),c2:i.add(i.sub(i.mul(i.add(e,n),o),a),c)}}},hi=class{constructor(e,r){this.MASK=Ut;let{Fp2:n}=e,{Fp:o}=n;this.Fp6=e,this.ORDER=n.ORDER,this.BITS=2*e.BITS,this.BYTES=2*e.BYTES,this.isLE=e.isLE,this.ZERO={c0:e.ZERO,c1:e.ZERO},this.ONE={c0:e.ONE,c1:e.ZERO},this.FROBENIUS_COEFFICIENTS=pi(n,n.NONRESIDUE,o.ORDER,12,1,6)[0],this.X_LEN=r.X_LEN,this.finalExponentiate=r.Fp12finalExponentiate}create(e){return e}isValid({c0:e,c1:r}){let{Fp6:n}=this;return n.isValid(e)&&n.isValid(r)}is0({c0:e,c1:r}){let{Fp6:n}=this;return n.is0(e)&&n.is0(r)}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}neg({c0:e,c1:r}){let{Fp6:n}=this;return{c0:n.neg(e),c1:n.neg(r)}}eql({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return s.eql(e,n)&&s.eql(r,o)}sqrt(e){zr()}inv({c0:e,c1:r}){let{Fp6:n}=this,o=n.inv(n.sub(n.sqr(e),n.mulByNonresidue(n.sqr(r))));return{c0:n.mul(e,o),c1:n.neg(n.mul(r,o))}}div(e,r){let{Fp6:n}=this,{Fp2:o}=n,{Fp:s}=o;return this.mul(e,typeof r=="bigint"?s.inv(s.create(r)):this.inv(r))}pow(e,r){return kn(this,e,r)}invertBatch(e){return je(this,e)}add({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return{c0:s.add(e,n),c1:s.add(r,o)}}sub({c0:e,c1:r},{c0:n,c1:o}){let{Fp6:s}=this;return{c0:s.sub(e,n),c1:s.sub(r,o)}}mul({c0:e,c1:r},n){let{Fp6:o}=this;if(typeof n=="bigint")return{c0:o.mul(e,n),c1:o.mul(r,n)};let{c0:s,c1:i}=n,a=o.mul(e,s),c=o.mul(r,i);return{c0:o.add(a,o.mulByNonresidue(c)),c1:o.sub(o.mul(o.add(e,r),o.add(s,i)),o.add(a,c))}}sqr({c0:e,c1:r}){let{Fp6:n}=this,o=n.mul(e,r);return{c0:n.sub(n.sub(n.mul(n.add(n.mulByNonresidue(r),e),n.add(e,r)),o),n.mulByNonresidue(o)),c1:n.add(o,o)}}addN(e,r){return this.add(e,r)}subN(e,r){return this.sub(e,r)}mulN(e,r){return this.mul(e,r)}sqrN(e){return this.sqr(e)}fromBytes(e){let{Fp6:r}=this;if(e.length!==this.BYTES)throw new Error("fromBytes invalid length="+e.length);return{c0:r.fromBytes(e.subarray(0,r.BYTES)),c1:r.fromBytes(e.subarray(r.BYTES))}}toBytes({c0:e,c1:r}){let{Fp6:n}=this;return $(n.toBytes(e),n.toBytes(r))}cmov({c0:e,c1:r},{c0:n,c1:o},s){let{Fp6:i}=this;return{c0:i.cmov(e,n,s),c1:i.cmov(r,o,s)}}fromBigTwelve(e){let{Fp6:r}=this;return{c0:r.fromBigSix(e.slice(0,6)),c1:r.fromBigSix(e.slice(6,12))}}frobeniusMap(e,r){let{Fp6:n}=this,{Fp2:o}=n,{c0:s,c1:i,c2:a}=n.frobeniusMap(e.c1,r),c=this.FROBENIUS_COEFFICIENTS[r%12];return{c0:n.frobeniusMap(e.c0,r),c1:n.create({c0:o.mul(s,c),c1:o.mul(i,c),c2:o.mul(a,c)})}}mulByFp2({c0:e,c1:r},n){let{Fp6:o}=this;return{c0:o.mulByFp2(e,n),c1:o.mulByFp2(r,n)}}conjugate({c0:e,c1:r}){return{c0:e,c1:this.Fp6.neg(r)}}mul014({c0:e,c1:r},n,o,s){let{Fp6:i}=this,{Fp2:a}=i,c=i.mul01(e,n,o),u=i.mul1(r,s);return{c0:i.add(i.mulByNonresidue(u),c),c1:i.sub(i.sub(i.mul01(i.add(r,e),n,a.add(o,s)),c),u)}}mul034({c0:e,c1:r},n,o,s){let{Fp6:i}=this,{Fp2:a}=i,c=i.create({c0:a.mul(e.c0,n),c1:a.mul(e.c1,n),c2:a.mul(e.c2,n)}),u=i.mul01(r,o,s),l=i.mul01(i.add(e,r),a.add(n,o),s);return{c0:i.add(i.mulByNonresidue(u),c),c1:i.sub(l,i.add(c,u))}}_cyclotomicSquare({c0:e,c1:r}){let{Fp6:n}=this,{Fp2:o}=n,{c0:s,c1:i,c2:a}=e,{c0:c,c1:u,c2:l}=r,{first:d,second:f}=o.Fp4Square(s,u),{first:h,second:p}=o.Fp4Square(c,a),{first:m,second:g}=o.Fp4Square(i,l),y=o.mulByNonresidue(g);return{c0:n.create({c0:o.add(o.mul(o.sub(d,s),Pe),d),c1:o.add(o.mul(o.sub(h,i),Pe),h),c2:o.add(o.mul(o.sub(m,a),Pe),m)}),c1:n.create({c0:o.add(o.mul(o.add(y,c),Pe),y),c1:o.add(o.mul(o.add(f,u),Pe),f),c2:o.add(o.mul(o.add(p,l),Pe),p)})}}_cyclotomicExp(e,r){let n=this.ONE;for(let o=this.X_LEN-1;o>=0;o--)n=this._cyclotomicSquare(n),hc(r,o)&&(n=this.mul(n,e));return n}};function qc(t){let e=Re(t.ORDER),r=new di(e,t),n=new li(r),o=new hi(n,t);return{Fp:e,Fp2:r,Fp6:n,Fp12:o}}var Ie=BigInt(0),Wo=BigInt(1),He=BigInt(2),Xo=BigInt(3),Fn=BigInt(4),nr=BigInt("0xd201000000010000"),Vu=Ct(nr),Sr={p:BigInt("0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab"),n:BigInt("0x73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000001"),h:BigInt("0x396c8c005555e1568c00aaab0000aaab"),a:Ie,b:Fn,Gx:BigInt("0x17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb"),Gy:BigInt("0x08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1")},ju=Re(Sr.n,{modFromBytes:!0,isLE:!0}),{Fp:D,Fp2:H,Fp6:Ku,Fp12:Y}=qc({ORDER:Sr.p,X_LEN:Vu,FP2_NONRESIDUE:[Wo,Wo],Fp2mulByB:({c0:t,c1:e})=>{let r=D.mul(t,Fn),n=D.mul(e,Fn);return{c0:D.sub(r,n),c1:D.add(r,n)}},Fp12finalExponentiate:t=>{let e=nr,r=Y.div(Y.frobeniusMap(t,6),t),n=Y.mul(Y.frobeniusMap(r,2),r),o=Y.conjugate(Y._cyclotomicExp(n,e)),s=Y.mul(Y.conjugate(Y._cyclotomicSquare(n)),o),i=Y.conjugate(Y._cyclotomicExp(s,e)),a=Y.conjugate(Y._cyclotomicExp(i,e)),c=Y.mul(Y.conjugate(Y._cyclotomicExp(a,e)),Y._cyclotomicSquare(o)),u=Y.conjugate(Y._cyclotomicExp(c,e)),l=Y.frobeniusMap(Y.mul(o,a),2),d=Y.frobeniusMap(Y.mul(i,n),3),f=Y.frobeniusMap(Y.mul(c,Y.conjugate(n)),1),h=Y.mul(Y.mul(u,Y.conjugate(s)),n);return Y.mul(Y.mul(Y.mul(l,d),f),h)}}),{G2psi:Fc,G2psi2:Hu}=Lc(D,H,H.div(H.ONE,H.NONRESIDUE)),mi=Object.freeze({DST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",encodeDST:"BLS_SIG_BLS12381G2_XMD:SHA-256_SSWU_RO_NUL_",p:D.ORDER,m:2,k:128,expand:"xmd",hash:ve}),gi={p:H.ORDER,n:Sr.n,h:BigInt("0x5d543a95414e7f1091d50792876a202cd91de4547085abaa68a205b2e5a7ddfa628f1cb4d9e82ef21537e293a6691ae1616ec6e786f0c70cf1c38e31c7238e5"),a:H.ZERO,b:H.fromBigTuple([Fn,Fn]),Gx:H.fromBigTuple([BigInt("0x024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8"),BigInt("0x13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e")]),Gy:H.fromBigTuple([BigInt("0x0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801"),BigInt("0x0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be")])},Jo=$n(D.toBytes(Ie),{infinity:!0,compressed:!0});function Qo(t){t=t.slice();let e=t[0]&224,r=!!(e>>7&1),n=!!(e>>6&1),o=!!(e>>5&1);return t[0]&=31,{compressed:r,infinity:n,sort:o,value:t}}function $n(t,e){if(t[0]&224)throw new Error("setMask: non-empty mask");return e.compressed&&(t[0]|=128),e.infinity&&(t[0]|=64),e.sort&&(t[0]|=32),t}function Gu(t,e,r){let{BYTES:n,ORDER:o}=D,s=e.is0(),{x:i,y:a}=e.toAffine();if(r){if(s)return Jo.slice();let c=!!(a*He/o);return $n(he(i,n),{compressed:!0,sort:c})}else return s?$(Uint8Array.of(64),new Uint8Array(2*n-1)):$(he(i,n),he(a,n))}function yi(t){t.assertValidity();let{BYTES:e,ORDER:r}=D,{x:n,y:o}=t.toAffine();if(t.is0())return Jo.slice();let s=!!(o*He/r);return $n(he(n,e),{compressed:!0,sort:s})}function Zu(t){let{compressed:e,infinity:r,sort:n,value:o}=Qo(t),{BYTES:s,ORDER:i}=D;if(o.length===48&&e){let a=ke(o),c=D.create(a&nt(D.BITS));if(r){if(c!==Ie)throw new Error("invalid G1 point: non-empty, at infinity, with compression");return{x:Ie,y:Ie}}let u=D.add(D.pow(c,Xo),D.create(Sr.b)),l=D.sqrt(u);if(!l)throw new Error("invalid G1 point: compressed point");return l*He/i!==BigInt(n)&&(l=D.neg(l)),{x:D.create(c),y:D.create(l)}}else if(o.length===96&&!e){let a=ke(o.subarray(0,s)),c=ke(o.subarray(s));if(r){if(a!==Ie||c!==Ie)throw new Error("G1: non-empty point at infinity");return Vn.G1.Point.ZERO.toAffine()}return{x:D.create(a),y:D.create(c)}}else throw new Error("invalid G1 point: expected 48/96 bytes")}function $c(t){let{infinity:e,sort:r,value:n}=Qo(oe("signatureHex",t,48)),o=D.ORDER,s=Vn.G1.Point,i=ke(n);if(e)return s.ZERO;let a=D.create(i&nt(D.BITS)),c=D.add(D.pow(a,Xo),D.create(Sr.b)),u=D.sqrt(c);if(!u)throw new Error("invalid G1 point: compressed");let l=BigInt(r);u*He/o!==l&&(u=D.neg(u));let d=s.fromAffine({x:a,y:u});return d.assertValidity(),d}function Yu(t,e,r){let{BYTES:n,ORDER:o}=D,s=e.is0(),{x:i,y:a}=e.toAffine();if(r){if(s)return $(Jo,he(Ie,n));let c=!!(a.c1===Ie?a.c0*He/o:a.c1*He/o);return $($n(he(i.c1,n),{compressed:!0,sort:c}),he(i.c0,n))}else{if(s)return $(Uint8Array.of(64),new Uint8Array(4*n-1));let{re:c,im:u}=H.reim(i),{re:l,im:d}=H.reim(a);return $(he(u,n),he(c,n),he(d,n),he(l,n))}}function bi(t){t.assertValidity();let{BYTES:e}=D;if(t.is0())return $(Jo,he(Ie,e));let{x:r,y:n}=t.toAffine(),{re:o,im:s}=H.reim(r),{re:i,im:a}=H.reim(n),u=!!((a>Ie?a*He:i*He)/D.ORDER&Wo),l=o;return $($n(he(s,e),{sort:u,compressed:!0}),he(l,e))}function zu(t){let{BYTES:e,ORDER:r}=D,{compressed:n,infinity:o,sort:s,value:i}=Qo(t);if(!n&&!o&&s||!n&&o&&s||s&&o&&n)throw new Error("invalid encoding flag: "+(t[0]&224));let a=(c,u,l)=>ke(c.slice(u,l));if(i.length===96&&n){if(o){if(i.reduce((p,m)=>p!==0?m+1:m,0)>0)throw new Error("invalid G2 point: compressed");return{x:H.ZERO,y:H.ZERO}}let c=a(i,0,e),u=a(i,e,2*e),l=H.create({c0:D.create(u),c1:D.create(c)}),d=H.add(H.pow(l,Xo),gi.b),f=H.sqrt(d),h=f.c1===Ie?f.c0*He/r:f.c1*He/r?Wo:Ie;return f=s&&h>0?f:H.neg(f),{x:l,y:f}}else if(i.length===192&&!n){if(o){if(i.reduce((f,h)=>f!==0?h+1:h,0)>0)throw new Error("invalid G2 point: uncompressed");return{x:H.ZERO,y:H.ZERO}}let c=a(i,0*e,1*e),u=a(i,1*e,2*e),l=a(i,2*e,3*e),d=a(i,3*e,4*e);return{x:H.fromBigTuple([u,c]),y:H.fromBigTuple([d,l])}}else throw new Error("invalid G2 point: expected 96/192 bytes")}function Vc(t){let{ORDER:e}=D,{infinity:r,sort:n,value:o}=Qo(oe("signatureHex",t)),s=Vn.G2.Point,i=o.length/2;if(i!==48&&i!==96)throw new Error("invalid compressed signature length, expected 96/192 bytes");let a=ke(o.slice(0,i)),c=ke(o.slice(i));if(r)return s.ZERO;let u=D.create(a&nt(D.BITS)),l=D.create(c),d=H.create({c0:l,c1:u}),f=H.add(H.pow(d,Xo),gi.b),h=H.sqrt(f);if(!h)throw new Error("Failed to find a square root");let{re:p,im:m}=H.reim(h),g=BigInt(n),y=m>Ie&&m*He/e!==g,w=m===Ie&&p*He/e!==g;(y||w)&&(h=H.neg(h));let b=s.fromAffine({x:d,y:h});return b.assertValidity(),b}var Vn=Uc({fields:{Fp:D,Fp2:H,Fp6:Ku,Fp12:Y,Fr:ju},G1:{...Sr,Fp:D,htfDefaults:{...mi,m:1,DST:"BLS_SIG_BLS12381G1_XMD:SHA-256_SSWU_RO_NUL_"},wrapPrivateKey:!0,allowInfinityPoint:!0,isTorsionFree:(t,e)=>{let r=BigInt("0x5f19672fdf76ce51ba69c6076a0f77eaddb3a93be6f89688de17d813620a00022e01fffffffefffe"),n=new t(D.mul(e.X,r),e.Y,e.Z);return e.multiplyUnsafe(nr).negate().multiplyUnsafe(nr).equals(n)},clearCofactor:(t,e)=>e.multiplyUnsafe(nr).add(e),mapToCurve:ed,fromBytes:Zu,toBytes:Gu,ShortSignature:{fromBytes(t){return se(t),$c(t)},fromHex(t){return $c(t)},toBytes(t){return yi(t)},toRawBytes(t){return yi(t)},toHex(t){return F(yi(t))}}},G2:{...gi,Fp:H,hEff:BigInt("0xbc69f08f2ee75b3584c6a0ea91b352888e2a8e9145ad7689986ff031508ffe1329c2f178731db956d82bf015d1212b02ec0ec69d7477c1ae954cbc06689f6a359894c0adebbf6b4e8020005aaa95551"),htfDefaults:{...mi},wrapPrivateKey:!0,allowInfinityPoint:!0,mapToCurve:td,isTorsionFree:(t,e)=>e.multiplyUnsafe(nr).negate().equals(Fc(t,e)),clearCofactor:(t,e)=>{let r=nr,n=e.multiplyUnsafe(r).negate(),o=Fc(t,e),s=e.double();return s=Hu(t,s),s=s.subtract(o),o=n.add(o),o=o.multiplyUnsafe(r).negate(),s=s.add(o),s=s.subtract(n),s.subtract(e)},fromBytes:zu,toBytes:Yu,Signature:{fromBytes(t){return se(t),Vc(t)},fromHex(t){return Vc(t)},toBytes(t){return bi(t)},toRawBytes(t){return bi(t)},toHex(t){return F(bi(t))}}},params:{ateLoopSize:nr,r:Sr.n,xNegative:!0,twistType:"multiplicative"},htfDefaults:mi,hash:ve}),Wu=si(H,[[["0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97d6"],["0x0","0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71a"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71e","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38d"],["0x171d6541fa38ccfaed6dea691f5fb614cb14b4e7f4e810aa22d6108f142b85757098e38d0f671c7188e2aaaaaaaa5ed1","0x0"]],[["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa63"],["0xc","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa9f"],["0x1","0x0"]],[["0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706","0x1530477c7ab4113b59a4c18b076d11930f7da5d4a07f649bf54439d87d27e500fc8c25ebf8c92f6812cfc71c71c6d706"],["0x0","0x5c759507e8e333ebb5b7a9a47d7ed8532c52d39fd3a042a88b58423c50ae15d5c2638e343d9c71c6238aaaaaaaa97be"],["0x11560bf17baa99bc32126fced787c88f984f87adf7ae0c7f9a208c6b4f20a4181472aaa9cb8d555526a9ffffffffc71c","0x8ab05f8bdd54cde190937e76bc3e447cc27c3d6fbd7063fcd104635a790520c0a395554e5c6aaaa9354ffffffffe38f"],["0x124c9ad43b6cf79bfbf7043de3811ad0761b0f37a1e26286b0e977c69aa274524e79097a56dc4bd9e1b371c71c718b10","0x0"]],[["0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa8fb"],["0x0","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffa9d3"],["0x12","0x1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaa99"],["0x1","0x0"]]].map(t=>t.map(e=>H.fromBigTuple(e.map(BigInt))))),Xu=si(D,[["0x11a05f2b1e833340b809101dd99815856b303e88a2d7005ff2627b56cdb4e2c85610c2d5f2e62d6eaeac1662734649b7","0x17294ed3e943ab2f0588bab22147a81c7c17e75b2f6a8417f565e33c70d1e86b4838f2a6f318c356e834eef1b3cb83bb","0xd54005db97678ec1d1048c5d10a9a1bce032473295983e56878e501ec68e25c958c3e3d2a09729fe0179f9dac9edcb0","0x1778e7166fcc6db74e0609d307e55412d7f5e4656a8dbf25f1b33289f1b330835336e25ce3107193c5b388641d9b6861","0xe99726a3199f4436642b4b3e4118e5499db995a1257fb3f086eeb65982fac18985a286f301e77c451154ce9ac8895d9","0x1630c3250d7313ff01d1201bf7a74ab5db3cb17dd952799b9ed3ab9097e68f90a0870d2dcae73d19cd13c1c66f652983","0xd6ed6553fe44d296a3726c38ae652bfb11586264f0f8ce19008e218f9c86b2a8da25128c1052ecaddd7f225a139ed84","0x17b81e7701abdbe2e8743884d1117e53356de5ab275b4db1a682c62ef0f2753339b7c8f8c8f475af9ccb5618e3f0c88e","0x80d3cf1f9a78fc47b90b33563be990dc43b756ce79f5574a2c596c928c5d1de4fa295f296b74e956d71986a8497e317","0x169b1f8e1bcfa7c42e0c37515d138f22dd2ecb803a0c5c99676314baf4bb1b7fa3190b2edc0327797f241067be390c9e","0x10321da079ce07e272d8ec09d2565b0dfa7dccdde6787f96d50af36003b14866f69b771f8c285decca67df3f1605fb7b","0x6e08c248e260e70bd1e962381edee3d31d79d7e22c837bc23c0bf1bc24c6b68c24b1b80b64d391fa9c8ba2e8ba2d229"],["0x8ca8d548cff19ae18b2e62f4bd3fa6f01d5ef4ba35b48ba9c9588617fc8ac62b558d681be343df8993cf9fa40d21b1c","0x12561a5deb559c4348b4711298e536367041e8ca0cf0800c0126c2588c48bf5713daa8846cb026e9e5c8276ec82b3bff","0xb2962fe57a3225e8137e629bff2991f6f89416f5a718cd1fca64e00b11aceacd6a3d0967c94fedcfcc239ba5cb83e19","0x3425581a58ae2fec83aafef7c40eb545b08243f16b1655154cca8abc28d6fd04976d5243eecf5c4130de8938dc62cd8","0x13a8e162022914a80a6f1d5f43e7a07dffdfc759a12062bb8d6b44e833b306da9bd29ba81f35781d539d395b3532a21e","0xe7355f8e4e667b955390f7f0506c6e9395735e9ce9cad4d0a43bcef24b8982f7400d24bc4228f11c02df9a29f6304a5","0x772caacf16936190f3e0c63e0596721570f5799af53a1894e2e073062aede9cea73b3538f0de06cec2574496ee84a3a","0x14a7ac2a9d64a8b230b3f5b074cf01996e7f63c21bca68a81996e1cdf9822c580fa5b9489d11e2d311f7d99bbdcc5a5e","0xa10ecf6ada54f825e920b3dafc7a3cce07f8d1d7161366b74100da67f39883503826692abba43704776ec3a79a1d641","0x95fc13ab9e92ad4476d6e3eb3a56680f682b4ee96f7d03776df533978f31c1593174e4b4b7865002d6384d168ecdd0a","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"],["0x90d97c81ba24ee0259d1f094980dcfa11ad138e48a869522b52af6c956543d3cd0c7aee9b3ba3c2be9845719707bb33","0x134996a104ee5811d51036d776fb46831223e96c254f383d0f906343eb67ad34d6c56711962fa8bfe097e75a2e41c696","0xcc786baa966e66f4a384c86a3b49942552e2d658a31ce2c344be4b91400da7d26d521628b00523b8dfe240c72de1f6","0x1f86376e8981c217898751ad8746757d42aa7b90eeb791c09e4a3ec03251cf9de405aba9ec61deca6355c77b0e5f4cb","0x8cc03fdefe0ff135caf4fe2a21529c4195536fbe3ce50b879833fd221351adc2ee7f8dc099040a841b6daecf2e8fedb","0x16603fca40634b6a2211e11db8f0a6a074a7d0d4afadb7bd76505c3d3ad5544e203f6326c95a807299b23ab13633a5f0","0x4ab0b9bcfac1bbcb2c977d027796b3ce75bb8ca2be184cb5231413c4d634f3747a87ac2460f415ec961f8855fe9d6f2","0x987c8d5333ab86fde9926bd2ca6c674170a05bfe3bdd81ffd038da6c26c842642f64550fedfe935a15e4ca31870fb29","0x9fc4018bd96684be88c9e221e4da1bb8f3abd16679dc26c1e8b6e6a1f20cabe69d65201c78607a360370e577bdba587","0xe1bba7a1186bdb5223abde7ada14a23c42a0ca7915af6fe06985e7ed1e4d43b9b3f7055dd4eba6f2bafaaebca731c30","0x19713e47937cd1be0dfd0b8f1d43fb93cd2fcbcb6caf493fd1183e416389e61031bf3a5cce3fbafce813711ad011c132","0x18b46a908f36f6deb918c143fed2edcc523559b8aaf0c2462e6bfe7f911f643249d9cdf41b44d606ce07c8a4d0074d8e","0xb182cac101b9399d155096004f53f447aa7b12a3426b08ec02710e807b4633f06c851c1919211f20d4c04f00b971ef8","0x245a394ad1eca9b72fc00ae7be315dc757b3b080d4c158013e6632d3c40659cc6cf90ad1c232a6442d9d3f5db980133","0x5c129645e44cf1102a159f748c4a3fc5e673d81d7e86568d9ab0f5d396a7ce46ba1049b6579afb7866b1e715475224b","0x15e6be4e990f03ce4ea50b3b42df2eb5cb181d8f84965a3957add4fa95af01b2b665027efec01c7704b456be69c8b604"],["0x16112c4c3a9c98b252181140fad0eae9601a6de578980be6eec3232b5be72e7a07f3688ef60c206d01479253b03663c1","0x1962d75c2381201e1a0cbd6c43c348b885c84ff731c4d59ca4a10356f453e01f78a4260763529e3532f6102c2e49a03d","0x58df3306640da276faaae7d6e8eb15778c4855551ae7f310c35a5dd279cd2eca6757cd636f96f891e2538b53dbf67f2","0x16b7d288798e5395f20d23bf89edb4d1d115c5dbddbcd30e123da489e726af41727364f2c28297ada8d26d98445f5416","0xbe0e079545f43e4b00cc912f8228ddcc6d19c9f0f69bbb0542eda0fc9dec916a20b15dc0fd2ededda39142311a5001d","0x8d9e5297186db2d9fb266eaac783182b70152c65550d881c5ecd87b6f0f5a6449f38db9dfa9cce202c6477faaf9b7ac","0x166007c08a99db2fc3ba8734ace9824b5eecfdfa8d0cf8ef5dd365bc400a0051d5fa9c01a58b1fb93d1a1399126a775c","0x16a3ef08be3ea7ea03bcddfabba6ff6ee5a4375efa1f4fd7feb34fd206357132b920f5b00801dee460ee415a15812ed9","0x1866c8ed336c61231a1be54fd1d74cc4f9fb0ce4c6af5920abc5750c4bf39b4852cfe2f7bb9248836b233d9d55535d4a","0x167a55cda70a6e1cea820597d94a84903216f763e13d87bb5308592e7ea7d4fbc7385ea3d529b35e346ef48bb8913f55","0x4d2f259eea405bd48f010a01ad2911d9c6dd039bb61a6290e591b36e636a5c871a5c29f4f83060400f8b49cba8f6aa8","0xaccbb67481d033ff5852c1e48c50c477f94ff8aefce42d28c0f9a88cea7913516f968986f7ebbea9684b529e2561092","0xad6b9514c767fe3c3613144b45f1496543346d98adf02267d5ceef9a00d9b8693000763e3b90ac11e99b138573345cc","0x2660400eb2e4f3b628bdd0d53cd76f2bf565b94e72927c1cb748df27942480e420517bd8714cc80d1fadc1326ed06f7","0xe0fa1d816ddc03e6b24255e0d7819c171c40f65e273b853324efcd6356caa205ca2f570f13497804415473a1d634b8f","0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001"]].map(t=>t.map(e=>BigInt(e)))),Ju=ci(D,{A:D.create(BigInt("0x144698a3b8e9433d693a02c96d4982b0ea985383ee66a8d8e8981aefd881ac98936f8da0e0f97f5cf428082d584c1d")),B:D.create(BigInt("0x12e2908d11688030018b12e8753eee3b2016c1f0f24f4070a0b9c14fcef35ef55a23215a316ceaa5d1cc48e98e172be0")),Z:D.create(BigInt(11))}),Qu=ci(H,{A:H.create({c0:D.create(Ie),c1:D.create(BigInt(240))}),B:H.create({c0:D.create(BigInt(1012)),c1:D.create(BigInt(1012))}),Z:H.create({c0:D.create(BigInt(-2)),c1:D.create(BigInt(-1))})});function ed(t){let{x:e,y:r}=Ju(D.create(t[0]));return Xu(e,r)}function td(t){let{x:e,y:r}=Qu(H.fromBigTuple(t));return Wu(e,r)}function jc(t,e,r){let n=typeof t=="string"?t:F(t),o=typeof e=="string"?e:F(e),s=typeof r=="string"?r:F(r);return Vn.verifyShortSignature(o,s,n)}var nd=BigInt(1e6),wi=t=>ae(new Je(t)),tn=t=>{let r=wi(t)/nd;return new Date(Number(r))};var Kc=60*1e3,od=60,sd=24,id=sd*od,ad=5,cd=5,fd=30*id,Ee;(function(t){t[t.Empty=0]="Empty",t[t.Fork=1]="Fork",t[t.Labeled=2]="Labeled",t[t.Leaf=3]="Leaf",t[t.Pruned=4]="Pruned"})(Ee||(Ee={}));function ud(t,e){for(let r=0;r<t.length;r++)if(t[r]>e[r])return!0;return!1}var or=class t{#e=!1;#t=void 0;static async create(e){let r=t.createUnverified(e);return await r.verify(),r}static createUnverified(e){return new t(e.certificate,e.rootKey,e.canisterId,e.blsVerify??jc,e.maxAgeInMinutes,e.disableTimeVerification,e.agent)}constructor(e,r,n,o,s=ad,i=!1,a){this._rootKey=r,this._canisterId=n,this._blsVerify=o,this._maxAgeInMinutes=s,this.#e=i,this.cert=Fe(e),a&&"getTimeDiffMsecs"in a&&"hasSyncedTime"in a&&"syncTime"in a&&(this.#t=a)}lookup_path(e){return Ar(e,this.cert.tree)}lookup_subtree(e){return rs(e,this.cert.tree)}async verify(){let e=await es(this.cert.tree),r=await this._checkDelegationAndGetKey(this.cert.delegation),n=this.cert.signature,o=ld(r),s=$(Kn("ic-state-root"),e),i=Be(this.lookup_path(["time"]));if(!i)throw J.fromCode(new Ht("Certificate does not contain a time"));if(!this.#e){let a=this.#t?.getTimeDiffMsecs()??0,c=this._maxAgeInMinutes*Kc,u=new Date,l=u.getTime()+a,d=l-c,f=l+cd*Kc,h=tn(i),p=h.getTime()<d,m=h.getTime()>f;if((p||m)&&this.#t&&!this.#t.hasSyncedTime())return await this.#t.syncTime(this._canisterId),await this.verify();if(p)throw Te.fromCode(new lr(this._maxAgeInMinutes,h,u,a,"past"));if(m)throw this.#t?.hasSyncedTime()?ue.fromCode(new Ae("System time has been synced with the IC network, but certificate is still too far in the future.")):Te.fromCode(new lr(5,h,u,a,"future"))}try{if(!await this._blsVerify(o,n,s))throw Te.fromCode(new Ht("Invalid signature"))}catch(a){throw Te.fromCode(new Ht("Signature verification failed",a))}}async _checkDelegationAndGetKey(e){if(!e)return this._rootKey;let r=t.createUnverified({certificate:e.certificate,rootKey:this._rootKey,canisterId:this._canisterId,blsVerify:this._blsVerify,disableTimeVerification:this.#e,maxAgeInMinutes:fd,agent:this.#t});if(r.cert.delegation)throw J.fromCode(new ho);await r.verify();let n=e.subnet_id,o=L.fromUint8Array(n);if(!xi({canisterId:this._canisterId,subnetId:o,tree:r.cert.tree}))throw Te.fromCode(new Dr(this._canisterId,o));let i=Be(r.lookup_path(["subnet",n,"public_key"]));if(!i)throw Te.fromCode(new po(`Could not find subnet key for subnet ID ${o.toText()}`));return i}},jn=pe("308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100"),dd=96;function ld(t){let e=jn.byteLength+dd;if(t.byteLength!==e)throw J.fromCode(new Mr(e,t.byteLength));let r=t.slice(0,jn.byteLength);if(!wr(r,jn))throw J.fromCode(new mo(jn,r));return t.slice(jn.byteLength)}function Be(t){if(t.status===Me.Found&&t.value instanceof Uint8Array)return t.value}async function es(t){switch(t[0]){case Ee.Empty:return ve(Kn("ic-hashtree-empty"));case Ee.Pruned:return t[1];case Ee.Leaf:return ve($(Kn("ic-hashtree-leaf"),t[1]));case Ee.Labeled:return ve($(Kn("ic-hashtree-labeled"),t[1],await es(t[2])));case Ee.Fork:return ve($(Kn("ic-hashtree-fork"),await es(t[1]),await es(t[2])));default:throw Yt}}function Kn(t){let e=new Uint8Array([t.length]),r=new TextEncoder().encode(t);return $(e,r)}function Hc(t){return typeof t[0]=="string"?W(t[0]):t[0]}var Me;(function(t){t.Unknown="Unknown",t.Absent="Absent",t.Found="Found",t.Error="Error"})(Me||(Me={}));var Tr;(function(t){t.Absent="Absent",t.Unknown="Unknown",t.Found="Found"})(Tr||(Tr={}));var te;(function(t){t.Absent="Absent",t.Unknown="Unknown",t.Found="Found",t.Less="Less",t.Greater="Greater"})(te||(te={}));function Ar(t,e){if(t.length===0)switch(e[0]){case Ee.Empty:return{status:Me.Absent};case Ee.Leaf:{if(!e[1])throw ue.fromCode(new Zt("Invalid tree structure for leaf"));if(e[1]instanceof Uint8Array)return{status:Me.Found,value:e[1].slice(e[1].byteOffset,e[1].byteLength+e[1].byteOffset)};throw Yt}case Ee.Pruned:return{status:Me.Unknown};case Ee.Labeled:case Ee.Fork:return{status:Me.Error};default:throw Yt}let r=Hc(t),n=Hn(r,e);switch(n.status){case te.Found:return Ar(t.slice(1),n.value);case te.Absent:case te.Greater:case te.Less:return{status:Me.Absent};case te.Unknown:return{status:Me.Unknown};default:throw Yt}}function rs(t,e){if(t.length===0)return{status:Tr.Found,value:e};let r=Hc(t),n=Hn(r,e);switch(n.status){case te.Found:return rs(t.slice(1),n.value);case te.Unknown:return{status:Tr.Unknown};case te.Absent:case te.Greater:case te.Less:return{status:Tr.Absent};default:throw Yt}}function ts(t){switch(t[0]){case Ee.Empty:return[];case Ee.Fork:return ts(t[1]).concat(ts(t[2]));default:return[t]}}function Hn(t,e){switch(e[0]){case Ee.Labeled:return ud(t,e[1])?{status:te.Greater}:wr(t,e[1])?{status:te.Found,value:e[2]}:{status:te.Less};case Ee.Fork:{let r=Hn(t,e[1]);switch(r.status){case te.Greater:{let n=Hn(t,e[2]);return n.status===te.Less?{status:te.Absent}:n}case te.Unknown:{let n=Hn(t,e[2]);return n.status===te.Less?{status:te.Unknown}:n}default:return r}}case Ee.Pruned:return{status:te.Unknown};default:return{status:te.Absent}}}function xi(t){let{canisterId:e,subnetId:r,tree:n}=t,o=Ar(["subnet",r.toUint8Array(),"canister_ranges"],n);if(o.status!==Me.Found)throw J.fromCode(new Et(`Could not find canister ranges for subnet ${r.toText()}`,o.status));if(!(o.value instanceof Uint8Array))throw J.fromCode(new kr(`Could not find canister ranges for subnet ${r.toText()}`));return Fe(o.value).map(c=>[L.fromUint8Array(c[0]),L.fromUint8Array(c[1])]).some(c=>c[0].ltEq(e)&&c[1].gtEq(e))}var _i=async t=>{let{agent:e,paths:r,disableCertificateTimeVerification:n=!1}=t,o=L.from(t.canisterId),s=[...new Set(r)],i=new Map,a=s.map((c,u)=>{let l=pd(c,o);return(async()=>{try{if(e.rootKey===null)throw me.fromCode(new ut);let d=e.rootKey,f=await e.readState(o,{paths:[l]}),h=await or.create({certificate:f.certificate,rootKey:d,canisterId:o,disableTimeVerification:n,agent:e}),p=(y,w)=>{if(w==="subnet"){let b=hd(f.certificate,o,d);return{path:w,data:b}}else return{path:w,data:Be(y.lookup_path(l))}},{path:m,data:g}=p(h,s[u]);if(!g)console.warn(`Expected to find result for path ${m}, but instead found nothing.`),typeof m=="string"?i.set(m,null):i.set(m.key,null);else switch(m){case"time":{i.set(m,tn(g));break}case"controllers":{i.set(m,md(g));break}case"module_hash":{i.set(m,F(g));break}case"subnet":{i.set(m,g);break}case"candid":{i.set(m,new TextDecoder().decode(g));break}default:if(typeof m!="string"&&"key"in m&&"path"in m)switch(m.decodeStrategy){case"raw":i.set(m.key,g);break;case"leb128":{i.set(m.key,wi(g));break}case"cbor":{i.set(m.key,Fe(g));break}case"hex":{i.set(m.key,F(g));break}case"utf-8":i.set(m.key,new TextDecoder().decode(g))}}}catch(d){if(d instanceof We&&(d.hasCode(Ht)||d.hasCode(lr)))throw d;typeof c!="string"&&"key"in c&&"path"in c?i.set(c.key,null):i.set(c,null),console.group(),console.warn(`Expected to find result for path ${c}, but instead found nothing.`),console.warn(d),console.groupEnd()}})()});return await Promise.all(a),i},hd=(t,e,r)=>{if(!e._isPrincipal)throw G.fromCode(new Ae("Invalid canisterId"));let n=Fe(t),o=n.tree,s=n.delegation,i;if(s&&s.subnet_id?i=L.fromUint8Array(new Uint8Array(s.subnet_id)):!s&&typeof r<"u"?(i=L.selfAuthenticating(new Uint8Array(r)),s={subnet_id:i.toUint8Array(),certificate:new Uint8Array(0)}):(i=L.selfAuthenticating(L.fromText("tdb26-jop6k-aogll-7ltgs-eruif-6kk7m-qpktf-gdiqx-mxtrf-vb5e6-eqe").toUint8Array()),s={subnet_id:i.toUint8Array(),certificate:new Uint8Array(0)}),!xi({canisterId:e,subnetId:i,tree:o}))throw Te.fromCode(new Dr(e,i));let c=rs(["subnet",s.subnet_id,"node"],o);if(c.status!==Tr.Found)throw J.fromCode(new Et("Node not found",c.status));if(c.value instanceof Uint8Array)throw ue.fromCode(new Zt("Invalid node tree"));let u=ts(c.value),l=new Map;return u.forEach(d=>{let f=L.from(d[1]).toText(),h=Ar(["public_key"],d[2]);if(h.status!==Me.Found)throw J.fromCode(new Et("Public key not found",h.status));let p=h.value;if(p.byteLength!==44)throw J.fromCode(new Mr(44,p.byteLength));l.set(f,p)}),{subnetId:L.fromUint8Array(new Uint8Array(s.subnet_id)).toText(),nodeKeys:l}},pd=(t,e)=>{let r=e.toUint8Array();switch(t){case"time":return[W("time")];case"controllers":return[W("canister"),r,W("controllers")];case"module_hash":return[W("canister"),r,W("module_hash")];case"subnet":return[W("subnet")];case"candid":return[W("canister"),r,W("metadata"),W("candid:service")];default:if("key"in t&&"path"in t)if(typeof t.path=="string"||t.path instanceof Uint8Array){let n=t.path,o=typeof n=="string"?W(n):n;return[W("canister"),r,W("metadata"),o]}else return t.path}throw ue.fromCode(new Ae(`Error while encoding your path for canister status. Please ensure that your path ${t} was formatted correctly.`))},md=t=>Fe(t).map(r=>L.fromUint8Array(r));var sr=BigInt(0),be=BigInt(1),Ei=BigInt(2),yd=BigInt(8);function bd(t,e,r,n){let o=t.sqr(r),s=t.sqr(n),i=t.add(t.mul(e.a,o),s),a=t.add(t.ONE,t.mul(e.d,t.mul(o,s)));return t.eql(i,a)}function gd(t,e={}){let r=Yo("edwards",t,e,e.FpFnLE),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i}=s;Rt(e,{},{uvRatio:"function"});let a=Ei<<BigInt(o.BYTES*8)-be,c=g=>n.create(g),u=e.uvRatio||((g,y)=>{try{return{isValid:!0,value:n.sqrt(n.div(g,y))}}catch{return{isValid:!1,value:sr}}});if(!bd(n,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function l(g,y,w=!1){let b=w?be:sr;return Ho("coordinate "+g,y,b,a),y}function d(g){if(!(g instanceof p))throw new Error("ExtendedPoint expected")}let f=tr((g,y)=>{let{X:w,Y:b,Z:E}=g,I=g.is0();y==null&&(y=I?yd:n.inv(E));let S=c(w*y),B=c(b*y),A=n.mul(E,y);if(I)return{x:sr,y:be};if(A!==be)throw new Error("invZ was invalid");return{x:S,y:B}}),h=tr(g=>{let{a:y,d:w}=s;if(g.is0())throw new Error("bad point: ZERO");let{X:b,Y:E,Z:I,T:S}=g,B=c(b*b),A=c(E*E),_=c(I*I),T=c(_*_),P=c(B*y),C=c(_*c(P+A)),x=c(T+c(w*c(B*A)));if(C!==x)throw new Error("bad point: equation left != right (1)");let v=c(b*E),R=c(I*S);if(v!==R)throw new Error("bad point: equation left != right (2)");return!0});class p{constructor(y,w,b,E){this.X=l("x",y),this.Y=l("y",w),this.Z=l("z",b,!0),this.T=l("t",E),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){if(y instanceof p)throw new Error("extended point not allowed");let{x:w,y:b}=y||{};return l("x",w),l("y",b),new p(w,b,be,c(w*b))}static fromBytes(y,w=!1){let b=n.BYTES,{a:E,d:I}=s;y=Ws(er(y,b,"point")),Er(w,"zip215");let S=Ws(y),B=y[b-1];S[b-1]=B&-129;let A=Ot(S),_=w?a:n.ORDER;Ho("point.y",A,sr,_);let T=c(A*A),P=c(T-be),C=c(I*T-E),{isValid:x,value:v}=u(P,C);if(!x)throw new Error("bad point: invalid y coordinate");let R=(v&be)===be,k=(B&128)!==0;if(!w&&v===sr&&k)throw new Error("bad point: x=0 and x_0=1");return k!==R&&(v=c(-v)),p.fromAffine({x:v,y:A})}static fromHex(y,w=!1){return p.fromBytes(oe("point",y),w)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,w=!0){return m.createCache(this,y),w||this.multiply(Ei),this}assertValidity(){h(this)}equals(y){d(y);let{X:w,Y:b,Z:E}=this,{X:I,Y:S,Z:B}=y,A=c(w*B),_=c(I*E),T=c(b*B),P=c(S*E);return A===_&&T===P}is0(){return this.equals(p.ZERO)}negate(){return new p(c(-this.X),this.Y,this.Z,c(-this.T))}double(){let{a:y}=s,{X:w,Y:b,Z:E}=this,I=c(w*w),S=c(b*b),B=c(Ei*c(E*E)),A=c(y*I),_=w+b,T=c(c(_*_)-I-S),P=A+S,C=P-B,x=A-S,v=c(T*C),R=c(P*x),k=c(T*x),j=c(C*P);return new p(v,R,j,k)}add(y){d(y);let{a:w,d:b}=s,{X:E,Y:I,Z:S,T:B}=this,{X:A,Y:_,Z:T,T:P}=y,C=c(E*A),x=c(I*_),v=c(B*b*P),R=c(S*T),k=c((E+I)*(A+_)-C-x),j=R-v,O=R+v,N=c(x-w*C),U=c(k*j),M=c(O*N),q=c(k*N),xe=c(j*O);return new p(U,M,xe,q)}subtract(y){return this.add(y.negate())}multiply(y){if(!o.isValidNot0(y))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:w,f:b}=m.cached(this,y,E=>Ke(p,E));return Ke(p,[w,b])[0]}multiplyUnsafe(y,w=p.ZERO){if(!o.isValid(y))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return y===sr?p.ZERO:this.is0()||y===be?this:m.unsafe(this,y,b=>Ke(p,b),w)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return m.unsafe(this,s.n).is0()}toAffine(y){return f(this,y)}clearCofactor(){return i===be?this:this.multiplyUnsafe(i)}toBytes(){let{x:y,y:w}=this.toAffine(),b=n.toBytes(w);return b[b.length-1]|=y&be?128:0,b}toHex(){return F(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(y){return Ke(p,y)}static msm(y,w){return Jr(p,o,y,w)}_setWindowSize(y){this.precompute(y)}toRawBytes(){return this.toBytes()}}p.BASE=new p(s.Gx,s.Gy,be,c(s.Gx*s.Gy)),p.ZERO=new p(sr,be,be,sr),p.Fp=n,p.Fn=o;let m=new Xr(p,o.BITS);return p.BASE.precompute(8),p}var ns=class{constructor(e){this.ep=e}static fromBytes(e){zr()}static fromHex(e){zr()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(e){return this.ep.toAffine(e)}toHex(){return F(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(e){return this.assertSame(e),this.init(this.ep.add(e.ep))}subtract(e){return this.assertSame(e),this.init(this.ep.subtract(e.ep))}multiply(e){return this.init(this.ep.multiply(e))}multiplyUnsafe(e){return this.init(this.ep.multiplyUnsafe(e))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(e,r){return this.init(this.ep.precompute(e,r))}toRawBytes(){return this.toBytes()}};function wd(t,e,r={}){if(typeof e!="function")throw new Error('"hash" function param is required');Rt(r,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:n}=r,{BASE:o,Fp:s,Fn:i}=t,a=r.randomBytes||Ur,c=r.adjustScalarBytes||(_=>_),u=r.domain||((_,T,P)=>{if(Er(P,"phflag"),T.length||P)throw new Error("Contexts/pre-hash are not supported");return _});function l(_){return i.create(Ot(_))}function d(_){let T=b.secretKey;_=oe("private key",_,T);let P=oe("hashed private key",e(_),2*T),C=c(P.slice(0,T)),x=P.slice(T,2*T),v=l(C);return{head:C,prefix:x,scalar:v}}function f(_){let{head:T,prefix:P,scalar:C}=d(_),x=o.multiply(C),v=x.toBytes();return{head:T,prefix:P,scalar:C,point:x,pointBytes:v}}function h(_){return f(_).pointBytes}function p(_=Uint8Array.of(),...T){let P=$(...T);return l(e(u(P,oe("context",_),!!n)))}function m(_,T,P={}){_=oe("message",_),n&&(_=n(_));let{prefix:C,scalar:x,pointBytes:v}=f(T),R=p(P.context,C,_),k=o.multiply(R).toBytes(),j=p(P.context,k,v,_),O=i.create(R+j*x);if(!i.isValid(O))throw new Error("sign failed: invalid s");let N=$(k,i.toBytes(O));return er(N,b.signature,"result")}let g={zip215:!0};function y(_,T,P,C=g){let{context:x,zip215:v}=C,R=b.signature;_=oe("signature",_,R),T=oe("message",T),P=oe("publicKey",P,b.publicKey),v!==void 0&&Er(v,"zip215"),n&&(T=n(T));let k=R/2,j=_.subarray(0,k),O=Ot(_.subarray(k,R)),N,U,M;try{N=t.fromBytes(P,v),U=t.fromBytes(j,v),M=o.multiplyUnsafe(O)}catch{return!1}if(!v&&N.isSmallOrder())return!1;let q=p(x,U.toBytes(),N.toBytes(),T);return U.add(N.multiplyUnsafe(q)).subtract(M).clearCofactor().is0()}let w=s.BYTES,b={secretKey:w,publicKey:w,signature:2*w,seed:w};function E(_=a(b.seed)){return er(_,b.seed,"seed")}function I(_){let T=A.randomSecretKey(_);return{secretKey:T,publicKey:h(T)}}function S(_){return ct(_)&&_.length===i.BYTES}function B(_,T){try{return!!t.fromBytes(_,T)}catch{return!1}}let A={getExtendedPublicKey:f,randomSecretKey:E,isValidSecretKey:S,isValidPublicKey:B,toMontgomery(_){let{y:T}=t.fromBytes(_),P=b.publicKey,C=P===32;if(!C&&P!==57)throw new Error("only defined for 25519 and 448");let x=C?s.div(be+T,be-T):s.div(T-be,T+be);return s.toBytes(x)},toMontgomeryPriv(_){let T=b.secretKey;er(_,T);let P=e(_.subarray(0,T));return c(P).subarray(0,T)},randomPrivateKey:E,precompute(_=8,T=t.BASE){return T.precompute(_,!1)}};return Object.freeze({keygen:I,getPublicKey:h,sign:m,verify:y,utils:A,Point:t,lengths:b})}function xd(t){let e={a:t.a,d:t.d,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=Re(e.n,t.nBitLength,!0),o={Fp:r,Fn:n,uvRatio:t.uvRatio},s={randomBytes:t.randomBytes,adjustScalarBytes:t.adjustScalarBytes,domain:t.domain,prehash:t.prehash,mapToCurve:t.mapToCurve};return{CURVE:e,curveOpts:o,hash:t.hash,eddsaOpts:s}}function _d(t,e){let r=e.Point;return Object.assign({},e,{ExtendedPoint:r,CURVE:t,nBitLength:r.Fn.BITS,nByteLength:r.Fn.BYTES})}function Gc(t){let{CURVE:e,curveOpts:r,hash:n,eddsaOpts:o}=xd(t),s=gd(e,r),i=wd(s,n,o);return _d(t,i)}var Ed=BigInt(0),Dt=BigInt(1),Zc=BigInt(2),J0=BigInt(3),vd=BigInt(5),Id=BigInt(8),rn=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Gn={p:rn,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Id,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Bd(t){let e=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=rn,a=t*t%s*t%s,c=ot(a,Zc,s)*a%s,u=ot(c,Dt,s)*t%s,l=ot(u,vd,s)*u%s,d=ot(l,e,s)*l%s,f=ot(d,r,s)*d%s,h=ot(f,n,s)*f%s,p=ot(h,o,s)*h%s,m=ot(p,o,s)*h%s,g=ot(m,e,s)*l%s;return{pow_p_5_8:ot(g,Zc,s)*t%s,b2:a}}function Sd(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}var vi=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Si(t,e){let r=rn,n=ee(e*e*e,r),o=ee(n*n*e,r),s=Bd(t*o).pow_p_5_8,i=ee(t*n*s,r),a=ee(e*i*i,r),c=i,u=ee(i*vi,r),l=a===t,d=a===ee(-t,r),f=a===ee(-t*vi,r);return l&&(i=c),(d||f)&&(i=u),Nt(i,r)&&(i=ee(-i,r)),{isValid:l||d,value:i}}var ir=Re(Gn.p,{isLE:!0}),Td=Re(Gn.n,{isLE:!0}),Ad={...Gn,Fp:ir,hash:ga,adjustScalarBytes:Sd,uvRatio:Si},Ue=Gc(Ad);var Ii=vi,Od=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Cd=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Rd=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Nd=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Yc=t=>Si(Dt,t),Pd=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Bi=t=>Ue.Point.Fp.create(Ot(t)&Pd);function zc(t){let{d:e}=Gn,r=rn,n=y=>ir.create(y),o=n(Ii*t*t),s=n((o+Dt)*Rd),i=BigInt(-1),a=n((i-e*o)*n(o+e)),{isValid:c,value:u}=Si(s,a),l=n(u*t);Nt(l,r)||(l=n(-l)),c||(u=l),c||(i=o);let d=n(i*(o-Dt)*Nd-a),f=u*u,h=n((u+u)*a),p=n(d*Od),m=n(Dt-f),g=n(Dt+f);return new Ue.Point(n(h*g),n(m*p),n(p*g),n(h*m))}function Ud(t){se(t,64);let e=Bi(t.subarray(0,32)),r=zc(e),n=Bi(t.subarray(32,64)),o=zc(n);return new kt(r.add(o))}var kt=class t extends ns{constructor(e){super(e)}static fromAffine(e){return new t(Ue.Point.fromAffine(e))}assertSame(e){if(!(e instanceof t))throw new Error("RistrettoPoint expected")}init(e){return new t(e)}static hashToCurve(e){return Ud(oe("ristrettoHash",e,64))}static fromBytes(e){se(e,32);let{a:r,d:n}=Gn,o=rn,s=E=>ir.create(E),i=Bi(e);if(!lc(ir.toBytes(i),e)||Nt(i,o))throw new Error("invalid ristretto255 encoding 1");let a=s(i*i),c=s(Dt+r*a),u=s(Dt-r*a),l=s(c*c),d=s(u*u),f=s(r*n*l-d),{isValid:h,value:p}=Yc(s(f*d)),m=s(p*u),g=s(p*m*f),y=s((i+i)*m);Nt(y,o)&&(y=s(-y));let w=s(c*g),b=s(y*w);if(!h||Nt(b,o)||w===Ed)throw new Error("invalid ristretto255 encoding 2");return new t(new Ue.Point(y,w,Dt,b))}static fromHex(e){return t.fromBytes(oe("ristrettoHex",e,32))}static msm(e,r){return Jr(t,Ue.Point.Fn,e,r)}toBytes(){let{X:e,Y:r,Z:n,T:o}=this.ep,s=rn,i=g=>ir.create(g),a=i(i(n+r)*i(n-r)),c=i(e*r),u=i(c*c),{value:l}=Yc(i(a*u)),d=i(l*a),f=i(l*c),h=i(d*f*o),p;if(Nt(o*h,s)){let g=i(r*Ii),y=i(e*Ii);e=g,r=y,p=i(d*Cd)}else p=f;Nt(e*h,s)&&(r=i(-r));let m=i((n-r)*p);return Nt(m,s)&&(m=i(-m)),ir.toBytes(m)}equals(e){this.assertSame(e);let{X:r,Y:n}=this.ep,{X:o,Y:s}=e.ep,i=u=>ir.create(u),a=i(r*s)===i(n*o),c=i(n*s)===i(r*o);return a||c}is0(){return this.equals(t.ZERO)}};kt.BASE=new kt(Ue.Point.BASE);kt.ZERO=new kt(Ue.Point.ZERO);kt.Fp=ir;kt.Fn=Td;var Wc,Xc,os=class{static{Wc=Symbol.iterator,Xc=Symbol.toStringTag}#e;#t;constructor(e={}){this[Wc]=this.entries.bind(this),this[Xc]="ExpirableMap";let{source:r=[],expirationTime:n=600*1e3}=e,o=Date.now();this.#e=new Map([...r].map(([s,i])=>[s,{value:i,timestamp:o}])),this.#t=n}prune(){let e=Date.now();for(let[r,n]of this.#e.entries())e-n.timestamp>this.#t&&this.#e.delete(r);return this}set(e,r){this.prune();let n={value:r,timestamp:Date.now()};return this.#e.set(e,n),this}get(e){let r=this.#e.get(e);if(r!==void 0){if(Date.now()-r.timestamp>this.#t){this.#e.delete(e);return}return r.value}}clear(){this.#e.clear()}entries(){let e=this.#e.entries();return function*(){for(let[n,o]of e)yield[n,o.value]}()}values(){let e=this.#e.values();return function*(){for(let n of e)yield n.value}()}keys(){return this.#e.keys()}forEach(e,r){for(let[n,o]of this.#e.entries())e.call(r,o.value,n,this)}has(e){return this.#e.has(e)}delete(e){return this.#e.delete(e)}get size(){return this.#e.size}};var Jc=t=>{if(t<=127)return 1;if(t<=255)return 2;if(t<=65535)return 3;if(t<=16777215)return 4;throw G.fromCode(new mn("Length too long (> 4 bytes)"))},Qc=(t,e,r)=>{if(r<=127)return t[e]=r,1;if(r<=255)return t[e]=129,t[e+1]=r,2;if(r<=65535)return t[e]=130,t[e+1]=r>>8,t[e+2]=r,3;if(r<=16777215)return t[e]=131,t[e+1]=r>>16,t[e+2]=r>>8,t[e+3]=r,4;throw G.fromCode(new mn("Length too long (> 4 bytes)"))},Ti=(t,e)=>{if(t[e]<128)return 1;if(t[e]===128)throw G.fromCode(new Xe("Invalid length 0"));if(t[e]===129)return 2;if(t[e]===130)return 3;if(t[e]===131)return 4;throw G.fromCode(new Xe("Length too long (> 4 bytes)"))},Dd=(t,e)=>{let r=Ti(t,e);if(r===1)return t[e];if(r===2)return t[e+1];if(r===3)return(t[e+1]<<8)+t[e+2];if(r===4)return(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];throw G.fromCode(new Xe("Length too long (> 4 bytes)"))},np=Uint8Array.from([48,12,6,10,43,6,1,4,1,131,184,67,1,1]),nn=Uint8Array.from([48,5,6,3,43,101,112]),op=Uint8Array.from([48,16,6,7,42,134,72,206,61,2,1,6,5,43,129,4,0,10]),sp=Uint8Array.from([48,29,6,13,43,6,1,4,1,130,220,124,5,3,1,2,1,6,12,43,6,1,4,1,130,220,124,5,3,2,1]);function ss(t,e){let r=2+Jc(t.byteLength+1),n=e.byteLength+r+t.byteLength,o=0,s=new Uint8Array(1+Jc(n)+n);return s[o++]=48,o+=Qc(s,o,n),s.set(e,o),o+=e.byteLength,s[o++]=3,o+=Qc(s,o,t.byteLength+1),s[o++]=0,s.set(new Uint8Array(t),o),s}var is=(t,e)=>{let r=0,n=(a,c)=>{if(o[r++]!==a)throw G.fromCode(new Xe(`Expected ${c} at offset ${r}`))},o=new Uint8Array(t);if(n(48,"sequence"),r+=Ti(o,r),!wr(o.slice(r,r+e.byteLength),e))throw G.fromCode(new Xe("Not the expected OID."));r+=e.byteLength,n(3,"bit string");let s=Dd(o,r)-1;r+=Ti(o,r),n(0,"0 padding");let i=o.slice(r);if(s!==i.length)throw G.fromCode(new yo(s,i.length));return i};var as=class t{static from(e){return this.fromDer(e.toDer())}static fromRaw(e){return new t(e)}static fromDer(e){return new t(this.derDecode(e))}static{this.RAW_KEY_LENGTH=32}static derEncode(e){return ss(e,nn)}static derDecode(e){let r=is(e,nn);if(r.length!==this.RAW_KEY_LENGTH)throw G.fromCode(new Xe("An Ed25519 public key must be exactly 32 bytes long"));return r}#e;get rawKey(){return this.#e}#t;get derKey(){return this.#t}constructor(e){if(e.byteLength!==t.RAW_KEY_LENGTH)throw G.fromCode(new Xe("An Ed25519 public key must be exactly 32 bytes long"));this.#e=e,this.#t=t.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}};var Ai=class{constructor(){this.observers=[]}subscribe(e){this.observers.push(e)}unsubscribe(e){this.observers=this.observers.filter(r=>r!==e)}notify(e,...r){this.observers.forEach(n=>n(e,...r))}},cs=class extends Ai{constructor(){super()}print(e,...r){this.notify({message:e,level:"info"},...r)}warn(e,...r){this.notify({message:e,level:"warn"},...r)}error(e,r,...n){this.notify({message:e,level:"error",error:r},...n)}};var fs=class t{#e;#t;#n;#c;#i;#u;#r;#o;#a=0;static{this.default={initialInterval:500,randomizationFactor:.5,multiplier:1.5,maxInterval:6e4,maxElapsedTime:9e5,maxIterations:10,date:Date}}constructor(e=t.default){let{initialInterval:r=500,randomizationFactor:n=.5,multiplier:o=1.5,maxInterval:s=6e4,maxElapsedTime:i=9e5,maxIterations:a=10,date:c=Date}=e;this.#e=r,this.#t=n,this.#n=o,this.#c=s,this.#o=c,this.#i=c.now(),this.#u=i,this.#r=a}get ellapsedTimeInMsec(){return this.#o.now()-this.#i}get currentInterval(){return this.#e}get count(){return this.#a}get randomValueFromInterval(){let e=this.#t*this.#e,r=this.#e-e,n=this.#e+e;return Math.random()*(n-r)+r}incrementCurrentInterval(){return this.#e=Math.min(this.#e*this.#n,this.#c),this.#a++,this.#e}next(){return this.ellapsedTimeInMsec>=this.#u||this.#a>=this.#r?null:(this.incrementCurrentInterval(),this.randomValueFromInterval)}};var mt;(function(t){t.Received="received",t.Processing="processing",t.Replied="replied",t.Rejected="rejected",t.Unknown="unknown",t.Done="done"})(mt||(mt={}));var Ri=60*1e3,kd=1e6,Md=0,Ld="308182301d060d2b0601040182dc7c0503010201060c2b0601040182dc7c05030201036100814c0e6ec71fab583b08bd81373c255c3c371b2e84863c98a4f1e08b74235d14fb5d9c0cd546d9685f913a0c0b2cc5341583bf4b4392e467db96d65b9bb4cb717112f8472e0d5a4d14505ffd7484b01291091c5f87b98883463f98091a0baaae";var qd="ic0.app",Fd=".ic0.app",$d="icp0.io",Vd=".icp0.io",jd="icp-api.io",Kd=".icp-api.io",Oi=200,Hd=202,Gd=404;function Zd(){let t;if(typeof window<"u")if(window.fetch)t=window.fetch.bind(window);else throw me.fromCode(new qr("Fetch implementation was not available. You appear to be in a browser context, but window.fetch was not present."));else if(typeof global<"u")if(global.fetch)t=global.fetch.bind(global);else throw me.fromCode(new qr("Fetch implementation was not available. You appear to be in a Node.js context, but global.fetch was not available."));else typeof self<"u"&&self.fetch&&(t=self.fetch.bind(self));if(t)return t;throw me.fromCode(new qr("Fetch implementation was not available. Please provide fetch to the HttpAgent constructor, or ensure it is available in the window or global context."))}function Yd(t){let e;if(t!==void 0)!t.match(/^[a-z]+:/)&&typeof window<"u"?e=new URL(window.location.protocol+"//"+t):e=new URL(t);else{let r=["ic0.app","icp0.io","127.0.0.1","localhost"],n=[".github.dev",".gitpod.io"],o=typeof window<"u"?window.location:void 0,s=o?.hostname,i;s&&typeof s=="string"&&(n.some(a=>s.endsWith(a))?i=s:i=r.find(a=>s.endsWith(a))),o&&i?e=new URL(`${o.protocol}//${i}${o.port?":"+o.port:""}`):e=new URL("https://icp-api.io")}return e.toString()}var Or=class t{#e;#t;#n;#c;#i;#u;#r;#o;#a;#w;#s;#d;#l;#f;get#v(){return this.#f*Ri}#h;#p;#m;#y;constructor(e={}){this.#e=null,this.#t=!1,this.#n=Md,this.#c=!1,this.#i=null,this.#u=!1,this._isAgent=!0,this.config={},this.log=new cs,this.#h=[],this.#p=[],this.#m=new os({expirationTime:5*Ri}),this.#y=!0,this.#_=(o,s)=>{if(this.#y===!1)return o;let{status:i,signatures:a=[],requestId:c}=o;for(let u of a){let{timestamp:l,identity:d}=u,f=L.fromUint8Array(d).toText(),h;if(i===Ft.Replied){let{reply:w}=o;h=Tn({status:i,reply:w,timestamp:BigInt(l),request_id:c})}else if(i===Ft.Rejected){let{reject_code:w,reject_message:b,error_code:E}=o;h=Tn({status:i,reject_code:w,reject_message:b,error_code:E,timestamp:BigInt(l),request_id:c})}else throw ue.fromCode(new Ae(`Unknown status: ${i}`));let p=$(qs,h),m=s.nodeKeys.get(f);if(!m)throw J.fromCode(new To);let g=as.fromDer(m).rawKey;if(Ue.verify(u.signature,p,g))return o;throw Te.fromCode(new Ao(f))}return o},this.config=e,this.#o=e.fetch||Zd()||fetch.bind(global),this.#a=e.fetchOptions,this.#w=e.callOptions,this.#t=e.shouldFetchRootKey??!1,this.#u=e.shouldSyncTime??!1,e.rootKey?this.rootKey=e.rootKey:this.#t?this.rootKey=null:this.rootKey=pe(Ld);let r=Yd(e.host);this.host=new URL(r),e.verifyQuerySignatures!==void 0&&(this.#y=e.verifyQuerySignatures),this.#d=e.retryTimes??3;let n=()=>new fs({maxIterations:this.#d});if(this.#l=e.backoffStrategy||n,this.host.hostname.endsWith(Fd)?this.host.hostname=qd:this.host.hostname.endsWith(Vd)?this.host.hostname=$d:this.host.hostname.endsWith(Kd)&&(this.host.hostname=jd),e.credentials){let{name:o,password:s}=e.credentials;this.#s=`${o}${s?":"+s:""}`}if(this.#r=Promise.resolve(e.identity||new Qt),e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes>5)throw G.fromCode(new pr("The maximum ingress expiry time is 5 minutes.",e.ingressExpiryInMinutes));if(e.ingressExpiryInMinutes&&e.ingressExpiryInMinutes<=0)throw G.fromCode(new pr("Ingress expiry time must be greater than 0.",e.ingressExpiryInMinutes));this.#f=e.ingressExpiryInMinutes||5,this.addTransform("update",Gs(Un)),e.useQueryNonces&&this.addTransform("query",Gs(Un)),e.logToConsole&&this.log.subscribe(o=>{o.level==="error"?console.error(o.message):o.level==="warn"?console.warn(o.message):console.log(o.message)})}static createSync(e={}){return new this({...e})}static async create(e={}){let r=t.createSync(e);return await r.#g(),r}static async from(e){try{return"config"in e?await t.create(e.config):await t.create({fetch:e._fetch,fetchOptions:e._fetchOptions,callOptions:e._callOptions,host:e._host.toString(),identity:e._identity??void 0})}catch{throw G.fromCode(new Io)}}isLocal(){let e=this.host.hostname;return e==="127.0.0.1"||e.endsWith("127.0.0.1")}addTransform(e,r,n=r.priority||0){if(e==="update"){let o=this.#p.findIndex(s=>(s.priority||0)<n);this.#p.splice(o>=0?o:this.#p.length,0,Object.assign(r,{priority:n}))}else if(e==="query"){let o=this.#h.findIndex(s=>(s.priority||0)<n);this.#h.splice(o>=0?o:this.#h.length,0,Object.assign(r,{priority:n}))}}async getPrincipal(){if(!this.#r)throw me.fromCode(new Gt);return(await this.#r).getPrincipal()}async call(e,r,n){let o=r.callSync??!0,s=await(n??this.#r);if(!s)throw me.fromCode(new Gt);let i=L.from(e),a=r.effectiveCanisterId?L.from(r.effectiveCanisterId):i;await this.#g(a);let c=s.getPrincipal(),u=Ci(this.#f,this.#n),l={request_type:$o.Call,canister_id:i,method_name:r.methodName,arg:r.arg,sender:c,ingress_expiry:u},d=await this._transform({request:{body:null,method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:At.Call,body:l}),f;r?.nonce?f=h(r.nonce):d.body.nonce?f=h(d.body.nonce):f=void 0,l.nonce=f;function h(y){return Object.assign(y,{__nonce__:void 0})}d=await s.transformRequest(d);let p=Fo(d.body),m=this.#l(),g=St(l);try{let b=o?()=>(this.log.print(`fetching "/api/v3/canister/${a.toText()}/call" with request:`,d),this.#o(""+new URL(`/api/v3/canister/${a.toText()}/call`,this.host),{...this.#w,...d.request,body:p})):()=>(this.log.print(`fetching "/api/v2/canister/${a.toText()}/call" with request:`,d),this.#o(""+new URL(`/api/v2/canister/${a.toText()}/call`,this.host),{...this.#w,...d.request,body:p})),{responseBodyBytes:E,...I}=await this.#b({requestFn:b,backoff:m,tries:0}),S=E.byteLength>0?Fe(E):null;return{requestId:g,response:{...I,body:S},requestDetails:l}}catch(y){let w;if(y instanceof We){if(y.hasCode(bn))return this.log.warn("v3 api not supported. Fall back to v2"),this.call(e,{...r,callSync:!1},n);if(y.hasCode(pr)&&!this.#c)return await this.syncTime(i),this.call(i,r,n);y.code.requestContext={requestId:g,senderPubKey:d.body.sender_pubkey,senderSignature:d.body.sender_sig,ingressExpiry:d.body.content.ingress_expiry},w=y}else w=ue.fromCode(new Ae(y));throw this.log.error(`Error while making call: ${w.message}`,w),w}}async#x(e){let{ecid:r,transformedRequest:n,body:o,requestId:s,backoff:i,tries:a}=e,c=a===0?0:i.next();if(this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with tries:`,{tries:a,backoff:i,delay:c}),c===null)throw ue.fromCode(new hr(`Backoff strategy exhausted after ${a} attempts.`,s));c>0&&await new Promise(h=>setTimeout(h,c));let u;try{this.log.print(`fetching "/api/v2/canister/${r.toString()}/query" with request:`,n);let h=await this.#o(""+new URL(`/api/v2/canister/${r.toString()}/query`,this.host),{...this.#a,...n.request,body:o});if(h.status===Oi)u={...Fe(Kr(await h.arrayBuffer())),httpDetails:{ok:h.ok,status:h.status,statusText:h.statusText,headers:jo(h.headers)},requestId:s};else throw J.fromCode(new yn(h.status,h.statusText,jo(h.headers),await h.text()))}catch(h){if(a<this.#d)return this.log.warn(`Caught exception while attempting to make query:
  ${h}
  Retrying query.`),await this.#x({...e,tries:a+1});throw h instanceof We?h:pn.fromCode(new gn(h))}if(!this.#y)return u;let l=u.signatures?.[0]?.timestamp;if(!l)throw J.fromCode(new Bo("Timestamp not found in query response. This suggests a malformed or malicious response."));let d=Number(BigInt(l)/BigInt(kd));if(Date.now()+this.#n-d>this.#v){if(a<this.#d)return this.log.warn("Timestamp is older than the max ingress expiry. Retrying query.",{requestId:s,signatureTimestampMs:d}),await this.#x({...e,tries:a+1});throw Te.fromCode(new wo(this.#f,s,a))}return u}async#b(e){let{requestFn:r,backoff:n,tries:o}=e,s=o===0?0:n.next();if(s===null)throw J.fromCode(new hr(`Retry strategy exhausted after ${o} attempts.`));s>0&&await new Promise(l=>setTimeout(l,s));let i,a=new Uint8Array;try{i=await r(),i.status===Oi&&(a=Kr(await i.clone().arrayBuffer()))}catch(l){if(o<this.#d)return this.log.warn(`Caught exception while attempting to make request:
  ${l}
  Retrying request.`),await this.#b({requestFn:r,backoff:n,tries:o+1});throw pn.fromCode(new gn(l))}let c=jo(i.headers);if(i.status===Oi||i.status===Hd)return{ok:i.ok,status:i.status,statusText:i.statusText,responseBodyBytes:a,headers:c};let u=await i.text();if(i.status===Gd&&i.url.includes("api/v3"))throw J.fromCode(new bn);if(u.startsWith("Invalid request expiry: "))throw G.fromCode(new pr(u,this.#f));if(o<this.#d)return await this.#b({requestFn:r,backoff:n,tries:o+1});throw J.fromCode(new yn(i.status,i.statusText,c,u))}async query(e,r,n){let o=this.#l(),s=r.effectiveCanisterId?L.from(r.effectiveCanisterId):L.from(e);await this.#g(s),this.log.print(`ecid ${s.toString()}`),this.log.print(`canisterId ${e.toString()}`);let i,a=await(n??this.#r);if(!a)throw me.fromCode(new Gt);let c=L.from(e),u=a.getPrincipal(),l=Ci(this.#f,this.#n),d={request_type:_r.Query,canister_id:c,method_name:r.methodName,arg:r.arg,sender:u,ingress_expiry:l},f=St(d);i=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:At.Query,body:d}),i=await a.transformRequest(i);let h=Fo(i.body),p={canister:c.toText(),ecid:s,transformedRequest:i,body:h,requestId:f,backoff:o,tries:0},m=async()=>{let y=await this.#x(p);return{requestDetails:d,...y}},g=async()=>{let y=this.#m.get(s.toString());if(y)return y;await this.fetchSubnetKeys(s.toString());let w=this.#m.get(s.toString());if(!w)throw Te.fromCode(new So);return w};try{if(!this.#y)return await m();let[y,w]=await Promise.all([m(),g()]);try{return this.#_(y,w)}catch{this.log.warn("Query response verification failed. Retrying with fresh subnet keys."),this.#m.delete(s.toString());let b=await g();return this.#_(y,b)}}catch(y){let w;throw y instanceof We?(y.code.requestContext={requestId:f,senderPubKey:i.body.sender_pubkey,senderSignature:i.body.sender_sig,ingressExpiry:i.body.content.ingress_expiry},w=y):w=ue.fromCode(new Ae(y)),this.log.error(`Error while making query: ${w.message}`,w),w}}#_;async createReadStateRequest(e,r){await this.#g();let n=await(r??this.#r);if(!n)throw me.fromCode(new Gt);let o=n.getPrincipal(),s=await this._transform({request:{method:"POST",headers:{"Content-Type":"application/cbor",...this.#s?{Authorization:"Basic "+btoa(this.#s)}:{}}},endpoint:At.ReadState,body:{request_type:_r.ReadState,paths:e.paths,sender:o,ingress_expiry:Ci(this.#f,this.#n)}});return n.transformRequest(s)}async readState(e,r,n,o){await this.#E();let s=L.from(e);function i(l){for(let d of l.paths){let[f,h]=d,p=new TextEncoder().encode("request_status");if(wr(f,p))return h}}let a,c;if(o)a=o,c=St(a);else{c=i(r);let l=await this.#r;if(!l)throw me.fromCode(new Gt);a=await this.createReadStateRequest(r,l)}this.log.print(`fetching "/api/v2/canister/${s}/read_state" with request:`,a);let u=this.#l();try{let{responseBodyBytes:l}=await this.#b({requestFn:()=>this.#o(""+new URL(`/api/v2/canister/${s.toString()}/read_state`,this.host),{...this.#a,...a.request,body:Fo(a.body)}),backoff:u,tries:0}),d=Fe(l);return this.log.print("Read state response:",d),d}catch(l){let d;throw l instanceof We?(l.code.requestContext={requestId:c,senderPubKey:a.body.sender_pubkey,senderSignature:a.body.sender_sig,ingressExpiry:a.body.content.ingress_expiry},d=l):d=ue.fromCode(new Ae(l)),this.log.error(`Error while making read state: ${d.message}`,d),d}}parseTimeFromResponse(e){let r;if(e.certificate){let n=Fe(e.certificate);if(n&&"tree"in n)r=n.tree;else throw J.fromCode(new Zt("Could not decode time from response"));let o=Ar(["time"],r);if(o.status!==Me.Found)throw J.fromCode(new Et("Time was not found in the response or was not in its expected format.",o.status));if(!(o.value instanceof Uint8Array)&&!ArrayBuffer.isView(o))throw J.fromCode(new kr("Time was not in its expected format."));let s=tn(o.value);return this.log.print("Time from response:",s),this.log.print("Time from response in milliseconds:",s.getTime()),s.getTime()}else this.log.warn("No certificate found in response");return 0}async syncTime(e){this.#i=this.#i??(async()=>{await this.#E();let r=Date.now();try{e||this.log.print("Syncing time with the IC. No canisterId provided, so falling back to ryjl3-tyaaa-aaaaa-aaaba-cai");let n=e??L.from("ryjl3-tyaaa-aaaaa-aaaba-cai"),o=t.createSync({identity:new Qt,host:this.host.toString(),fetch:this.#o,retryTimes:0,rootKey:this.rootKey??void 0,shouldSyncTime:!1}),i=(await Promise.all(Array(3).fill(null).map(async()=>{let c=(await _i({canisterId:n,agent:o,paths:["time"],disableCertificateTimeVerification:!0})).get("time");if(c instanceof Date)return c.getTime()},[]))).reduce((a,c)=>typeof c=="number"&&c>a?c:a,0);i>0&&(this.#n=i-r,this.#c=!0,this.log.notify({message:`Syncing time: offset of ${this.#n}`,level:"info"}))}catch(n){let o=n instanceof We?n:ue.fromCode(new Ae(n));throw this.log.error("Caught exception while attempting to sync time",o),o}})(),await this.#i.finally(()=>{this.#i=null})}async status(){let e=this.#s?{Authorization:"Basic "+btoa(this.#s)}:{};this.log.print('fetching "/api/v2/status"');let r=this.#l(),{responseBodyBytes:n}=await this.#b({backoff:r,requestFn:()=>this.#o(""+new URL("/api/v2/status",this.host),{headers:e,...this.#a}),tries:0});return Fe(n)}async fetchRootKey(){return this.#e=this.#e??(async()=>{let e=await this.status();return this.rootKey=e.root_key,this.rootKey})(),await this.#e.finally(()=>{this.#e=null})}async#g(e){await Promise.all([this.#E(),this.#I(e)])}async#E(){if(!this.rootKey)if(this.rootKey===null&&this.host.toString()!=="https://icp-api.io"&&this.#t)await this.fetchRootKey();else throw me.fromCode(new ut(this.#t))}async#I(e){this.#u&&!this.hasSyncedTime()&&await this.syncTime(e)}invalidateIdentity(){this.#r=null}replaceIdentity(e){this.#r=Promise.resolve(e)}async fetchSubnetKeys(e){let r=L.from(e);await this.#g(r);let o=(await _i({canisterId:r,paths:["subnet"],agent:this})).get("subnet");if(o&&typeof o=="object"&&"nodeKeys"in o)return this.#m.set(r.toText(),o),o}_transform(e){let r=Promise.resolve(e);if(e.endpoint===At.Call)for(let n of this.#p)r=r.then(o=>n(o).then(s=>s||o));else for(let n of this.#h)r=r.then(o=>n(o).then(s=>s||o));return r}getTimeDiffMsecs(){return this.#n}hasSyncedTime(){return this.#c}};function Ci(t,e){let r=t*Ri;return Yr.fromDeltaInMilliseconds(r,e)}var zd=300*1e3;function Ni(){return el(Xd(Wd(),1e3),Qd(1e3,1.2),Jd(zd))}function Wd(){let t=!0;return async()=>t?(t=!1,!0):!1}function Xd(t,e){return async(r,n,o)=>{if(await t(r,n,o))return new Promise(s=>setTimeout(s,e))}}function Jd(t){let e=Date.now()+t;return async(r,n,o)=>{if(Date.now()>e)throw J.fromCode(new hr(`Request timed out after ${t} msec`,n,o))}}function Qd(t,e){let r=t;return()=>new Promise(n=>setTimeout(()=>{r*=e,n()},r))}function el(...t){return async(e,r,n)=>{for(let o of t)await o(e,r,n)}}var tf={strategy:Ni(),preSignReadStateRequest:!1};function rf(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Pi(t,e){return t!==null&&typeof t=="object"&&rf(t,e)}function rl(t,e){return rf(t,e)&&typeof t[e]=="function"}function ef(t){return Pi(t,"body")&&Pi(t.body,"content")&&t.body.content.request_type===_r.ReadState&&Pi(t.body.content,"ingress_expiry")&&typeof t.body.content.ingress_expiry=="object"&&t.body.content.ingress_expiry!==null&&rl(t.body.content.ingress_expiry,"toHash")}async function Ui(t,e,r,n={}){let o=[W("request_status"),r],s,i;if(n.preSignReadStateRequest??!1?(i=await nl({paths:[o],agent:t,pollingOptions:n}),s=await t.readState(e,{paths:[o]},void 0,i)):s=await t.readState(e,{paths:[o]}),t.rootKey==null)throw me.fromCode(new ut);let c=await or.create({certificate:s.certificate,rootKey:t.rootKey,canisterId:e,blsVerify:n.blsVerify,agent:t}),u=Be(c.lookup_path([...o,W("status")])),l;switch(typeof u>"u"?l=mt.Unknown:l=new TextDecoder().decode(u),l){case mt.Replied:return{reply:Be(c.lookup_path([...o,"reply"])),certificate:c};case mt.Received:case mt.Unknown:case mt.Processing:return await(n.strategy??Ni())(e,r,l),Ui(t,e,r,{...n,request:i});case mt.Rejected:{let d=new Uint8Array(Be(c.lookup_path([...o,"reject_code"])))[0],f=new TextDecoder().decode(Be(c.lookup_path([...o,"reject_message"]))),h=Be(c.lookup_path([...o,"error_code"])),p=h?new TextDecoder().decode(h):void 0;throw Kt.fromCode(new Lr(r,d,f,p))}case mt.Done:throw ue.fromCode(new Eo(r))}throw Yt}async function nl(t){let{paths:e,agent:r,pollingOptions:n}=t;if(n.request&&ef(n.request))return n.request;let o=await r.createReadStateRequest?.({paths:e},void 0);if(!ef(o))throw G.fromCode(new Oo(o));return o}var Ge=Symbol.for("ic-agent-metadata"),us=class t{static agentOf(e){return e[Ge].config.agent}static interfaceOf(e){return e[Ge].service}static canisterIdOf(e){return L.from(e[Ge].config.canisterId)}static createActorClass(e,r){let n=e({IDL:gr});class o extends t{constructor(i){if(!i.canisterId)throw G.fromCode(new wn(i.canisterId));let a=typeof i.canisterId=="string"?L.fromText(i.canisterId):i.canisterId;super({config:{...nf,...i,canisterId:a},service:n});for(let[c,u]of n._fields)r?.httpDetails&&u.annotations.push(Di),r?.certificate&&u.annotations.push(of),this[c]=sl(this,c,u,i.blsVerify)}}return o}static createActor(e,r){if(!r.canisterId)throw G.fromCode(new wn(r.canisterId));return new(this.createActorClass(e))(r)}static createActorWithHttpDetails(e,r){return new(this.createActorClass(e,{httpDetails:!0}))(r)}static createActorWithExtendedDetails(e,r,n={httpDetails:!0,certificate:!0}){return new(this.createActorClass(e,n))(r)}constructor(e){this[Ge]=Object.freeze(e)}};function on(t,e){let r=gr.decode(t,e);switch(r.length){case 0:return;case 1:return r[0];default:return r}}var nf={pollingOptions:tf},Di="http-details",of="certificate";function sl(t,e,r,n){let o;r.annotations.includes("query")||r.annotations.includes("composite_query")?o=async(i,...a)=>{i={...i,...t[Ge].config.queryTransform?.(e,a,{...t[Ge].config,...i})};let c=i.agent||t[Ge].config.agent||new Or,u=L.from(i.canisterId||t[Ge].config.canisterId),l=gr.encode(r.argTypes,a),d=await c.query(u,{methodName:e,arg:l,effectiveCanisterId:i.effectiveCanisterId}),f={...d.httpDetails,requestDetails:d.requestDetails};switch(d.status){case Ft.Rejected:{let h=new xo(d.requestId,d.reject_code,d.reject_message,d.error_code,d.signatures);throw h.callContext={canisterId:u,methodName:e,httpDetails:f},Kt.fromCode(h)}case Ft.Replied:return r.annotations.includes(Di)?{httpDetails:f,result:on(r.retTypes,d.reply.arg)}:on(r.retTypes,d.reply.arg)}}:o=async(i,...a)=>{i={...i,...t[Ge].config.callTransform?.(e,a,{...t[Ge].config,...i})};let c=i.agent||t[Ge].config.agent||Or.createSync(),{canisterId:u,effectiveCanisterId:l,pollingOptions:d}={...nf,...t[Ge].config,...i},f=L.from(u),h=l!==void 0?L.from(l):f,p=gr.encode(r.argTypes,a),{requestId:m,response:g,requestDetails:y}=await c.call(f,{methodName:e,arg:p,effectiveCanisterId:h,nonce:i.nonce}),w,b;if(Qi(g.body)){if(c.rootKey==null)throw me.fromCode(new ut);let B=g.body.certificate;b=await or.create({certificate:B,rootKey:c.rootKey,canisterId:L.from(u),blsVerify:n,agent:c});let A=[W("request_status"),m];switch(new TextDecoder().decode(Be(b.lookup_path([...A,"status"])))){case"replied":w=Be(b.lookup_path([...A,"reply"]));break;case"rejected":{let T=new Uint8Array(Be(b.lookup_path([...A,"reject_code"])))[0],P=new TextDecoder().decode(Be(b.lookup_path([...A,"reject_message"]))),C=Be(b.lookup_path([...A,"error_code"])),x=C?new TextDecoder().decode(C):void 0,v=new Lr(m,T,P,x);throw v.callContext={canisterId:f,methodName:e,httpDetails:g},Kt.fromCode(v)}}}else if(Ji(g.body)){let{reject_code:B,reject_message:A,error_code:_}=g.body,T=new _o(m,B,A,_);throw T.callContext={canisterId:f,methodName:e,httpDetails:g},Kt.fromCode(T)}if(g.status===202){let B={...d,blsVerify:n},A=await Ui(c,h,m,B);b=A.certificate,w=A.reply}let E=r.annotations.includes(Di),I=r.annotations.includes(of),S={...g,requestDetails:y};if(w!==void 0)return E&&I?{httpDetails:S,certificate:b,result:on(r.retTypes,w)}:I?{certificate:b,result:on(r.retTypes,w)}:E?{httpDetails:S,result:on(r.retTypes,w)}:on(r.retTypes,w);{let B=new Ae(`Call was returned undefined. We cannot determine if the call was successful or not. Return types: [${r.retTypes.map(A=>A.display()).join(",")}].`);throw B.callContext={canisterId:f,methodName:e,httpDetails:S},ue.fromCode(B)}};let s=(...i)=>o({},...i);return s.withOptions=i=>(...a)=>o(i,...a),s}function sf(t){return t!==null&&typeof t=="object"}var sn=class t{static from(e){if(typeof e=="string"){let r=pe(e);return this.fromRaw(r)}else if(sf(e)){let r=e;if(sf(r)&&Object.hasOwnProperty.call(r,"__derEncodedPublicKey__"))return this.fromDer(r);if(ArrayBuffer.isView(r)){let n=r;return this.fromRaw(dt(n.buffer))}else{if(r instanceof ArrayBuffer)return this.fromRaw(dt(r));if("rawKey"in r&&r.rawKey instanceof Uint8Array)return this.fromRaw(r.rawKey);if("derKey"in r)return this.fromDer(r.derKey);if("toDer"in r)return this.fromDer(r.toDer())}}throw new Error("Cannot construct Ed25519PublicKey from the provided key.")}static fromRaw(e){return new t(e)}static fromDer(e){return new t(this.derDecode(e))}static{this.RAW_KEY_LENGTH=32}static derEncode(e){let r=ss(e,nn);return r.__derEncodedPublicKey__=void 0,r}static derDecode(e){let r=is(e,nn);if(r.length!==this.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");return r}#e;get rawKey(){return this.#e}#t;get derKey(){return this.#t}constructor(e){if(e.byteLength!==t.RAW_KEY_LENGTH)throw new Error("An Ed25519 public key must be exactly 32bytes long");this.#e=e,this.#t=t.derEncode(e)}toDer(){return this.derKey}toRaw(){return this.rawKey}},Cr=class t extends Jt{static generate(e){if(e&&e.length!==32)throw new Error("Ed25519 Seed needs to be 32 bytes long.");e||(e=Ue.utils.randomPrivateKey()),xa(e,new Uint8Array(new Array(32).fill(0)))&&console.warn("Seed is all zeros. This is not a secure seed. Please provide a seed with sufficient entropy if this is a production environment.");let r=new Uint8Array(32);for(let o=0;o<32;o++)r[o]=e[o];let n=Ue.getPublicKey(r);return t.fromKeyPair(n,r)}static fromParsedJson(e){let[r,n]=e;return new t(sn.fromDer(pe(r)),pe(n))}static fromJSON(e){let r=JSON.parse(e);if(Array.isArray(r)){if(typeof r[0]=="string"&&typeof r[1]=="string")return this.fromParsedJson([r[0],r[1]]);throw new Error("Deserialization error: JSON must have at least 2 items.")}throw new Error(`Deserialization error: Invalid JSON type for string: ${JSON.stringify(e)}`)}static fromKeyPair(e,r){return new t(sn.fromRaw(e),r)}static fromSecretKey(e){let r=Ue.getPublicKey(e);return t.fromKeyPair(r,e)}#e;#t;constructor(e,r){super(),this.#e=sn.from(e),this.#t=r}toJSON(){return[F(this.#e.toDer()),F(this.#t)]}getKeyPair(){return{secretKey:this.#t,publicKey:this.#e}}getPublicKey(){return this.#e}async sign(e){let r=Ue.sign(e,this.#t.slice(0,32));return Object.defineProperty(r,"__signature__",{enumerable:!1,value:void 0}),r}static verify(e,r,n){let[o,s,i]=[e,r,n].map(a=>(typeof a=="string"&&(a=pe(a)),dt(a)));return Ue.verify(o,s,i)}};var ki=class t extends Error{constructor(e){super(e),this.message=e,Object.setPrototypeOf(this,t.prototype)}};function af(t){if(typeof global<"u"&&global.crypto&&global.crypto.subtle)return global.crypto.subtle;if(t)return t;if(typeof crypto<"u"&&crypto.subtle)return crypto.subtle;throw new ki("Global crypto was not available and none was provided. Please inlcude a SubtleCrypto implementation. See https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto")}var Zn=class t extends Jt{static async generate(e){let{extractable:r=!1,keyUsages:n=["sign","verify"],subtleCrypto:o}=e??{},s=af(o),i=await s.generateKey({name:"ECDSA",namedCurve:"P-256"},r,n),a=dt(await s.exportKey("spki",i.publicKey));return Object.assign(a,{__derEncodedPublicKey__:void 0}),new this(i,a,s)}static async fromKeyPair(e,r){let n=af(r),o=dt(await n.exportKey("spki",e.publicKey));return Object.assign(o,{__derEncodedPublicKey__:void 0}),new t(e,o,n)}constructor(e,r,n){super(),this._keyPair=e,this._derKey=r,this._subtleCrypto=n}getKeyPair(){return this._keyPair}getPublicKey(){let e=this._derKey,r=Object.create(this._keyPair.publicKey);return r.toDer=function(){return e},r}async sign(e){let r={name:"ECDSA",hash:{name:"SHA-256"}},n=dt(await this._subtleCrypto.sign(r,this._keyPair.privateKey,e));return Object.assign(n,{__signature__:void 0}),n}};var ds=class{#e;get rawKey(){return this.#e.rawKey}get derKey(){return this.#e.derKey}toDer(){return this.#e.toDer()}getPublicKey(){return this.#e}getPrincipal(){if(!this.#e.rawKey)throw new Error("Cannot get principal from a public key without a raw key.");return L.fromUint8Array(new Uint8Array(this.#e.rawKey))}transformRequest(){return Promise.reject("Not implemented. You are attempting to use a partial identity to sign calls, but this identity only has access to the public key.To sign calls, use a DelegationIdentity instead.")}constructor(e){this.#e=e}};function Mi(t){if(typeof t!="string"||t.length<64)throw new Error("Invalid public key.");return pe(t)}var an=class{constructor(e,r,n){this.pubkey=e,this.expiration=r,this.targets=n}toCborValue(){return{pubkey:this.pubkey,expiration:this.expiration,...this.targets&&{targets:this.targets}}}toJSON(){return{expiration:this.expiration.toString(16),pubkey:F(this.pubkey),...this.targets&&{targets:this.targets.map(e=>e.toHex())}}}};async function il(t,e,r,n){let o=new an(e.toDer(),BigInt(+r)*BigInt(1e6),n),s=new Uint8Array([...Fs,...new Uint8Array(St({...o}))]),i=await t.sign(s);return{delegation:o,signature:i}}var Yn=class t{static async create(e,r,n=new Date(Date.now()+900*1e3),o={}){let s=await il(e,r,n,o.targets);return new t([...o.previous?.delegations||[],s],o.previous?.publicKey||e.getPublicKey().toDer())}static fromJSON(e){let{publicKey:r,delegations:n}=typeof e=="string"?JSON.parse(e):e;if(!Array.isArray(n))throw new Error("Invalid delegations.");let o=n.map(s=>{let{delegation:i,signature:a}=s,{pubkey:c,expiration:u,targets:l}=i;if(l!==void 0&&!Array.isArray(l))throw new Error("Invalid targets.");return{delegation:new an(Mi(c),BigInt("0x"+u),l&&l.map(d=>{if(typeof d!="string")throw new Error("Invalid target.");return L.fromHex(d)})),signature:Mi(a)}});return new this(o,Mi(r))}static fromDelegations(e,r){return new this(e,r)}constructor(e,r){this.delegations=e,this.publicKey=r}toJSON(){return{delegations:this.delegations.map(e=>{let{delegation:r,signature:n}=e,{targets:o}=r;return{delegation:{expiration:r.expiration.toString(16),pubkey:F(r.pubkey),...o&&{targets:o.map(s=>s.toHex())}},signature:F(n)}}),publicKey:F(this.publicKey)}}},zn=class extends Jt{static fromDelegation(e,r){return new this(e,r)}constructor(e,r){super(),this._inner=e,this._delegation=r}getDelegation(){return this._delegation}getPublicKey(){return{derKey:this._delegation.publicKey,toDer:()=>this._delegation.publicKey}}sign(e){return this._inner.sign(e)}async transformRequest(e){let{body:r,...n}=e,o=await St(r);return{...n,body:{content:r,sender_sig:await this.sign(new Uint8Array([...An,...new Uint8Array(o)])),sender_delegation:this._delegation.delegations,sender_pubkey:this._delegation.publicKey}}}},Wn=class t extends ds{#e;get delegation(){return this.#e}constructor(e,r){super(e),this.#e=r}static fromDelegation(e,r){return new t(e,r)}};function Li(t,e){for(let{delegation:o}of t.delegations)if(+new Date(Number(o.expiration/BigInt(1e6)))<=+Date.now())return!1;let r=[],n=e?.scope;n&&(Array.isArray(n)?r.push(...n.map(o=>typeof o=="string"?L.fromText(o):o)):r.push(typeof n=="string"?L.fromText(n):n));for(let o of r){let s=o.toText();for(let{delegation:i}of t.delegations){if(i.targets===void 0)continue;let a=!0;for(let c of i.targets)if(c.toText()===s){a=!1;break}if(a)return!1}}return!0}var cf=["mousedown","mousemove","keydown","touchstart","wheel"],Xn=class{callbacks=[];idleTimeout=600*1e3;timeoutID=void 0;static create(e={}){return new this(e)}constructor(e={}){let{onIdle:r,idleTimeout:n=600*1e3}=e||{};this.callbacks=r?[r]:[],this.idleTimeout=n;let o=this._resetTimer.bind(this);window.addEventListener("load",o,!0),cf.forEach(function(i){document.addEventListener(i,o,!0)});let s=(i,a)=>{let c;return(...u)=>{let l=this,d=function(){c=void 0,i.apply(l,u)};clearTimeout(c),c=window.setTimeout(d,a)}};if(e?.captureScroll){let i=s(o,e?.scrollDebounce??100);window.addEventListener("scroll",i,!0)}o()}registerCallback(e){this.callbacks.push(e)}exit(){clearTimeout(this.timeoutID),window.removeEventListener("load",this._resetTimer,!0);let e=this._resetTimer.bind(this);cf.forEach(function(r){document.removeEventListener(r,e,!0)}),this.callbacks.forEach(r=>r())}_resetTimer(){let e=this.exit.bind(this);window.clearTimeout(this.timeoutID),this.timeoutID=window.setTimeout(e,this.idleTimeout)}};var al=(t,e)=>e.some(r=>t instanceof r),ff,uf;function cl(){return ff||(ff=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fl(){return uf||(uf=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var df=new WeakMap,Fi=new WeakMap,lf=new WeakMap,qi=new WeakMap,Vi=new WeakMap;function ul(t){let e=new Promise((r,n)=>{let o=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{r(yt(t.result)),o()},i=()=>{n(t.error),o()};t.addEventListener("success",s),t.addEventListener("error",i)});return e.then(r=>{r instanceof IDBCursor&&df.set(r,t)}).catch(()=>{}),Vi.set(e,t),e}function dl(t){if(Fi.has(t))return;let e=new Promise((r,n)=>{let o=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{r(),o()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)});Fi.set(t,e)}var $i={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return Fi.get(t);if(e==="objectStoreNames")return t.objectStoreNames||lf.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return yt(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function hf(t){$i=t($i)}function ll(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){let n=t.call(ls(this),e,...r);return lf.set(n,e.sort?e.sort():[e]),yt(n)}:fl().includes(t)?function(...e){return t.apply(ls(this),e),yt(df.get(this))}:function(...e){return yt(t.apply(ls(this),e))}}function hl(t){return typeof t=="function"?ll(t):(t instanceof IDBTransaction&&dl(t),al(t,cl())?new Proxy(t,$i):t)}function yt(t){if(t instanceof IDBRequest)return ul(t);if(qi.has(t))return qi.get(t);let e=hl(t);return e!==t&&(qi.set(t,e),Vi.set(e,t)),e}var ls=t=>Vi.get(t);function mf(t,e,{blocked:r,upgrade:n,blocking:o,terminated:s}={}){let i=indexedDB.open(t,e),a=yt(i);return n&&i.addEventListener("upgradeneeded",c=>{n(yt(i.result),c.oldVersion,c.newVersion,yt(i.transaction),c)}),r&&i.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),o&&c.addEventListener("versionchange",u=>o(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}var pl=["get","getKey","getAll","getAllKeys","count"],ml=["put","add","delete","clear"],ji=new Map;function pf(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(ji.get(e))return ji.get(e);let r=e.replace(/FromIndex$/,""),n=e!==r,o=ml.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||pl.includes(r)))return;let s=async function(i,...a){let c=this.transaction(i,o?"readwrite":"readonly"),u=c.store;return n&&(u=u.index(a.shift())),(await Promise.all([u[r](...a),o&&c.done]))[0]};return ji.set(e,s),s}hf(t=>({...t,get:(e,r,n)=>pf(e,r)||t.get(e,r,n),has:(e,r)=>!!pf(e,r)||t.has(e,r)}));var yf="auth-client-db",bf="ic-keyval",yl=async(t=yf,e=bf,r)=>(hs&&localStorage?.getItem(st)&&(localStorage.removeItem(st),localStorage.removeItem(it)),await mf(t,r,{upgrade:n=>{n.objectStoreNames.contains(e)&&n.clear(e),n.createObjectStore(e)}}));async function bl(t,e,r){return await t.get(e,r)}async function gl(t,e,r,n){return await t.put(e,n,r)}async function wl(t,e,r){return await t.delete(e,r)}var Jn=class t{_db;_storeName;static async create(e){let{dbName:r=yf,storeName:n=bf,version:o=gf}=e??{},s=await yl(r,n,o);return new t(s,n)}constructor(e,r){this._db=e,this._storeName=r}async set(e,r){return await gl(this._db,this._storeName,e,r)}async get(e){return await bl(this._db,this._storeName,e)??null}async remove(e){return await wl(this._db,this._storeName,e)}};var it="identity",st="delegation",wf="iv",gf=1,hs=typeof window<"u",Qn=class{prefix;_localStorage;constructor(e="ic-",r){this.prefix=e,this._localStorage=r}get(e){return Promise.resolve(this._getLocalStorage().getItem(this.prefix+e))}set(e,r){return this._getLocalStorage().setItem(this.prefix+e,r),Promise.resolve()}remove(e){return this._getLocalStorage().removeItem(this.prefix+e),Promise.resolve()}_getLocalStorage(){if(this._localStorage)return this._localStorage;let e=typeof window>"u"?typeof global>"u"?typeof self>"u"?void 0:self.localStorage:global.localStorage:window.localStorage;if(!e)throw new Error("Could not find local storage.");return e}},eo=class{#e;constructor(e){this.#e=e??{}}initializedDb;get _db(){return new Promise(e=>{if(this.initializedDb){e(this.initializedDb);return}Jn.create(this.#e).then(r=>{this.initializedDb=r,e(r)})})}async get(e){return await(await this._db).get(e)}async set(e,r){await(await this._db).set(e,r)}async remove(e){await(await this._db).remove(e)}};var xl=BigInt(1e9),_l=BigInt(3600),El=xl*_l,vl="https://identity.internetcomputer.org",Il="#authorize",Bl=BigInt(8)*El,Ki="ECDSA",Hi="Ed25519",Sl=500,Tl="UserInterrupt",ps=class{_identity;_key;_chain;_storage;idleManager;_createOptions;_idpWindow;_eventHandler;static async create(e={}){let r=e.storage??new eo,n=e.keyType??Ki,o=null;if(e.identity)o=e.identity;else{let c=await r.get(it);if(!c&&hs)try{let u=new Qn,l=await u.get(st),d=await u.get(it);l&&d&&n===Ki&&(console.log("Discovered an identity stored in localstorage. Migrating to IndexedDB"),await r.set(st,l),await r.set(it,d),c=l,await u.remove(st),await u.remove(it))}catch(u){console.error("error while attempting to recover localstorage: "+u)}if(c)try{typeof c=="object"?n===Hi&&typeof c=="string"?o=Cr.fromJSON(c):o=await Zn.fromKeyPair(c):typeof c=="string"&&(o=Cr.fromJSON(c))}catch{}}let s=new Qt,i=null;if(o)try{let c=await r.get(st);if(typeof c=="object"&&c!==null)throw new Error("Delegation chain is incorrectly stored. A delegation chain should be stored as a string.");e.identity?s=e.identity:c&&(i=Yn.fromJSON(c),Li(i)?"toDer"in o?s=Wn.fromDelegation(o,i):s=zn.fromDelegation(o,i):(await Gi(r),o=null))}catch(c){console.error(c),await Gi(r),o=null}let a;return e.idleOptions?.disableIdle?a=void 0:(i||e.identity)&&(a=Xn.create(e.idleOptions)),o||(n===Hi?(o=Cr.generate(),await r.set(it,JSON.stringify(o.toJSON()))):(e.storage&&n===Ki&&console.warn(`You are using a custom storage provider that may not support CryptoKey storage. If you are using a custom storage provider that does not support CryptoKey storage, you should use '${Hi}' as the key type, as it can serialize to a string`),o=await Zn.generate(),await r.set(it,o.getKeyPair()))),new this(s,o,i,r,a,e)}constructor(e,r,n,o,s,i,a,c){this._identity=e,this._key=r,this._chain=n,this._storage=o,this.idleManager=s,this._createOptions=i,this._idpWindow=a,this._eventHandler=c,this._registerDefaultIdleCallback()}_registerDefaultIdleCallback(){let e=this._createOptions?.idleOptions;!e?.onIdle&&!e?.disableDefaultIdleCallback&&this.idleManager?.registerCallback(()=>{this.logout(),location.reload()})}async _handleSuccess(e,r){let n=e.delegations.map(a=>({delegation:new an(a.delegation.pubkey,a.delegation.expiration,a.delegation.targets),signature:a.signature})),o=Yn.fromDelegations(n,e.userPublicKey),s=this._key;if(!s)return;this._chain=o,"toDer"in s?this._identity=Wn.fromDelegation(s,this._chain):this._identity=zn.fromDelegation(s,this._chain),this._idpWindow?.close();let i=this._createOptions?.idleOptions;!this.idleManager&&!i?.disableIdle&&(this.idleManager=Xn.create(i),this._registerDefaultIdleCallback()),this._removeEventListener(),delete this._idpWindow,this._chain&&await this._storage.set(st,JSON.stringify(this._chain.toJSON())),r?.(e)}getIdentity(){return this._identity}async isAuthenticated(){return!this.getIdentity().getPrincipal().isAnonymous()&&this._chain!==null&&Li(this._chain)}async login(e){let r=Al(this._createOptions?.loginOptions,e),n=r?.maxTimeToLive??Bl,o=new URL(r?.identityProvider?.toString()||vl);o.hash=Il,this._idpWindow?.close(),this._removeEventListener(),this._eventHandler=this._getEventHandler(o,{maxTimeToLive:n,...r}),window.addEventListener("message",this._eventHandler),this._idpWindow=window.open(o.toString(),"idpWindow",r?.windowOpenerFeatures)??void 0;let s=()=>{this._idpWindow&&(this._idpWindow.closed?this._handleFailure(Tl,r?.onError):setTimeout(s,Sl))};s()}_getEventHandler(e,r){return async n=>{if(n.origin!==e.origin)return;let o=n.data;switch(o.kind){case"authorize-ready":{let s={kind:"authorize-client",sessionPublicKey:new Uint8Array(this._key?.getPublicKey().toDer()),maxTimeToLive:r?.maxTimeToLive,allowPinAuthentication:r?.allowPinAuthentication,derivationOrigin:r?.derivationOrigin?.toString(),...r?.customValues};this._idpWindow?.postMessage(s,e.origin);break}case"authorize-client-success":try{await this._handleSuccess(o,r?.onSuccess)}catch(s){this._handleFailure(s.message,r?.onError)}break;case"authorize-client-failure":this._handleFailure(o.text,r?.onError);break;default:break}}}_handleFailure(e,r){this._idpWindow?.close(),r?.(e),this._removeEventListener(),delete this._idpWindow}_removeEventListener(){this._eventHandler&&window.removeEventListener("message",this._eventHandler),this._eventHandler=void 0}async logout(e={}){if(await Gi(this._storage),this._identity=new Qt,this._chain=null,e.returnTo)try{window.history.pushState({},"",e.returnTo)}catch{window.location.href=e.returnTo}}};async function Gi(t){await t.remove(it),await t.remove(st),await t.remove(wf)}function Al(t,e){if(!t&&!e)return;let r=t?.customValues||e?.customValues?{...t?.customValues,...e?.customValues}:void 0;return{...t,...e,customValues:r}}var Ol=({IDL:t})=>t.Service({whoami:t.Func([],[t.Text],["query"]),link_sol_pubkey:t.Func([t.Text,t.Vec(t.Nat8)],[t.Text],[]),unlink_sol_pubkey:t.Func([],[t.Text],[]),get_deposit_address:t.Func([t.Text],[t.Text],["query"]),get_balance:t.Func([t.Text],[t.Nat64],[]),get_nonce:t.Func([t.Text],[t.Nat64],["query"]),get_pid:t.Func([t.Text],[t.Text],["query"]),get_sol_deposit_address:t.Func([t.Text],[t.Text],[]),get_sol_balance:t.Func([t.Text],[t.Nat64],[]),transfer:t.Func([t.Text,t.Nat64,t.Text,t.Vec(t.Nat8),t.Nat64],[t.Text],[]),transfer_sol:t.Func([t.Text,t.Nat64,t.Text,t.Vec(t.Nat8),t.Nat64],[t.Text],[]),get_sol_deposit_address_ii:t.Func([],[t.Text],[]),get_deposit_address_ii:t.Func([],[t.Text],[]),get_sol_balance_ii:t.Func([],[t.Nat64],[]),get_balance_ii:t.Func([],[t.Nat64],[]),get_nonce_ii:t.Func([],[t.Nat64],[]),transfer_ii:t.Func([t.Text,t.Nat64],[t.Text],[]),transfer_sol_ii:t.Func([t.Text,t.Nat64],[t.Text],[])}),xf=Ol;var Cl="https://ic0.app",Rl="f4kcz-fqaaa-aaaap-an3hq-cai",Lt=null,xs=null,_f=null,we=null,Le=null,ge=null;function gs(t,e){document.getElementById(t).style.display=e?"block":"none"}function re(t,e){document.getElementById(t).innerText=e}function fn(t,e){let r=document.getElementById("alerts");r.className=t,r.textContent=e||""}var Rr=t=>fn("ok",t),ne=t=>fn("warn",t),ar=t=>fn("err",t),Mt=t=>fn("muted",t);function qt(t){let e=(t?.message||String(t||"")).trim();return/Request timed out after 300000 msec/i.test(e)?"Request timed out. This may be due to network delays or consensus issues. Retry in a few seconds, or check balances later as the TX may still complete.":/processing/i.test(e)&&/Request ID:/i.test(e)?"The network is processing the call. Refresh balances shortly.":/inconsistent/i.test(e)||/consensus/i.test(e)?"Network variance prevented consensus. Retry the operation.":/blockhash/i.test(e)?"Blockhash retrieval failed; network may be busy. Retry.":e}function $e(t,e){return t().catch(r=>{let n=qt(r);throw e?e(n,r):ar(n),r})}async function no(){_f=new Or({host:Cl,identity:xs??void 0}),we=us.createActor(xf,{agent:_f,canisterId:Rl})}async function oo(){Lt||(Lt=await ps.create())}function Nl(){if("phantom"in window){let t=window.phantom?.solana;if(t?.isPhantom)return t}window.open("https://phantom.app/","_blank")}var un=Nl(),to=1e-4,ro=2e-4,ms=1e-4,ys=2e-4,bs=5e-6,Pl=BigInt(Math.round(to*1e8)),Ul=BigInt(Math.round(ro*1e8)),Zi=0,Yi=!1,zi=0,Wi=!1,ws=1e4;async function Ef(t=!1){let e=Date.now();if(!t&&e-Zi<ws){let n=Math.ceil((ws-(e-Zi))/1e3);ne(`Please wait ~${n}s before refreshing SOL again.`);return}if(Yi){Mt("Refreshing SOL\u2026");return}Yi=!0;let r=document.getElementById("get_sol");r&&(r.disabled=!0);try{if(Le==="ii"){let n=await $e(()=>we.get_sol_balance_ii(),o=>ne(o));re("sol_balance",`SOL Balance: ${(Number(n)/1e9).toFixed(9)} SOL`),Mt("SOL balance updated.")}else if(Le==="phantom"){if(!ge)return ne("Connect Phantom first");let n=await $e(()=>we.get_sol_balance(ge),o=>ne(o));re("sol_balance",`SOL Balance: ${(Number(n)/1e9).toFixed(9)} SOL`),Mt("SOL balance updated.")}else ne("Pick an auth mode to refresh SOL.");Zi=Date.now()}finally{Yi=!1,r&&(r.disabled=!1)}}async function vf(t=!1){let e=Date.now();if(!t&&e-zi<ws){let n=Math.ceil((ws-(e-zi))/1e3);ne(`Please wait ~${n}s before refreshing ICP again.`);return}if(Wi){Mt("Refreshing ICP\u2026");return}Wi=!0;let r=document.getElementById("refresh_icp");r&&(r.disabled=!0);try{if(Le==="ii"){let n=await $e(()=>we.get_balance_ii(),o=>ne(o));re("balance",`ICP Balance: ${(Number(n)/1e8).toFixed(8)} ICP`),Mt("ICP balance updated.")}else if(Le==="phantom"){if(!ge)return ne("Connect Phantom first");let n=await $e(()=>we.get_balance(ge),o=>ne(o));re("balance",`ICP Balance: ${(Number(n)/1e8).toFixed(8)} ICP`),Mt("ICP balance updated.")}else ne("Pick an auth mode to refresh ICP.");zi=Date.now()}finally{Wi=!1,r&&(r.disabled=!1)}}async function cn(t=!1){await Promise.allSettled([vf(t),Ef(t)])}function Dl(){gs("ii_block",!0),gs("phantom_block",!1),re("mode_status","Mode: Internet Identity"),fn("","")}function kl(){gs("phantom_block",!0),gs("ii_block",!1),re("mode_status","Mode: Phantom"),fn("","")}document.getElementById("mode_ii").onclick=async()=>{if(Le==="phantom"){try{await un.disconnect()}catch{}ge=null,["pubkey","sol_deposit","sol_balance"].forEach(t=>re(t,""))}Le="ii",await oo(),await no(),Dl()};document.getElementById("mode_phantom").onclick=async()=>{if(Le==="ii"){Lt||await oo();try{await Lt.logout()}catch{}xs=null}Le="phantom",await no(),kl()};document.getElementById("ii_login").onclick=async()=>{if(Le!=="ii")return alert("Switch to Internet Identity mode first");await oo();let t={identityProvider:"https://identity.ic0.app"};Lt.login({...t,maxTimeToLive:BigInt(7)*BigInt(1440*60*1e9),onSuccess:async()=>{xs=Lt.getIdentity(),await no();try{let e=await we.whoami();re("ii_status",`Signed in as: ${e}`);let r=await $e(()=>we.get_deposit_address_ii(),o=>ne(o));re("deposit",`ICP Deposit to: ${r}`);let n=await $e(()=>we.get_sol_deposit_address_ii(),o=>ne(o));re("sol_deposit",`SOL Deposit to: ${n}`),re("pid",`ICP Principal: ${e}`),await cn(!0),Rr("Logged in with Internet Identity.")}catch(e){re("ii_status","Signed in (fetch error)."),ne(qt(e))}},onError:e=>{ar(`II login failed: ${qt(e)}`)}})};document.getElementById("ii_logout").onclick=async()=>{await oo(),await Lt.logout(),xs=null,await no(),re("ii_status","Not signed in"),re("pid",""),Mt("Logged out of Internet Identity.")};document.getElementById("connect").onclick=async()=>{if(Le!=="phantom")return alert("Switch to Phantom mode first");try{ge=(await un.connect()).publicKey.toString(),re("pubkey",`Sol Pubkey: ${ge} (Solana Mainnet)`);let e=await $e(()=>we.get_deposit_address(ge),n=>ne(n));re("deposit",`ICP Deposit to: ${e} (Send ICP here)`);let r=await $e(()=>we.get_sol_deposit_address(ge),n=>ne(n));re("sol_deposit",`SOL Deposit to: ${r} (Mainnet; send SOL here)`),await cn(!0),Rr("Connected to Phantom.")}catch(t){ar(`Phantom connect error: ${qt(t)}`)}};document.getElementById("logout").onclick=async()=>{try{await un.disconnect()}catch{}ge=null,["pubkey","pid","deposit","balance","sol_deposit","sol_balance"].forEach(t=>re(t,"")),Mt("Disconnected Phantom. To prevent auto\u2011reconnect, revoke in Phantom settings.")};document.getElementById("link_wallet").onclick=async()=>{if(!ge)return alert("Connect Phantom first");try{if(Lt||await oo(),!await Lt.isAuthenticated())return alert("Login with Internet Identity (II mode) to link");let e=`link ${await we.whoami()}`,r=new TextEncoder().encode(e),o=(await un.signMessage(r,"utf8")).signature,s=await $e(()=>we.link_sol_pubkey(ge,Array.from(o)));Rr(s)}catch(t){ar(`Link error: ${qt(t)}`)}};document.getElementById("send").onclick=async()=>{let t=document.getElementById("to").value,e=document.getElementById("amount").value;if(isNaN(parseFloat(e))||parseFloat(e)<0)return alert("Invalid amount");let r=BigInt(Math.round(parseFloat(e)*1e8));if(Le==="ii"){let n=parseFloat(e)+ys+to,o=`Confirm transaction (II mode):
To: ${t}
Amount: ${e} ICP
Network fee: ${ys} ICP
Service fee: ${to} ICP
Total deduction: ${n.toFixed(8)} ICP`;if(!window.confirm(o))return;let s=document.getElementById("send");s.disabled=!0,s.innerText="Processing... (may take 30s)";try{let i=await $e(()=>we.transfer_ii(t,r),u=>ne(u)),a=i.match(/block (\d+)/),c=a?a[1]:"";re("status",`${i}${c?` View on Dashboard: https://dashboard.internetcomputer.org/block/${c}`:""}`),await cn(!0),i.startsWith("Transfer successful")?(document.getElementById("to").value="",document.getElementById("amount").value="",Rr("ICP transfer complete. Balances updated.")):ne(i)}catch(i){ar(`ICP send error: ${qt(i)}`)}finally{s.disabled=!1,s.innerText="Send ICP"}return}if(Le==="phantom"){if(!ge)return alert("Connect Phantom first");let n=await we.get_nonce(ge),s=parseFloat(e)+ys+to,i=`Confirm transaction (Phantom mode):
To: ${t}
Amount: ${e} ICP
Network fee: ${ys} ICP
Service fee: ${to} ICP
Total deduction: ${s.toFixed(8)} ICP`;if(!window.confirm(i))return;let a=`transfer to ${t} amount ${r} nonce ${n} service_fee ${Pl}`,c=new TextEncoder().encode(a),u=document.getElementById("send");u.disabled=!0,u.innerText="Processing... (may take 30s)";try{let d=(await un.signMessage(c,"utf8")).signature,f=await $e(()=>we.transfer(t,r,ge,Array.from(d),n),m=>ne(m)),h=f.match(/block (\d+)/),p=h?h[1]:"";re("status",`${f}${p?` View on Dashboard: https://dashboard.internetcomputer.org/block/${p}`:""}`),await cn(!0),f.startsWith("Transfer successful")?(document.getElementById("to").value="",document.getElementById("amount").value="",Rr("ICP transfer complete. Balances updated.")):ne(f)}catch(l){ar(`ICP send error: ${qt(l)}`)}finally{u.disabled=!1,u.innerText="Send ICP"}}};document.getElementById("get_sol").onclick=async()=>{await Ef(!1)};document.getElementById("refresh_icp").onclick=async()=>{await vf(!1)};document.getElementById("send_sol").onclick=async()=>{let t=document.getElementById("to_sol").value,e=document.getElementById("amount_sol").value;if(isNaN(parseFloat(e))||parseFloat(e)<0)return alert("Invalid amount");let r=BigInt(Math.round(parseFloat(e)*1e9));if(Le==="ii"){let n=parseFloat(e)+bs,o=ro+ms,s=`Confirm SOL transaction (II mode):
To: ${t}
Amount: ${e} SOL
Solana fee: ~${bs} SOL
ICP ledger fee: ${ms} ICP
Service fee: ${ro} ICP
Total SOL deduction: ${n.toFixed(9)} SOL
Total ICP deduction: ${o.toFixed(4)} ICP`;if(!window.confirm(s))return;let i=document.getElementById("send_sol");i.disabled=!0,i.innerText="Processing... (may take 30s)";try{let a=await $e(()=>we.transfer_sol_ii(t,r),l=>ne(l)),c=a.match(/txid (.+)/),u=c?c[1]:"";re("status",`${a}${u?` View on Solana FM: https://solana.fm/tx/${u}`:""}`),await cn(!0),a.startsWith("Transfer successful")?(document.getElementById("to_sol").value="",document.getElementById("amount_sol").value="",Rr("SOL transfer submitted. Balances updated.")):ne(a)}catch(a){ar(`SOL send error: ${qt(a)}`)}finally{i.disabled=!1,i.innerText="Send SOL"}return}if(Le==="phantom"){if(!ge)return alert("Connect first");let n=await we.get_nonce(ge),s=parseFloat(e)+bs,i=ro+ms,a=`Confirm SOL transaction (Phantom mode):
To: ${t}
Amount: ${e} SOL
Solana fee: ~${bs} SOL
ICP ledger fee: ${ms} ICP
Service fee: ${ro} ICP
Total SOL deduction: ${s.toFixed(9)} SOL
Total ICP deduction: ${i.toFixed(4)} ICP`;if(!window.confirm(a))return;let c=`transfer_sol to ${t} amount ${r} nonce ${n} service_fee ${Ul}`,u=new TextEncoder().encode(c),l=document.getElementById("send_sol");l.disabled=!0,l.innerText="Processing... (may take 30s)";try{let f=(await un.signMessage(u,"utf8")).signature,h=await $e(()=>we.transfer_sol(t,r,ge,Array.from(f),n),g=>ne(g)),p=h.match(/txid (.+)/),m=p?p[1]:"";re("status",`${h}${m?` View on Solana FM: https://solana.fm/tx/${m}`:""}`),await cn(!0),h.startsWith("Transfer successful")?(document.getElementById("to_sol").value="",document.getElementById("amount_sol").value="",Rr("SOL transfer submitted. Balances updated.")):ne(h)}catch(d){ar(`SOL send error: ${qt(d)}`)}finally{l.disabled=!1,l.innerText="Send SOL"}}};await no();re("mode_status","Pick a mode: Internet Identity or Phantom");Mt("Ready.");
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/abstract/bls.js:
@noble/curves/esm/abstract/tower.js:
@noble/curves/esm/bls12-381.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
